/*! CreditChina | 2016 Baidu Inc. All Rights Reserved. */
define("template/ReadModel",["require","er/util","ub-ria/mvc/ReadModel","./Data","common/GlobalData","./enum"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/ReadModel"),n=require("./Data"),r=require("common/GlobalData");t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:"模板管理",href:"#/template/list"},{text:e.get("title")}];return t}};var o=require("./enum").Type,a=require("./enum").CreditType,s=require("./enum").ShardingLevel,l=require("./enum").ObjectType;return e.prototype.prepare=function(){i.prototype.prepare.apply(this,arguments),this.fill(this.get("template")),this.set("type",o.valueIndex[this.get("type")].text),this.set("creditType",a.valueIndex[this.get("creditType")].text),this.set("shardingLevel",s.valueIndex[this.get("shardingLevel")].text),this.set("objectType",l.valueIndex[this.get("objectType")].text),this.set("list",t.parseJSON(this.get("schemaFields")))},e}),define("template/ReadView",["require","er/util","ub-ria/mvc/ReadView","tpl!8ab58a8b.tpl.html","./enum","common/layout"],function(require){function e(){n.apply(this,arguments)}function t(e){return e?"是":"否"}var i=require("er/util"),n=require("ub-ria/mvc/ReadView");require("tpl!8ab58a8b.tpl.html"),i.inherits(e,n),e.prototype.template="templateRead";var r=require("./enum").DataType,o=require("common/layout").getExtractInfo,a=[{title:"模板项目",field:"name",minWidth:90,content:function(e){return o(e.name,"template-item")}},{title:"将模板项指定为：",field:"tplType",minWidth:130,content:function(e){return e.tplType}},{title:"数据类型",field:"type",content:function(e){return r.valueIndex[e.type].text}},{title:"长度",field:"length",content:function(e){return e.length}},{title:"是否必填",field:"required",content:function(e){return t(e.required)}},{title:"列表显示",field:"listed",content:function(e){return t(e.listed)}}];return e.prototype.uiProperties={table:{fields:a,select:!1,width:700}},e}),define("template/Read",["require","er/util","./config","ub-ria/mvc/ReadAction","./ReadView","./ReadModel"],function(require){function e(){n.apply(this,arguments)}var t=require("er/util"),i=require("./config"),n=require("ub-ria/mvc/ReadAction");return t.inherits(e,n),e.prototype.group="unknown",e.prototype.entityDescription=i.description,e.prototype.viewType=require("./ReadView"),e.prototype.modelType=require("./ReadModel"),e}),define("template/ListView",["require","underscore","er/util","esui/lib","ub-ria/mvc/ListView","tpl!8ab58a8b.tpl.html","common/enum","./enum","common/layout","esui/Table","common/util/fixedbugtable"],function(require){function e(){d.apply(this,arguments)}function t(e){var t=f.valueIndex[e.status].alias;if("INACTIVE"===t||"DISABLE"===t)return!0;else return!1}function i(e){var t=f.valueIndex[e.status].alias;if("ACTIVE"===t)return!0;else return!1}function n(e,i){if(0===e.length)return!1;var n=!0;return l.each(e,function(e){if(!t(i[e]))n=!1}),n}function r(e,t){if(0===e.length)return!1;var n=!0;return l.each(e,function(e){if(!i(t[e]))n=!1}),n}function o(e,t){if(0===e.length)return!1;else return!0}function a(e){this.fire("transitStatus",{targetStatus:e.name,indexes:[e.args],allEntities:e.target.datasource})}function s(e){if(!this.model.get("isChildAction")){var t=this.getSafely("active"),i=this.getSafely("disable"),a=this.getSafely("remove");t.helper.clearDOMEvents(),i.helper.clearDOMEvents(),a.helper.clearDOMEvents();var s=e.selectedIndex,l=e.target.datasource;if(n(s,l))t.setDisabled(!1),t.helper.addDOMEvent(t.main,"click",c.bind(function(){this.fire("transitStatus",{indexes:e.selectedIndex,allEntities:l,targetStatus:"active"})},this));else t.setDisabled(!0);if(r(s,l))i.setDisabled(!1),i.helper.addDOMEvent(i.main,"click",c.bind(function(){this.fire("transitStatus",{indexes:e.selectedIndex,allEntities:l,targetStatus:"disable"})},this));else i.setDisabled(!0);if(o(s,l))a.setDisabled(!1),a.helper.addDOMEvent(a.main,"click",c.bind(function(){this.fire("transitStatus",{indexes:e.selectedIndex,allEntities:l,targetStatus:"remove"})},this));else a.setDisabled(!0)}}var l=require("underscore"),u=require("er/util"),c=require("esui/lib"),d=require("ub-ria/mvc/ListView");require("tpl!8ab58a8b.tpl.html"),u.inherits(e,d),e.prototype.template="templateList",e.prototype.commandHandler=function(){};var f=require("common/enum").TemplateStatus,h=require("./enum").Type,p=require("./enum").CreditType,m=require("./enum").ObjectType,g=require("common/layout").getExtractInfo;return e.prototype.getUIProperties=function(){var e=this,n=this.uiProperties||{},r=[{title:"模板编号",field:"templateId",width:80,content:function(e){return e.templateId}},{title:"模板标题",field:"name",minWidth:180,content:function(t){if(e.model.get("isChildAction"))return g(t.name,"template-name");else return'<a href="#/template/view~id='+t.id+'">'+g(t.name,"template-name")+"</a>"}},{title:"部门",field:"department",minWidth:120,content:function(e){return g(e.department,"department")}},{title:"类别",field:"type",width:90,stable:!0,content:function(e){return h.valueIndex[e.type].text}},{title:"类型",field:"creditType",width:70,stable:!0,content:function(e){return p.valueIndex[e.creditType].text}},{title:"状态",field:"status",width:70,stable:!0,content:function(e){return f.valueIndex[e.status].text}},{title:"对象类型",field:"objType",width:"80",stable:!0,content:function(e){return m.valueIndex[e.objectType||0].text}},{title:"创建人",field:"creatorName",minWidth:75,content:function(e){return g(e.creatorName,"creator-name")}},{title:"创建时间",field:"creatorTime",minWidth:150,content:function(e){return e.creatorTime}}];if(!this.model.get("isChildAction"))r.push({title:"操作",field:"operation",minWidth:150,content:function(e,n){var r=[],o=f.valueIndex[e.status].alias;if(t(e))r.push({text:"启用",type:"active",command:"active",args:""+n});if(i(e))r.push({text:"禁用",type:"disable",command:"disable",args:""+n});if("INACTIVE"===o)r.push({text:"编辑",url:"#/template/update~id="+e.id});r.push({text:"删除",type:"remove",command:"remove",args:""+n});var a=require("esui/Table");return a.operations(r)}});if(n.table.fields=r,this.model.get("isChildAction"))n.table.select="single";else n.table.select="multi";return n},e.prototype.uiProperties={table:{fields:[],selectMode:"line"},pager:{pageSizes:[100],pageSize:100}},e.prototype.uiEvents={"table:select":s,"table:command":a},e.prototype.bindEvents=function(){d.prototype.bindEvents.apply(this,arguments);var e=require("common/util/fixedbugtable");e.fixedbugToWidth.call(this)},e}),define("template/ListModel",["require","underscore","er/util","ub-ria/mvc/BaseModel","ub-ria/mvc/ListModel","./Data","common/GlobalData","common/enum","./enum","er/datasource"],function(require){function e(){n.apply(this,arguments),this.addData(new o),this.addData("global",a.getInstance())}var t=require("underscore"),i=require("er/util"),n=require("ub-ria/mvc/BaseModel"),r=require("ub-ria/mvc/ListModel"),o=require("./Data"),a=require("common/GlobalData");i.inherits(e,r);var s=require("common/enum").TemplateStatus,l=require("./enum").Type,u=require("./enum").CreditType,c=require("er/datasource");return e.prototype.datasource={crumbPath:c.constant([{text:"模板管理"}]),useTableCommand:c.constant(!0),initData:[{departments:function(e){var t=e.data("global").getUserProperty("userId");return e.getDepartments(t)}},{departmentId:function(e){var i=[];if(e.data("global").getUserProperty("authorityAlias").SUPER)i.push({text:"全部部门",value:-1});var n=-1;if(t.each(e.get("departments"),function(e,t){if(i.push({text:e.name,value:e.id}),e.belonged)n=e.id}),e.set("departments",i),e.get("departmentId"))return e.get("departmentId");else return n}},{results:{retrieve:function(e){t.each(e.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},e);var i=e.getQuery();return i=t.purify(i,null,!0),e.search(i)},dump:!0}}],types:c.constant([{text:"所有类别",value:-1},l.fromAlias("BAD"),l.fromAlias("GOOD"),l.fromAlias("BASE"),l.fromAlias("DISHONESTY")]),creditTypes:c.constant([{text:"所有类型",value:-1},u.fromAlias("JUDGE"),u.fromAlias("PUNISH"),u.fromAlias("REWARD")])},e.prototype.defaultArgs={orderBy:"creatorTime",order:"desc"},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=r.prototype.getQuery.apply(this,arguments);if(e.departmentId=this.get("departmentId"),e.type=this.get("type"),e.creditType=this.get("creditType"),this.get("isChildAction"))e.status=s.ACTIVE;else delete e.status;return e},e.prototype.getDepartments=function(e){return this.data().getDepartments({userId:e})},e.prototype.transitStatus=function(e,t){return this.data().transitStatus({ids:e,status:t})},e}),define("template/List",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","ub-ria/mvc/handler/ToastSubmitHandler","./ListModel","./ListView","common/enum"],function(require){function e(){a.apply(this,arguments)}function t(e){return function(t){if(t.failures&&t.failures.length>0){var i=n.filter(e,function(e,i){return n.indexOf(t.failures,e.id)>-1}),r=n.pluck(i,"name"),o=this.view.alert("操作完成，以下模板操作失败："+r.join("、"),"提示");o.on("ok",this.reload)}else{var a=new s;a.setTemplate("操作成功"),a.handle({},this),this.reload()}}}function i(e){var i=require("common/enum").TemplateStatus,r=i.aliasIndex[e.targetStatus.toUpperCase()].value,o=n.filter(e.allEntities,function(t,i){return n.indexOf(e.indexes,i+"")>-1}),a=n.pluck(o,"id");return this.view.waitConfirm("确认操作吗？","提示信息").then(n.bind(function(){this.model.transitStatus(a,r).then(n.bind(t(e.allEntities),this))},this))}var n=require("underscore"),r=require("er/util"),o=require("./config"),a=require("ub-ria/mvc/ListAction"),s=require("ub-ria/mvc/handler/ToastSubmitHandler");return r.inherits(e,a),e.prototype.group="unknown",e.prototype.entityDescription=o.description,e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("transitStatus",i,this)},e}),define("template/FormView",["require","underscore","er/util","ub-ria/util","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html","./enum","common/layout","esui/Table"],function(require){function e(){a.apply(this,arguments)}function t(e){var t={};switch(s[e.target.getValue()]){case"GOOD":t.hidden=!1,t.datasource=[{text:"请选择",value:""},l.fromAlias("REWARD")];break;case"BAD":case"DISHONESTY":t.hidden=!1,t.datasource=[{text:"请选择",value:""},l.fromAlias("JUDGE"),l.fromAlias("PUNISH")];break;case"BASE":t.hidden="hidden",t.datasource=[{text:"请选择",value:"0"}],t.value="0"}var i=this.get("creditType");i.getValidityLabel().main.innerHTML="",i.setProperties(t)}function i(e){return e?"是":"否"}function n(e){this.fire("create",{args:e.args})}function r(e){this.fire(e.name,{index:e.args,entities:e.target.datasource})}var o=(require("underscore"),require("er/util")),a=(require("ub-ria/util"),require("ub-ria/mvc/FormView"));require("tpl!8ab58a8b.tpl.html"),o.inherits(e,a);var s=require("./enum").Type,l=require("./enum").CreditType;e.prototype.template="templateForm",e.prototype.getEntity=function(){var e=a.prototype.getEntity.apply(this,arguments);return e.schemaFields=this.get("table").datasource,e};var u=require("./enum").DataType,c=require("common/layout").getExtractInfo,d=[{title:"模板项目",field:"name",minWidth:90,content:function(e){return c(e.name,"template-item")}},{title:"将模板项指定为：",field:"tplType",minWidth:130,content:function(e){return e.tplType}},{title:"数据类型",field:"type",content:function(e){return u.valueIndex[e.type].text}},{title:"长度",field:"length",content:function(e){return e.length}},{title:"是否必填",field:"required",content:function(e){return i(e.required)}},{title:"列表显示",field:"listed",content:function(e){return i(e.listed)}},{title:"操作",field:"name",minWidth:120,content:function(e,t){var i=[];if(!e.isFinal)i.push({text:"编辑",type:"modify",command:"modify",args:""+t}),i.push({text:"删除",type:"remove",command:"remove",args:""+t});var n=require("esui/Table");return n.operations(i)}}];return e.prototype.uiProperties={table:{fields:d,select:!1,width:700}},e.prototype.uiEvents={"type:change":t,"add:click":n,"table:command":r},e.prototype.bindEvents=function(){a.prototype.bindEvents.apply(this,arguments)},e.prototype.enterDocument=function(){a.prototype.enterDocument.apply(this,arguments);var e=s[this.model.get("type")];if("BASE"===e)this.get("creditType").setProperties({hidden:"hidden",datasource:[{text:"请选择",value:"0"}],value:"0"})},e}),define("template/FormModel",["require","underscore","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData","er/datasource","er/Deferred","./enum"],function(require){function e(){o.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance()),this.setValidator()}function t(e,t){var i=[],r=[];n.map(t,function(t){if(-1===n.indexOf(e,t))i.push(t);if(n.indexOf(e,t)!==n.lastIndexOf(e,t))r.push(t)});var o="";if(i.length)o+=i.join(",")+"项没有指定，请检查并指定！";if(r.length)o+=r.join(",")+"项重复指定，请核实！";return o}function i(e){var t=["姓名","身份证号","更新时间","归属地域","农户名称"],i=["nameField","idCardField","updateTimeField","regionField","nameField"],o=r.parseJSON(e.schemaFields);return n.map(t,function(t,r){var a=n.findWhere(o,{tplType:t});if(a){var s=i[r];e[s]=a.name}}),e}var n=require("underscore"),r=require("er/util"),o=require("ub-ria/mvc/FormModel"),a=require("./Data"),s=require("common/GlobalData"),l=require("er/datasource"),u=require("er/Deferred");r.inherits(e,o);var c=require("./enum").Type,d=require("./enum").CreditType,f=require("./enum").ShardingLevel,h=require("./enum").ObjectType;return e.prototype.datasource={crumbPath:function(e){var t=[{text:"模板管理",href:"#/template/list"},{text:e.get("title")}];return t},types:l.constant([{text:"请选择",value:""},c.fromAlias("BAD"),c.fromAlias("GOOD"),c.fromAlias("BASE"),c.fromAlias("DISHONESTY")]),creditTypes:l.constant([{text:"请选择",value:""},d.fromAlias("JUDGE"),d.fromAlias("PUNISH"),d.fromAlias("REWARD")]),shardingLevels:l.constant([f.fromAlias("SOCIETY")]),objectTypes:l.constant([h.fromAlias("COMPANY"),h.fromAlias("PEOPLE")]),initCreate:{retrieve:function(e){if("create"===e.get("formType")){var t=e.data("global").getUserProperty("userId");return e.initCreate(t)}},dump:!0},list:function(){return[]},userList:l.constant([]),blacklistDataSource:function(e){return e.data("global").getSystemProperty("blacklistTpls")},entity:{retrieve:function(e){if("update"===e.get("formType"))return e.data().findById(e.get("id"));else return void 0},dump:!0}},e.prototype.prepare=function(){if(o.prototype.prepare.apply(this,arguments),this.get("template"))this.fill(this.get("template")),this.set("list",r.parseJSON(this.get("schemaFields")))},e.prototype.initCreate=function(e){return this.data().initCreate({userId:e})},e.prototype.fillEntity=function(e){return e.departmentId=this.get("departmentId"),e.schemaFields=JSON.stringify(e.schemaFields),e},e.prototype.validateEntity=function(e){var i=n.pluck(e.schemaFields,"tplType"),r="";if(1===e.objectType)r=t(i,["姓名","身份证号"]);else r=t(i,["农户名称"]);return r},e.prototype.update=function(e){var t=this.validateEntity(e);if(t)return u.rejected({global:t});else return e=this.fillEntity(e),e.id=this.get("id"),e.modifierId=this.data("global").getUserProperty("userId"),e.creatorId=this.data("global").getUserProperty("userId"),e=i(e),this.data().update(e)},e.prototype.create=function(e){var t=this.validateEntity(e);if(t)return u.rejected({global:t});else return e=this.fillEntity(e),e.creatorId=this.data("global").getUserProperty("userId"),e=i(e),this.data().save(e)},e}),define("template/Form",["require","underscore","ub-ria/mvc/FormAction","er/util","./config","ub-ria/mvc/handler/ToastSubmitHandler","ub-ria/mvc/handler/RedirectSubmitHandler","./FormModel","./FormView"],function(require){function e(){a.apply(this,arguments);var e=new u;e.setTemplate("操作成功"),e.setNextSubmitHandler(new c),this.setSubmitHandler(e)}function t(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}function i(e){var t=this.view.popActionDialog({url:"/template/createDetail",title:"新建模板项",actionOptions:{existEntities:this.model.get("list"),objectType:this.view.get("objectType").getValue()}});t["onaction@submit"]=o.bind(function(e){this.model.get("list").push(e.data),this.view.get("table").repaint([{name:"datasource"}],[]),t.dispose()},this),t["onaction@cancel"]=function(){t.dispose()}}function n(e){var t=e.entities[e.index],i=o.filter(this.model.get("list"),function(e){return e.name!==t.name}),n=this.view.popActionDialog({url:"/template/updateDetail",title:"编辑模板项",actionOptions:{index:e.index,entity:t,existEntities:i,objectType:this.view.get("objectType").getValue()}});n["onaction@submit"]=o.bind(function(e){this.model.get("list")[e.index]=e.data,this.view.get("table").repaint([{name:"datasource"}],[]),n.dispose()},this),n["onaction@cancel"]=function(){n.dispose()}}function r(e){this.model.get("list").splice(e.index,1),this.view.get("table").repaint([{name:"datasource"}],[])}var o=require("underscore"),a=require("ub-ria/mvc/FormAction"),s=require("er/util"),l=require("./config"),u=require("ub-ria/mvc/handler/ToastSubmitHandler"),c=require("ub-ria/mvc/handler/RedirectSubmitHandler");return s.inherits(e,a),e.prototype.group="unknown",e.prototype.entityDescription=l.description,e.prototype.modelType=require("./FormModel"),e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var i={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage(),skin:"china"};this.view.waitConfirm(i).then(o.bind(t,this))}else t.call(this)},e.prototype.getMethod=function(e){var t={create:"create",update:"update"};return t[e]||null},e.prototype.handleSubmitError=function(e){if(409===e.status)e=require("er/util").parseJSON(e.responseText);if(e.global)return this.view.alert(e.global),!0;else if(e.fields)return this.view.notifyErrors(e),!0;return!1},e.prototype.viewType=require("./FormView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("create",i,this),this.view.on("remove",r,this),this.view.on("modify",n,this)},e}),define("template/DetailFormView",["require","underscore","er/util","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=e.target.getData().name,n=i.pluck(this.model.get("existEntities"),"name");if(i.indexOf(n,t)>-1){e.preventDefault();var r={fields:[{field:"name",message:"模板项名称已存在"}]};this.notifyErrors(r)}}var i=require("underscore"),n=require("er/util"),r=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),n.inherits(e,r),e.prototype.template="detailTemplateForm",e.prototype.getEntity=function(){var e=r.prototype.getEntity.apply(this,arguments);return e.length=e.maxLength,e},e.prototype.uiProperties={},e.prototype.uiEvents={"form:aftervalidate":t},e}),define("template/DetailFormModel",["require","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData","er/datasource","./enum"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/FormModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("er/datasource");t.inherits(e,i);var a=require("./enum").DataType,s=[{text:"是",value:!0},{text:"否",value:!1}];return e.prototype.datasource={crumbPath:function(e){var t=[{text:"模板",href:"#/template/list"},{text:e.get("title")}];return t},types:o.constant([a.fromAlias("NUMBER"),a.fromAlias("TEXT"),a.fromAlias("DATE")]),tplTypes:function(e){var t=[{text:"不指定",value:"不指定"}];if("2"===e.get("objectType"))t.push({text:"农户名称",value:"农户名称"});else t=t.concat([{text:"姓名",value:"姓名"},{text:"身份证号",value:"身份证号"}]);return t=t.concat([{text:"更新时间",value:"更新时间"},{text:"归属地域",value:"归属地域"}])},requireds:o.constant(s),listeds:o.constant(s),entity:function(e){if("update"===e.get("formType"))e.fill(e.get("entity"))}},e}),define("template/DetailForm",["require","ub-ria/mvc/FormAction","er/util","./config","./DetailFormModel","./DetailFormView"],function(require){function e(){t.apply(this,arguments)}var t=require("ub-ria/mvc/FormAction"),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="unknown",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./DetailFormModel"),e.prototype.submit=function(e){var t=e.target.getEntity();this.fire("submit",{data:t,index:this.model.get("index")})},e.prototype.cancelEdit=function(){this.fire("cancel")},e.prototype.viewType=require("./DetailFormView"),e}),define("template/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/template/list",type:"template/List",title:"模板 - 列表",auth:["TEMPLATE_VIEW"]},{path:"/template/create",type:"template/Form",title:"新建模板",args:{formType:"create"},auth:["TEMPLATE_MODIFY"]},{path:"/template/update",type:"template/Form",title:"修改模板",args:{formType:"update"},auth:["TEMPLATE_MODIFY"]},{path:"/template/view",type:"template/Read",title:"查看模板信息",auth:["TEMPLATE_VIEW"]},{path:"/template/read",movedTo:"template/view"},{path:"/template/createDetail",type:"template/DetailForm",title:"新建模板项",args:{formType:"create"},auth:["TEMPLATE_MODIFY"]},{path:"/template/updateDetail",type:"template/DetailForm",title:"修改模板项",args:{formType:"update"},auth:["TEMPLATE_MODIFY"]}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"template",description:"模板"}}),define("siteMessage/SiteMessageListView",["require","underscore","er/util","esui/lib","ef/UIModel","ub-ria/mvc/ListView","./enum","tpl!8ab58a8b.tpl.html","common/layout","esui/Table"],function(require){function e(){o.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("esui/lib"),r=require("ef/UIModel"),o=require("ub-ria/mvc/ListView"),a=require("./enum").MessageType,s=require("./enum").AuditOpinion;require("tpl!8ab58a8b.tpl.html"),i.inherits(e,o),e.prototype.template="siteMessageList";var l=(require("./enum").Status,require("common/layout").getExtractInfo,[{title:"姓名",field:"messageName",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.id+'">'+e.messageName+"</div>"}},{title:"留言类型",field:"message_type",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){return a.getTextFromValue(e.messageType)}},{title:"发表时间",field:"createTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.createTime)return"";else return n.date.format(e.createTime,"YYYY-MM-DD")}},{title:"留言标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){if(e.isAudit)return'<div class="ellipsistext" title="'+e.title+'">'+e.title+"</div>";var t="#/site/update~from=list&id="+e.id,i=[{text:e.title,type:"update",url:t}],n=require("esui/Table");return'<div class="ellipsistext" style="margin-left:-9px;" title="'+e.title+'">'+n.operations(i)+"</div>"}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:120,stable:!0,content:function(e){if(e.isAudit)return'<div class="ellipsistext" title="'+e.title+'">查看</div>';var t="#/site/update~from=list&id="+e.id,i=[{text:"查看",type:"update",url:t}],n=require("esui/Table");return'<div class="ellipsistext" style="margin-left:-9px;" title="'+e.title+'">'+n.operations(i)+"</div>"}},{title:"审核意见",field:"suggestion",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){if(e.auditConclusion)return s.getTextFromValue(e.auditConclusion);else return""}}]);return e.prototype.getSearchArgs=function(){var e=this.get("filter"),i=e?e.getData():{};i.order=this.get("table").order,i.orderBy=this.get("table").orderBy;var n=this.get("keyword");if(n)i.keyword=t.trim(n.getValue());i.pageSize=this.get("pager").get("pageSize");var o=this.get("calendar").getRawValue();return i.beginTime=r.formatters.date(o.begin),i.endTime=r.formatters.date(o.end),i},e.prototype.tableFields=l,e}),define("siteMessage/SiteMessageListModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","ef/UIModel","er/datasource","./enum"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("ef/UIModel");t.inherits(e,i);var a=require("er/datasource"),s=require("./enum").MessageType;return e.prototype.datasource={crumbPath:a.constant([{text:"网站留言"}]),siteMessageType:a.constant([s.fromAlias("ALL"),s.fromAlias("CONSULT"),s.fromAlias("SUGGESTION"),s.fromAlias("OTHER")]),pageSize:function(e){return e.data("global").getPageSize()},date:{retrieve:function(e){var t=o.formatters.date(new Date),i=e.get("beginTime")||"2015-01-01",n=e.get("endTime")||t;return{date:i+","+n,dateRange:"2015-01-01,"+t}},dump:!0}},e.prototype.defaultArgs={},e.prototype.prepare=function(){},e.prototype.defaultArgs={orderBy:"create_time",order:"desc"},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments);delete e.status,e.beginTime=this.get("beginTime"),e.endTime=this.get("endTime");var t=this.get("messageType");if("-1"!==t)e.type=t;return e.order=this.get("order"),e.orderBy=this.get("orderBy"),e.keyword=this.get("keyword"),e},e.prototype.search=function(e){return this.data().getMessageList(e)},e}),define("siteMessage/SiteMessageList",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","./SiteMessageListModel","./SiteMessageListView"],function(require){function e(){n.apply(this,arguments)}var t=(require("underscore"),require("er/util")),i=require("./config"),n=require("ub-ria/mvc/ListAction");return t.inherits(e,n),e.prototype.group="unknown",e.prototype.entityDescription=i.description,e.prototype.modelType=require("./SiteMessageListModel"),e.prototype.viewType=require("./SiteMessageListView"),e}),define("siteMessage/ReadFormView",["require","underscore","etpl","er/util","esui/lib","ub-ria/mvc/FormView","common/permission","common/common","tpl!8ab58a8b.tpl.html","./enum"],function(require){function e(){r.apply(this,arguments)}function t(){this.fire("reload")}function i(e){var t=this,i=e.target.getSelectedItem().id,n={roleType:i};this.model.getPeople(n).then(function(e){var i=t.get("people");i.setProperties({datasource:e})})}var n=(require("underscore"),require("etpl"),require("er/util")),r=(require("esui/lib"),require("ub-ria/mvc/FormView"));require("common/permission"),require("common/common");return require("tpl!8ab58a8b.tpl.html"),n.inherits(e,r),e.prototype.template="readSiteMessageForm",e.prototype.getEntity=function(){var e=r.prototype.getEntity.apply(this,arguments);require("./enum").MessageType;return e.reviewId=this.model.get("id"),e.auditorId=this.get("role").getSelectedItem().id,e.auditConclusion=e.auditResult[0],e.auditOpinion=e.auditComment,e.reviewType=3,e.sendee=this.get("people").getSelectedItem().id,e},e.prototype.uiEvents={"reset:click":t,"role:change":i},e}),define("siteMessage/ReadFormModel",["require","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData","./enum"],function(require){function e(){n.apply(this,arguments),this.addData(new r),this.addData("global",o.getInstance())}var t=require("er/util"),i=require("esui/lib"),n=require("common/base/BaseModel"),r=require("./Data"),o=require("common/GlobalData");t.inherits(e,n);require("./enum");return e.prototype.datasource={crumbPath:function(e){var t=[{text:"网站留言",href:"#/site/list"},{text:"留言详情"}];return t},messageInfo:function(e){var t=e.get("id");return e.getMessageInfo(t).done(function(t){e.fill(t),e.set("channelName",t.messageName),e.set("profession",t.profession),e.set("telephone",t.telephone),e.set("email",t.email);var i=require("./enum").MessageType.getTextFromValue(t.messageType);e.set("messageType",i),e.set("title",t.title),e.set("content",t.emailContent)})},userName:function(e){return e.set("nowTime",i.date.format(new Date,"YYYY-MM-DD")),e.data("global").getUser().username},roles:function(e){return e.getRole()},peoples:function(e){return e.getPeople({roleType:2})}},e.prototype.getMessageInfo=function(e){var t=this.data();return t.getMessageInfo({messageId:e})},e.prototype.getRole=function(e){return this.data().getRole(e)},e.prototype.getPeople=function(e){return this.data().getPeople(e)},e}),define("siteMessage/ReadForm",["require","common/base/BaseForm","er/util","./config","er/Deferred","underscore","./ReadFormModel","./ReadFormView"],function(require){function e(){t.apply(this,arguments)}var t=require("common/base/BaseForm"),i=require("er/util"),n=require("./config"),r=require("er/Deferred"),o=require("underscore");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./ReadFormModel"),e.prototype.viewType=require("./ReadFormView"),e.prototype.submit=function(e){var t=this.view.getEntity();this.view.disableSubmit(),r.when(this.submitEntity(t)).ensure(o.bind(this.view.enableSubmit,this.view))},e.prototype.redirectAfterCancel=function(){this.redirect("/site/list")},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments);var e=this;this.setSubmitHandler({handle:function(){e.redirect("/site/list")}}),this.view.on("reload",function(){this.reload()},this)},e}),define("siteMessage/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.MessageType=new e({alias:"ALL",text:"留言类型",value:-1},{alias:"SUGGESTION",text:"改进建议",value:1},{alias:"CONSULT",text:"问题反馈",value:2},{alias:"OTHER",text:"其他",value:3}),exports.AuditOpinion=new e({alias:"ALL",text:"审核意见",value:-1},{alias:"TONGYI",text:"同意",value:1},{alias:"XIACHE",text:"下撤",value:2},{alias:"XIUGAI",text:"修改",value:3},{alias:"OTHER",text:"其他",value:4},{alias:"CAINA",text:"采纳",value:5},{alias:"HULUE",text:"忽略",value:6}),exports}),define("siteMessage/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"site")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={getMessageList:{name:"getMessageList",scope:"instance",policy:"auto",options:{method:"GET",url:"/siteMessage/getMessageList"}},getMessageInfo:{name:"getMessageInfo",scope:"instance",policy:"auto",options:{method:"GET",url:"/siteMessage/getMessageInfo"}},getRole:{name:"getRole",scope:"instance",policy:"auto",options:{method:"GET",url:"/siteMessage/findSendee"}},getPeople:{name:"getPeople",scope:"instance",policy:"auto",options:{method:"GET",url:"/siteMessage/getSendee"}},update:{name:"site/update",scope:"instance",policy:"auto",options:{method:"POST",url:"/siteMessage/saveMessageReview"}}};e.prototype.getMessageList=function(e){return this.request("getMessageList",e)},e.prototype.getMessageInfo=function(e){return this.request("getMessageInfo",e)},e.prototype.getChannelInfo=function(e){return this.request("getChannelInfo",e)},e.prototype.getRole=function(e){return this.request("getRole",e)},e.prototype.getPeople=function(e){return this.request("getPeople",e)};var o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("siteMessage/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/site/list",type:"siteMessage/SiteMessageList",title:"网站留言 - 列表",auth:["SITE_VIEW"]},{path:"/site/update",type:"siteMessage/ReadForm",title:"网站留言 - 详情",args:{formType:"update"},auth:["SITE_MODIFY"]}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"siteMessage",description:"网站留言"}}),define("role/ListView",["require","underscore","er/util","esui/lib","ub-ria/mvc/ListView","tpl!8ab58a8b.tpl.html"],function(require){function e(){s.apply(this,arguments)}function t(){var e=this,t=[];if(o.each(this.getSelectedItems(),function(e){t.push(e.id)}),t.length){var i=this.model.get("roleid"),n="undefined"!=typeof i?i:1,r=this.confirm("你确认要删除么？","提示信息");
r.on("ok",function(){e.fire("delete",{args:{ids:t,roletype:n}})})}}function i(e){var t=this,i=this.popActionDialog({url:e.url,title:e.title,width:500,actionOptions:e.options});i["onaction@ok"]=function(e){i.dispose(),t.fire("reload")},i["onaction@cancel"]=function(){i.dispose()}}function n(e){var t=e.target;t.main.blur();var n={url:"/role/create",title:"新增",options:{roleid:this.model.get("roleid")||1}};i.call(this,n)}function r(e){var t=e.args;switch(e.name){case"edit":var n={url:"/role/create",title:"编辑",options:{id:t,roleid:this.model.get("roleid")||1}};i.call(this,n)}}var o=require("underscore"),a=require("er/util"),s=(require("esui/lib"),require("ub-ria/mvc/ListView"));require("tpl!8ab58a8b.tpl.html"),a.inherits(e,s),e.prototype.template="roleList";var l=[{title:"姓名",field:"name",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.name}},{title:"账号",field:"loginName",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.loginName}},{title:"所属组织",field:"deptname",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.deptname}}];return e.prototype.tableFields=l,e.prototype.uiProperties={table:{fields:l}},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=o.trim(i.getValue());t.pageSize=this.get("pager").get("pageSize");var n=this.model.get("roleid");return t.roleid="undefined"!=typeof n?n:1,t},e.prototype.uiEvents={"delete:click":t,"create:click":n,"table:command":r},e}),define("role/ListModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","common/common","er/datasource"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("common/common");t.inherits(e,i),i.prototype.statusTransitions=[{status:0,deny:[0]},{status:1,deny:[1]}];var a=require("er/datasource");return e.prototype.datasource={crumbPath:function(e){var t=[{text:"角色设置"}];return t},useTableCommand:a.constant(!0),selectMode:a.constant("multi"),initChannel:function(e){var t=e.get("roleid");t="undefined"==typeof t?1:t,e.set("channel"+t,"active")},targetIdStr:function(){var e=o.getTargetId(),t="";if(e)t="&targetId="+e;return t}},e.prototype.defaultArgs={orderBy:"",order:""},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments),t=this.get("roleid");if("undefined"!=typeof t)e.roleid=t;else e.roleid=1;return e},e.prototype.remove=function(e){var t=this.data();return t.remove(e)},e}),define("role/List",["require","er/util","./config","ub-ria/mvc/ListAction","./ListModel","./ListView"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=e.args,i=this;this.model.remove(t).then(function(){i.reload()})}var i=require("er/util"),n=require("./config"),r=require("ub-ria/mvc/ListAction");return i.inherits(e,r),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.initBehavior=function(){r.prototype.initBehavior.apply(this,arguments),this.view.on("delete",t,this),this.view.on("reload",function(){this.reload()},this)},e}),define("role/FormView",["require","underscore","er/util","esui/lib","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){f.apply(this,arguments),p=this}function t(){var e=h.fn.zTree.getZTreeObj("treeUser"),t=e.getCheckedNodes(!0),i=[];return u.each(t,function(e){i.push(e.id)}),i}function i(e){var t=e.target,i=t.datasource,n=t.getValue(),r=[];u.each(n.split(","),function(e){u.each(i,function(t){if(t.value===e)r.push(t.title)})});var o,a=this.get("channels");if(r.length)o=r.join(","),a.setValue(r.join(","));else o="请选择",a.setValue("");d.g("select-channel").innerHTML=o}function n(e){var t=h.fn.zTree.getZTreeObj("treeUser");u.each(m,function(i){i.highlight=e,t.updateNode(i)})}function r(e){var t=e.target,i=t.getValue(),r=h.fn.zTree.getZTreeObj("treeUser");if(""===i)return r.expandAll(!1),void n(!1);else r.expandAll(!0);return r.expandAll(!0),n(!1),m=r.getNodesByParamFuzzy("name",i),void n(!0)}function o(e,t,i){var n=h.fn.zTree.getZTreeObj("treeUser");n.expandNode(i)}function a(e,t,i){var n=h.fn.zTree.getZTreeObj("treeUser"),r=n.getCheckedNodes(!0),o=[];u.each(r,function(e){o.push(e.name)});var a=o.join(",")||"请选择";p.fire("treeChange",o),d.g("select-user").innerHTML=a}function s(e,t){return t.highlight?{color:"#A60000",fontWeight:"bold"}:{color:"#333",fontWeight:"normal"}}function l(e){var t=e.data,i=this.get("users");i.setValue(t.join(","))}var u=require("underscore"),c=require("er/util"),d=require("esui/lib"),f=require("ub-ria/mvc/FormView"),h=jQuery;require("tpl!8ab58a8b.tpl.html");var p;c.inherits(e,f),e.prototype.template="roleForm",e.prototype.getEntity=function(){var e=f.prototype.getEntity.apply(this,arguments),i=this.model,n=i.get("id");if("undefined"!=typeof n)e.id=n;else e.ids=t(),e.roletype=i.get("roleid")||1;return e},e.prototype.uiProperties={},e.prototype.uiEvents={"boxGroup:change":i};var m,g,v={check:{enable:!0,nocheckInherit:!1},data:{simpleData:{enable:!0}},view:{showIcon:!1,dblClickExpand:!1,fontCss:s},callback:{onClick:o,onCheck:a}};return e.prototype.bindEvents=function(){f.prototype.bindEvents.apply(this,arguments),g=d.deepClone(this.model.get("userTree"));var e=this.model.get("id");if("undefined"==typeof e){var t=d.g("select-user"),i=this.get("selectUserPanel");d.on(t,"click",function(){d.toggleClass(this,"active"),i.toggleState("hidden")}),h.fn.zTree.init(h("#treeUser"),v,g);var n=this.get("searchUser");n.on("input",r,this),n.on("search",r,this),this.on("treeChange",l,this)}},e}),define("role/FormModel",["require","underscore","er/util","common/base/BaseModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=(require("underscore"),require("er/util")),i=require("common/base/BaseModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={userTree:function(e){var t=e.get("id");if("undefined"==typeof t)return e.getUserTree();else return void 0}},e.prototype.addUser=function(e){var t=this.data();return t.addUser(e)},e.prototype.updateChannel=function(e){var t=this.data();return t.updateChannel(e)},e.prototype.getChannelTree=function(e){var t=this.data();return t.getChannelTree(e)},e.prototype.getUserTree=function(){var e=this.data(),t={roleid:this.get("roleid")};return e.getUserTree(t)},e}),define("role/Form",["require","common/base/BaseForm","er/util","./config","./FormModel","./FormView"],function(require){function e(){t.apply(this,arguments)}var t=require("common/base/BaseForm"),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./FormModel"),e.prototype.viewType=require("./FormView"),e.prototype.submitEntity=function(e){var t=this;if("undefined"!=typeof e.id)this.model.updateChannel(e).then(function(){t.fire("ok",e)});else this.model.addUser(e).then(function(){t.fire("ok",e)})},e.prototype.cancelEdit=function(){this.fire("cancel")},e}),define("role/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports}),define("role/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"role")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={search:{name:"role/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/role/findUsers"}},list:{name:"role/list",scope:"instance",policy:"auto"},save:{name:"role/updateRole",scope:"instance",policy:"auto",options:{method:"POST",url:"/role/updateRole"}},update:{name:"role/updateChannel",scope:"instance",policy:"auto",options:{method:"POST",url:"/role/updateChannel"}},remove:{name:"role/delRole",scope:"instance",policy:"auto",options:{method:"POST",url:"/role/delRole"}},channelTree:{name:"role/getChannelTree",scope:"instance",policy:"auto",options:{method:"GET",url:"/role/getChannelTree"}},userTree:{name:"role/getUserTree",scope:"instance",policy:"auto",options:{method:"GET",url:"/role/getUserTree"}},tree:{name:"role/tree",scope:"instance",policy:"auto"}},o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e.prototype.remove=function(e){var t=this.request("role/delRole",e);return t},e.prototype.addUser=function(e){var t=this.request("role/updateRole",e);return t},e.prototype.updateChannel=function(e){var t=this.request("role/updateChannel",e);return t},e.prototype.getChannelTree=function(e){var t=this.request("role/getChannelTree",e);return t},e.prototype.getUserTree=function(e){var t=this.request("role/getUserTree",e);return t},e}),define("role/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/role/list",type:"role/List",title:"角色设置 - 列表",auth:["ROLE_VIEW"]},{path:"/role/create",type:"role/Form",title:"新建角色设置",args:{formType:"create"},auth:["ROLE_MODIFY"]},{path:"/role/update",type:"role/Form",title:"修改角色角色设置",args:{formType:"update"},auth:["ROLE_MODIFY"]},{path:"/role/view",type:"role/Read",title:"查看角色角色设置信息",auth:["ROLE_VIEW"]},{path:"/role/read",movedTo:"role/view"}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"role",description:"角色"}}),define("record/VerifyRecordView",["require","er/util","ub-ria/mvc/FormView","etpl","tpl!8ab58a8b.tpl.html","./enum"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=this,i=e.target.getSelectedItem().id,n={roleType:i};this.model.getPeople(n).then(function(e){var i=t.get("people");i.setProperties({datasource:e})})}var i=require("er/util"),n=require("ub-ria/mvc/FormView");require("etpl");require("tpl!8ab58a8b.tpl.html"),i.inherits(e,n),e.prototype.template="auditVerifyRecordForm",e.prototype.getEntity=function(){var e=n.prototype.getEntity.apply(this,arguments);return e.artId=this.model.get("id"),e.taskName=8,e.artStatus=this.model.get("status"),e.organization=this.model.get("departmentName"),e.reviewConclusion=this.get("auditResult").getValue(),e.reviewOpinion=e.auditComment,e.sendee=this.get("people").getSelectedItem().id,e};var r=require("./enum"),o=r.AuditLogFields;return e.prototype.uiProperties={recordHistoryTable:{fields:o,select:!1,width:850}},e.prototype.uiEvents={"role:change":t},e}),define("record/VerifyRecordModel",["require","underscore","er/util","ub-ria/mvc/FormModel","ef/UIModel","./Data","common/GlobalData","../template/Data"],function(require){function e(){i.apply(this,arguments),this.addData(new r),this.addData("global",o.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/FormModel"),n=require("ef/UIModel"),r=require("./Data"),o=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:"所有记录",href:"#/record/list"},{text:e.get("title")}];return t},auditName:function(e){return e.data("global").getUserProperty("userName")},approveDate:function(e){return n.formatters.date(new Date)},companyName:function(e){return e.get("name")},roles:function(e){return e.getRole({tagDetail:2})},peoples:function(e){return e.getPeople({roleType:8})},templateInfo:{retrieve:function(e){if(e.get("templateId")){var t=require("../template/Data");return(new t).findById(e.get("templateId"))}},dump:!0},entity:{retrieve:function(e){if(e.get("id")){var i={id:e.get("id")};return e.data().getRecord(i).then(function(i){e.set("content",t.parseJSON(i.record.content)),e.set("reviews",i.reviews)})}},dump:!0}},e.prototype.prepare=function(){!this.get("id")},e.prototype.saveVerify=function(e){return e.ids=this.get("ids")||[this.get("id")],e.auditId=this.data("global").getUserProperty("userId"),this.data().saveVerify(e)},e.prototype.getRole=function(e){return this.data().getRole(e)},e.prototype.getPeople=function(e){return this.data().getPeople(e)},e}),define("record/VerifyRecord",["require","underscore","ub-ria/mvc/FormAction","ub-ria/mvc/BaseAction","er/util","./config","er/Deferred","ub-ria/mvc/handler/ToastSubmitHandler","ub-ria/mvc/handler/RedirectSubmitHandler","./VerifyRecordModel","./VerifyRecordView","er/events"],function(require){function e(){s.apply(this,arguments)}function t(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}function i(e){var t=new f;t.setTemplate("操作成功"),t.handle(e,this);var i=this.fire("submitAudit");if(!i.isDefaultPrevented()){var n=new h,r="/record/list";n.setTemplate(r),n.handle(e,this)}}function n(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function r(e){var t=this.view.getEntity();this.view.disableSubmit(),d.when(this.submitEntity(t)).ensure(a.bind(this.view.enableSubmit,this.view))}function o(){var e=this.fire("cancelAudit");if(!e.isDefaultPrevented())this.cancelEdit()}var a=require("underscore"),s=require("ub-ria/mvc/FormAction"),l=require("ub-ria/mvc/BaseAction"),u=require("er/util"),c=require("./config"),d=require("er/Deferred"),f=require("ub-ria/mvc/handler/ToastSubmitHandler"),h=require("ub-ria/mvc/handler/RedirectSubmitHandler");return u.inherits(e,s),e.prototype.group="unknown",e.prototype.entityDescription=c.description,e.prototype.modelType=require("./VerifyRecordModel"),e.prototype.viewType=require("./VerifyRecordView"),e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var i={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage(),skin:"china"};this.view.waitConfirm(i).then(a.bind(t,this))}else t.call(this)},e.prototype.redirectAfterCancel=function(){this.back("/"+this.getEntityName()+"/list~templateId="+this.model.get("templateId"))},e.prototype.submitEntity=function(e){return this.model.saveVerify(e).then(a.bind(i,this),a.bind(n,this))},e.prototype.initBehavior=function(){l.prototype.initBehavior.apply(this,arguments),this.view.on("submit",r,this),this.view.on("cancel",o,this)},e}),define("record/ListView",["require","underscore","er/util","esui/lib","ef/UIModel","ub-ria/mvc/ListView","common/GlobalData","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","./enum","common/layout","esui/Table","common/enum","common/util/globalLoading","common/util/download","common/util/fixedbugtable"],function(require){function e(){v.apply(this,arguments)}function t(e,t,i){if(t.SUPER)return!0;if(t.UPLOAD)return!0;if(t.READONLY)return!0;if(t.SUPERVISION)return!0;else return void 0}function i(e){var t=this.popActionDialog({id:"dialog",url:"/template/list",width:960,title:"选择模板",needFoot:!0,options:{status:require("common/enum").TemplateStatus.ACTIVE}}),i=t.getFoot().getChild("btnOk"),n=t.getFoot().getChild("btnCancel");i.on("click",function(e){t.fire("selected")}),n.on("click",function(e){t.dispose()}),t.on("selected",function(e){var t=e.target.getAction(),i=t.getSelectItems();if(i.length<1)this.alert("请至少选择一个模板","错误");this.fire("tplSelected",{templates:i})},this)}function n(e){this.fire("changeRecordType",{recordType:e.tab.panel})}function r(e){switch(e.name){case"remove":var t={indexes:[e.args],allEntities:e.target.datasource,targetStatus:e.name};this.fire(e.name,t)}}function o(e){var t=this.getSafely("submit"),i=this.getSafely("remove");t.helper.clearDOMEvents(),i.helper.clearDOMEvents();var n=e.selectedIndex,r=e.target.datasource;if(l(n,r))t.setDisabled(!1),t.helper.addDOMEvent(t.main,"click",m.bind(function(){this.fire("submit",{indexes:e.selectedIndex,allEntities:r,targetStatus:"submit"})},this));else t.setDisabled(!0);if(u(n,r))i.setDisabled(!1),i.helper.addDOMEvent(i.main,"click",m.bind(function(){this.fire("remove",{indexes:e.selectedIndex,allEntities:r,targetStatus:"remove"})},this));else i.setDisabled(!0)}function a(e){var t=C.valueIndex[e.status].alias;return"SAVED"===t}function s(e){var t=C.valueIndex[e.status].alias;return"WAITING"!==t&&"DELETED"!==t}function l(e,t){if(0===e.length)return!1;var i=!0;return h.each(e,function(e){if(!a(t[e]))i=!1}),i}function u(e,t){if(0===e.length)return!1;var i=!0;return h.each(e,function(e){if(!s(t[e]))i=!1}),i}function c(e){var t=e.target.getSelectedItem();this.fire("tplSelected",{template:t})}function d(){var e=this,t=this.get("import"),i=t.helper.getId(),n=require("common/util/globalLoading");new y({trigger:"#"+i,accept:"application/msexcel",action:"/record/uploadExcel",name:"excelFile",left:86,top:0,data:{templateId:this.model.get("templateId"),departmentId:this.model.get("template").departmentId,creatorId:b.getInstance().getUser().userid},beforeUpload:function(e){n.show()}}).success(function(t){if(n.hide(),"string"==typeof t)t=p.parseJSON(t);var i=e.alert(t.message,"提示信息");i.on("ok",function(){e.fire("reload")})}).error(function(t){if(n.hide(),"string"==typeof t)t=p.parseJSON(t);var i=p.parseJSON(t.responseText);e.alert(i.message,"提示信息")})}function f(){var e=require("common/util/download"),t=this.model.get("templateId");e.iframePost("/template/outExcel","id="+t,"","window.downLoad")}var h=require("underscore"),p=require("er/util"),m=require("esui/lib"),g=require("ef/UIModel"),v=require("ub-ria/mvc/ListView"),y=window.Upload,b=require("common/GlobalData");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),p.inherits(e,v),e.prototype.template="recordList",e.prototype.commandHandler=function(){};var C=require("./enum").Status,E=require("common/layout").getExtractInfo;return e.prototype.getUIProperties=function(){var e=this.uiProperties||{},i=this;if(!this.model.get("templateId"))return e;var n=[{title:"序号",content:function(e){return e.id}},{title:"状态",minWidth:80,content:function(e){return C.valueIndex[e.status].text}}],r=p.parseJSON(this.model.get("template").schemaFields);h.each(r,function(e){if(e.listed){var t={title:e.name,content:function(t){return E(t.content[e.name]||"")}};n.push(t)}});var o=this.model.data("global").getUserProperty("userId"),a=this.model.data("global").getUserProperty("authorityAlias"),l=this.model.get("templateId"),u=this.model.get("isMine"),c={title:"操作",minWidth:100,content:function(e,i){var n=[],r="id="+e.id+"&templateId="+l;if(u&&(r+="&isMine=1"),!t(o,a,e))return"";if(s(e))n.push({text:"编辑",url:"#/record/update~"+r},{text:"删除",type:"remove",command:"remove",args:""+i});var c=require("esui/Table");return c.operations(n)}},d={title:"操作",minWidth:80,content:function(e,t){var n="#/record/verify~id="+e.id+"&departmentId="+i.model.get("departmentId")+"&templateId="+i.model.get("templateId"),r=[{text:"审核",url:n}],o=require("esui/Table");return o.operations(r)}};if(a.UPLOAD===!0)n.push(c);else if(a.READONLY===!0||a.SUPERVISION===!0)n.push(d);return e.table.fields=n,e},e.prototype.getSearchArgs=function(){var e={};if(e.templateId=this.model.get("templateId"),e.departmentId=this.model.get("departmentId"),this.model.get("isMine"))e.isMine=1;var t=this.get("keyword");if(t)e.keyword=h.trim(t.getValue());var i=this.get("calendar").getRawValue();if(e.beginTime=g.formatters.date(i.begin),e.endTime=g.formatters.date(i.end),e.status=this.get("status").getValue(),this.get("table"))e.order=this.get("table").order,e.orderBy=this.get("table").orderBy,e.pageSize=this.get("pager").get("pageSize");if(e.recordType=this.get("recordType").getValue(),e.status=this.get("status").getValue(),this.get("$templateId"))e.recordSource=this.get("recordSource").getValue(),e.templateId=this.get("templateId");return e},e.prototype.uiProperties={table:{select:"multi",selectMode:"line",breakLine:!0},pager:{pageSizes:[100],pageSize:100}},e.prototype.uiEvents={"switch:click":i,"tab:activate":n,"table:command":r,"table:select":o,"recordType:change":c},e.prototype.bindEvents=function(){if(v.prototype.bindEvents.apply(this,arguments),this.model.get("templateId")&&!this.model.get("READ_ONLY"))d.call(this),this.get("export").on("click",f,this);var e=require("common/util/fixedbugtable");e.fixedbugToWidth.call(this)},e.prototype.enterDocument=function(){if(v.prototype.enterDocument.apply(this,arguments),this.model.get("templateId"))this.get("status").setDisabled(!1),this.get("recordSource").setDisabled(!1)},e}),define("record/ListModel",["require","underscore","er/util","ub-ria/mvc/BaseModel","ub-ria/mvc/ListModel","./Data","common/GlobalData","ef/UIModel","moment","er/datasource","./enum","department/Data","template/Data"],function(require){function e(){r.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance())}function t(){var e=u(new Date).format("YYYY-MM-DD"),t=u(e),i=t.clone().subtract("day",7).toDate(),n=t.clone().subtract("day",0).subtract("second",1).toDate();return i=u(i).format("YYYY-MM-DD HH:mm:ss"),n=u(n).format("YYYY-MM-DD HH:mm:ss"),{begin:i,end:n}}var i=require("underscore"),n=require("er/util"),r=require("ub-ria/mvc/BaseModel"),o=require("ub-ria/mvc/ListModel"),a=require("./Data"),s=require("common/GlobalData"),l=require("ef/UIModel"),u=require("moment");n.inherits(e,o);var c=require("er/datasource"),d=require("./enum").Status;return e.prototype.datasource={crumbPath:c.constant([{text:"优良/不良记录列表"}]),useTableCommand:c.constant(!0),createHref:function(e){var t=e.get("templateId"),i=e.get("departmentId"),n=e.get("isMine");if(n)return"#/record/create~templateId="+t+"&departmentId="+i+"&isMine=1";else return"#/record/create~templateId="+t},recordTypes:function(e){return e.getRecordTypeList()},recordSources:function(e){var t=require("department/Data");if(e.get("templateId"))return(new t).getDepartmentInfo(e.get("departmentId"))},statuses:c.constant([d.fromAlias("ALL"),d.fromAlias("PUBLISHED"),d.fromAlias("WAITING"),d.fromAlias("REJECTED"),d.fromAlias("SAVED"),d.fromAlias("DELETED")]),pageSize:function(e){return e.data("global").getPageSize()},results:{retrieve:function(e){if(e.get("templateId")){i.each(e.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},e);var t=e.getQuery();return t=i.purify(t,null,!0),e.search(t)}},dump:!0},templateInfo:{retrieve:function(e){if(e.get("templateId")){var t=require("template/Data");return(new t).findById(e.get("templateId"))}},dump:!0},tab:[{tabs:function(e){var t=[],i={panel:"all",title:"所有记录"},n={panel:"already",title:"已审核记录"},r={panel:"audit",title:"待审批记录"},o={panel:"my",title:"我上传的记录"},a=e.data("global").getUserProperty("authorityAlias");if(a.SUPER)return t.push(i,r,o,n),t;if(t.push(i),a.AUDIT)t.push(r);if(a.UPLOAD)t.push(o);if(a.READONLY||a.SUPERVISION)t.push(n);return t}},{activeIndex:function(e){var t=i.pluck(e.get("tabs"),"panel"),n=e.get("isMine")?"my":"all";return i.indexOf(t,n)}}]},e.prototype.getDefaultStatusValue=function(){return 5},e.prototype.getDefaultArgs=function(){var e={},i=t();e.startDate=i.begin,e.endDate=i.end;var n=this.get("userName");if(n)e.userName=n;return e},e.prototype.prepare=function(){var e=this.get("beginTime")||"2015-01-01",t=this.get("endTime")||l.formatters.date(new Date);this.set("rangeDate",e+","+t);var r=this.get("results");i.each(r,function(e,t){if(e.content&&n.parseJSON(e.content)instanceof Object)e.content=n.parseJSON(e.content)});var o=this.data("global").getUserProperty("authorityAlias"),a=[d.fromAlias("ALL")];if(a=a.concat([d.fromAlias("AUDITED")]),o.SUPERVISION===!0)this.set("statuses",a);if(!o.SUPER&&!o.UPLOAD)this.set("READ_ONLY",!0);for(var s=this.get("recordTypes"),u=0;u<s.length;u++)s[u].value=u;if(!this.get("templateId"))s.splice(0,0,{name:"记录类型"});if(this.set("recordTypes",s),this.get("recordSources")){var c=[this.get("recordSources")];this.set("recordSources",c)}},e.prototype.getQuery=function(){var e=o.prototype.getQuery.apply(this,arguments);if(e.beginTime=this.get("beginTime"),e.endTime=this.get("endTime"),e.recordType=this.get("recordType"),e.recordSource=this.get("recordSource"),e.templateId=this.get("templateId"),this.get("isMine"))e.creatorId=this.data("global").getUserProperty("userId");return e},e.prototype.recordList=function(e){return this.data().recordList(e)},e.prototype.submit=function(e){return this.data().batch({ids:e,status:1})},e.prototype.remove=function(e){return this.data().batch({ids:e,status:4})},e.prototype.search=function(e){var t=this.data("global").getUserProperty("authorityAlias");if(t.READONLY)return this.data().getRecordList(e);else if(t.SUPERVISION)return e.auditOpinion=-2,this.data().getRecordList(e);return this.data().getRecordListOld(e)},e.prototype.getRecordTypeList=function(e){return this.data().getRecordTypeList(e)},e.prototype.getTemplate=function(){var e=this,t=require("template/Data");return(new t).findById(e.get("templateId"))},e}),define("record/List",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","ub-ria/mvc/handler/ToastSubmitHandler","./ListModel","./ListView","ub-ria/mvc/handler/RedirectSubmitHandler"],function(require){function e(){u.apply(this,arguments)}function t(e){var t=e.template;if(t){var i=this.view.getSearchArgs();i.templateId=t.id,i.departmentId=t.departmentId,this.reloadWithQueryUpdate(i)}}function i(e){var t="/record/",i="list",n=this.model.get("templateId"),r=this.model.get("departmentId"),o=!1;if("audit"===e.recordType)i="auditList";else if("my"===e.recordType)o=!0;else if("already"===e.recordType)i="alreadyAuditList";if(t+=i,n&&!o==!0&&"mine"===!this.model.get("from"))t+="~templateId="+n+"&departmentId="+r;else if(o)t+="~isMine=1&from=mine";this.redirect(t,{force:!0})}function n(e){return function(t){if(t.failures&&t.failures.length>0){var i=a.filter(e,function(e,i){return a.indexOf(t.failures,e.id)>-1}),n=a.pluck(i,"name"),r=this.view.alert("操作完成，以下模板操作失败："+n.join("、"),"提示");r.on("ok",this.reload)}else{var o=new c;o.setTemplate("操作成功"),o.handle({},this),this.reload()}}}function r(e){var t=a.filter(e.allEntities,function(t,i){return a.indexOf(e.indexes,i+"")>-1}),i=a.pluck(t,"id"),r=e.targetStatus;return this.view.waitConfirm("确认操作吗？","提示信息").then(a.bind(function(){this.model[r](i).then(a.bind(n(e.allEntities),this))},this))}function o(e){var t=this;this.model.getTemplate().then(function(e){var i=e.template;if(i){var n={templateId:i.id};t.reloadWithQueryUpdate(n)}})}var a=require("underscore"),s=require("er/util"),l=require("./config"),u=require("ub-ria/mvc/ListAction"),c=require("ub-ria/mvc/handler/ToastSubmitHandler");s.inherits(e,u),e.prototype.group="unknown",e.prototype.entityDescription=l.description,e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView");require("ub-ria/mvc/handler/RedirectSubmitHandler");return e.prototype.initBehavior=function(){u.prototype.initBehavior.apply(this,arguments),this.view.on("tplSelected",t,this),this.view.on("changeRecord",o,this),this.view.on("remove",r,this),this.view.on("submit",r,this),this.view.on("reload",function(){this.reload()},this),this.view.on("changeRecordType",i,this)},e}),define("record/FormView",["require","underscore","esui/lib","er/util","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=e.target.parent.validate();if(t)this.fire("submit")}function i(e){this.fire("save")}var n=require("underscore"),r=require("esui/lib"),o=require("er/util"),a=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),o.inherits(e,a),e.prototype.template="recordForm",e.prototype.getEntity=function(){var e=a.prototype.getEntity.apply(this,arguments),t=this.model.get("template"),i=this.model.get("fields");n.each(e,function(t,o){var a=n.find(i,function(e){return e.name===o});if(a&&3===a.type){var s=(t||new Date).getTime();e[o]=r.date.format(s,"YYYY-MM-DD")}});var o=["nameField","idCardField","updateTimeField","regionField"];return n.map(o,function(i){var n=i.replace("Field",""),r=t[i];if(t[i])e[n]=e[r]}),e},e.prototype.uiProperties={},e.prototype.uiEvents={"submit:click":t,"save:click":i},e.prototype.enterDocument=function(){a.prototype.enterDocument.apply(this,arguments);var e=this.model.get("content");if(e){var t=this.getGroup("customInputs");n.each(t,function(t){if(e.hasOwnProperty(t.name))t.setValue(e[t.name])})}},e}),define("template/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Type=new e({alias:"ALL",text:"所有类别",value:-1},{alias:"UNKNOW",text:"未知",value:0},{alias:"BAD",text:"不良模板",value:4},{alias:"GOOD",text:"优良模板",value:2},{alias:"BASE",text:"基础信息",value:1},{alias:"DISHONESTY",text:"失信黑名单",value:8}),exports.CreditType=new e({alias:"UNKNOW",text:"--"},{alias:"JUDGE",text:"行政裁决"},{alias:"PUNISH",text:"行政处罚"},{alias:"REWARD",text:"行政奖励"}),exports.ShardingLevel=new e({alias:"UNKNOW",text:"未知"},{alias:"SOCIETY",text:"社会共享"}),exports.DataType=new e({alias:"UNKNOW",text:"未知"},{alias:"NUMBER",text:"数字"},{alias:"TEXT",text:"文本"},{alias:"DATE",text:"日期"}),exports.ObjectType=new e({alias:"UNKNOW",text:"未知",value:0},{alias:"COMPANY",text:"法人",value:2},{alias:"PEOPLE",text:"自然人",value:1}),exports}),define("record/FormModel",["require","underscore","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData","er/Deferred","../template/Data","../template/enum"],function(require){function e(){r.apply(this,arguments),this.addData(new o),this.addData("global",a.getInstance())}function t(e){switch(e){case"NUMBER":return"^\\d+$";case"TEXT":return"^.+$";case"DATE":return"^\\d{4}[-\\/\\.\\u5e74]?\\d{1,2}[-\\/\\.\\u6708]?\\d{1,2}\\u65e5?$"}}var i=require("underscore"),n=require("er/util"),r=require("ub-ria/mvc/FormModel"),o=require("./Data"),a=require("common/GlobalData"),s=require("er/Deferred");return n.inherits(e,r),e.prototype.datasource={crumbPath:function(e){var t="#/record/list~";if(e.get("isMine"))t+="&isMine=1";var i=[{text:e.get("isMine")?"我的上传记录":"所有信用记录",href:t},{text:e.get("title")}];return i},templateInfo:{retrieve:function(e){if(!e.get("templateId"))throw new Error("templateId is needed");var t=require("../template/Data");return(new t).findById(e.get("templateId"))},dump:!0},entity:{retrieve:function(e){if("create"!==e.get("formType"))return e.data().findById(e.get("id"));else return void 0},dump:!0},constantTrue:function(){return!0}},e.prototype.prepare=function(){var e=n.parseJSON(this.get("template").schemaFields),r=require("../template/enum").DataType.valueIndex;i.each(e,function(e){e.required=!!e.required;var i=[];if(e.required)i.push("必填");i.push(r[e.type].text+"类型"),i.push("长度小于"+e.length),e.info=i.join("，"),e.pattern=t(r[e.type].alias,e.required)}),this.set("fields",e);var o=n.parseJSON(this.get("content"));this.set("content",o)},e.prototype.fillEntity=function(e){var t={templateId:this.get("templateId"),userId:this.data("global").getUserProperty("userId")},n=["name","idCard","updateTime","region"];if(i.map(n,function(i){if("undefined"!=typeof e[i])t[i]=e[i],delete e[i]}),"update"===this.get("formType"))t.id=this.get("id");return t.content=JSON.stringify(e),t},e.prototype.validateEntity=function(e){var t="";return t},e.prototype.submit=function(e){var t=this.validateEntity(e);if(t)return s.rejected({global:t});if(e=this.fillEntity(e),e.status=1,e.id)return this.data().update(e);else return this.data().create(e)},e.prototype.save=function(e){if(e=this.fillEntity(e),e.status=3,e.id)return this.data().update(e);else return this.data().create(e)},e}),define("record/Form",["require","underscore","ub-ria/mvc/FormAction","ub-ria/mvc/BaseAction","er/util","./config","er/Deferred","ub-ria/mvc/handler/ToastSubmitHandler","ub-ria/mvc/handler/RedirectSubmitHandler","./FormModel","./FormView","er/events"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel();
}function i(e){var t=new f,i="/record/list~";if(this.model.get("isMine"))i+="&isMine=1";t.setTemplate(i);var n=new d;n.setTemplate("操作成功"),n.setNextSubmitHandler(t),n.handle(e,this)}function n(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function r(e){var t=this.view.getEntity();this.view.disableSubmit();var i=e.type;c.when(this.submitEntity(t,i)).ensure(o.bind(this.view.enableSubmit,this.view))}var o=require("underscore"),a=require("ub-ria/mvc/FormAction"),s=require("ub-ria/mvc/BaseAction"),l=require("er/util"),u=require("./config"),c=require("er/Deferred"),d=require("ub-ria/mvc/handler/ToastSubmitHandler"),f=require("ub-ria/mvc/handler/RedirectSubmitHandler");return l.inherits(e,a),e.prototype.group="unknown",e.prototype.entityDescription=u.description,e.prototype.modelType=require("./FormModel"),e.prototype.viewType=require("./FormView"),e.prototype.getMethod=function(e){var t={create:"create",update:"update"};return t[e]||null},e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var i={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage(),skin:"china"};this.view.waitConfirm(i).then(o.bind(t,this))}else t.call(this)},e.prototype.redirectAfterCancel=function(){this.back("/"+this.getEntityName()+"/list~templateId="+this.model.get("templateId"))},e.prototype.submitEntity=function(e,t){return this.model[t](e).then(o.bind(i,this),o.bind(n,this))},e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("submit",r,this),this.view.on("save",r,this),this.view.on("cancel",this.cancelEdit,this)},e}),define("record/AuditListView",["require","underscore","er/util","esui/lib","ef/UIModel","ub-ria/mvc/ListView","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","./enum","common/layout","esui/Table","common/enum","common/util/fixedbugtable"],function(require){function e(){l.apply(this,arguments)}function t(e){var t=this.popActionDialog({id:"dialog",url:"/template/list",width:960,title:"选择模板",needFoot:!0,options:{status:require("common/enum").TemplateStatus.ACTIVE}}),i=t.getFoot().getChild("btnOk"),n=t.getFoot().getChild("btnCancel");i.on("click",function(e){t.fire("selected")}),n.on("click",function(e){t.dispose()}),t.on("selected",function(e){var t=e.target.getAction(),i=t.getSelectItems();if(i.length<1)this.alert("请至少选择一个模板","错误");this.fire("tplSelected",{templates:i})},this)}function i(e){this.fire("changeRecordType",{recordType:e.tab.panel})}function n(e){var t=this.get("audit");t.helper.clearDOMEvents();var i=e.target.datasource,n=e.selectedIndex;if(n.length>0)t.setDisabled(!1),t.helper.addDOMEvent(t.main,"click",a.bind(function(){this.fire("audit",{indexes:n,allEntities:i})},this));else t.setDisabled(!0)}var r=require("underscore"),o=require("er/util"),a=require("esui/lib"),s=require("ef/UIModel"),l=require("ub-ria/mvc/ListView");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),o.inherits(e,l),e.prototype.template="auditRecordList";var u=require("./enum").Status,c=require("common/layout").getExtractInfo;return e.prototype.getUIProperties=function(){var e=this.uiProperties||{};if(!this.model.get("templateId"))return e;var t=[{title:"序号",content:function(e){return e.id}},{title:"状态",content:function(e){return u.valueIndex[e.status].text}}],i=o.parseJSON(this.model.get("template").schemaFields);r.each(i,function(e){if(e.listed){var i={title:e.name,content:function(t){return c(t.content[e.name]||"")}};t.push(i)}});var n=this.model.get("templateId"),a={title:"操作",minWidth:80,content:function(e,t){var i="#/record/audit~id="+e.id+"&templateId="+n,r=[{text:"审核",url:i}],o=require("esui/Table");return o.operations(r)}};return t.push(a),e.table.fields=t,e},e.prototype.getSearchArgs=function(){var e={};e.templateId=this.model.get("templateId");var t=this.get("keyword");if(t)e.keyword=r.trim(t.getValue());var i=this.get("calendar").getRawValue();return e.beginTime=s.formatters.date(i.begin),e.endTime=s.formatters.date(i.end),e.order=this.get("table").order,e.orderBy=this.get("table").orderBy,e.pageSize=this.get("pager").get("pageSize"),e},e.prototype.uiProperties={table:{select:"multi",selectMode:"line"},pager:{pageSizes:[100],pageSize:100}},e.prototype.uiEvents={"switch:click":t,"tab:activate":i,"table:select":n},e.prototype.bindEvents=function(){l.prototype.bindEvents.apply(this,arguments);var e=require("common/util/fixedbugtable");e.fixedbugToWidth.call(this)},e}),define("record/AuditListModel",["require","underscore","er/util","ub-ria/mvc/BaseModel","ub-ria/mvc/ListModel","./Data","common/GlobalData","ef/UIModel","er/datasource","./enum","template/Data"],function(require){function e(){n.apply(this,arguments),this.addData(new o),this.addData("global",a.getInstance())}var t=require("underscore"),i=require("er/util"),n=require("ub-ria/mvc/BaseModel"),r=require("ub-ria/mvc/ListModel"),o=require("./Data"),a=require("common/GlobalData"),s=require("ef/UIModel");i.inherits(e,r);var l=require("er/datasource");require("./enum").Status;return e.prototype.datasource={crumbPath:l.constant([{text:"优良/不良记录列表"}]),pageSize:function(e){return e.data("global").getPageSize()},results:{retrieve:function(e){if(e.get("templateId")){t.each(e.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},e);var i=e.getQuery();return i=t.purify(i,null,!0),e.search(i)}},dump:!0},templateInfo:{retrieve:function(e){if(e.get("templateId")){var t=require("template/Data");return(new t).findById(e.get("templateId"))}},dump:!0},tab:[{tabs:function(e){var t=[],i={panel:"all",title:"所有记录"},n={panel:"already",title:"已审核记录"},r={panel:"audit",title:"待审批记录"},o={panel:"my",title:"我上传的记录"},a=e.data("global").getUserProperty("authorityAlias");if(a.SUPER)return t.push(i,r,o,n),t;if(t.push(i),a.AUDIT)t.push(r);if(a.UPLOAD)t.push(o);return t}},{activeIndex:function(e){var i=t.pluck(e.get("tabs"),"panel");return t.indexOf(i,"audit")}}]},e.prototype.defaultArgs={},e.prototype.prepare=function(){var e=this.get("beginTime")||"2015-01-01",n=this.get("endTime")||s.formatters.date(new Date);this.set("rangeDate",e+","+n);var r=this.get("results");t.each(r,function(e,t){if(e.content&&i.parseJSON(e.content)instanceof Object)e.content=i.parseJSON(e.content)})},e.prototype.getQuery=function(){var e=r.prototype.getQuery.apply(this,arguments);return e.templateId=this.get("templateId"),e.beginTime=this.get("beginTime"),e.endTime=this.get("endTime"),e.status=1,e},e}),define("record/AuditList",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","./AuditListModel","./AuditListView"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=e.templates[0];if(t){var i={templateId:t.id};this.reloadWithQueryUpdate(i)}}function i(e){var t="/record/",i="list",n=this.model.get("templateId"),r=(this.model.get("departmentId"),!1);if("audit"===e.recordType)i="auditList";else if("my"===e.recordType)r=!0;else if("already"===e.recordType)i="alreadyAuditList";if(t+=i,n){if(r)t+="~isMine=1"}else if(r)t+="~isMine=1";this.redirect(t,{force:!0})}function n(e){var t=r.pluck(r.filter(e.allEntities,function(t,i){return r.indexOf(e.indexes,i+"")>-1}),"id"),i=this.view.popActionDialog({url:"/record/audit",title:"批量审核",actionOptions:{templateId:this.model.get("templateId"),ids:t}});i["onaction@submitAudit"]=r.bind(function(e){e.preventDefault(),this.reload()},this),i["onaction@cancelAudit"]=function(e){e.preventDefault(),i.dispose()}}var r=require("underscore"),o=require("er/util"),a=require("./config"),s=require("ub-ria/mvc/ListAction");return o.inherits(e,s),e.prototype.group="unknown",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./AuditListModel"),e.prototype.viewType=require("./AuditListView"),e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("tplSelected",t,this),this.view.on("changeRecordType",i,this),this.view.on("audit",n,this)},e}),define("record/AuditFormView",["require","er/util","esui/lib","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){n.apply(this,arguments)}var t=require("er/util"),i=require("esui/lib"),n=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),t.inherits(e,n),e.prototype.template="auditRecordForm",e.prototype.getEntity=function(){var e=n.prototype.getEntity.apply(this,arguments);return e.status=i.g("pass").checked?"0":"2",e},e.prototype.uiProperties={},e.prototype.uiEvents={},e}),define("template/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"template")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={search:{name:"template/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/template/getList"}},departments:{name:"template/departments",scope:"instance",policy:"auto",options:{method:"GET",url:"/topDepartments"}},findById:{name:"template/findById",scope:"instance",policy:"auto",options:{method:"GET",url:"/template/getDetail"}},initCreate:{name:"template/initCreate",scope:"instance",policy:"auto",options:{method:"GET",url:"/template/init"}},list:{name:"template/list",scope:"instance",policy:"auto"},save:{name:"template/save",scope:"instance",policy:"auto",options:{method:"POST",url:"/template/create"}},update:{name:"template/update",scope:"instance",policy:"auto",options:{method:"POST",url:"/template/update"}},remove:{name:"template/remove",scope:"instance",policy:"auto"},transitStatus:{name:"template/transitStatus",scope:"instance",policy:"auto",options:{method:"POST",url:"/template/updateStatus"}}};e.prototype.findById=function(e){return this.request("template/findById",{id:e})},e.prototype.getDepartments=function(e){return this.request("template/departments",e)},e.prototype.initCreate=function(e){return this.request("template/initCreate",e)},e.prototype.transitStatus=function(e){return this.request("template/transitStatus",e)};var o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("record/AuditFormModel",["require","underscore","er/util","ub-ria/mvc/FormModel","ef/UIModel","./Data","common/GlobalData","../template/Data"],function(require){function e(){i.apply(this,arguments),this.addData(new r),this.addData("global",o.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/FormModel"),n=require("ef/UIModel"),r=require("./Data"),o=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:"待审核记录",href:"#/record/auditList~templateId="+e.get("templateId")},{text:e.get("title")}];return t},auditName:function(e){return e.data("global").getUserProperty("userName")},approveDate:function(e){return n.formatters.date(new Date)},templateInfo:{retrieve:function(e){if(!e.get("templateId"))throw new Error("templateId is needed");var t=require("../template/Data");return(new t).findById(e.get("templateId"))},dump:!0},entity:{retrieve:function(e){if(e.get("id"))return e.data().findById(e.get("id"));else return void 0},dump:!0}},e.prototype.prepare=function(){if(this.get("id"))this.set("content",t.parseJSON(this.get("content")))},e.prototype.audit=function(e){return e.ids=this.get("ids")||[this.get("id")],e.auditId=this.data("global").getUserProperty("userId"),this.data().audit(e)},e}),define("record/AuditForm",["require","underscore","ub-ria/mvc/FormAction","ub-ria/mvc/BaseAction","er/util","./config","er/Deferred","ub-ria/mvc/handler/ToastSubmitHandler","ub-ria/mvc/handler/RedirectSubmitHandler","./AuditFormModel","./AuditFormView","er/events"],function(require){function e(){s.apply(this,arguments)}function t(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}function i(e){var t=new f;t.setTemplate("操作成功"),t.handle(e,this);var i=this.fire("submitAudit");if(!i.isDefaultPrevented()){var n=new h,r="/record/auditList~templateId="+this.model.get("templateId");n.setTemplate(r),n.handle(e,this)}}function n(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function r(e){var t=this.view.getEntity();this.view.disableSubmit(),d.when(this.submitEntity(t)).ensure(a.bind(this.view.enableSubmit,this.view))}function o(){var e=this.fire("cancelAudit");if(!e.isDefaultPrevented())this.cancelEdit()}var a=require("underscore"),s=require("ub-ria/mvc/FormAction"),l=require("ub-ria/mvc/BaseAction"),u=require("er/util"),c=require("./config"),d=require("er/Deferred"),f=require("ub-ria/mvc/handler/ToastSubmitHandler"),h=require("ub-ria/mvc/handler/RedirectSubmitHandler");return u.inherits(e,s),e.prototype.group="unknown",e.prototype.entityDescription=c.description,e.prototype.modelType=require("./AuditFormModel"),e.prototype.viewType=require("./AuditFormView"),e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var i={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage(),skin:"china"};this.view.waitConfirm(i).then(a.bind(t,this))}else t.call(this)},e.prototype.redirectAfterCancel=function(){this.back("/"+this.getEntityName()+"/auditList~templateId="+this.model.get("templateId"))},e.prototype.submitEntity=function(e){return this.model.audit(e).then(a.bind(i,this),a.bind(n,this))},e.prototype.initBehavior=function(){l.prototype.initBehavior.apply(this,arguments),this.view.on("submit",r,this),this.view.on("cancel",o,this)},e}),define("record/enum",["require","er/Enum","common/enum","esui/lib"],function(require){var e=require("er/Enum"),exports={},t={0:"编辑暂存",1:"提交审批",2:"删除文章",3:"恢复文章",4:"总编辑审批",5:"审核员审批",6:"编辑提交",7:"批阅"};return exports.ReviewStatusMap={0:"全部状态",1:"暂存",2:"已经删除",3:"审批拒绝",4:"待审批",5:"已近发布"},exports.roleAndNamesMap={0:"编辑员",1:"总编辑",2:"后台监察员"},exports.AuditLogFields=[{title:"任务提交人",field:"userName",width:150,content:function(e){var t=e.userName;return'<div class="ellipsistext" title="'+t+'">'+t+"</div>"}},{title:"提交人角色",field:"roleName",width:100,content:function(e){var t=e.roleName,i=require("common/enum").Role.valueIndex[t]||{};return i.text||""}},{title:"任务名称",field:"taskName",width:110,content:function(e){return'<div class="ellipsistext" title="'+t[e.taskName]+'">'+t[e.taskName]+"</div>"}},{title:"任务提交时间",field:"commitTime",width:150,content:function(e){var t=require("esui/lib");if(!e.commitTime)return"";else return t.date.format(e.commitTime,"YYYY-MM-DD HH:mm:ss")}},{title:"单位名称",field:"organization",width:100,content:function(e){return'<div class="ellipsistext" title="'+e.organization+'">'+e.organization+"</div>"}},{title:"审批结论+意见",field:"conclusionAndOpinion",width:240,content:function(e){return'<div class="ellipsistext" title="'+e.conclusionAndOpinion+'">'+e.conclusionAndOpinion+"</div>"}}],exports.Status=new e({alias:"PUBLISHED",text:"已发布",value:0},{alias:"WAITING",text:"待审批",value:1},{alias:"REJECTED",text:"审批拒绝",value:2},{alias:"SAVED",text:"暂存",value:3},{alias:"DELETED",text:"已删除",value:4},{alias:"ALL",text:"所有状态",value:5},{alias:"AUDITED",text:"已审核",value:6}),exports.AuditOpinion=new e({alias:"ALL",text:"审核结论",value:-1},{alias:"TONGYI",text:"同意",value:1},{alias:"XIACHE",text:"下撤",value:2},{alias:"XIUGAI",text:"修改",value:3},{alias:"OTHER",text:"其他",value:4}),exports}),define("record/AlreadyAuditListView",["require","underscore","er/util","esui/lib","ef/UIModel","ub-ria/mvc/ListView","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","./enum","common/enum","common/util/fixedbugtable"],function(require){function e(){u.apply(this,arguments)}function t(e){var t=this.popActionDialog({id:"dialog",url:"/template/list",minWidth:960,title:"选择模板",needFoot:!0,options:{status:require("common/enum").TemplateStatus.ACTIVE}}),i=t.getFoot().getChild("btnOk"),n=t.getFoot().getChild("btnCancel");i.on("click",function(e){t.fire("selected")}),n.on("click",function(e){t.dispose()}),t.on("selected",function(e){var t=e.target.getAction(),i=t.getSelectItems();if(i.length<1)this.alert("请至少选择一个模板","错误");this.fire("tplSelected",{templates:i})},this)}function i(e){this.fire("changeRecordType",{recordType:e.tab.panel})}function n(e){var t=this.get("audit");t.helper.clearDOMEvents();var i=e.target.datasource,n=e.selectedIndex;if(n.length>0)t.setDisabled(!1),t.helper.addDOMEvent(t.main,"click",s.bind(function(){this.fire("audit",{indexes:n,allEntities:i})},this));else t.setDisabled(!0)}function r(e){var t=e.target.getSelectedItem();this.fire("tplSelected",{template:t})}var o=require("underscore"),a=require("er/util"),s=require("esui/lib"),l=require("ef/UIModel"),u=require("ub-ria/mvc/ListView");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),a.inherits(e,u),e.prototype.template="alreadyAuditRecordList";var c=(require("./enum").Status,[{title:"记录编号",field:"id",sortable:!0,minWidth:80,content:function(e){return e.id}},{title:"农户人/自然人名称",field:"companyName",minWidth:100,content:function(e){return e.name||""}},{title:"记录类型",field:"type",sortable:!0,minWidth:150,content:function(e){return e.templateName}},{title:"提交时间",field:"createTime",sortable:!0,minWidth:100,content:function(e){if(!e.createTime)return"";else return s.date.format(e.createTime,"YYYY-MM-DD")}},{title:"发布来源",field:"recordSource",minWidth:80,content:function(e){return e.departmentName}},{title:"审核结论",field:"conclusion",minWidth:80,content:function(e){if(e.auditOpinion&&null!==e.auditOpinion){var t=require("./enum").AuditOpinion;return t.getTextFromValue(e.auditOpinion)}return""}},{title:"状态",field:"status",minWidth:70,content:function(e){if(null!==e.status){var t=require("./enum").Status;return t.getTextFromValue(e.status)}return""}},{title:"审核时间",field:"auditTime",minWidth:100,content:function(e){if(!e.auditTime)return"";else return s.date.format(e.auditTime,"YYYY-MM-DD")}}]);return e.prototype.tableFields=c,e.prototype.getSearchArgs=function(){var e={};e.templateId=this.model.get("templateId"),e.departmentId=this.model.get("departmentId");var t=this.get("keyword");if(t)e.keyword=o.trim(t.getValue());var i=this.get("calendar").getRawValue();if(e.beginTime=l.formatters.date(i.begin),e.endTime=l.formatters.date(i.end),this.get("table"))e.order=this.get("table").order,e.orderBy=this.get("table").orderBy,e.pageSize=this.get("pager").get("pageSize");e.recordType=this.get("recordType").getValue();var n=this.model.data("global").getUserProperty("authorityAlias");if(n.READONLY!==!0&&n.SUPERVISION!==!0)e.status=this.get("status").getValue();if(e.auditOpinion=this.get("auditMessage").getValue(),this.get("templateId"))e.recordSource=this.get("recordSource").getValue(),e.templateId=this.get("templateId");return e},e.prototype.uiProperties={table:{selectMode:"line"},pager:{pageSizes:[100],pageSize:100}},e.prototype.uiEvents={"switch:click":t,"tab:activate":i,"table:select":n,"recordType:change":r},e.prototype.enterDocument=function(){if(u.prototype.enterDocument.apply(this,arguments),this.model.get("templateId"))this.get("recordSource").setDisabled(!1);this.get("status").hide(),this.get("auditMessage").setValue(this.model.get("auditOpinion"))},e.prototype.bindEvents=function(){u.prototype.bindEvents.apply(this,arguments);var e=require("common/util/fixedbugtable");e.fixedbugToWidth.call(this)},e}),define("record/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"record")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={search:{name:"record/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/record/quaryRecords"}},getRecordList:{name:"record/queryPage",scope:"instance",policy:"auto",options:{method:"GET",url:"/record/queryPage"}},findById:{name:"record/findById",scope:"instance",policy:"auto",options:{method:"GET",url:"/record/id"}},update:{name:"record/update",scope:"instance",policy:"auto",options:{method:"POST",url:"/records/update"}},create:{name:"record/create",scope:"instance",policy:"auto",options:{method:"POST",url:"/records/add"}},batch:{name:"record/batch",scope:"instance",policy:"auto",options:{method:"POST",url:"/record/status"}},audit:{name:"record/audit",scope:"instance",policy:"auto",options:{method:"POST",url:"/record/approveRecords"}},list:{name:"record/list",scope:"instance",policy:"auto"},remove:{name:"record/remove",scope:"instance",policy:"auto"},restore:{name:"record/restore",scope:"instance",policy:"auto"},tree:{name:"record/tree",scope:"instance",policy:"auto"},getRecordTypeList:{name:"template/getList",scope:"instance",policy:"auto",options:{method:"GET",url:"/template/getAllEnableTemplate"}},getRecord:{name:"record/verifyList",scope:"instance",policy:"auto",options:{method:"GET",url:"/record/queryOne"}},saveVerify:{name:"record/verify",scope:"instance",policy:"auto",options:{method:"POST",url:"/saveReview"}},getRole:{name:"getRole",scope:"instance",policy:"auto",options:{method:"GET",url:"/siteMessage/findSendee"}},getPeople:{name:"getPeople",scope:"instance",policy:"auto",options:{method:"GET",url:"/siteMessage/getSendee"}}};e.prototype.findById=function(e){return this.request("record/findById",{id:e})},e.prototype.update=function(e){return this.request("record/update",e)},e.prototype.create=function(e){return this.request("record/create",e)},e.prototype.audit=function(e){return this.request("record/audit",e)},e.prototype.batch=function(e){return this.request("record/batch",e)},e.prototype.getRecordTypeList=function(e){return this.request("template/getList",e)},e.prototype.getRecord=function(e){return this.request("record/verifyList",e)},e.prototype.getRecordList=function(e){return this.request("record/queryPage",e)},e.prototype.getRecordListOld=function(e){return this.request("record/search",e)},e.prototype.getAlreadyAuditList=function(e){return this.request("record/queryPage",e)},e.prototype.getRole=function(e){return this.request("getRole",e)},e.prototype.getPeople=function(e){return this.request("getPeople",e)},e.prototype.saveVerify=function(e){return this.request("record/verify",e)};var o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("record/AlreadyAuditListModel",["require","underscore","er/util","ub-ria/mvc/BaseModel","ub-ria/mvc/ListModel","./Data","common/GlobalData","ef/UIModel","./enum","er/datasource","department/Data","template/Data"],function(require){function e(){n.apply(this,arguments),this.addData(new o),this.addData("global",a.getInstance())}var t=require("underscore"),i=require("er/util"),n=require("ub-ria/mvc/BaseModel"),r=require("ub-ria/mvc/ListModel"),o=require("./Data"),a=require("common/GlobalData"),s=require("ef/UIModel"),l=require("./enum").AuditOpinion;i.inherits(e,r);var u=require("er/datasource"),c=require("./enum").Status;return e.prototype.datasource={crumbPath:u.constant([{text:"优良/不良记录列表"}]),pageSize:function(e){return e.data("global").getPageSize()},statuses:u.constant([c.fromAlias("ALL"),c.fromAlias("PUBLISHED"),c.fromAlias("WAITING"),c.fromAlias("DELETED")]),recordTypes:function(e){return e.getRecordTypeList()},recordSources:function(e){var t=require("department/Data");if(e.get("templateId"))return(new t).getDepartmentInfo(e.get("departmentId"));else return void 0},auditMessages:u.constant([l.fromAlias("ALL"),l.fromAlias("TONGYI"),l.fromAlias("XIACHE"),l.fromAlias("XIUGAI"),l.fromAlias("OTHER")]),results:{retrieve:function(e){if(e.get("templateId")){t.each(e.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},e);var i=e.getQuery();return i=t.purify(i,null,!0),e.getAlreadyAuditList(i)}},dump:!0},templateInfo:{retrieve:function(e){if(e.get("templateId")){var t=require("template/Data");return(new t).findById(e.get("templateId"))}},dump:!0},tab:[{tabs:function(e){var t=[],i={panel:"all",title:"所有记录"},n={panel:"already",title:"已审核记录"},r={panel:"audit",title:"待审批记录"},o={panel:"my",title:"我上传的记录"},a=e.data("global").getUserProperty("authorityAlias");if(a.SUPER)return t.push(i,r,o,n),t;if(t.push(i),a.AUDIT)t.push(r);if(a.UPLOAD)t.push(o);if(a.READONLY||a.SUPERVISION)t.push(n);return t}},{activeIndex:function(e){var i=t.pluck(e.get("tabs"),"panel");return t.indexOf(i,"already")}}]},e.prototype.defaultArgs={orderBy:"createTime",order:"desc"},e.prototype.prepare=function(){var e=this.get("beginTime")||"2015-01-01",n=this.get("endTime")||s.formatters.date(new Date);this.set("rangeDate",e+","+n);var r=this.get("results");t.each(r,function(e,t){if(e.content&&i.parseJSON(e.content)instanceof Object)e.content=i.parseJSON(e.content)});for(var o=this.get("recordTypes"),a=0;a<o.length;a++)o[a].value=a;if(!this.get("templateId"))o.splice(0,0,{name:"记录类型"});if(this.set("recordTypes",o),this.get("recordSources")){var l=[this.get("recordSources")];this.set("recordSources",l)}},e.prototype.getQuery=function(){var e=r.prototype.getQuery.apply(this,arguments);return e.templateId=this.get("templateId"),e.beginTime=this.get("beginTime"),e.endTime=this.get("endTime"),e.recordType=this.get("recordType"),e.recordSource=this.get("recordSource"),e.auditOpinion=this.get("auditOpinion"),e.status=6,e},e.prototype.getAlreadyAuditList=function(e){return this.data().getAlreadyAuditList(e)},e.prototype.getRecordTypeList=function(e){return this.data().getRecordTypeList(e)},e}),define("record/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/record/list",type:"record/List",title:"信用记录 - 列表",auth:["RECORD_VIEW"]},{path:"/record/auditList",type:"record/AuditList",title:"信用记录 - 待审核记录",auth:["RECORD_VIEW"]},{path:"/record/alreadyAuditList",type:"record/AlreadyAuditList",title:"信用记录 - 已审核记录",auth:["RECORD_VIEW"]},{path:"/record/create",type:"record/Form",title:"新建信用记录",args:{formType:"create"},auth:["RECORD_MODIFY"]},{path:"/record/update",type:"record/Form",title:"修改信用记录",args:{formType:"update"},auth:["RECORD_MODIFY"]},{path:"/record/view",type:"record/Read",title:"查看信用记录信息",auth:["RECORD_VIEW"]},{path:"/record/read",movedTo:"record/view"},{path:"/record/audit",type:"record/AuditForm",title:"审批信用记录",args:{formType:"create"},auth:["RECORD_MODIFY"]},{path:"/record/verify",type:"record/VerifyRecord",title:"审核信用记录",auth:["RECORD_MODIFY"]}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"record",description:"信用记录"}}),define("record/AlreadyAuditList",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","./AlreadyAuditListModel","./AlreadyAuditListView"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=e.template;if(t){var i=this.view.getSearchArgs();i.templateId=t.id,i.departmentId=t.departmentId,this.reloadWithQueryUpdate(i)}}function i(e){var t="/record/",i="list",n=this.model.get("templateId"),r=(this.model.get("departmentId"),!1);if("audit"===e.recordType)i="auditList";else if("my"===e.recordType)r=!0;else if("all"===e.recordType)i="list";if(t+=i,n){if(r)t+="~isMine=1"}else if(r)t+="~isMine=1";this.redirect(t,{force:!0})}function n(e){var t=r.pluck(r.filter(e.allEntities,function(t,i){return r.indexOf(e.indexes,i+"")>-1}),"id"),i=this.view.popActionDialog({url:"/record/audit",title:"批量审核",actionOptions:{templateId:this.model.get("templateId"),ids:t}});i["onaction@submitAudit"]=r.bind(function(e){e.preventDefault(),this.reload()},this),i["onaction@cancelAudit"]=function(e){e.preventDefault(),i.dispose()}}var r=require("underscore"),o=require("er/util"),a=require("./config"),s=require("ub-ria/mvc/ListAction");return o.inherits(e,s),e.prototype.group="unknown",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./AlreadyAuditListModel"),e.prototype.viewType=require("./AlreadyAuditListView"),e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("tplSelected",t,this),this.view.on("changeRecordType",i,this),this.view.on("audit",n,this)},e}),define("pubData/WSInterfaceView",["require","er/util","ub-ria/mvc/FormView","ub-ria/mvc/ListView","esui/lib","tpl!8ab58a8b.tpl.html","common/util/download"],function(require){function e(){o.apply(this,arguments)}function t(e){var t=(e.target,require("common/util/download"));t.iframePost("/publicity/downloadXmlTemplate","","window.downLoad")}function i(e){var t=(e.target,require("common/util/download"));t.iframePost("/publicity/downloadXml","","window.downLoad")}function n(e){var t=require("common/util/download");t.iframePost("/publicity/downloadSecretKey","","window.downLoad")}var r=require("er/util"),o=require("ub-ria/mvc/FormView"),a=require("ub-ria/mvc/ListView");require("esui/lib");return require("tpl!8ab58a8b.tpl.html"),r.inherits(e,o),e.prototype.template="webserversMain",e.prototype.getEntity=function(){var e=o.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiProperties={},e.prototype.uiEvents={},e.prototype.bindEvents=function(){a.prototype.bindEvents.apply(this,arguments),this.get("download-Template").on("click",t,this),this.get("download-Illustrate").on("click",i,this),this.get("download-miyao").on("click",n,this)},e}),define("pubData/WSInterfaceModel",["require","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData","esui/lib"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/FormModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("esui/lib");return t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:e.get("title")}];return t},dataList:function(e){return e.getUploadLog().done(function(t){if(e.set("token",t.token),t.lists&&t.lists.length>0){if(t.lists[0])e.set("uploadTime0",o.date.format(t.lists[0].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal0",t.lists[0].successTolal);if(t.lists[1])e.set("uploadTime1",o.date.format(t.lists[1].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal1",t.lists[1].successTolal);if(t.lists[2])e.set("uploadTime2",o.date.format(t.lists[2].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal2",t.lists[2].successTolal);if(t.lists[3])e.set("uploadTime3",o.date.format(t.lists[3].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal3",t.lists[3].successTolal);if(t.lists[4])e.set("uploadTime4",o.date.format(t.lists[4].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal4",t.lists[4].successTolal);if(t.lists[5])e.set("uploadTime5",o.date.format(t.lists[5].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal5",t.lists[5].successTolal);if(t.lists[6])e.set("uploadTime6",o.date.format(t.lists[6].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal6",t.lists[6].successTolal);if(t.lists[7])e.set("uploadTime7",o.date.format(t.lists[7].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal7",t.lists[7].successTolal);if(t.lists[8])e.set("uploadTime8",o.date.format(t.lists[8].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal8",t.lists[8].successTolal);if(t.lists[9])e.set("uploadTime9",o.date.format(t.lists[9].uploadTime,"YYYY年MM月DD日 HH:mm:ss")),e.set("successTolal9",t.lists[9].successTolal)}})}},e.prototype.getUploadLog=function(){var e=this.data();return e.getUploadLog()},e}),define("pubData/WSInterface",["require","ub-ria/mvc/FormAction","er/util","./config","./WSInterfaceModel","./WSInterfaceView"],function(require){function e(){t.apply(this,arguments)}var t=require("ub-ria/mvc/FormAction"),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./WSInterfaceModel"),e.prototype.viewType=require("./WSInterfaceView"),e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},e}),define("pubData/UpLoadView",["require","underscore","er/util","ub-ria/mvc/ListView","esui/lib","common/layout","tpl!8ab58a8b.tpl.html","./enum","common/GlobalData","esui/Table","common/util/globalLoading","common/util/download"],function(require){function e(){d.apply(this,arguments);
}function t(e){var t=this,i=e.args,n=i.split(",");switch(e.name){case"remove":var r=t.confirm("你确认要删除么？","提示信息");r.on("ok",function(){t.fire("delete",{args:{recordId:+n[0],fileId:n[1],dataType:+n[2]}})})}}function i(e){this.fire("changeDataType",{dataType:e.tab.value})}function n(){f.addClass(f.g("upload-result"),"hidden")}function r(e){var t=null,i=this.get("importData"),n=i.helper.getId(),r=require("common/util/globalLoading");new h({trigger:"#"+n,accept:"application/msexcel",action:"/publicity/uploadExcels",name:"multipartFile",left:86,top:100,data:{},beforeUpload:function(){clearInterval(t),r.show()}}).success(function(e){t=setTimeout(function(){r.hide(),f.removeClass(f.g("upload-result"),"hidden"),e=c.parseJSON(e);var t=p.uploadMsgMap[e.uploadErrorStatus[0]],i=e.uploadResult;if(i)f.g("uploadResponse").innerHTML=t,f.g("uploadState").innerHTML=i.uploadStatus,f.g("uploadTotal").innerHTML=i.uploadSuccessTotal,$(".download-link").attr("src",i.uploadReportPath)},45e3)})}function o(e){var t="",i=require("common/util/download"),n=1;t="type="+n,i.iframePost("/publicity/downloadTemplate",t,"window.downLoad")}function a(e){var t="",i=require("common/util/download"),n=0;t="type="+n,i.iframePost("/publicity/downloadTemplate",t,"window.downLoad")}function s(e){var t=[],i=require("common/util/download"),n=$(".download-link").attr("src");t=n.split("."),reportPath="reportPath="+t[0],i.iframePost("/publicity/downloadReport",reportPath,"window.downLoad")}function l(e){var t=require("common/util/download");t.iframePost("/publicity/downloadNotice","","window.downLoad")}var u=require("underscore"),c=require("er/util"),d=require("ub-ria/mvc/ListView"),f=require("esui/lib"),h=(require("common/layout"),window.Upload);require("tpl!8ab58a8b.tpl.html"),c.inherits(e,d),e.prototype.template="upLoadDataForm";var p=require("./enum");return e.prototype.uiProperties={table:{selectMode:"line"}},e.prototype.getUIProperties=function(){var e=this.uiProperties||{},t=(require("common/GlobalData").getInstance(),this.model.get("dataType"));if(void 0===t)t=1;var i=[{title:"行政项目决定书文号",field:"wsh",sortable:!1,resizable:!1,width:180,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.wsh+'">'+e.wsh+"</div>"}},{title:"项目名称",field:"ajmc",sortable:!1,resizable:!1,width:160,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.ajmc+'">'+e.ajmc+"</div>"}},{title:"行政相对人名称",field:"xdrMc",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.xdrMc+'">'+e.xdrMc+"</div>"}},{title:"数据更新时间戳",field:"sjc",sortable:!1,resizable:!1,width:120,stable:!0,content:function(e){return f.date.format(e.sjc,"YYYY-MM-DD")}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:120,stable:!0,content:function(e){var i=location.hash.split("~"),n=i[1]?"&"+i[1]:"";if(1===t)n+="&dataType=1";var r="#/pubData/read~from=upLoad"+n+"&recordId="+e.recordId,o=[{command:"edits",type:"edits",url:r,text:"查看"},{command:"remove",type:"remove",args:e.recordId+","+e.fileId+","+t,text:"删除"}],a=require("esui/Table");return a.operations(o)}}];return e.table.fields=i,e},e.prototype.getEntity=function(){var e=FormView.prototype.getEntity.apply(this,arguments);return e},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{},i=this.get("keyword");if(i)t.keyword=u.trim(i.getValue());if(this.model.get("dataType"))t.dataType=0;return t},e.prototype.bindEvents=function(){d.prototype.bindEvents.apply(this,arguments),r.call(this),this.get("download-permit").on("click",o,this),this.get("download-punish").on("click",a,this),this.get("downloadLink").on("click",s,this),this.get("reloadBtn").on("click",n,this),this.get("downloadTipLink").on("click",l,this)},e.prototype.uiEvents={"tab:activate":i,"table:command":t},e}),define("pubData/UpLoadModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","ef/UIModel","common/permission","er/datasource","./enum"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData");require("ef/UIModel"),require("common/permission");t.inherits(e,i);var o=require("er/datasource"),a=require("./enum");return e.prototype.datasource={crumbPath:function(e){var t=[{text:e.get("title")}];return t},useTableCommand:o.constant(!0),dataTabs:function(e){return a.dataTabs},dataActive:function(e){var t=e.get("dataType");if(void 0===t)t=1;return t}},e.prototype.remove=function(e){return this.data().deleteData(e)},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments),t=this.get("dataType");if(void 0===t||1===t)e.dataType=1;else e.dataType=0;return e},e.prototype.search=function(e){return this.data().pubDataSearch(e)},e}),define("pubData/UpLoad",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","./UpLoadModel","./UpLoadView"],function(require){function e(){o.apply(this,arguments)}function t(e){var t="/pubData/upLoad";if(0===e.dataType)t+="~dataType=0";else t+="";this.redirect(t,{force:!0})}function i(e){var t=e.args,i=this;this.model.remove(t).then(function(){i.reload()})}var n=(require("underscore"),require("er/util")),r=require("./config"),o=require("ub-ria/mvc/ListAction");return n.inherits(e,o),e.prototype.group="default",e.prototype.entityDescription=r.description,e.prototype.modelType=require("./UpLoadModel"),e.prototype.viewType=require("./UpLoadView"),e.prototype.initBehavior=function(){o.prototype.initBehavior.apply(this,arguments),this.view.on("changeDataType",t,this),this.view.on("delete",i,this)},e}),define("pubData/ReadDataView",["require","underscore","er/util","ub-ria/mvc/FormView","common/common","tpl!8ab58a8b.tpl.html"],function(require){function e(){i.apply(this,arguments)}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/FormView");require("common/common");return require("tpl!8ab58a8b.tpl.html"),t.inherits(e,i),e.prototype.template="readDataFormTpl",e.prototype.getEntity=function(){var e=i.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiEvents={},e.prototype.bindEvents=function(){i.prototype.bindEvents.apply(this,arguments),this.get("back").on("click",function(){this.fire("backList",this.model.get("from"))},this)},e}),define("pubData/ReadDataModel",["require","underscore","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData","./enum"],function(require){function e(){n.apply(this,arguments),this.addData(new r),this.addData("global",o.getInstance())}function t(){var e=location.hash.split("~"),t=e[1].split("&");if("dataType=1"===t[2])t=t.slice(1,2);else if("dataType=1"===t[1])t=[];else if("dataType=0"===t[1]&&3===t.length)t=t.slice(1,2);else t=t.slice(1,3);return t.join("&")}var i=(require("underscore"),require("er/util")),n=(require("esui/lib"),require("common/base/BaseModel")),r=require("./Data"),o=require("common/GlobalData");i.inherits(e,n);var a=require("./enum");return e.prototype.datasource={crumbPath:function(e){var i=[{text:"上传数据",href:"#/pubData/upLoad"},{text:"查看数据"}],n=(e.get("from"),t());return i[0].href+="~"+n,i},dataType:function(e){var t=e.get("dataType");return t},dataInfo:function(e){var t=e.get("recordId"),i=e.get("dataType");return e.getDataDetail(t).done(function(t){if(e.fill(t),e.set("roleId",t.roleId),"0"===i)e.set("cfwxh",t.cfWsh),e.set("cfCfmc",t.cfCfmc),e.set("cfSy",t.cfSy),e.set("cfYj",t.cfYj),e.set("cfCflb1",t.cfCflb1),e.set("cfCflb2",t.cfCflb2),e.set("cfXdrMc",t.cfXdrMc),e.set("cfXdrShxym",t.cfXdrShxym),e.set("cfXdrZdm",t.cfXdrZdm),e.set("cfXdrGsdj",t.cfXdrGsdj),e.set("cfXdrSwdj",t.cfXdrSwdj),e.set("cfXdrSfz",t.cfXdrSfz),e.set("cfFr",t.cfFr),e.set("cfJg",t.cfJg),e.set("cfJdrq",t.cfJdrq),e.set("cfJzq",t.cfJzq),e.set("cfQx",t.cfQx),e.set("cfXzjg",t.cfXzjg),e.set("cfZt",a.punishStateMap[t.cfZt]),e.set("cfDfbm",t.cfDfbm),e.set("cfSjc",t.cfSjc),e.set("cfBz",t.cfBz),e.set("cfXzbm",t.cfXzbm);else if("1"===i)e.set("xkWsh",t.xkWsh),e.set("xkXmmc",t.xkXmmc),e.set("xkSplb",t.xkSplb),e.set("xkNr",t.xkNr),e.set("xkXdr",t.xkXdr),e.set("xkXdrShxym",t.xkXdrShxym),e.set("xkXdrZdm",t.xkXdrZdm),e.set("xkXdrGsdj",t.xkXdrGsdj),e.set("xkXdrSwdj",t.xkXdrSwdj),e.set("xkXdrSfz",t.xkXdrSfz),e.set("xkFr",t.xkFr),e.set("xkJdrq",t.xkJdrq),e.set("xkJzq",t.xkJzq),e.set("xkYxq",t.xkYxq),e.set("xkXzjg",t.xkXzjg),e.set("xkZt",a.punishStateMap[t.xkZt]),e.set("xkDfbm",t.xkDfbm),e.set("xkSjc",t.xkSjc),e.set("xkBz",t.xkBz),e.set("xkXzbm",t.xkXzbm)})}},e.prototype.getDataDetail=function(e){var t=this.data(),i=this.get("dataType");return t.getDatadetail({recordId:e,dataType:i})},e}),define("pubData/ReadData",["require","common/base/BaseForm","er/util","./config","./ReadDataModel","./ReadDataView"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=i();t="/pubData/upLoad~"+t,this.redirect(t)}function i(){var e=location.hash.split("~"),t=e[1].split("&");if("dataType=1"===t[2])t=t.slice(1,2);else if("dataType=1"===t[1])t=[];else if("dataType=0"===t[1]&&3===t.length)t=t.slice(1,2);else t=t.slice(1,3);return t.join("&")}var n=require("common/base/BaseForm"),r=require("er/util"),o=require("./config");return r.inherits(e,n),e.prototype.group="default",e.prototype.entityDescription=o.description,e.prototype.modelType=require("./ReadDataModel"),e.prototype.initBehavior=function(){n.prototype.initBehavior.apply(this,arguments),this.view.on("backList",t,this)},e.prototype.viewType=require("./ReadDataView"),e.prototype.leave=function(){this.view.fire("leave"),n.prototype.leave.apply(this,arguments)},e}),define("pubData/FormView",["require","er/util","underscore","ub-ria/mvc/FormView","esui/lib","tpl!8ab58a8b.tpl.html","common/util/download"],function(require){function e(){r.apply(this,arguments)}function t(){var e=this,t={};t.hasRead=this.get("cookie-remember").checked?1:0,o.addClass(o.g("downloadTip"),"hidden"),e.fire("cookieTipBtn",{args:t})}function i(e){var t=require("common/util/download");t.iframePost("/publicity/downloadNotice","","window.downLoad")}var n=require("er/util"),r=(require("underscore"),require("ub-ria/mvc/FormView")),o=require("esui/lib");window.Upload;return require("tpl!8ab58a8b.tpl.html"),n.inherits(e,r),e.prototype.template="pubDataUserForm",e.prototype.getEntity=function(){var e=r.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiProperties={},e.prototype.bindEvents=function(){if(r.prototype.bindEvents.apply(this,arguments),this.get("downloadTipLink"))this.get("downloadTipLink").on("click",i,this);if(this.get("cookieTipBtn"))this.get("cookieTipBtn").on("click",t,this)},e.prototype.uiEvents={},e}),define("pubData/FormModel",["require","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData","esui/lib"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/FormModel"),n=require("./Data"),r=require("common/GlobalData");require("esui/lib");return t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:e.get("title")}];return t},dataList:function(e){return e.dataList().done(function(t){e.set("userName",t.userName),e.set("areaName",t.areaName),e.set("areaCode",t.areaCode),e.set("uploadTotal",t.uploadTotal),e.set("pubUploadLogs",t.pubUploadLogs),e.set("cookieNum",t.hasRead),e.set("roleId",t.roleId)})}},e.prototype.dataList=function(){var e=this.data();return e.dataList()},e.prototype.getCookieNum=function(e){var t=this.data();return t.getCookieNum(e)},e}),define("pubData/Form",["require","underscore","ub-ria/mvc/FormAction","er/util","./config","common/base/BaseForm","./FormModel","./FormView"],function(require){function e(){i.apply(this,arguments)}function t(e){var t=e.args;this.model.getCookieNum(t)}var i=(require("underscore"),require("ub-ria/mvc/FormAction")),n=require("er/util"),r=require("./config"),o=require("common/base/BaseForm");return n.inherits(e,i),e.prototype.group="default",e.prototype.entityDescription=r.description,e.prototype.modelType=require("./FormModel"),e.prototype.viewType=require("./FormView"),e.prototype.initBehavior=function(){o.prototype.initBehavior.apply(this,arguments),this.view.on("cookieTipBtn",t,this)},e}),define("pubData/DataHistoryView",["require","er/util","esui/lib","ub-ria/mvc/ListView","underscore","common/permission","common/layout","tpl!8ab58a8b.tpl.html","./enum","common/GlobalData","esui/Table"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=this,i=e.args,n=i.split(",");switch(e.name){case"remove":var r=t.confirm("你确认要删除么？","提示信息");r.on("ok",function(){t.fire("delete",{args:{dataType:n[1],fileId:n[0]}})})}}var i=require("er/util"),n=require("esui/lib"),r=require("ub-ria/mvc/ListView");require("underscore"),require("common/permission"),require("common/layout");require("tpl!8ab58a8b.tpl.html"),i.inherits(e,r);var o=require("./enum");e.prototype.template="dataHistoryList";var a=(require("common/GlobalData").getInstance(),[{title:"数据更新记录",field:"uploadTime",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return n.date.format(e.uploadTime,"YY年MM月DD日 HH:mm:ss")}},{title:"行政类型",field:"dataType",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){var t=o.dataTypeMap[e.dataType];return'<div class="ellipsistext" title="'+t+'">'+t+"</div>"}},{title:"上传数据总数",field:"successTolal",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.successTolal+'">'+e.successTolal+"条</div>"}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:120,stable:!0,content:function(e){var t=[{command:"remove",type:"remove",args:e.fileId+","+e.dataType,text:"删除"}],i=require("esui/Table");return i.operations(t)}}]);return e.prototype.tableFields=a,e.prototype.uiProperties={table:{fields:a}},e.prototype.uiEvents={"table:command":t},e}),define("pubData/DataHistoryModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","ef/UIModel","common/permission","er/datasource","./enum"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData");require("ef/UIModel"),require("common/permission");t.inherits(e,i);var o=require("er/datasource");require("./enum");return e.prototype.datasource={crumbPath:function(e){var t=[{text:e.get("title")}];return t},useTableCommand:o.constant(!0)},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments);this.get("dataType");return e.dataType=0,e},e.prototype.remove=function(e){return this.data().deleteBatch(e)},e.prototype.search=function(){var e=this.data();return e.dataList()},e}),define("pubData/DataHistory",["require","underscore","er/util","./config","ub-ria/mvc/ListAction","./DataHistoryModel","./DataHistoryView"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=e.args,i=this;this.model.remove(t).then(function(){i.reload()})}var i=(require("underscore"),require("er/util")),n=require("./config"),r=require("ub-ria/mvc/ListAction");return i.inherits(e,r),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./DataHistoryModel"),e.prototype.viewType=require("./DataHistoryView"),e.prototype.initBehavior=function(){r.prototype.initBehavior.apply(this,arguments),this.view.on("delete",t,this)},e}),define("pubData/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports.dataTabs=[{title:"行政处罚",value:0},{title:"行政许可",value:1}],exports.punishStateMap={0:"正常",1:"撤销",2:"异议",3:"其他"},exports.dataTypeMap={0:"行政处罚",1:"行政许可"},exports.punishClassMap={0:"警告",1:"罚款",2:"没收违法所得",3:"没收非法财产",4:"责令停产停业",5:"暂扣或吊销许可证",6:"暂扣或吊销许可执照",7:"行政拘留",8:"其他"},exports.errorTipMap=["请输入旧口令","请输入新口令","请再次输入新口令","新口令不能包含空格","新口令由8-18个字符组成,必须包含大小写字母和数字","两次输入的新口令不一致"],exports.uploadMsgMap={0:"上传成功",1:"上传失败",2:"文件格式不支持",3:"缺少文件后缀名",4:"网络中断",5:"文件太大,超过了最大支持",6:"标题名称错误",7:"下载模板有误",8:"超过总条数",9:"模板中没有提交数据"},exports}),define("pubData/ChangePwdView",["require","underscore","er/util","ub-ria/mvc/FormView","esui/lib","tpl!8ab58a8b.tpl.html","./enum"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=a.errorTipMap,i=/^(?=.*[0-9].*)(?=.*[A-Z].*)(?=.*[a-z].*).{8,18}$/,n=$(e),r="";if(n.is("#oldPassword"))if(""===$(e).val())r=t[0],o.g("oldPasswordTip").innerHTML=r;else o.g("oldPasswordTip").innerHTML="";if(n.is("#newPassword"))if(""===$(e).val())r=t[1],o.g("newPwdTip").innerHTML=r;else if($(e).val().indexOf(" ")>-1)r=t[3],o.g("newPwdTip").innerHTML=r;else if(!i.test($(e).val()))r=t[4],o.g("newPwdTip").innerHTML=r;else o.g("newPwdTip").innerHTML="";if(n.is("#repeatNewPassword"))if(""===$(e).val())r=t[2],o.g("repeatPwdTip").innerHTML=r;else if($(e).val().indexOf(" ")>-1)r=t[3],o.g("repeatPwdTip").innerHTML=r;else if(!i.test($(e).val()))r=t[4],o.g("repeatPwdTip").innerHTML=r;else if($(e).val()!==$("#newPassword").val())r=t[5],o.g("repeatPwdTip").innerHTML=r;else o.g("repeatPwdTip").innerHTML=""}function i(){var e=this,i={},n=[];if(i.oldPassword=this.get("old-password").getValue(),i.newPassword1=this.get("new-password").getValue(),i.newPassword2=this.get("repeat-new-password").getValue(),$(".password-input").each(function(){t(this)}),$(".password-input").each(function(e,t){var i=$(t);if(""===i.val())return!1;else return void 0}),$(".changepwd-tip").each(function(e,t){var i=$(t),r=$.trim(i.html());if(""!==r)n.push(r)}),n.length>0)return!1;var r=this.confirm("你确认要修改口令吗？","提示信息");r.on("ok",function(){e.fire("quantityReview",{args:i})})}var n=(require("underscore"),require("er/util")),r=require("ub-ria/mvc/FormView"),o=require("esui/lib");require("tpl!8ab58a8b.tpl.html"),n.inherits(e,r),e.prototype.template="changePwdMain";var a=require("./enum");return e.prototype.getEntity=function(){var e=r.prototype.getEntity.apply(this,arguments);return e},e.prototype.bindEvents=function(){r.prototype.bindEvents.apply(this,arguments),$("form :input").on("blur",function(e){var i=this;intervalTimer=setTimeout(function(){t(i)},200)}),this.get("quantityReview").on("click",i,this)},e.prototype.uiProperties={},e.prototype.uiEvents={},e}),define("pubData/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"account")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={dataList:{name:"publicity/getCurrentStatus",scope:"instance",policy:"auto",options:{method:"GET",url:"/publicity/getCurrentStatus"}},pubDataSearch:{name:"publicity/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/publicity/search"}},getDataDetail:{name:"getDatadetail",scope:"instance",policy:"auto",options:{method:"GET",url:"/publicity/detail"}},deleteData:{name:"deleteData",scope:"instance",policy:"auto",options:{method:"GET",url:"/publicity/delete"}},changePassword:{name:"publicity/updatePassword",scope:"instance",policy:"auto",options:{method:"POST",url:"/publicity/updatePassword"}},getUploadLog:{name:"publicity/getUploadLog",scope:"instance",policy:"auto",options:{method:"GET",url:"/publicity/getXmlUploadLog"}},deleteBatch:{name:"publicity/deleteBatch",scope:"instance",policy:"auto",options:{method:"GET",url:"/publicity/deleteBatch"}},getCookieNum:{name:"publicity/rememberMe",scope:"instance",policy:"auto",options:{method:"POST",url:"/publicity/rememberMe"}}};e.prototype.dataList=function(e){var t=this.request("publicity/getCurrentStatus",e);return t},e.prototype.pubDataSearch=function(e){var t=this.request("publicity/search",e);return t},e.prototype.getDatadetail=function(e){var t=this.request("getDatadetail",e);return t},e.prototype.deleteData=function(e){var t=this.request("deleteData",e);return t},e.prototype.deleteBatch=function(e){var t=this.request("publicity/deleteBatch",e);return t},e.prototype.updatePassword=function(e){var t=this.request("publicity/updatePassword",e);return t},e.prototype.getUploadLog=function(e){var t=this.request("publicity/getUploadLog",e);return t},e.prototype.getCookieNum=function(e){var t=this.request("publicity/rememberMe",e);return t};var o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("pubData/ChangePwdModel",["require","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/FormModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:e.get("title")}];return t}},e.prototype.sendPassword=function(e){var t=this.data();return t.updatePassword(e)},e}),define("pubData/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/pubData/form",type:"pubData/Form",title:"当前状态"},{path:"/pubData/dataHistory",type:"pubData/DataHistory",title:"数据上传记录"},{path:"/pubData/upLoad",type:"pubData/UpLoad",title:"数据上传"},{path:"/pubData/changePwd",type:"pubData/ChangePwd",title:"修改口令"},{path:"/pubData/wsInterface",type:"pubData/WSInterface",title:"WS数据接口"},{path:"/pubData/read",type:"pubData/ReadData",title:"数据上传-数据详情",args:{formType:"changePassword"},auth:["PUBDATA_READ"]}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"pubData",description:"数据"}}),define("pubData/ChangePwd",["require","underscore","ub-ria/mvc/FormAction","ub-ria/mvc/ListAction","er/util","./config","common/base/BaseForm","esui/lib","./ChangePwdModel","./ChangePwdView"],function(require){function e(){i.apply(this,arguments)}function t(e){var t=e.args;this.model.sendPassword(t).then(function(e){var t=e.resultValue,i=e.resultKey;if("5"===i)a.g("oldPasswordTip").innerHTML=t;else if("6"===i)a.g("newPwdTip").innerHTML=t;else if("4"===i)a.g("repeatPwdTip").innerHTML=t;else if("10"===i)a.removeClass(a.g("changePwd-result"),"hidden")})}var i=(require("underscore"),require("ub-ria/mvc/FormAction")),n=(require("ub-ria/mvc/ListAction"),require("er/util")),r=require("./config"),o=require("common/base/BaseForm"),a=require("esui/lib");return n.inherits(e,i),e.prototype.group="default",e.prototype.entityDescription=r.description,e.prototype.modelType=require("./ChangePwdModel"),e.prototype.viewType=require("./ChangePwdView"),e.prototype.initBehavior=function(){o.prototype.initBehavior.apply(this,arguments),this.view.on("quantityReview",t,this)},e}),define("log/ListView",["require","er/util","ub-ria/mvc/ListView","tpl!8ab58a8b.tpl.html"],function(require){function e(){n.apply(this,arguments)}function t(){var e=this.get("userName").getValue(),t=this.get("rangeCalendar").getValue(),i=t.split(","),n=i[0],r=i[1];this.fire("btnsearch",{args:{userName:e,startDate:n,endDate:r}})}var i=require("er/util"),n=require("ub-ria/mvc/ListView");require("tpl!8ab58a8b.tpl.html"),i.inherits(e,n),e.prototype.template="logList";var r=[{title:"姓名",field:"userName",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.userName}},{title:"用户",field:"loginName",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.loginName}},{title:"部委",field:"depName",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.depName}},{title:"操作时间",field:"opTime",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.opTime}},{title:"操作对象",field:"opLevel",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.opLevel}},{title:"操作事项",field:"opContent",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=i.encodeHTML(e.opContent);return'<div class="ellipsistext" title="'+t+'">'+e.opContent+"</div>"}}];return e.prototype.tableFields=r,e.prototype.uiProperties={table:{fields:r}},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};delete t.rangeCalendar,t.order=this.get("table").order,t.orderBy=this.get("table").orderBy,t.pageSize=this.get("pager").get("pageSize");var i=this.get("rangeCalendar").getValue().split(",");return t.startDate=i[0],t.endDate=i[1],t},e.prototype.bindEvents=function(){n.prototype.bindEvents.apply(this,arguments),this.get("search").on("click",t,this),this.get("rangeCalendar").on("change",t,this)},e}),define("log/ListModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","moment","er/datasource"],function(require){function e(){n.apply(this,arguments),this.addData(new r),this.addData("global",o.getInstance())}function t(){var e=a(new Date).format("YYYY-MM-DD"),t=a(e),i=t.clone().subtract("day",7).toDate(),n=t.clone().subtract("day",0).subtract("second",1).toDate();return i=a(i).format("YYYY-MM-DD HH:mm:ss"),n=a(n).format("YYYY-MM-DD HH:mm:ss"),{begin:i,end:n}}var i=(require("underscore"),require("er/util")),n=require("ub-ria/mvc/ListModel"),r=require("./Data"),o=require("common/GlobalData"),a=require("moment");i.inherits(e,n),n.prototype.statusTransitions=[{status:0,deny:[0]},{status:1,deny:[1]}];var s=require("er/datasource"),l=[{href:"",text:"系统日志"}];return e.prototype.datasource={crumbPath:s.constant(l)},e.prototype.defaultArgs={},e.prototype.prepare=function(){if("undefined"!=typeof this.get("startDate"))this.set("rangeDate",this.get("startDate")+","+this.get("endDate"));else{var e=t();this.set("rangeDate",e.begin+","+e.end)}},e.prototype.getDefaultArgs=function(){var e={},i=t();e.startDate=i.begin,e.endDate=i.end;var n=this.get("userName");if(n)e.userName=n;return e},e.prototype.getQuery=function(){var e=n.prototype.getQuery.apply(this,arguments);return e.pageSize=this.get("pageSize")||20,e.userName=this.get("userName"),e.startDate=this.get("startDate"),e.endDate=this.get("endDate"),e},e}),define("log/List",["require","er/util","er/URL","./config","ub-ria/mvc/ListAction","./ListModel","./ListView"],function(require){function e(){s.apply(this,arguments)}function t(e){var t="/log/list";t=o.withQuery(t,e).toString(),this.redirect(t,{force:!0})}function i(e){if(this.reloadWithQueryUpdate(e.args),!e.args.userName)delete e.args.userName;t.call(this,e.args)}function n(e){var i=this.getSearchQuery();if(delete i.order,delete i.orderBy,!i.userName)delete i.userName;return t.call(this,i),e.isDefaultPrevented=function(){return!0},e}var r=require("er/util"),o=require("er/URL"),a=require("./config"),s=require("ub-ria/mvc/ListAction");return r.inherits(e,s),e.prototype.group="default",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.performSearch=function(){var e=this.getSearchQuery();if(!e.userName)delete e.userName;t.call(this,e)},e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("btnsearch",i,this),this.on("pagechange",n,this)},e}),define("log/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports}),define("log/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"log")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={search:{name:"log/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/oplog/list"}},list:{name:"log/list",scope:"instance",policy:"auto"},save:{name:"log/save",scope:"instance",policy:"auto"},update:{name:"log/update",scope:"instance",policy:"auto"},remove:{name:"log/remove",scope:"instance",policy:"auto"},restore:{name:"log/restore",scope:"instance",policy:"auto"},findById:{name:"log/findById",scope:"instance",policy:"auto"},tree:{name:"log/tree",scope:"instance",policy:"auto"}},o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("log/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/log/list",type:"log/List",title:"日志 - 列表",auth:["LOG_VIEW"]},{path:"/log/create",type:"log/Form",title:"新建日志",args:{formType:"create"},auth:["LOG_MODIFY"]},{path:"/log/update",type:"log/Form",title:"修改日志",args:{formType:"update"},auth:["LOG_MODIFY"]},{path:"/log/view",type:"log/Read",title:"查看日志信息",auth:["LOG_VIEW"]},{path:"/log/read",movedTo:"log/view"}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"log",description:"日志"}}),define("error/View",["require","ef/UIView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("ef/UIView"),i=require("er/util");return e.prototype.uiEvents={"reload:click":function(){this.fire("reload")},"goHome:click":function(){this.fire("goHome")}},i.inherits(e,t),e}),define("error/NotFound",["require","./View","./Action","tpl!8ab58a8b.tpl.html","er/util"],function(require){function e(){i.apply(this,arguments)}var t=require("./View"),i=require("./Action");return require("tpl!8ab58a8b.tpl.html"),e.prototype.createView=function(){var e=new t;return e.name="not-found",e.template="notFound",e},require("er/util").inherits(e,i),e}),define("department/PeopleFormView",["require","er/util","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),t.inherits(e,i),e.prototype.template="peopleDepartmentForm",e.prototype.getEntity=function(){var e=i.prototype.getEntity.apply(this,arguments),t=this.model;if("undefined"!=typeof t.get("id"))e.id=t.get("id");else e.deptid=t.get("deptid");return e},e.prototype.uiProperties={},e.prototype.uiEvents={},e}),define("department/PeopleFormModel",["require","er/util","common/base/BaseModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("common/base/BaseModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={},e.prototype.addUser=function(e){var t=this.data();return t.addUser(e)},e}),define("department/PeopleForm",["require","common/base/BaseForm","er/util","./config","./PeopleFormModel","./PeopleFormView"],function(require){function e(){t.apply(this,arguments)}var t=require("common/base/BaseForm"),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./PeopleFormModel"),e.prototype.viewType=require("./PeopleFormView"),e.prototype.submitEntity=function(e){var t=this;this.model.addUser(e).then(function(){t.fire("ok",e)})},e.prototype.cancelEdit=function(){this.fire("cancel")},e}),define("department/ListView",["require","underscore","er/util","esui/lib","ub-ria/mvc/ListView","tpl!8ab58a8b.tpl.html","esui/Table","common/util/download"],function(require){function e(){c.apply(this,arguments)}function t(e){var t=this,i=e.args,r=this.get("tree"),o=r.getSelectedNodes();switch(e.name){case"edits":var a=i.split(","),s={id:a[0],name:a[1],loginName:a[2],deptname:a[3],deptid:o[0].id},l={url:"/department/createpeople",title:"修改人员",options:s};n.call(this,l);break;case"delete":var u=this.confirm("你确认要删除么？","提示信息");u.on("ok",function(){t.fire("delete",{args:{ids:[i],selectedId:o[0].id}})})}}function i(){var e=this,t=[];if(s.each(this.getSelectedItems(),function(e){t.push(e.id)}),!t.length)return void this.alert("请先选择需要删除的人员");var i=this.get("tree"),n=i.getSelectedNodes(),r=this.confirm("你确认要删除么？","提示信息");r.on("ok",function(){e.fire("delete",{args:{ids:t,selectedId:n[0].id}})})}function n(e){var t=this,i=this.popActionDialog({
url:e.url,title:e.title,width:600,actionOptions:e.options});i["onaction@ok"]=function(n){i.dispose(),t.fire("reload",{selectedId:e.options.deptid})},i["onaction@cancel"]=function(){i.dispose()}}function r(){var e=this.get("tree"),t=e.getSelectedNodes();if(!t.length)return void this.alert("新建人员请先选择组织架构");var i={url:"/department/createpeople",title:"新增人员",options:{deptname:t[0].text,deptid:t[0].id}};n.call(this,i)}function o(e){var t=e.node;u.g("goform").href="#/department/form~selectedId="+t.id,this.fire("treeSelect",{args:t})}function a(){var e=require("common/util/download");e.iframePost("/user/outExcel","","","window.downLoad")}var s=require("underscore"),l=require("er/util"),u=require("esui/lib"),c=require("ub-ria/mvc/ListView");require("tpl!8ab58a8b.tpl.html"),l.inherits(e,c),e.prototype.template="departmentList";var d=[{title:"姓名",field:"name",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.name}},{title:"登录账号",field:"loginName",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.loginName}},{title:"所属部门",field:"deptname",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){return e.deptname}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:80,stable:!0,content:function(e){var t=[{command:"edits",type:"edits",args:e.id+","+e.name+","+e.loginName+","+e.deptname,text:"编辑"},{command:"delete",type:"delete",args:e.id,text:"删除"}],i=require("esui/Table");return i.operations(t)}}];return e.prototype.uiProperties={},e.prototype.uiEvents={"table:command":t,"delete:click":i,"create:click":r,"tree:select":o},e.prototype.tableFields=d,e.prototype.getSearchArgs=function(){var e={};e.pageSize=this.get("pager").get("pageSize");var t=this.get("tree"),i=t.getSelectedNodes();if(i&&i.length)e.selectedId=i[0].id;return e},e.prototype.bindEvents=function(){c.prototype.bindEvents.apply(this,arguments);var e=this.get("tree");e.selectNode(this.model.get("selectedId"),!0);var t=this.get("download");t.on("click",a,this);var i=this.model.get("parentNodeIds");s.each(i,function(t){e.expandNode(t)}),u.removeClass(e.main,"ui-tree-content-wrapper-selected")},e}),define("department/ListModel",["require","underscore","er/util","esui/lib","ub-ria/mvc/ListModel","./Data","common/GlobalData","esui/TreeStrategy","er/datasource"],function(require){function e(){o.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance())}function t(e,t){function n(t){i.each(t,function(t){var i=r.deepClone(t);if(delete i.children,o[i.id]=i,t.id===+e)a=t;n(t.children)})}if(!t.children||!t.children.length)return[];var o={},a={};if(n(t.children),!o[e])a=t.children[0],e=a.id;for(var s=r.deepClone(a),l=[e];0!==s.pid;){var u=s.pid;l.unshift(o[u].id),s=o[u]}return{parentNodeIds:l,selectedId:e}}var i=require("underscore"),n=require("er/util"),r=require("esui/lib"),o=require("ub-ria/mvc/ListModel"),a=require("./Data"),s=require("common/GlobalData"),l=require("esui/TreeStrategy");n.inherits(e,o),o.prototype.statusTransitions=[{status:0,deny:[0]},{status:1,deny:[1]}];var u=require("er/datasource");return e.prototype.datasource={crumbPath:function(e){var t=[{text:"组织架构和人员"}];return t},useTableCommand:u.constant(!0),strategy:function(e){return new l},treeSourcetmp:[{treeSource:function(e){return e.getTreeSource()}},{selectedId:function(e){var i;if("undefined"==typeof e.get("selectedId")){var n=e.get("treeSource"),r=n.children;if(r&&r.length)i=r[0].id}else i=e.get("selectedId");var o=t.call(e,i,e.get("treeSource")),a=o.parentNodeIds;return i=o.selectedId,e.set("parentNodeIds",a),i}}],showTrue:function(){return!0},selectMode:u.constant("multi")},e.prototype.defaultArgs={orderBy:"",order:"",status:""},e.prototype.getTreeSource=function(){var e=this.data();return e.getTreeSource()},e.prototype.remove=function(e){var t=this.data();return t.remove(e)},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=o.prototype.getQuery.apply(this,arguments);return e.deptid=this.get("selectedId"),e},o.prototype.getPeopleList=function(e){var t=this.data();return t.getPeopleList(e)},e}),define("department/List",["require","er/util","./config","ub-ria/mvc/ListAction","./ListModel","./ListView"],function(require){function e(){s.apply(this,arguments)}function t(e){}function i(e){var t=e.args.ids,i=e.args.selectedId,n=this;this.model.remove(t).then(function(){n.redirect("/department/list~selectedId="+i,{force:!0})})}function n(e){var t=e.args.id,i=this,n={deptid:t,page:1};this.model.getPeopleList(n).then(function(e){var t=i.view,n=t.get("table"),r=t.get("pager");n.setDatasource(e.results),r.set("count",e.totalCount)})}function r(e){this.redirect("/department/list~selectedId="+e.selectedId,{force:!0})}var o=require("er/util"),a=require("./config"),s=require("ub-ria/mvc/ListAction");return o.inherits(e,s),e.prototype.group="default",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("edit",t,this),this.view.on("delete",i,this),this.view.on("treeSelect",n,this),this.view.on("reload",r,this)},e}),define("department/FormView",["require","underscore","er/util","esui/lib","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){u.apply(this,arguments)}function t(e){l.g("d-name").innerHTML=e.text,l.g("d-p-name").innerHTML=e.ptext||"--",l.g("d-order").innerHTML="undefined"!=typeof e.order?e.order:"",l.g("d-p-name-update").innerHTML='<span class="form-field-value-required-star"></span>'+(e.ptext||"--"),this.get("deptNamePanel").setValue(e.text),this.get("orderPanel").setValue(e.order)}function i(e){var i=e.node;t.call(this,i)}function n(e){var t=e.node,i=t.id;this.fire("goPeopleList",{selectedId:i})}function r(e){var t=this,i=e.target.id,n=0,r=this.get("tree"),o=r.getSelectedNodes(),a="新增平级单位";if(!o||!o.length)o=[{id:0,text:""}];if("addDepart"!==i)n=1,a="新增下级单位";var s=this.popActionDialog({url:"/department/createform",title:a,width:500,actionOptions:{type:n,node:o}});s["onaction@ok"]=function(e){s.dispose(),t.fire("reload",{id:o[0].id})},s["onaction@cancel"]=function(){s.dispose()}}function o(e){var t,i,n=e.target,r=this.get("updatePanel"),o=this.get("savePanel");if("updateDepart"===n.id)t=n,i=this.get("saveDepart"),t.hide(),i.show(),r.hide(),o.show();else{var a=this.get("formPanel");if(!a.validate())return;var s=this.get("deptNamePanel").getValue(),l=this.get("orderPanel").getValue(),u=this.get("tree").getSelectedNodes()[0].id,c={data:{deptName:s,order:l,deptId:u,type:2}};this.fire("update",c)}}var a=require("underscore"),s=require("er/util"),l=require("esui/lib"),u=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),s.inherits(e,u),e.prototype.template="departmentForm",e.prototype.getEntity=function(){var e=u.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiProperties={},e.prototype.uiEvents={"tree:select":n,"tree:selectnode":i,"addDepart:click":r,"addLowDepart:click":r,"updateDepart:click":o,"saveDepart:click":o},e.prototype.bindEvents=function(){u.prototype.bindEvents.apply(this,arguments);var e=this.get("updateDepart"),t=this.model.get("treeSource");if(t.children&&t.children.length)e.removeState("hidden");var i=this.get("tree");i.selectNode(this.model.get("selectedId"));var n=this.model.get("parentNodeIds");a.each(n,function(e){i.expandNode(e)}),l.removeClass(i.main,"ui-tree-content-wrapper-selected")},e}),define("department/FormModel",["require","underscore","er/util","esui/lib","ub-ria/mvc/FormModel","./Data","common/GlobalData","esui/TreeStrategy"],function(require){function e(){o.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance())}function t(e,t){function n(t){i.each(t,function(t){var i=r.deepClone(t);if(delete i.children,o[i.id]=i,t.id===+e)a=t;n(t.children)})}if(!t.children||!t.children.length)return[];var o={},a={};if(n(t.children),!o[e])a=t.children[0],e=a.id;for(var s=r.deepClone(a),l=[e];0!==s.pid;){var u=s.pid;l.unshift(o[u].id),s=o[u]}return{parentNodeIds:l,selectedId:e}}var i=require("underscore"),n=require("er/util"),r=require("esui/lib"),o=require("ub-ria/mvc/FormModel"),a=require("./Data"),s=require("common/GlobalData"),l=require("esui/TreeStrategy");return n.inherits(e,o),e.prototype.datasource={crumbPath:function(e){var t=[{text:"组织架构和人员"}];return t},showTrue:function(){return!0},strategy:function(e){return new l},treeSourcetmp:[{treeSource:function(e){return e.getTreeSource()}},{selectedId:function(e){var i;if("undefined"==typeof e.get("selectedId")){var n=e.get("treeSource"),r=n.children;if(r&&r.length)i=r[0].id}else i=e.get("selectedId");var o=t.call(this,i,e.get("treeSource")),a=o.parentNodeIds;return i=o.selectedId,e.set("parentNodeIds",a),i}}],global:function(e){return e.data("global").getSystem()}},e.prototype.getTreeSource=function(){var e=this.data();return e.getTreeSource()},e.prototype.update=function(e){var t=this.data();return t.save(e)},e}),define("department/Form",["require","ub-ria/mvc/FormAction","er/util","./config","./FormModel","./FormView"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=e.data,i=this;this.model.update(t).done(function(){i.reload()})}function i(e){this.redirect("/department/form~selectedId="+e.id,{force:!0})}function n(e){this.redirect("/department/list~selectedId="+e.selectedId,{force:!0})}var r=require("ub-ria/mvc/FormAction"),o=require("er/util"),a=require("./config");return o.inherits(e,r),e.prototype.group="default",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./FormModel"),e.prototype.viewType=require("./FormView"),e.prototype.initBehavior=function(){r.prototype.initBehavior.apply(this,arguments),this.view.on("update",t,this),this.view.on("reload",i,this),this.view.on("goPeopleList",n,this)},e}),define("department/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports}),define("department/CreateFormView",["require","er/util","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),t.inherits(e,i),e.prototype.template="createDepartmentForm",e.prototype.getEntity=function(){var e=i.prototype.getEntity.apply(this,arguments),t=this.model,n=t.get("node")[0];return e.type=t.get("type"),e.deptId=n.id,e},e.prototype.uiProperties={},e.prototype.uiEvents={},e}),define("department/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"department")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={tree:{name:"department/tree",scope:"instance",policy:"auto",options:{method:"GET",url:"/departments"}},search:{name:"department/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/department/findUsers"}},list:{name:"department/list",scope:"instance",policy:"auto"},save:{name:"department/save",scope:"instance",policy:"auto",options:{method:"POST",url:"/department/addParallel"}},update:{name:"department/update",scope:"instance",policy:"auto"},remove:{name:"department/remove",scope:"instance",policy:"auto",options:{method:"POST",url:"/department/delUsers"}},addUser:{name:"department/addUser",scope:"instance",policy:"auto",options:{method:"POST",url:"/department/addUser"}},restore:{name:"department/restore",scope:"instance",policy:"auto"},findById:{name:"department/findById",scope:"instance",policy:"auto"},getDepartmentInfo:{name:"department/getDepartmentInfo",scope:"instance",policy:"auto",options:{method:"GET",url:"/department/getDepartmentInfo"}}},o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e.prototype.getTreeSource=function(){var e=this.request("department/tree");return e},e.prototype.remove=function(e){var t=this.request("department/remove",{ids:e});return t},e.prototype.getPeopleList=function(e){var t=this.request("department/search",e);return t},e.prototype.addUser=function(e){var t=this.request("department/addUser",e);return t},e.prototype.getDepartmentInfo=function(e){var t=this.request("department/getDepartmentInfo",{templateId:e});return t},e}),define("department/CreateFormModel",["require","er/util","common/base/BaseModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("common/base/BaseModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={info:function(e){var t,i,n=e.get("node")[0];if(0===e.get("type"))t=n.ptext,i=n.pid;else t=n.text,i=n.id;e.set("ptext",t||"--"),e.set("deptId",i)},global:function(e){return e.data("global").getSystem()}},e}),define("department/CreateForm",["require","esui/lib","common/base/BaseForm","er/util","./config","./CreateFormModel","./CreateFormView"],function(require){function e(){t.apply(this,arguments)}var t=(require("esui/lib"),require("common/base/BaseForm")),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./CreateFormModel"),e.prototype.viewType=require("./CreateFormView"),e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},e.prototype.submitHandler=function(e,t){t.fire("ok",e)},e.prototype.cancelEdit=function(){this.fire("cancel")},e}),define("department/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/department/list",type:"department/List",title:"组织架构和人员 - 列表",auth:["DEPARTMENT_VIEW"]},{path:"/department/form",type:"department/Form",title:"组织架构和人员信息",args:{formType:"create"},auth:["DEPARTMENT_MODIFY"]},{path:"/department/createform",type:"department/CreateForm",title:"新建组织架构",args:{formType:"create"},auth:["DEPARTMENT_MODIFY"]},{path:"/department/createpeople",type:"department/PeopleForm",title:"新建人员信息",auth:["DEPARTMENT_MODIFY"]},{path:"/department/read",movedTo:"department/view"}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"department",description:"组织架构和人员"}}),define("common/util/minimessage",["require","underscore","er/util","esui/lib","ub-ria/mvc/RequestManager","ub-ria/mvc/RequestStrategy","common/permission"],function(require){function e(){r.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("esui/lib"),r=require("ub-ria/mvc/RequestManager"),o=require("ub-ria/mvc/RequestStrategy"),a=require("common/permission");i.inherits(e,r);var s='<dd><a href="#/channel/view~from=reviewList&articleId=${id}" title="${title}">${title}</a></dd>';e.prototype.render=function(e){n.g("mini-message-count").innerHTML=e.unAuditCount;var i=["<dt>待审批文章</dt>"];t.each(e.unAuditList,function(e){var t=n.format(s,e);i.push(t)}),n.g("mini-message-list").innerHTML=i.join(""),n.removeClass("mini-message","hidden")},e.prototype.loadAuditLists=function(){var e=this,t=this.request("message/unAuditList",null,{method:"GET",url:"/auditPending/unAuditList"});return t.then(function(t){if(t.unAuditList.length)e.render(t)})};var l=!1;e.prototype.bindEvents=function(){n.on("mini-message-info","click",function(){if(l=!l)n.addClass("mini-message","mini-message-open");else n.removeClass("mini-message","mini-message-open")}),n.on("mini-message-list","click",function(){n.removeClass("mini-message","mini-message-open")})},e.prototype.start=function(){if(a.isChiefEditor()||a.isAuditor())this.loadAuditLists(),this.interval=setInterval(t.bind(this.loadAuditLists,this),6e4),this.bindEvents()},e.prototype.stop=function(){clearInterval(this.interval),n.addClasses("mini-message","hidden")};var u={loadAuditLists:{name:"message/unAuditList",scope:"global",policy:"abort"}};t.each(u,function(t){var i=require("ub-ria/mvc/RequestManager");i.register(e,t.name,t)});var c=new e;return c.setRequestStrategy(new o),e.getInstance=function(){return c},e}),define("common/util/gotop",["require"],function(require){function e(){i()}function t(e){var t=$(window).scrollTop();if(t>200)$("#gotop").show();else $("#gotop").hide()}function i(){$(window).off("scroll",t),$(window).on("scroll",t),$("#gotop").on("click",function(){$(window).scrollTop(0)})}function n(){$(window).off("scroll",t),$("#gotop").hide()}return{init:e,unBind:n}}),define("common/util/globalLoading",["require","esui/lib"],function(require){var e=require("esui/lib"),t=null;return{show:function(){if(t)clearTimeout(t);t=setTimeout(function(){e.removeClass(e.g("global-loading"),"hidden")},600)},hide:function(){if(t)clearTimeout(t),e.addClass(e.g("global-loading"),"hidden");e.removeClass("hidden")}}}),define("common/util/fixedbugtable",["require"],function(require){var exports={};return exports.fixedbugToWidth=function(){var e=this.get("table");if(e){var t=e.helper.getPart("body");if(t){t.style.overflow="visible";var i=t.getElementsByTagName("table")[0],n=$(i).width()+40+"px",r=e.helper.getPart("head");t.style.width=n,r.style.width=n}}},exports}),define("common/util/download",["require","esui/lib"],function(require){function e(e){return e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')}function t(){var e=n.g(r);if(!e){var e=document.createElement("iframe"),t=1,i="-1000px";e.id=r,e.width=t,e.height=t,e.src="about:blank",e.style.position="absolute",e.style.top=i,e.style.left=i,document.body.appendChild(e)}return e}function i(i,r,a,s){var l=t();a=decodeURIComponent(a);var u=l.contentWindow.document;u.open("text/html"),u.write(n.format(o,{0:e(i+"?t="+(new Date).getTime()+"&"+(r?r:"")),1:(a?'"'+e(a)+"&":'"')+"__callbackName__="+s+'"'})),u.close()}var n=require("esui/lib"),r="__PostIframe__",o='<html><head></head><body><script type="text/javascript">window.onload = function(){var form = document.getElementById("__PostIframeForm__");form.submit();};</script><form id="__PostIframeForm__" method="POST" action="${0}"><input type="text" name="__PostIframeParamsName__" id="__PostIframeParams__" value=${1} /></form></body></html>';return{iframePost:i}}),define("common/util/backspace",["require"],function(require){function e(){function e(e){var t=e||window.event,i=t.target||t.srcElement,n=i.type||i.getAttribute("type"),r=i.readOnly,o=i.disabled;r="undefined"==typeof r?!1:r,o="undefined"==typeof o?!1:o;var a=!(8!==t.keyCode||"password"!==n&&"text"!==n&&"textarea"!==n||r!==!0&&o!==!0),s=8===t.keyCode&&"password"!==n&&"text"!==n&&"textarea"!==n;if(s||a)return!1;else return void 0}document.onkeypress=e,document.onkeydown=e}return{init:e}}),define("common/main",["require","common/extension/ajax","er/Deferred","./GlobalData","common/util/backspace","common/util/minimessage","common/permission"],function(require){function e(){var e=s.getInstance();return a.all(e.loadUser(),e.loadSystem(),e.loadChannelsEnum(),e.loadReviewStatusEnum())}function t(){var e=["startup/ui","startup/ria","startup/biz"];return a.require(e)}function i(){var e=["er/config","er/permission","ub-ria","common/extension","common/layout","common/config","channel/config","department/config","record/config","siteMessage/config","template/config","role/config","account/config","log/config","pubData/config"];if("object"!=typeof JSON)e.push("js!external/json2.js");require(e,function(e,t,i,r,o){r.enable(),e.indexURL=n(),o.init(),i.start(),require("common/util/backspace").init(),require("common/util/minimessage").getInstance().start()})}function n(){return require("common/permission").getIndex()}function r(){var e=window.DEBUG?"main.html":"login.html";throw location.href=e+location.hash,new Error("Failed to redirect to index")}function o(){e().then(t,r).then(i)}require("common/extension/ajax").enable();var a=require("er/Deferred"),s=require("./GlobalData");return{start:o}}),define("common/gray",["require","./egg/config"],function(require){for(var e=Math.random(),t=require("./egg/config"),i=[],n=0;n<t.length;n++){var r=t[n];if(r.ratio>=e)i.push("common/egg/"+r.name)}if(i.length)window.require(i,function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if("function"==typeof t.enable)t.enable()}})}),define("common/extension",["require","./extension/util","./extension/ajax","./extension/mvc","./extension/ui"],function(require){return{enable:function(){require("./extension/util").enable(),require("./extension/ajax").enable(),require("./extension/mvc").enable(),require("./extension/ui").enable()}}}),define("common/extension/util",["require","underscore","moment","moment/lang/zh-cn","ub-ria/util"],function(require){function e(){i.lang("zh-cn"),t.extend(t,require("ub-ria/util"))}var t=require("underscore"),i=require("moment");return require("moment/lang/zh-cn"),{enable:t.once(e)}}),define("common/extension/ui",["require","underscore","esui/lib","../GlobalData","esui/Table","esui/Form","esui/Pager","esui/TextBox"],function(require){function e(){var e=require("esui/Table");e.defaultProperties.sortable=!0,e.defaultProperties.columnResizable=!0,e.defaultProperties.select="multi",e.defaultProperties.followHead=!1,e.defaultProperties.breakLine=!0,e.defaultProperties.encode=!0;var t=require("esui/Form");t.defaultProperties.autoValidate=!0;var r=require("esui/Pager"),o=n.getInstance().getUser().authorityAlias;if(o.DATAUPLOAD===!0)r.prototype.defaultProperties.pageSizes=[10],r.prototype.defaultProperties.pageSize=10;else r.prototype.defaultProperties.pageSizes=[20],r.prototype.defaultProperties.pageSize=20;var a=require("esui/TextBox");a.prototype.getRawValue=function(){var e=i.g(this.inputId);return i.trim(e?e.value:this.rawValue||this.value||"")}}var t=require("underscore"),i=require("esui/lib"),n=require("../GlobalData");return{enable:t.once(e)}}),define("common/extension/mvc",["require","underscore"],function(require){function e(){}var t=require("underscore");return{enable:t.once(e)}}),define("common/extension/ajax",["require","underscore","er/util","er/ajax","common/common","../GlobalData"],function(require){function e(){l.config.cache=!1,l.config.timeout=15e12,l.config.charset="utf-8"}function t(){var e={json:"application/json"};l.hooks.beforeExecute=function(t){if(t.contentType&&e.hasOwnProperty(t.contentType))t.contentType=e[t.contentType];var i=require("common/common");if("json"===t.dataType){var n=i.getTargetId();if(!t.data)t.data={};t.data.targetId=""+n}}}function i(){var e=require("../GlobalData"),t=(new e).getUser();l.hooks.beforeSend=function(e,i){var n=i.method.toUpperCase();if(t.sessionToken&&("POST"===n||"PUT"===n))e.setRequestHeader("X-Session-Token",t.sessionToken)}}function n(){function e(){i=!1}var t={403:{name:"not-authorized",title:"登录超时",message:"系统登录超时，请重新登录再试。",handler:function(){var e=window.DEBUG?"main.html":"login.html";location.href=e+location.hash}},200:{name:"timeout",title:"登录超时",message:"您长时间未操作系统，为保证安全请重新登录。",handler:function(){}},500:{name:"server-error",title:"系统错误",message:"系统发生错误，请稍后再试。",handler:function(){}}},i=!1;l.on("fail",function(n){if(!n.options.background)if(!i){var r=t[n.xhr.status];if(r)i=!0,window.require(["esui/Dialog"],function(t){var i=n.xhr,o=r.title,a=r.message;if(500===i.status){var l=s.parseJSON(i.responseText);o="提示信息",a=l.message}var u={title:o,content:a},c=t.alert(u);if(r.handler)c.on("ok",r.handler),c.on("ok",e),c.on("close",e)})}})}function r(){l.hooks.serializeData=function(e,t){if(1===arguments.length)t=e,e="";if(null==t)t="";var i=l.hooks.serializeData.getKey,n=e?encodeURIComponent(e):"",r=Object.prototype.toString.call(t);switch(r){case"[object Array]":return l.hooks.serializeArray(e,t);case"[object Object]":var o=[];for(var a in t){var s=i(a,e),u=l.hooks.serializeData(s,t[a]);if(u)o.push(u)}return o.join("&");default:return n?n+"="+encodeURIComponent(t):encodeURIComponent(t)}},l.hooks.serializeData.getKey=function(e,t){return t?t:e},l.hooks.serializeArray=function(e,t){for(var i=e?encodeURIComponent(e):"",n=[],r=0;r<t.length;r++){var o=t[r];n[r]=l.hooks.serializeData("",o)}var s="";if(i)a.each(n,function(e){s+="&"+i+"="+e});else return n.join("&");return s.slice(1)}}function o(){e(),t(),i(),n(),r()}var a=require("underscore"),s=require("er/util"),l=require("er/ajax");return{enable:a.once(o)}}),define("common/egg/config",["require"],function(require){return[{name:"downloadLogo",ratio:0}]}),define("error/Action",["require","ub-ria/mvc/BaseAction","er/Model","common/common","common/permission","er/util","er/config"],function(require){function e(){i.apply(this,arguments)}function t(){var e=r.getTargetId(),t=o.getIndex();this.redirect(t+"~targetId="+e)}var i=require("ub-ria/mvc/BaseAction"),n=require("er/Model"),r=require("common/common"),o=require("common/permission");return require("er/util").inherits(e,i),e.prototype.createModel=function(){var e=new n;return e.set("indexURL",require("er/config").indexURL),e},e.prototype.initBehavior=function(){this.view.on("reload",this.reload,this),this.view.on("goHome",t,this)},e}),define("error/GenericError",["require","./Action","./View","tpl!8ab58a8b.tpl.html","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("./Action"),i=require("./View");return require("tpl!8ab58a8b.tpl.html"),e.prototype.createView=function(){var e=new i;return e.name="generic-error",e.template="genericError",e},require("er/util").inherits(e,t),e}),define("error/config",["require","underscore","./GenericError","er/controller"],function(require){var e=require("underscore");require("./GenericError");var t=[{path:"/404",type:"error/NotFound",title:"无法找到页面"},{path:"/400",type:"error/GenericError",title:"出现未知问题"}],i=require("er/controller");e.each(t,i.registerAction,i)}),define("common/config",["require","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","error/config","er-track","er/events","er/controller"],function(require){require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),require("error/config");var e=require("er-track").create();if(e.includeAll(),window.DEBUG)e.use("console");e.start();var t=require("er/events");t.on("actionfail",function(e){if(!e.isChildAction){var t=require("er/controller");t.renderAction("/400")}}),t.on("enteractionfail",function(e){if(!e.isChildAction){var t=require("er/controller");t.renderAction("/400")}})}),define("common/base/BaseListModel",["require","er/util","ub-ria/mvc/ListModel","ub-ria/mvc/EntityValidator"],function(require){function e(){i.apply(this,arguments),this.setValidator(new n)}var t=require("er/util"),i=require("ub-ria/mvc/ListModel"),n=require("ub-ria/mvc/EntityValidator");return t.inherits(e,i),e}),define("channel/VerifyFormView",["require","underscore","etpl","er/util","esui/lib","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html","./enum"],function(require){function e(){l.apply(this,arguments)}function t(){this.fire("reload")}function i(e){var t=e.target.getSelectedItem().roletype,i=this.model.get("roleAndNameMap"),n=i[t];this.get("people").set("datasource",n)}function n(){var e=this.model,t=e.get("channelId"),i=d[t],n="",a={channelId:t,homeTitle:e.get("homeTitle"),policySummary:e.get("policySummary")||""};r.each(i.recommend,function(t){var i="verifyChannelImgTpl",r=e.get("articleTypeStr").indexOf([",",t.recommendType,","].join(""))>-1?!0:!1,l={checked:r},u=s.extend(a,l,t);n+=o.render(i,u)});var l=this.get("panel-recommend");l.setContent(n)}var r=require("underscore"),o=require("etpl"),a=require("er/util"),s=require("esui/lib"),l=require("ub-ria/mvc/FormView");require("tpl!8ab58a8b.tpl.html"),a.inherits(e,l),e.prototype.template="verifyChannelForm",e.prototype.getEntity=function(){var e=l.prototype.getEntity.apply(this,arguments),t=this.model,i=s.date.format(t.get("reviewVo").commitTime,"YYYY-MM-DD");return e.commitTime=i,e.auditorId=t.get("reviewVo").auditorId,e.artId=t.get("reviewVo").artId,e.roleName=t.get("reviewVo").roleName,e.sendee=this.get("people").getSelectedItem().type,e};var u=require("./enum"),c=u.VerifyLogFields;e.prototype.uiEvents={"reset:click":t,"role:change":i},e.prototype.uiProperties={reviewTable:{fields:c,select:!1,width:850}};var d=u.formConfig;return e.prototype.bindEvents=function(){l.prototype.bindEvents.apply(this,arguments);var e=this.model.get("from");if("alreadyAuditList"===e)this.get("back").on("click",function(){this.fire("backList")},this);else if("auditList"===e)this.get("cancel").on("click",function(){this.fire("cancel")},this);n.call(this)},e}),define("channel/VerifyFormModel",["require","underscore","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData","./enum"],function(require){function e(){o.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance())}function t(){var e=location.hash.split("~"),t=e[1].split("&");return t=t.slice(1,t.length-1),t.join("&")}var i=require("underscore"),n=require("er/util"),r=require("esui/lib"),o=require("common/base/BaseModel"),a=require("./Data"),s=require("common/GlobalData");n.inherits(e,o);var l=require("./enum");return e.prototype.datasource={crumbPath:function(e){var i=e.get("from"),n=t(),r=[{text:"栏目管理",href:"#/channel/"+i+"~"+n},{text:"审核文章"}];return r},channelInfo:function(e){var t=e.get("articleId");return e.getChannelInfo(t).done(function(t){t.artReviewVoList=t.artReviewVoList||[],e.fill(t);var n=s.getInstance().getChannels().valueNameMap,o=n[t.channelId]||"";if(e.set("channelName",o),"undefined"!=typeof t.informationAttribute)e.set("informationName",l.informationAttributesMap[t.informationAttribute]);if("undefined"!=typeof t.creditHotAttribuite)e.set("creditHotName",l.creditHotAttribuiteMap[t.creditHotAttribuite]);if(e.set("releaseSourceStr",(t.releaseSource||[]).join(",")),e.set("isReprintedStr",l.isReprintedMap[t.isReprinted]),t.reviewVo.commitTime)e.set("commitTimeStr",r.date.format(t.reviewVo.commitTime,"YYYY-MM-DD"));else e.set("commitTimeStr","");if(t.releaseTime)e.set("releaseTimeStr",r.date.format(t.releaseTime,"YYYY-MM-DD"));else e.set("releaseTimeStr","");e.set("organizationStr",l.organizationMap[t.organization]);var a=e.get("roleAndNames"),u={},c=i.map(a,function(e){return u[e.roleType]=i.map(e.userList,function(e){return{name:e.userName,type:e.userId}}),{name:e.roleName,roletype:e.roleType}});e.set("roleAndNameMap",u),e.set("roleTypes",c);var d=a[0].userList,f=i.map(d,function(e){return{name:e.userName,type:e.userId}});e.set("peopleTypes",f);var h=t.articleType||[],p=","+h.join(",")+",";e.set("articleTypeStr",p);var m=t.uuids;if(m&&m.length){var g={};i.each(m,function(e,t){var i=h[t];g[i]=e}),e.set("uuidsObj",g)}else e.set("uuidsObj",{})})},userName:function(e){return e.set("nowTime",r.date.format(new Date,"YYYY-MM-DD")),e.data("global").getUser().username}},e.prototype.getChannelInfo=function(e){var t=this.data();return t.getChannelInfo({articleId:e})},e.prototype.getOrderList=function(e){var t=this.data();return t.getOrderList(e)},e.prototype.saveVerify=function(e){var t=this.data();return t.saveVerify(e)},e}),define("channel/VerifyForm",["require","underscore","ub-ria/mvc/FormAction","ub-ria/mvc/BaseAction","er/util","./config","er/Deferred","ub-ria/mvc/handler/ToastSubmitHandler","ub-ria/mvc/handler/RedirectSubmitHandler","./VerifyFormModel","./VerifyFormView","er/events"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=new d;t.setTemplate("操作成功"),t.handle(e,this);var n=i(),r=this.fire("submitAudit");if(!r.isDefaultPrevented()){var o=new f,a="/channel/auditList~"+n;o.setTemplate(a),o.handle(e,this)}}function i(){var e=location.hash.split("~"),t=e[1].split("&");return t=t.slice(1,t.length-1),t.join("&")}function n(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function r(e){var t=this.view.getEntity();this.view.disableSubmit(),c.when(this.submitEntity(t)).ensure(o.bind(this.view.enableSubmit,this.view));
}var o=require("underscore"),a=require("ub-ria/mvc/FormAction"),s=require("ub-ria/mvc/BaseAction"),l=require("er/util"),u=require("./config"),c=require("er/Deferred"),d=require("ub-ria/mvc/handler/ToastSubmitHandler"),f=require("ub-ria/mvc/handler/RedirectSubmitHandler");return l.inherits(e,a),e.prototype.group="unknown",e.prototype.entityDescription=u.description,e.prototype.modelType=require("./VerifyFormModel"),e.prototype.viewType=require("./VerifyFormView"),e.prototype.submitEntity=function(e){return this.model.saveVerify(e).then(o.bind(t,this),o.bind(n,this))},e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments);var e=i();this.view.on("submit",r,this),this.view.on("backList",function(){this.redirect("/channel/alreadyAuditList~"+e)},this),this.view.on("cancel",function(){this.redirect("/channel/auditList~"+e)},this),this.view.on("reload",function(){this.reload()},this)},e}),define("channel/ReviewListView",["require","er/util","esui/lib","ub-ria/mvc/ListView","underscore","common/permission","tpl!8ab58a8b.tpl.html","./enum","common/GlobalData","esui/Table"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this,t=[],i=this.getSelectedItems();if(s.each(i,function(e){t.push(e.id)}),t.length){var n=this.confirm("你确认要批量审核吗？","提示信息");n.on("ok",function(){e.fire("quantityReview",{args:{articleIds:t,targetStatus:l.isChiefEditor()?6:2}})})}}function i(e){var t=this.getSafely("quantityReview"),i=e.selectedIndex,n=e.target.datasource,r=[];if(s.each(i,function(e){r.push(n[e].id)}),r.length>0)t.setDisabled(!1);else t.setDisabled(!0)}function n(e){var t=e.args;switch(e.name){case"review":this.fire("review",t)}}var r=require("er/util"),o=require("esui/lib"),a=require("ub-ria/mvc/ListView"),s=require("underscore"),l=require("common/permission");require("tpl!8ab58a8b.tpl.html"),r.inherits(e,a),e.prototype.template="reviewChannelList";var u=(require("./enum"),require("common/GlobalData").getInstance()),c=[{title:"文章序号",field:"id",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){var t=u.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.title+'">'+e.title+"</div>"}},{title:"文章来源",field:"articleSource",sortable:!0,resizable:!1,width:150,stable:!0,content:function(e){var t=e.articleSource||"";return'<div class="ellipsistext" title="'+t+'">'+t+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return o.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"状态",field:"status",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){var t=u.getReviewStatus().reviewStatusMap||{};return t[e.status]}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:120,stable:!0,content:function(e){var t=[{command:"review",type:"review",args:e.id,text:"查看"}],i=require("esui/Table");return i.operations(t)}}];return e.prototype.tableFields=c,e.prototype.uiProperties={table:{fields:c,select:"multi"}},e.prototype.uiEvents={"table:command":n,"table:select":i,"quantityReview:click":t},e}),define("channel/ReviewListModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","./common","common/permission","er/datasource","./enum"],function(require){function e(){n.apply(this,arguments),this.addData(new r),this.addData("global",o.getInstance())}var t=require("underscore"),i=require("er/util"),n=require("ub-ria/mvc/ListModel"),r=require("./Data"),o=require("common/GlobalData"),a=require("./common"),s=require("common/permission");i.inherits(e,n);var l=require("er/datasource"),u=require("./enum");return e.prototype.defaultStatusValue=0,e.prototype.datasource={crumbPath:l.constant(u.CrumbPath),useTableCommand:l.constant(!0),channelTypes:function(){var e=o.getInstance().getChannels();return e.channelsList},reviewStatus:function(e){var i,n=o.getInstance().getReviewStatus();if(s.isChiefEditor())i=t.filter(n.reviewStatusList,function(e){return 5===e.value});else i=t.filter(n.reviewStatusList,function(e){return 6===e.value});return i},setStatus:function(e){if("undefined"==typeof e.get("status"))if(s.isChiefEditor())e.set("status",5);else e.set("status",6)},tabsHtml:function(){return a.initTabs("reviewList")}},e.prototype.getReviewStatus=function(){var e=this.data();return e.getReviewStatus()},e.prototype.defaultArgs={orderBy:"",order:""},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=n.prototype.getQuery.apply(this,arguments),t=this.get("channelType");if("-1"!==t)e.channelType=t;return e},e.prototype.toManyOperated=function(e){return this.data().toManyOperated(e)},e.prototype.search=function(e){return this.data().allList(e)},e.prototype.hasAnyBody=function(e){var t=this.data();return t.hasAnyBody(e)},e}),define("channel/ReviewList",["require","er/util","./config","ub-ria/mvc/ListAction","esui/Dialog","./ReviewListModel","./ReviewListView"],function(require){function e(){o.apply(this,arguments)}function t(e){var t=this,i=e.data,n=location.hash.split("~"),r=n[1]?"&"+n[1]:"";this.model.hasAnyBody({articleId:i}).done(function(){t.redirect("#/channel/view~from=reviewList"+r+"&articleId="+i)})}function i(e){var t=e.args,i=this;this.model.toManyOperated(t).then(function(e){if(0===e.message){var t={title:"提示信息",content:"操作失败,你选择的文章已经审批完毕"},n=a.alert(t);n.on("ok",function(){i.reload()})}else if(1===e.message)i.reload()})}var n=require("er/util"),r=require("./config"),o=require("ub-ria/mvc/ListAction"),a=require("esui/Dialog");return n.inherits(e,o),e.prototype.group="default",e.prototype.entityDescription=r.description,e.prototype.modelType=require("./ReviewListModel"),e.prototype.viewType=require("./ReviewListView"),e.prototype.initBehavior=function(){o.prototype.initBehavior.apply(this,arguments),this.view.on("review",t,this),this.view.on("quantityReview",i,this)},e}),define("channel/ReadFormView",["require","underscore","etpl","er/util","esui/lib","ub-ria/mvc/FormView","common/permission","common/common","tpl!8ab58a8b.tpl.html","./enum"],function(require){function e(){u.apply(this,arguments)}function t(){var e=this.model,t=e.get("channelId"),i=g[t],n="",r={channelId:t,homeTitle:e.get("homeTitle"),policySummary:e.get("policySummary")||""};o.each(i.recommend,function(i){var o="readChannelImgTpl",s=e.get("articleTypeStr").indexOf([",",i.recommendType,","].join(""))>-1?!0:!1,u={checked:s},c=l.extend(r,u,i);if("img"===i.type){var d={uuidsObjValue:e.get("uuidsObj")[i.recommendType]};c=l.extend(c,d)}else if(2===t&&4===i.recommendType)o="readPolicyTextTpl";else o="readChannelTextTpl";n+=a.render(o,c)});var s=this.get("panel-recommend");s.setContent(n)}function i(e){e.preventDefault();var t=this.model.get("articleId"),i=location.href.split("#")[0]+"#",n="/channel/preview~articleId="+t;n+="&targetId="+d.getTargetId(),i+=n,window.open(i)}function n(){var e=this,t=this.model.get("articleId");clearTimeout(m),m=setTimeout(function(){try{e.fire("resetVail",t)}catch(i){}},0),clearInterval(p),p=setInterval(function(){try{e.fire("resetVail",t)}catch(i){}},24e4)}function r(){clearTimeout(m),clearInterval(p)}var o=require("underscore"),a=require("etpl"),s=require("er/util"),l=require("esui/lib"),u=require("ub-ria/mvc/FormView"),c=require("common/permission"),d=require("common/common");require("tpl!8ab58a8b.tpl.html"),s.inherits(e,u),e.prototype.template="readChannelForm",e.prototype.getEntity=function(){var e=u.prototype.getEntity.apply(this,arguments);if(e.articleId=this.model.get("articleId"),+e.auditResult[0])if(c.isChiefEditor())e.targetStatus=6;else e.targetStatus=2;else e.targetStatus=4;return e};var f=require("./enum"),h=f.VerifyLogFields;e.prototype.uiProperties={reviewTable:{fields:h,select:!1,width:850}},e.prototype.uiEvents={};var p,m,g=f.formConfig;return e.prototype.bindEvents=function(){u.prototype.bindEvents.apply(this,arguments),t.call(this),this.get("back").on("click",function(){this.fire("backList",this.model.get("from"))},this);var e=this.model.get("from");if("reviewList"===e){var o=this.model.get("isHot")?"1":"0";this.get("isHot").setValue(o),this.get("auditResult").setValue("1"),n.call(this),this.on("leave",r,this)}var a=this.get("toPreview");a.on("click",i,this)},e}),define("channel/ReadFormModel",["require","underscore","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData","./enum"],function(require){function e(){o.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance())}function t(){var e=location.hash.split("~"),t=e[1].split("&");return t=t.slice(1,t.length-1),t.join("&")}var i=require("underscore"),n=require("er/util"),r=require("esui/lib"),o=require("common/base/BaseModel"),a=require("./Data"),s=require("common/GlobalData");n.inherits(e,o);var l=require("./enum");return e.prototype.datasource={crumbPath:function(e){var i=[{text:"栏目管理",href:"#/channel/list"},{text:"查看文章"}],n=t(),r=e.get("from");if("reviewList"===r)i[0].href="#/channel/reviewList~"+n,i[1].text="审核文章";else i[0].href="#/channel/"+r+"~"+n;return i},channelInfo:function(e){var t=e.get("articleId");return e.getChannelInfo(t).done(function(t){if(null!==t.artReviewVoList)t.artActivityList=t.artReviewVoList||[];e.fill(t);var n=s.getInstance().getChannels().valueNameMap,o=n[t.channelId]||"";if(e.set("channelName",o),"undefined"!=typeof t.informationAttribute)e.set("informationName",l.informationAttributesMap[t.informationAttribute]);if("undefined"!=typeof t.creditHotAttribuite)e.set("creditHotName",l.creditHotAttribuiteMap[t.creditHotAttribuite]);if(e.set("releaseSourceStr",(t.releaseSource||[]).join(",")),t.releaseTime)e.set("releaseTimeStr",r.date.format(t.releaseTime,"YYYY-MM-DD"));else e.set("releaseTimeStr","");var a=t.articleType||[],u=","+a.join(",")+",";e.set("articleTypeStr",u);var c=t.uuids;if(c&&c.length){var d={};i.each(c,function(e,t){var i=a[t];d[i]=e}),e.set("uuidsObj",d)}else e.set("uuidsObj",{})})},userName:function(e){return e.set("nowTime",r.date.format(new Date,"YYYY-MM-DD")),e.data("global").getUser().username}},e.prototype.getChannelInfo=function(e){var t=this.data();return t.getChannelInfo({articleId:e})},e.prototype.save=function(e){var t=this.data();return t.saveReview(e)},e.prototype.getCreditCommentList=function(){var e=this.data();return e.getCreditEvaluationList()},e.prototype.resetVail=function(e){var t=this.data();return t.resetVail(e)},e.prototype.destoryVail=function(e){var t=this.data();return t.destoryVail(e)},e}),define("channel/ReadForm",["require","common/base/BaseForm","er/util","./config","./ReadFormModel","./ReadFormView"],function(require){function e(){o.apply(this,arguments)}function t(e){var t=e.data,n=i();if("alllist"===t)this.redirect("/channel/allList~"+n);else this.redirect("/channel/"+t+"~"+n)}function i(){var e=location.hash.split("~"),t=e[1].split("&");return t=t.slice(1,t.length-2),t.join("&")}function n(e){var t=e.data;this.model.resetVail({articleId:t})}function r(){var e=this.model.get("articleId"),t=new Image;t.src="/article/validate/destoryArticleVailTime?articleId="+e+"&_="+(new Date).getTime()}var o=require("common/base/BaseForm"),a=require("er/util"),s=require("./config");return a.inherits(e,o),e.prototype.group="default",e.prototype.entityDescription=s.description,e.prototype.modelType=require("./ReadFormModel"),e.prototype.viewType=require("./ReadFormView"),e.prototype.redirectAfterCancel=function(e){var t=i();this.redirect("/channel/reviewList~"+t)},e.prototype.initBehavior=function(){o.prototype.initBehavior.apply(this,arguments);var e=this;this.setSubmitHandler({handle:function(){var t=i();e.redirect("/channel/reviewList~"+t)}}),this.view.on("backList",t,this),this.view.on("resetVail",n,this);var a=this.model.get("from");if("reviewList"===a)this.on("submitcancel",r,this)},e.prototype.leave=function(){this.view.fire("leave"),o.prototype.leave.apply(this,arguments)},e}),define("common/util/wordLimit",["require"],function(require){function e(){if("undefined"==typeof this.innerText)return this.textContent;else return this.innerText}function t(e){if("undefined"==typeof this.innerText)this.textContent=e||"";else this.innerText=e||""}function i(e,t){var i;if(window.getComputedStyle)i=window.getComputedStyle(this,null)[e];else i=this.currentStyle[e];if("undefined"!=typeof t)i=i*t+"px";return i.substring(0,i.toString().length-2)}function n(n){var r=e.call(this),o=this.getAttribute("title");if(null==o)this.setAttribute("title",r);else t.call(this,o);var a=i.call(this,"fontSize"),s=parseInt($(this).css("line-height"),10);if(1===s)s=$(this).css("line-height")*a;var l=this.clientHeight;if("norm"===s){s=Number(1.5*a);var u=this.getAttribute("style")||"";this.setAttribute("style",u+";line-height:"+s+"px")}else s=Number(s);var c=Math.floor(n*s);if(l>=c){for(r=e.call(this);3*c<this.clientHeight;)t.call(this,r.substring(0,r.length/2)),r=e.call(this);for(;c<this.clientHeight;)r=e.call(this),t.call(this,r.replace(/(\s)*([a-zA-Z0-9]?|\W)(\.\.\.)?$/,"..."))}}return{wordLimit:n}}),define("channel/PreviewFormView",["require","underscore","er/util","esui/lib","etpl","ub-ria/mvc/FormView","common/util/wordLimit","tpl!8ab58a8b.tpl.html","./enum"],function(require){function e(){s.apply(this,arguments)}function t(){var e=this.model,t=e.get("channelId"),i=c[t],r=this.model.get("articleType"),s=[];n.each(r,function(e){var t=n.find(i.recommend,function(t){return t.recommendType==e});if(t)s.push(t)});var l="",u={channelId:t,homeTitle:e.get("homeTitle"),articleTitle:e.get("title"),policySummary:e.get("policySummary")||"",summary:e.get("summary")};n.each(s,function(i){var n="previewChannelImgTpl",r=e.get("articleTypeStr").indexOf([",",i.recommendType,","].join(""))>-1?!0:!1,s={checked:r},c=o.extend(u,s,i);if(c.recommendTypeClass="recommendType"+i.recommendType,"img"===i.type){var d={uuidsObjValue:e.get("uuidsObj")[i.recommendType]};if(c=o.extend(c,d),2===i.recommendType)n="previewChannelImgTpl2"}else if(2==t&&4===i.recommendType)n="previewPolicyTextTpl",c.recommendTypeClass="recommendType4-2";else n="previewChannelTextTpl";l+=a.render(n,c)});var d=this.get("panel-recommend");d.setContent(l)}function i(){$(".text-limit4").each(function(){l.wordLimit.call(this,4)}),$(".text-limit2").each(function(){l.wordLimit.call(this,2)})}var n=require("underscore"),r=require("er/util"),o=require("esui/lib"),a=require("etpl"),s=require("ub-ria/mvc/FormView"),l=require("common/util/wordLimit");require("tpl!8ab58a8b.tpl.html"),r.inherits(e,s),e.prototype.template="previewChannelForm",e.prototype.getEntity=function(){var e=s.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiProperties={},e.prototype.uiEvents={};var u=require("./enum"),c=u.formConfig;return e.prototype.bindEvents=function(){s.prototype.bindEvents.apply(this,arguments),t.call(this),i.call(this)},e}),define("channel/PreviewFormModel",["require","underscore","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData"],function(require){function e(){r.apply(this,arguments),this.addData(new o),this.addData("global",a.getInstance())}var t=require("underscore"),i=require("er/util"),n=require("esui/lib"),r=require("common/base/BaseModel"),o=require("./Data"),a=require("common/GlobalData");return i.inherits(e,r),e.prototype.datasource={crumbPath:function(e){var t=[{text:"文章预览"}];return t},channelInfo:function(e){var i=e.get("articleId");return e.getChannelInfo(i).done(function(i){if(e.fill(i),i.releaseTime)e.set("releaseTimeStr",n.date.format(i.releaseTime,"YYYY年MM月DD日"));else e.set("releaseTimeStr","");var r=i.articleType||[],o=","+r.join(",")+",";e.set("articleTypeStr",o);var a=i.uuids;if(a&&a.length){var s={};t.each(a,function(e,t){var i=r[t];s[i]=e}),e.set("uuidsObj",s)}else e.set("uuidsObj",{})})}},e.prototype.getChannelInfo=function(e){var t=this.data();return t.getChannelInfo({articleId:e})},e}),define("channel/PreviewForm",["require","common/base/BaseForm","er/util","./config","./PreviewFormModel","./PreviewFormView"],function(require){function e(){t.apply(this,arguments)}var t=require("common/base/BaseForm"),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./PreviewFormModel"),e.prototype.viewType=require("./PreviewFormView"),e}),define("ui/OrderList",["require","underscore","esui","esui/InputControl","esui/lib","esui/painters"],function(require){function e(){c.apply(this,arguments)}function t(e){var t=e.target.getValue(),i=this.datasource;if(t){var n=l.filter(i,function(e){return e.title.indexOf(t)>-1});this.repaintList(n)}else this.repaintList(i)}function i(e,t){var i=l.findIndex(e,{isActive:!0}),n=e.splice(i,1)[0];e.splice(i+t,0,n)}function n(e){var t=this.datasource;i(t,-1),this.repaintButtonState(),this.repaintList(t),this.fire("order")}function r(e){var t=this.datasource;i(t,1),this.repaintButtonState(),this.repaintList(t),this.fire("order")}function o(e){var t=this.datasource;this.fire("delete",t)}function a(e){this.fire("refresh")}function s(e){this.fire("add")}var l=require("underscore"),u=require("esui"),c=require("esui/InputControl"),d=require("esui/lib");return e.prototype.type="OrderList",e.prototype.initOptions=function(e){var t={title:"列表标题",deleteText:"待选移除",deleteWidth:55,hasSearch:!1,hasOrder:!1,hasDelete:!1,hasRefresh:!1,hasAdd:!1,hasVisitNum:!1,datasource:[]},i={};i=d.extend(i,t,e),c.prototype.initOptions.call(this,i)},e.prototype.getOrderButtonHtml=function(){var e="",t='<button class="${buttonClasses} ${buttonUpClasses}" data-ui="id:${upId};childName:up;type:Button;skin:up;${states}">上移</button> <button class="${buttonClasses} ${buttonDownClasses}" data-ui="id:${downId};childName:down;type:Button;skin:down;${states}">下移</button>',i={buttonClasses:this.helper.getPartClassName("button"),buttonUpClasses:this.helper.getPartClassName("button-up"),upId:this.id+"-button-up",buttonDownClasses:this.helper.getPartClassName("button-down"),downId:this.id+"-button-down",states:this.hasOrder?"":"states:hidden;"};return e=d.format(t,i)},e.prototype.getDelButtonHtml=function(){var e="",t='<button class="${buttonClasses} ${buttonDelClasses}" data-ui="id:${delId};childName:del;type:Button;skin:del;${states}">待选移除</button> ',i={buttonClasses:this.helper.getPartClassName("button"),buttonDelClasses:this.helper.getPartClassName("button-del"),delId:this.id+"-button-del",states:this.hasDelete?"":"states:hidden;"};return e=d.format(t,i)},e.prototype.getRefHtml=function(){var e="",t='<button class="${buttonClasses} ${buttonRefClasses}" data-ui="id:${refId};childName:ref;type:Button;skin:ref;${states}">刷新</button> ',i={buttonClasses:this.helper.getPartClassName("button"),buttonRefClasses:this.helper.getPartClassName("button-ref"),refId:this.id+"-button-ref",states:this.hasRefresh?"":"states:hidden;"};return e=d.format(t,i)},e.prototype.getAddHtml=function(){var e="",t='<button class="${buttonClasses} ${buttonAddClasses}" data-ui="id:${addId};childName:add;type:Button;skin:adds;${states}">添加</button> ',i={buttonClasses:this.helper.getPartClassName("button"),buttonAddClasses:this.helper.getPartClassName("button-adds"),addId:this.id+"-button-add",states:this.hasAdd?"":"states:hidden;"};return e=d.format(t,i)},e.prototype.getOrderButtonsHtml=function(){var e=this.getRefHtml(),t=this.getAddHtml(),i=this.getDelButtonHtml(),n=this.getOrderButtonHtml(),r=this.helper.createPart("buttons");return r.innerHTML=e+t+i+n,r.outerHTML},e.prototype.getSearchHtml=function(){var e='<input class="${searchboxClasses}" data-ui="type:SearchBox;id:${searchId};childName:searchButton;placeholder:关键词;width:335;heigth:28;${states}"/>',t={searchboxClasses:this.helper.getPartClassName("searchbox"),searchId:this.id+"-searchbox",states:this.hasSearch?"":"states:hidden"},i=d.format(e,t),n=this.helper.createPart("search");return n.innerHTML=i,n.outerHTML},e.prototype.getListHtml=function(e){var t=this.helper.getPartClassName("body-list-item"),i="",n='<li class="${listItemClasses} ${active}" tagid="${id}"><p title="${title}">标题：${title}</p><p title="${title}">首页标题：${homeTitle}</p><p>栏目：${channelType}</p><p>来源：${articleSource}</p><p>时间：${modifierTime}</p>';if(this.hasVisitNum)n+="<p>点击量：${visitsNum}</p>";return n+="</li>",l.map(e,function(e,r){e.listItemClasses=t,e.active=e.isActive?"active":"",e.homeTitle=e.homeTitle||"无";var o=d.format(n,e);i+=o}),i},e.prototype.getBodyHtml=function(){var e='<div class="${titleClasses}">${title}</div>${searchHtml}<ul class="${listClasses}" id="${listId}">';e+=this.getListHtml(this.datasource),e+="</ul>";var t=d.format(e,{titleClasses:this.helper.getPartClassName("title"),title:this.title,searchHtml:this.getSearchHtml(),listClasses:this.helper.getPartClassName("body-list"),listId:this.helper.getId("body-list")}),i=this.helper.createPart("body");return i.innerHTML=t,i.outerHTML},e.prototype.initStructure=function(){var e=this.getOrderButtonsHtml()+this.getBodyHtml();this.main.innerHTML=e;var t={main:this.main,renderOptions:this.renderOptions},i=u.create("Panel",t);i.initChildren(),this.addChild(i,"panel")},e.prototype.onCheckedChange=function(e,t){var i=l.findIndex(this.datasource,{id:+t});if("checked"===e)this.datasource[i].isActive=!0;else this.datasource[i].isActive=!1;this.repaintButtonState(),this.fire("change",this.datasource)},e.prototype.repaintList=function(e){var t=this.getListHtml(e);this.helper.getPart("body-list").innerHTML=t},e.prototype.repaintButtonState=function(){var e=l.filter(this.datasource,function(e){return e.isActive}),t=this.getChild("panel").getChild("up"),i=this.getChild("panel").getChild("down");if(1===e.length){var n=l.findIndex(this.datasource,{isActive:!0});if(this.datasource.length<2)t.setDisabled(!0),i.setDisabled(!0);else if(0===n)t.setDisabled(!0),i.setDisabled(!1);else if(n===this.datasource.length-1)t.setDisabled(!1),i.setDisabled(!0);else t.setDisabled(!1),i.setDisabled(!1)}else t.setDisabled(!0),i.setDisabled(!0);var r=this.getChild("panel").getChild("del");if(e.length)r.setDisabled(!1);else r.setDisabled(!0)},e.prototype.initEvents=function(){var e=this;d.on(this.main,"click",function(t){for(var i=d.event.getTarget(t);i&&"LI"!==i.tagName&&i!=this.main;)i=i.parentNode;if(i&&"LI"===i.tagName){var n="checked",r=d.getAttribute(i,"tagid");if(d.hasClass(i,"active"))d.removeClass(i,"active"),n="unchecked";else d.addClass(i,"active");e.onCheckedChange(n,r)}});var i=this.getChild("panel"),l=i.getChild("searchButton");l.on("input",t,this);var u=i.getChild("up"),c=i.getChild("down");u.on("click",n,this),c.on("click",r,this);var f=i.getChild("del");f.on("click",o,this);var h=i.getChild("ref");h.on("click",a,this);var p=i.getChild("add");p.on("click",s,this),this.repaintButtonState()},e.prototype.repaint=require("esui/painters").createRepaint(c.prototype.repaint,{name:"datasource",paint:function(e,t){e.repaintList(t),e.repaintButtonState()}},{name:["hasRefresh","hasAdd","hasOrder"],paint:function(e,t,i,n){var r=e.getChild("panel"),o=r.getChild("ref"),a=r.getChild("add"),s=r.getChild("up"),l=r.getChild("down");if(t)o.show();else o.hide();if(i)a.show();else a.hide();if(n)s.show(),l.show();else s.hide(),l.hide()}},{name:["deleteText","deleteWidth"],paint:function(e,t,i){var n=e.getChild("panel"),r=n.getChild("del");r.setContent(t),r.main.style.width=i+"px"}}),d.inherits(e,c),u.register(e),e}),define("channel/OrderFormView",["require","ui/OrderList","underscore","er/util","esui/lib","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html","common/GlobalData"],function(require){function e(){p.apply(this,arguments)}function t(e){var t=e.target.getValue(),i=e.target.getSelectedItem().name,n=this.model.get("orderTypesMap"),r=n[t],o=r[0].value;this.fire("channelTypeChange",{args:{articleType:o,channelText:i}}),this.get("articleType").set("datasource",r);var a=this.get("leftSourceList");if("大家关注"===i)h.addClass("order-middle-operate","hidden"),this.get("rightSourceList").hide(),a.setProperties({hasRefresh:!0,hasAdd:!0,hasOrder:!0,deleteText:"移除",deleteWidth:38,hasVisitNum:!0});else h.removeClass("order-middle-operate","hidden"),this.get("rightSourceList").show(),a.setProperties({hasRefresh:!1,hasAdd:!1,hasOrder:!1,deleteText:"待选移除",deleteWidth:55,hasVisitNum:!1});this.get("publish").setDisabled(!0)}function i(e){var t=e.target.getValue(),i=this.get("channelType").getSelectedItem().name;this.fire("articleTypeChange",{args:{articleType:t,channelText:i}}),this.get("publish").setDisabled(!0)}function n(e){var t,i,n,r,o=e.target.id,a=this.get("leftSourceList"),s=this.get("rightSourceList"),l=a.get("datasource"),u=s.get("datasource"),c=[],f=[];if("goRight"===o)t=l,i=u,n=a,r=s;else t=u,i=l,n=s,r=a;d.map(t,function(e){if(e.isActive)e.isActive=!1,c.push(e);else f.push(e)}),n.setProperties({datasource:f}),r.setProperties({datasource:i.concat(c)}),n.fire("change",n.get("datasource"))}function r(e){var t=e.data,i=this.get("channelType").getSelectedItem().name;if("大家关注"===i){var n=d.filter(t,function(e){return!e.isActive});return void this.get("leftSourceList").setProperties({datasource:n})}var r=d.filter(t,function(e){return e.isActive}),o=this.get("articleType").getValue(),a=d.pluck(r,"id");this.fire("delete",{args:{ids:a,datasource:t,articleType:o}})}function o(e){var t=this.get("channelType").getSelectedItem().name;if("大家关注"!==t){var i=this.get("goRight"),n=e.data,r=d.filter(n,function(e){return e.isActive});if(r.length)i.setDisabled(!1);else i.setDisabled(!0)}}function a(e){var t=this.get("channelType").getSelectedItem().name;if("大家关注"!==t){var i=this.get("goLeft"),n=e.data,r=d.filter(n,function(e){return e.isActive});if(r.length)i.setDisabled(!1);else i.setDisabled(!0)}}function s(e){var t=this.get("channelType"),i=this.get("articleType"),n=i.getValue(),r=t.getSelectedItem().name;this.fire("articleTypeChange",{args:{articleType:n,channelText:r}})}function l(e){var t={url:"/channel/addList",title:"新增",options:{channelType:this.get("articleType").getValue()}},i=this.popActionDialog({url:t.url,title:t.title,width:1e3,needFoot:!0,actionOptions:t.options}),n=i.getFoot().getChild("btnOk"),r=i.getFoot().getChild("btnCancel");n.on("click",function(e){i.fire("selected")}),r.on("click",function(e){i.dispose()}),i.on("selected",function(e){var t=e.target.getAction(),n=t.getSelectItems(),r=m.getChannels().valueNameMap,o=d.map(n,function(e){return{title:e.title,homeTitle:e.homeTitle,id:e.id,channelType:r[e.channelId],articleSource:e.articleSource,modifierTime:e.releaseTime?h.date.format(e.releaseTime,"YYYY-MM-DD"):"",visitsNum:e.visitsNum}}),a=this.get("leftSourceList"),s=a.get("datasource");s=s.concat(o),s=d.uniq(s,function(e){return e.id}),a.setProperties({datasource:s}),i.dispose()},this)}function u(){}function c(e){var t,i=e.target,n=this.get("channelType").getSelectedItem().name,r=this.get("articleType"),o=r.getValue(),a=r.getSelectedItem().limitCount;switch(i.id){case"publish":case"save":var s;if("大家关注"!==n)s=this.get("rightSourceList").get("datasource");else s=this.get("leftSourceList").get("datasource");var l=d.map(s,function(e,t){return t+","+e.id}),u=l.length;if("publish"===i.id)if(u!==a){var c;if(u>a)c="您的编辑超出了"+(u-a)+"条！请继续编辑！";else c="您的编辑还差"+(a-u)+"条！请继续编辑！";return void this.alert(c)}if("save"===i.id)if(!u)return void this.alert("您的编辑至少选中1条！请继续编辑！");var f="publish"===i.id?3:4;t={args:{articleType:o,status:f,order:l}},this.fire("saveorpublish",t);break;case"readBak":t={args:{articleType:o,channelText:n}},this.fire("readBak",t)}}require("ui/OrderList");var d=require("underscore"),f=require("er/util"),h=require("esui/lib"),p=require("ub-ria/mvc/FormView");require("tpl!8ab58a8b.tpl.html"),f.inherits(e,p),e.prototype.template="orderChannelForm",e.prototype.getEntity=function(){var e=p.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiProperties={};var m=require("common/GlobalData").getInstance();return e.prototype.uiEvents={"channelType:change":t,"articleType:change":i,"goRight:click":n,"goLeft:click":n,"leftSourceList:delete":r,"leftSourceList:change":o,"leftSourceList:refresh":s,"leftSourceList:add":l,"rightSourceList:change":a,"rightSourceList:order":u},e.prototype.initButtonsStates=function(e){this.get("publish").setDisabled(!1),this.get("save").setDisabled(!1),this.get("readBak").setDisabled(!e)},e.prototype.bindEvents=function(){if(p.prototype.bindEvents.apply(this,arguments),this.model.get("orderData").isBak)this.get("readBak").setDisabled(!1);this.getGroup("submits").on("click",c,this)},e.prototype.uiProperties={leftSourceList:{hasSearch:!0,hasDelete:!0},rightSourceList:{hasOrder:!0}},e}),define("channel/OrderFormModel",["require","underscore","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData","./common","./enum"],function(require){function e(){r.apply(this,arguments),this.addData(new o),this.addData("global",a.getInstance())}var t=require("underscore"),i=require("er/util"),n=require("esui/lib"),r=require("common/base/BaseModel"),o=require("./Data"),a=require("common/GlobalData"),s=require("./common");i.inherits(e,r);var l=require("./enum");return e.prototype.datasource={crumbPath:function(e){return l.CrumbPath},selectTmp:[{orderTypes:function(e){return e.getOrderType()}},{channelTypes:function(e){var i=e.get("orderTypes"),n={},r=t.map(i,function(e){return n[e.type]=t.map(e.children,function(e){return{name:e.text,value:e.type,limitCount:e.limitCount}}),{name:e.text,value:e.type}});return e.set("orderTypesMap",n),r}},{articleTypes:function(e){var i=e.get("orderTypes"),n=(i[0]||[]).children||[],r=t.map(n,function(e){return{name:e.text,value:e.type,limitCount:e.limitCount}});return e.set("articleType",r[0].value),r}},{orderData:function(e){var t=e.get("articleType");return e.getOrderList(t)}},{leftOrderList:function(e){var i=e.get("orderData"),r=i.list;return r=t.map(r,function(e){if(e.modifierTime)e.modifierTime=n.date.format(e.modifierTime,"YYYY-MM-DD");else e.modifierTime="";return e}),e.set("orderList",r),t.filter(r,function(e){return!e.isChannelBack})}},{rightOrderList:function(e){var i=e.get("orderList"),n=t.filter(i,function(e){return e.isChannelBack});return n.sort(function(e,t){return e.order-t.order}),n}}],tabsHtml:function(){return s.initTabs("order")}},e.prototype.getOrderType=function(){var e=this.data();return e.getOrderType()},e.prototype.getOrderList=function(e){var t=this.data();return t.getOrderList(e)},e.prototype.deleteOrderBack=function(e){var t=this.data();return t.deleteOrderBack(e)},e.prototype.readArchived=function(e){var t=this.data();return t.readArchived(e)},e.prototype.saveOrPublish=function(e){var t=this.data();return t.saveOrPublish(e)},e}),define("channel/OrderForm",["require","underscore","esui/lib","common/base/BaseForm","er/util","./config","./OrderFormModel","./OrderFormView"],function(require){function e(){u.apply(this,arguments)}function t(e,t){e=s.map(e,function(e){if(e.modifierTime)e.modifierTime=l.date.format(e.modifierTime,"YYYY-MM-DD");else e.modifierTime="";return e});var i;if("大家关注"!==t)i=s.filter(e,function(e){return!e.isChannelBack});else i=e;var n=this.view.get("leftSourceList");if(n.setProperties({datasource:i}),"大家关注"!==t){var r=s.filter(e,function(e){return e.isChannelBack}),o=this.view.get("rightSourceList");r.sort(function(e,t){return e.order-t.order}),o.setProperties({datasource:r}),n.fire("change",i),o.fire("change",r)}}function i(e){var i=this,n=e.args,r=n.articleType,o=n.channelText;this.model.getOrderList(r).done(function(e){var n=e.list;t.call(i,n,o),i.view.initButtonsStates(e.isBak)})}function n(e){var t=this,i=e.args,n=s.extend({},i);delete n.datasource,this.model.deleteOrderBack(n).done(function(){var e=i.datasource,n=s.filter(e,function(e){return!e.isActive});t.view.alert("移除成功!"),t.view.get("leftSourceList").setProperties({datasource:n})})}function r(e){var i=this,n=e.args,r=n.articleType,o=n.channelText;this.model.readArchived(r).done(function(e){
var n=e.list;t.call(i,n,o)})}function o(e){var t=this;this.model.saveOrPublish(e.args).done(function(){if(4===e.args.status)t.view.get("readBak").setDisabled(!1),t.view.alert("保存成功!");else t.view.get("readBak").setDisabled(!0),t.view.alert("发布成功！")})}function a(){}var s=require("underscore"),l=require("esui/lib"),u=require("common/base/BaseForm"),c=require("er/util"),d=require("./config");return c.inherits(e,u),e.prototype.group="default",e.prototype.entityDescription=d.description,e.prototype.modelType=require("./OrderFormModel"),e.prototype.viewType=require("./OrderFormView"),e.prototype.initBehavior=function(){u.prototype.initBehavior.apply(this,arguments),this.view.on("channelTypeChange",i,this),this.view.on("articleTypeChange",i,this),this.view.on("delete",n,this),this.view.on("readBak",r,this),this.view.on("saveorpublish",o,this),this.view.on("add",a,this)},e}),define("channel/ListView",["require","underscore","er/util","esui/lib","ub-ria/mvc/ListView","common/layout","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","common/GlobalData","esui/Table"],function(require){function e(){f.apply(this,arguments)}function t(e){var t,i=this,n=e.args,r=n.split(",");switch(e.name){case"edits":if(t=r[2])return void this.alert("您好，该文章已经推荐，请联系总编辑重新调序替换后进行再次编辑！","提示信息");n={articleId:r[0],channelId:r[1]},i.fire("edits",n);break;case"remove":var o=r[0];if(t=r[1])return void this.alert("您好，该文章已经推荐，请联系总编辑重新调序替换后进行再次编辑！","提示信息");var a=this.confirm("你确认要删除么？","提示信息");a.on("ok",function(){i.fire("delete",{args:{ids:[o]}})});break;case"release":i.fire("release",{args:{ids:[n]}});break;case"recovery":i.fire("recovery",{args:{ids:[n]}})}}function i(){var e=this,t=[],i=this.getSelectedItems(),n=u.find(i,function(e){return e.isOrder});if(n)return void this.alert("选择的文章里有标签文章，请先去标签");var r=u.find(i,function(e){return 5===e.status||6===e.status});if(r)return void this.alert("选择的文章里有正在审核的文章，所以该文章不可删");var o=u.find(i,function(e){return 3===e.status});if(o)return void this.alert("选择的文章里有已删除文章，所以该文章不可删");if(u.each(i,function(e){if(3!==e.status)t.push(e.id)}),t.length){var a=this.confirm("你确认要删除么？","提示信息");a.on("ok",function(){e.fire("delete",{args:{ids:t}})})}}function n(){var e=this,t=[];if(u.each(this.getSelectedItems(),function(e){if(3===e.status)t.push(e.id)}),t.length)e.fire("recovery",{args:{ids:t}})}function r(e){if(!this.model.get("isChildAction")){var t=this.getSafely("delete"),i=this.getSafely("recovery"),n=e.selectedIndex,r=e.target.datasource,a=[];if(u.each(n,function(e){a.push(r[e].id)}),s(n,r))t.setDisabled(!1);else t.setDisabled(!0);if(o(n,r))i.setDisabled(!1);else i.setDisabled(!0)}}function o(e,t){if(0===e.length)return!1;var i=!0;return u.each(e,function(e){if(!a(t[e]))i=!1}),i}function a(e){if(3===e.status)return!0;else return!1}function s(e,t){if(0===e.length)return!1;var i=!0;return u.each(e,function(e){if(!l(t[e]))i=!1}),i}function l(e){if(1===e.status||2===e.status||4===e.status)return!0;else return!1}var u=require("underscore"),c=require("er/util"),d=require("esui/lib"),f=require("ub-ria/mvc/ListView"),h=require("common/layout");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),c.inherits(e,f),e.prototype.template="channelList";var p=require("common/GlobalData").getInstance(),m=[{title:"文章序号",field:"id",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){var t=p.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=location.hash.split("~"),i=t[1]?"&"+t[1]:"",n="#/channel/view~from=list"+i+"&articleId="+e.id,r=[{text:e.title,type:"read",url:n}],o=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+o.operations(r)+"</div>"}},{title:"文章来源",field:"articleSource",sortable:!0,resizable:!1,width:150,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.articleSource+'">'+e.articleSource+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return d.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"状态",field:"status",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){var t=p.getReviewStatus().reviewStatusMap||{};return t[e.status]}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=[{command:"edits",type:"edits",args:e.id+","+e.channelId+","+(e.isOrder||""),text:"编辑"},{command:"remove",type:"remove",args:e.id+","+(e.isOrder||""),text:"删除"},{command:"recovery",type:"recovery",args:e.id,text:"恢复"}];switch(e.status){case 1:t=t.slice(0,2);break;case 2:t=t.slice(0,2);break;case 3:t=t.slice(-1);break;case 4:t=t.slice(0,2);break;case 5:case 6:t=[]}var i=require("esui/Table");return i.operations(t)}},{title:"标签",field:"tags",sortable:!1,resizable:!1,width:70,stable:!0,content:function(e){return h.getExtractInfo(e.tags.join(","))}}];return e.prototype.uiProperties={table:{field:m,select:"multi"}},e.prototype.tableFields=m,e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=u.trim(i.getValue());return t.pageSize=this.get("pager").get("pageSize"),t},e.prototype.uiEvents={"table:command":t,"delete:click":i,"recovery:click":n,"table:select":r},e.prototype.tableFields=m,e}),define("channel/ListModel",["require","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","./common","./enum","er/datasource"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("./common");t.inherits(e,i);var a=require("./enum"),s=require("er/datasource");return e.prototype.datasource={crumbPath:s.constant(a.CrumbPath),channelTypes:function(e){var t=r.getInstance().getChannels();return t.channelsList},useTableCommand:s.constant(!0),channelStatus:function(){var e=r.getInstance().getReviewStatus();return e.reviewStatusList},setStatus:function(e){if("undefined"==typeof e.get("status"))e.set("status","-1")},tags:function(){return a.tags},tabsHtml:function(){return o.initTabs("list")}},e.prototype.getListChannels=function(){var e=this.data();return e.getListChannels()},e.prototype.defaultArgs={orderBy:"",order:"",status:"-1"},e.prototype.remove=function(e){return this.data().remove(e)},e.prototype.release=function(e){return this.data().release(e)},e.prototype.recovery=function(e){return this.data().recovery(e)},e.prototype.prepare=function(){},e.prototype.hasAnyBody=function(e){var t=this.data();return t.hasAnyBody(e)},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments);e.uid=this.data("global").getUser().userid;var t=this.get("channelType");if("-1"!==t)e.channelType=t;var n=this.get("tag");if("-1"!==n)e.tag=n;var r=this.get("status");if("-1"===r)delete e.status;return e},e.prototype.search=function(e){return this.data().list(e)},e}),define("channel/List",["require","er/util","./config","ub-ria/mvc/ListAction","./ListModel","./ListView"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=e.args,i=this;this.model.remove(t).then(function(){i.reload()})}function i(e){var t=e.args,i=this;this.model.release(t).then(function(){i.reload()})}function n(e){var t=e.args,i=this;this.model.recovery(t).then(function(){i.reload()})}function r(e){var t=this,i=e.articleId,n=location.hash.split("~"),r=n[1]?"&"+n[1]:"";this.model.hasAnyBody({articleId:i}).done(function(){var e="/channel/update~from=list"+r+"&articleId="+i+"&id="+i;t.redirect(e)})}var o=require("er/util"),a=require("./config"),s=require("ub-ria/mvc/ListAction");return o.inherits(e,s),e.prototype.group="default",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("delete",t,this),this.view.on("release",i,this),this.view.on("recovery",n,this),this.view.on("edits",r,this),this.view.on("reload",function(){this.reload()},this)},e}),define("common/util/localStorage",["require"],function(require){var e,t=function(){},i=window.document,n={set:t,get:t,remove:t,clear:t,each:t,obj:t,length:0};return function(){if("localStorage"in window)try{return void(e=window.localStorage)}catch(t){}var n,r,o=i.getElementsByTagName("head")[0],a=window.location.hostname||"localStorage",s=new Date;if(o.addBehavior){try{r=new ActiveXObject("htmlfile"),r.open(),r.write('<script>document.w=window;</script><iframe src="/favicon.ico"></iframe>'),r.close(),n=r.w.frames[0].document,o=n.createElement("head"),n.appendChild(o)}catch(t){o=i.getElementsByTagName("head")[0]}try{s.setDate(s.getDate()+36500),o.addBehavior("#default#userData"),o.expires=s.toUTCString(),o.load(a),o.save(a)}catch(t){return}var l,u;try{l=o.XMLDocument.documentElement,u=l.attributes}catch(t){return}var c="p__hack_",d="m-_-c",f=new RegExp("^"+c),h=new RegExp(d,"g"),p=function(e){return encodeURIComponent(c+e).replace(/%/g,d)},m=function(e){return decodeURIComponent(e.replace(h,"%")).replace(f,"")};if(e={length:u.length,isVirtualObject:!0,getItem:function(e){return(u.getNamedItem(p(e))||{nodeValue:null}).nodeValue||l.getAttribute(p(e))},setItem:function(e,t){try{l.setAttribute(p(e),t),o.save(a),this.length=u.length}catch(i){}},removeItem:function(e){try{l.removeAttribute(p(e)),o.save(a),this.length=u.length}catch(t){}},clear:function(){for(;u.length;)this.removeItem(u[0].nodeName);this.length=0},key:function(e){return u[e]?m(u[e].nodeName):void 0}},!("localStorage"in window))window.localStorage=e}else try{e=window.localStorage}catch(t){e=null}}(),window.LS=!e?n:{set:function(t,i){if(void 0!==this.get(t))this.remove(t);e.setItem(t,i),this.length=e.length},get:function(t){var i=e.getItem(t);return null===i?void 0:i},remove:function(t){e.removeItem(t),this.length=e.length},clear:function(){e.clear(),this.length=0},each:function(e){var t,i=this.obj(),n=e||function(){};for(t in i)if(n.call(this,t,this.get(t))===!1)break},obj:function(){var t,i,n={},r=0;if(e.isVirtualObject)n=e.key(-1);else for(t=e.length;t>r;r++)i=e.key(r),n[i]=this.get(i);return n},length:e.length},window.LS}),define("channel/HomeFormView",["require","tpl!8ab58a8b.tpl.html","underscore","er/util","esui/lib","ub-ria/mvc/FormView","common/util/localStorage"],function(require){function e(){l.apply(this,arguments)}function t(e){e.preventDefault();var t=this.get("form");if(t.validate())this.fire("previewSubmit")}function i(e){var t=e.target,i=t.getValue();if(c.set("lastChannelId",i),"0"!==i)this.fire("channelchange",{args:i})}function n(e,t,i){if("string"==typeof e)e=a.parseJSON(e);var n=e.imagename,r=t.substr(0,t.lastIndexOf("-")),o=this.get(t),l=s.g(r+"-p"),u=this.get(r+"-uuid");if(l.innerHTML="",s.addClass(u.main,"hidden"),u.removeState("disabled"),u.setValue(n),i)if(e.responseText)if("string"==typeof e.responseText)e.message=a.parseJSON(e.responseText).message;else e.message="出错了";if(e.message)return u.setValue(""),l.innerHTML="",void this.alert(e.message);o.setContent("替换图像");var c=new Image;c.src="/uploads/"+n,l.appendChild(c);var d=document.createElement("a");d.innerHTML="删除",d.onclick=function(){o.setContent("上传图像"),u.setValue(""),l.innerHTML="",d=null},l.appendChild(d)}function r(){var e=this.getGroup("upload"),t=this;o.each(e,function(e){var i=e,r=i.id,o=r.split("-"),a=i.helper.getId();new u({trigger:"#"+a,accept:"image/*",action:"/channel/uploads",name:"multipartFile",data:{imageTypeValue:o&&o[2]||""}}).success(function(e){n.call(t,e,r,!1)}).error(function(e){n.call(t,e,r,!0)})})}require("tpl!8ab58a8b.tpl.html");var o=require("underscore"),a=require("er/util"),s=require("esui/lib"),l=require("ub-ria/mvc/FormView"),u=window.Upload,c=require("common/util/localStorage");return a.inherits(e,l),e.prototype.template="homeChannelForm",e.prototype.getEntity=function(){var e=l.prototype.getEntity.apply(this,arguments);return e.flag=!0,e},e.prototype.uiProperties={},e.prototype.uiEvents={},e.prototype.bindEvents=function(){l.prototype.bindEvents.apply(this,arguments);var e=this.get("channelId");if(e.on("change",i,this),"read"!==this.model.get("operate"))r.call(this);var n=this.get("preview");n.on("click",t,this),this.get("back").on("click",function(){this.fire("backList")},this)},e}),define("channel/HomeFormModel",["require","er/util","common/base/BaseModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n("channelhome")),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("common/base/BaseModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={crumbPath:function(e){var t=[{text:"栏目管理",href:"#/channel/list"},{text:"上传文章"}];return t},channelList:function(e){return e.getChannels()}},e.prototype.getChannels=function(){var e=this.data();return e.getChannels()},e}),define("channel/HomeForm",["require","underscore","common/base/BaseForm","er/util","./config","er/Deferred","./HomeFormModel","./HomeFormView"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=e.args;this.redirect("/channel/create~channelId="+t)}function i(){this.submit("preview")}var n=require("underscore"),r=require("common/base/BaseForm"),o=require("er/util"),a=require("./config"),s=require("er/Deferred");return o.inherits(e,r),e.prototype.group="default",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./HomeFormModel"),e.prototype.viewType=require("./HomeFormView"),e.prototype.redirectAfterCancel=function(){this.redirect("/channel/list")},e.prototype.submit=function(e){var t=this.view.getEntity();if("preview"===e)t.flag=!1;this.view.disableSubmit();var i=t.channelId;if(null==i||"undefined"==typeof i)return this.view.alert("您没有上传文章的权限！"),void this.view.enableSubmit();else return void s.when(this.submitEntity(t)).ensure(n.bind(this.view.enableSubmit,this.view))},e.prototype.getCancelConfirmTitle=function(){return"提示信息"},e.prototype.initBehavior=function(){r.prototype.initBehavior.apply(this,arguments),this.view.on("channelchange",t,this),this.view.on("previewSubmit",i,this),this.view.on("backList",function(){this.redirect("/channel/list")},this)},e}),define("ui/ReleaseSourceList",["require","underscore","esui","esui/InputControl","esui/lib"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.viewContext.getGroup("ckItem"),t=r.where(e,{checked:!0}),i=r.pluck(t,"rawValue"),n=this.helper.getPart("head-title"),o=i.join(",");n.innerHTML=o||"&nbsp;",s.setAttribute(n,"title",o),this.rawValue=i}function i(e){var i=this.viewContext.getGroup("ckItem");r.each(i,function(t){t.setProperties({checked:e.target.checked,noChange:!0})}),t.call(this)}function n(){var e=this.getChild("ckAll"),i=this.viewContext.getGroup("ckItem"),n=r.where(i,{checked:!0});e.setProperties({checked:n.length===this.sourceItemsLen,noChange:!0}),t.call(this)}var r=require("underscore"),o=require("esui"),a=require("esui/InputControl"),s=require("esui/lib");return e.prototype.type="ReleaseSourceList",e.prototype.initOptions=function(e){var t={datasource:{},value:[],isHide:!0},i={};i=s.extend(i,t,e),a.prototype.initOptions.call(this,i)},e.prototype.getHeadHtml=function(){var e='<div class="${headClasses} clearfix"><div class="${titleClasses} ellipsistext" title="${selectedStr}" id="${titleId}">${selectedStr}</div><a id="${toggleBtn}" href="javascript:void(0)">${buttonText}</a></div>',t={headClasses:this.helper.getPartClassName("head"),titleClasses:this.helper.getPartClassName("head-title"),titleId:this.helper.getId("head-title"),selectedStr:this.rawValue.join(","),buttonText:this.isHide?"展开>>":"收起>>",toggleBtn:this.helper.getId("toggleBtn")};return s.format(e,t)},e.prototype.getBodyHtml=function(){var e=this,t='<div class="${bodyClasses} ${hidden}" id="${bodyId}"><p><input ${allChecked} data-ui="type:CheckBox;childName:ckAll;" title="全部"/></p>',i=0;r.each(this.datasource,function(n,o){i+=n.length,t+="<dl><dt>"+o+"：</dt>",r.each(n,function(i){var n='<dd><input ${checked} data-ui="type:CheckBox;value:${itemValue};group:ckItem;"title="${itemValue}"/></dd>',o={itemValue:i,checked:r.indexOf(e.rawValue,i)>-1?"checked":""};t+=s.format(n,o)}),t+="</dl>"}),t+="</div>";var n={bodyId:this.helper.getId("body"),bodyClasses:this.helper.getPartClassName("body"),hidden:this.isHide?"hidden":"",allChecked:this.rawValue.length===i?"checked":""};return this.sourceItemsLen=i,s.format(t,n)},e.prototype.initStructure=function(){this.main.innerHTML=this.getHeadHtml()+this.getBodyHtml(),this.initChildren()},e.prototype.initEvents=function(){var e=this,t=this.helper.getPart("toggleBtn"),o=this.helper.getPart("body");s.on(t,"click",function(){if(e.isHide)this.innerHTML="收起>>",e.isHide=!1,s.removeClass(o,"hidden");else this.innerHTML="展开>>",e.isHide=!0,s.addClass(o,"hidden")});var a=this.getChild("ckAll");a.on("change",i,this);var l=this.viewContext.getGroup("ckItem");r.each(l,function(t){t.on("change",n,e)})},s.inherits(e,a),o.register(e),e}),define("channel/FormView",["require","tpl!8ab58a8b.tpl.html","ui/ReleaseSourceList","underscore","er/util","esui/lib","ub-ria/mvc/FormView","common/util/localStorage","etpl","common/permission","common/common","common/util/gotop","./enum"],function(require){function e(){b.apply(this,arguments)}function t(e){var t=e.target,i=t.getValue();x.set("lastChannelId",i),d.call(this)}function i(e){var t=e.target,i=t.getValue();x.set("lastSpecialName",i),d.call(this)}function n(e){var t=e.target,i=t.getValue();x.set("lastHotName",i),d.call(this)}function r(e){var t=e.target,i=t.getValue();x.set("lastCreditComment",i),d.call(this)}function o(e){var t=e.target,i=t.getValue();x.set("lastCreditStage",i),d.call(this)}function a(e){var t=e.target,i=t.id,n=this.get(i+"-img"),r="addState";if(t.checked)n&&n.removeState("hidden"),r="removeState";else n&&n.addState("hidden");g.each(n.children,function(e){e[r]("disabled")})}function s(e,t,i){if("string"==typeof e)e=v.parseJSON(e);var n=e.imagename,r=t.substr(0,t.lastIndexOf("-")),o=this.get(t),a=y.g(r+"-p"),s=this.get(r+"-uuid");if(a.innerHTML="",y.addClass(s.main,"hidden"),s.removeState("disabled"),s.setValue(n),i)if(e.responseText)if("string"==typeof e.responseText)e.message=v.parseJSON(e.responseText).message;else e.message="出错了";if(e.message)return s.setValue(""),a.innerHTML="",void this.alert(e.message);o.setContent("替换图像");var l=new Image;l.src="/uploads/"+n,a.appendChild(l);var u=document.createElement("a");u.innerHTML="删除",u.onclick=function(){o.setContent("上传图像"),s.setValue(""),a.innerHTML="",u=null},a.appendChild(u)}function l(){var e=this.getGroup("upload"),t=this;g.each(e,function(e){var i=e,n=i.id,r=i.helper.getId();new E({trigger:"#"+r,accept:"image/*",action:"/channel/uploads",name:"multipartFile",data:{imageTypeValue:i.imageTypeValue}}).success(function(e){s.call(t,e,n,!1)}).error(function(e){s.call(t,e,n,!0)})})}function u(e){e.preventDefault();var t=this.get("form");if(t.validate())this.fire("previewSubmit")}function c(){clearTimeout(T),require("common/util/gotop").unBind(),clearTimeout(_),clearInterval(N)}function d(){var e=this,t=this.get("channelId").getValue(),i=S[t];this.getGroup("panel-external").addState("hidden"),g.each(this.getGroup("panel-external"),function(e){g.each(e.children,function(e){e.addState("disabled")})}),g.each(i.external,function(t){if(e.get(t).removeState("hidden"),"read"!==e.model.get("operate"))g.each(e.get(t).children,function(e){e.removeState("disabled")})});var n=this.model,r="",o={channelId:t,homeTitle:n.get("channelInfo").homeTitle,operate:n.get("operate")||"",policySummary:n.get("channelInfo").policySummary};g.each(i.recommend,function(e){var i="channelImgTpl",a=n.get("articleTypeStr").indexOf([",",e.recommendType,","].join(""))>-1?!0:!1,s={checked:a},l=y.extend(o,s,e);if("img"===e.type){var u={uuidsObjValue:n.get("uuidsObj")[e.recommendType]};l=y.extend(l,u)}else if(2===t||4===e.recommendType)i="policyTextTpl";else i="channelTextTpl";r+=D.render(i,l)});var a=this.get("panel-recommend");a.setContent(r),f.call(this)}function f(){var e=this,t=this.getGroup("ckimg");if(t.on("change",a,this),"read"!==this.model.get("operate"))l.call(this);var i=this.model.get("articleId");if("undefined"!=typeof i)C(".img-delete").on("click",function(){var t=C(this),i=this.id,n=i.substr(0,i.lastIndexOf("-")),r=n+"-uuid";e.get(r).setValue(""),t.parent().html(""),t=null});this.getGroup("ckhome").on("change",h,this)}function h(e){var t=e.target;if(t.checked)g.each(this.getGroup("ckhome"),function(e){if(e!==t)e.setChecked(!1)})}function p(e){e.preventDefault();var t=this.model.get("articleId"),i=location.href.split("#")[0]+"#",n="/channel/preview~articleId="+t;n+="&targetId="+B.getTargetId(),i+=n,window.open(i)}function m(){var e=this,t=this.model.get("articleId");clearTimeout(_),_=setTimeout(function(){try{e.fire("resetVail",t)}catch(i){}},0),clearInterval(N),N=setInterval(function(){try{e.fire("resetVail",t)}catch(i){}},24e4)}require("tpl!8ab58a8b.tpl.html"),require("ui/ReleaseSourceList");var g=require("underscore"),v=require("er/util"),y=require("esui/lib"),b=require("ub-ria/mvc/FormView"),C=jQuery,E=window.Upload,x=require("common/util/localStorage"),D=require("etpl"),w=require("common/permission"),B=require("common/common");v.inherits(e,b),e.prototype.template="channelForm";var A=[];window.setChannelUuid=function(e){A.push(e)},e.prototype.getEntity=function(){var e=b.prototype.getEntity.apply(this,arguments);if(w.isChiefEditor())e.status=6;else e.status=5;var t=this.model.get("articleId");if("undefined"!=typeof t)e.id=t;if(A.length)e.innerUuids=A;var i=UE.getEditor("ueditor-content");return e.content=i.getContent(),e},e.prototype.uiEvents={};var T,F=require("./enum"),S=F.formConfig,k=F.VerifyLogFields;e.prototype.uiProperties={releaseTime:{autoHideLayer:!0},reviewTable:{fields:k,select:!1,width:850}};var N,_;return e.prototype.bindEvents=function(){b.prototype.bindEvents.apply(this,arguments);var e=this;A=[],clearTimeout(T),UE.delEditor("ueditor-content");var a=UE.getEditor("ueditor-content");a.on("blur",function(){var t=this.getContent();e.get("content").setValue(t)}),a.on("afterUploadImg",function(e,t){if("afterUploadImg"===e)A.push(t.innerUuid)});var s=this.get("channelId");if(s.on("change",t,this),d.call(this),"read"===this.model.get("operate"))a.ready(function(){this.setDisabled()});var l=this.get("featureArticleAttribute");l.on("change",i,this);var f=this.get("creditHotAttribuite");f.on("change",n,this);var h=this.get("creditCommentAttribute");h.on("change",r,this);var g=this.get("weekNum");g.on("change",o,this);var v=this.model.get("articleId");if("undefined"!=typeof v){T=setTimeout(function(){try{a.setContent(e.model.get("channelInfo").content)}catch(t){}},500);var y=this.get("toPreview");y.removeState("hidden"),y.on("click",p,this),m.call(this)}var C=this.get("preview");C.on("click",u,this),this.on("leave",c,this),require("common/util/gotop").init()},e}),define("common/base/BaseModel",["require","er/util","ub-ria/mvc/FormModel","ub-ria/mvc/EntityValidator"],function(require){function e(){i.apply(this,arguments),this.setValidator(new n)}var t=require("er/util"),i=require("ub-ria/mvc/FormModel"),n=require("ub-ria/mvc/EntityValidator");return t.inherits(e,i),e}),define("channel/FormModel",["require","underscore","er/util","esui/lib","common/base/BaseModel","./Data","common/GlobalData","common/util/localStorage","./enum"],function(require){function e(){o.apply(this,arguments),this.addData(new a),this.addData("global",s.getInstance())}function t(){var e=location.hash.split("~"),t=e[1].split("&");return t=t.slice(1,t.length-2),t.join("&")}var i=require("underscore"),n=require("er/util"),r=require("esui/lib"),o=require("common/base/BaseModel"),a=require("./Data"),s=require("common/GlobalData"),l=require("common/util/localStorage");n.inherits(e,o);var u=require("./enum");return e.prototype.datasource={informationAttributes:function(){return u.informationAttributes},creditHotAttribuites:function(){return u.creditHotAttribuites},creditResultAttribuites:function(){return u.creditResultAttribuites},crumbPath:function(e){var i=[{text:"栏目管理",href:"#/channel/list"},{text:"上传文章"}],n=e.get("from");if(!n)i[0].href="#/channel/list";else{var r=t();i[0].href="#/channel/"+n+"~"+r}if("reviewList"===e.get("from"))i[1].text="审核文章";return i},channelList:function(e){var t=s.getInstance().getChannels();return t.channelsList.slice(1)},channelId:function(e){if("undefined"==typeof e.get("articleId")){var t=l.get("lastChannelId");if("undefined"!=typeof t)e.set("channelId",t)}return e.get("channelId")||void 0},getCreditCommentLists:function(e){return e.getCreditCommentList().done(function(e){return e.spVOList||[]})},getCreditCommentStages:function(e){return e.getCreditCommentList().done(function(e){return e.weeksNumLists||[]})},creditCommentAttribute:function(e){if("undefined"==typeof e.get("creditCommentAttribute")){var t=l.get("lastCreditComment");if(void 0!==typeof t)e.set("creditCommentAttribute",t)}return e.get("creditCommentAttribute")||void 0},weekNum:function(e){if("undefined"==typeof e.get("weekNum")){var t=l.get("lastCreditStage");if(void 0!==typeof t)e.set("weekNum",t)}return e.get("weekNum")||void 0},getSpecialReportLists:function(e){return e.getSpecialReportList().done(function(e){return e.spVOList||[]})},featureArticleAttribute:function(e){if("undefined"==typeof e.get("featureArticleAttribute")){var t=l.get("lastSpecialName");if("undefined"!=typeof t)e.set("featureArticleAttribute",t)}return e.get("featureArticleAttribute")||void 0},creditHotAttribuite:function(e){if("undefined"==typeof e.get("creditHotAttribuite")){var t=l.get("lastHotName");if("undefined"!=typeof t)e.set("creditHotAttribuite",u.creditHotAttribuiteMap[t])}return e.get("creditHotAttribuite")||void 0},channelInfoTmp:[{channelInfo:function(e){var t=e.get("articleId");if("undefined"!=typeof t)return e.getChannelInfo(t);else return{}}},{channelIdNew:function(e){var t=e.get("channelInfo");if(t&&t.id){if(e.set("artActivityList",t.artReviewVoList||[]),"undefined"==typeof e.get("channelId"))e.set("channelId",t.channelId);var n=t.articleType;if(n&&n.length){var o=","+n.join(",")+",";e.set("articleTypeStr",o);var a=t.uuids;if(a&&a.length){var s={};i.each(a,function(e,t){var i=n[t];s[i]=e}),e.set("uuidsObj",s)}else e.set("uuidsObj",{})}else e.set("articleTypeStr",""),e.set("uuidsObj",{});var l="";if(t.releaseTime)l=r.date.format(t.releaseTime,"YYYY-MM-DD");if(e.set("releaseTime",l),e.set("releaseSource",t.releaseSource||[]),e.set("releaseSourceStr",e.get("releaseSource").join(",")),t.featureArticleAttribute)e.set("featureArticleAttribute",t.featureArticleAttribute);if(t.weekNum)e.set("weekNum",t.weekNum);if(5===t.informationAttribute||6===t.informationAttribute)e.set("creditResultAttribuite",t.informationAttribute);if(t.informationAttribute>6)e.set("creditCommentAttribute",t.informationAttribute)}else e.set("articleTypeStr",""),e.set("uuidsObj",{}),e.set("releaseSource",["国家发展和改革委员会"]),e.set("releaseSourceStr","国家发展和改革委员会")}}],releaseSourceList:function(){return u.ReleaseSourceList}},e.prototype.getChannelInfo=function(e){var t=this.data();return t.getChannelInfo({articleId:e})},e.prototype.getChannels=function(){var e=this.data();return e.getChannels()},e.prototype.getSpecialReportList=function(){var e=this.data();return e.getSpecialReportList()},e.prototype.getCreditCommentList=function(){var e=this.data();return e.getCreditEvaluationList()},e.prototype.resetVail=function(e){var t=this.data();return t.resetVail(e)},e}),define("common/base/BaseForm",["require","underscore","ub-ria/mvc/FormAction","er/util"],function(require){function e(){r.apply(this,arguments),this.setSubmitHandler({handle:this.submitHandler||t})}function t(e,t){t.redirect("/"+t.getEntityName()+"/list")}function i(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}var n=require("underscore"),r=require("ub-ria/mvc/FormAction"),o=require("er/util");return o.inherits(e,r),e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var t={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage()};this.view.waitConfirm(t).then(n.bind(i,this))}else i.call(this)},e}),define("channel/Form",["require","underscore","common/base/BaseForm","er/util","./config","er/Deferred","./FormModel","./FormView"],function(require){function e(){a.apply(this,arguments)}function t(){this.submit("preview")}function i(){var e=location.hash.split("~"),t=e[1].split("&");return t=t.slice(1,t.length-2),t.join("&")}function n(e){var t=e.data;this.model.resetVail({articleId:t})}function r(){var e=this.model.get("articleId"),t=new Image;t.src="/article/validate/destoryArticleVailTime?articleId="+e+"&_="+(new Date).getTime()}var o=require("underscore"),a=require("common/base/BaseForm"),s=require("er/util"),l=require("./config"),u=require("er/Deferred");return s.inherits(e,a),e.prototype.group="default",e.prototype.entityDescription=l.description,e.prototype.modelType=require("./FormModel"),e.prototype.viewType=require("./FormView"),e.prototype.submit=function(e){var t=this.view.getEntity();if("preview"===e)t.status=1;this.view.disableSubmit();var i=t.channelId;if(null==i||"undefined"==typeof i)return this.view.alert("您没有上传文章的权限！"),void this.view.enableSubmit();else return void u.when(this.submitEntity(t)).ensure(o.bind(this.view.enableSubmit,this.view))},e.prototype.getCancelConfirmTitle=function(){return"提示信息"},e.prototype.redirectAfterCancel=function(){var e=this.model.get("from");if(!e)this.redirect("/channel/list");else{var t=i();this.redirect("/channel/"+e+"~"+t)}},e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("previewSubmit",t,this),this.view.on("resetVail",n,this);var e=this,o=this.model.get("from");this.setSubmitHandler({handle:function(){if(!o)e.redirect("/channel/list");else{var t=i();e.redirect("/channel/"+o+"~"+t)}}}),this.view.on("reload",function(){this.reload()},this);var s=this.model.get("articleId");if("undefined"!=typeof s)this.on("submitcancel",r,this)},e.prototype.leave=function(){this.view.fire("leave"),a.prototype.leave.apply(this,arguments)},e}),define("channel/CenterListView",["require","er/util","esui/lib","ub-ria/mvc/ListView","common/GlobalData","common/layout","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","common/permission","esui/Table"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=this,i=e.args,n=i.split(",");switch(e.name){case"edits":var r=n[2];if(r)return void this.alert("您好，该文章已经推荐，请联系总编辑重新调序替换后进行再次编辑！","提示信息");i={articleId:n[0],channelId:n[1]},t.fire("edits",i);break;case"remove":r=n[1];var o=n[0];if(r)return void this.alert("您好，该文章已经推荐，请联系总编辑重新调序替换后进行再次编辑！","提示信息");var a=this.confirm("你确认要删除么？","提示信息");a.on("ok",function(){t.fire("delete",{args:{ids:[o]}})});break;case"release":t.fire("release",{args:{ids:[i]}});break;case"recovery":t.fire("recovery",{args:{ids:[i]}})}}var i=require("er/util"),n=require("esui/lib"),r=require("ub-ria/mvc/ListView"),o=require("common/GlobalData").getInstance(),a=require("common/layout");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),i.inherits(e,r),e.prototype.template="centerList";var s=o.getUser().userid,l=require("common/permission"),u=[{title:"文章序号",field:"id",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){var t=o.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,
stable:!0,content:function(e){var t=location.hash.split("~"),i=t[1]?"&"+t[1]:"",n="#/channel/view~from=center"+i+"&articleId="+e.id+"&id="+e.id,r=[{text:e.title,type:"read",url:n}],o=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+o.operations(r)+"</div>"}},{title:"文章来源",field:"articleSource",sortable:!0,resizable:!1,width:150,stable:!0,content:function(e){var t=e.articleSource||"";return'<div class="ellipsistext" title="'+t+'">'+t+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return n.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"所有状态",field:"status",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){var t=o.getReviewStatus().reviewStatusMap||{};return t[e.status]}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=[{command:"edits",type:"edits",args:e.id+","+e.channelId+","+(e.isOrder||""),text:"编辑"},{command:"remove",type:"remove",args:e.id+","+(e.isOrder||""),text:"删除"},{command:"recovery",type:"recovery",args:e.id,text:"恢复"}];switch(e.status){case 1:t=t.slice(0,2);break;case 2:t=t.slice(0,2);break;case 3:t=t.slice(-1);break;case 4:t=t.slice(0,2);break;case 5:case 6:t=[]}if(s!==e.creatorId&&!l.isChiefEditor())t=[];var i=require("esui/Table");return i.operations(t)}},{title:"标签",field:"tags",sortable:!1,resizable:!1,width:70,stable:!0,content:function(e){if(e.tags)return a.getExtractInfo(e.tags.join(","));else return void 0}}];return e.prototype.tableFields=u,e.prototype.uiProperties={table:{fields:u}},e.prototype.uiEvents={"table:command":t},e}),define("channel/CenterListModel",["require","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","./common","er/datasource","./enum"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("./common");t.inherits(e,i);var a=require("er/datasource"),s=require("./enum");return e.prototype.defaultStatusValue=0,e.prototype.datasource={crumbPath:a.constant(s.CrumbPath),channelTypes:function(e){var t=r.getInstance().getChannels();return t.channelsList},useTableCommand:a.constant(!0),channelStatus:function(e){var t=r.getInstance().getReviewStatus();return t.reviewStatusList},setStatus:function(e){if("undefined"==typeof e.get("status"))e.set("status","-1")},tabsHtml:function(){return o.initTabs("centerList")},tags:function(){return s.tags}},e.prototype.getReviewStatus=function(){var e=this.data();return e.getReviewStatus()},e.prototype.getArticleFromReview=function(){var e=this.data();return e.getArticleFromReview()},e.prototype.defaultArgs={orderBy:"",order:""},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments),t=this.get("channelType");if("-1"!==t)e.channelType=t;var n=this.get("tag");if("-1"!==n)e.tag=n;var r=this.get("status");if("-1"===r)delete e.status;return e},e.prototype.search=function(e){return e.reviewType=1,e.isHistory=0,this.data().getArticleFromReview(e)},e.prototype.remove=function(e){return this.data().remove(e)},e.prototype.recovery=function(e){return this.data().recovery(e)},e.prototype.hasAnyBody=function(e){var t=this.data();return t.hasAnyBody(e)},e}),define("channel/CenterList",["require","er/util","./config","ub-ria/mvc/ListAction","./CenterListModel","./CenterListView"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=e.args,i=this;this.model.remove(t).then(function(){i.reload()})}function i(e){var t=e.args,i=this;this.model.recovery(t).then(function(){i.reload()})}function n(e){var t=this,i=e.articleId,n=location.hash.split("~"),r=n[1]?"&"+n[1]:"";this.model.hasAnyBody({articleId:i}).done(function(){var e="/channel/update~from=center"+r+"&articleId="+i+"&id="+i;t.redirect(e)})}var r=require("er/util"),o=require("./config"),a=require("ub-ria/mvc/ListAction");return r.inherits(e,a),e.prototype.group="default",e.prototype.entityDescription=o.description,e.prototype.modelType=require("./CenterListModel"),e.prototype.viewType=require("./CenterListView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("delete",t,this),this.view.on("recovery",i,this),this.view.on("edits",n,this),this.view.on("reload",function(){this.reload()},this)},e}),define("channel/AuditListView",["require","underscore","er/util","esui/lib","ub-ria/mvc/ListView","common/layout","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","./enum","common/GlobalData","esui/Table"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=e.args;switch(e.name){case"review":this.fire("review",t)}}function i(){var e=this,t=[],i=this.getSelectedItems();if(r.each(i,function(e){t.push(e.id)}),t.length){var n=this.confirm("你确认要批量审核吗？","提示信息");n.on("ok",function(){e.fire("quantityReview",{args:{articleIds:t}})})}}function n(e){var t=this.getSafely("quantityReview"),i=e.selectedIndex,n=e.target.datasource,o=[];if(r.each(i,function(e){o.push(n[e].id)}),o.length>0)t.setDisabled(!1);else t.setDisabled(!0)}var r=require("underscore"),o=require("er/util"),a=require("esui/lib"),s=require("ub-ria/mvc/ListView"),l=require("common/layout");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),o.inherits(e,s),e.prototype.template="auditChannelList";var u=(require("./enum"),require("common/GlobalData").getInstance()),c=[{title:"ID",field:"id",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){var t=u.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=location.hash.split("~"),i=t[1]?"&"+t[1]:"",n="#/channel/verify~from=auditList"+i+"&articleId="+e.id,r=[{text:e.title,type:"read",url:n}],o=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+o.operations(r)+"</div>"}},{title:"文章来源",field:"articleSource",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){var t=e.articleSource||"";return'<div class="ellipsistext" title="'+t+'">'+t+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return a.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"发布时间",field:"actualTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.actualTime)return"";else return a.date.format(e.actualTime,"YYYY-MM-DD")}},{title:"首发/转发",field:"isReprinted",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){if(e.isReprinted)return"首发";else return"转发"}},{title:"机构审核",field:"organization",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){if(1===e.organization)return"国家信息中心";else return void 0}},{title:"文章状态",field:"status",sortable:!1,resizable:!1,width:80,stable:!0,content:function(e){var t=u.getReviewStatus().reviewStatusMap||{};return t[e.status]}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:120,stable:!0,content:function(e){var t=location.hash.split("~"),i=t[1]?"&"+t[1]:"";if(e.isAudit)return e.title;var n=e.previewPath,r=[{text:"预览",type:"read",url:"http://www.creditchina.gov.cn"+n,target:"_blank"},{text:"审核",type:"read",url:"#/channel/verify~from=auditList"+i+"&articleId="+e.id}];if(3===e.status)r=r.splice(1,1);var o=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+o.operations(r)+"</div>"}},{title:"标签",field:"tags",sortable:!1,resizable:!1,width:70,stable:!0,content:function(e){return l.getExtractInfo(e.tags.join(","))}}];return e.prototype.tableFields=c,e.prototype.uiProperties={table:{fields:c,select:"multi"}},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=r.trim(i.getValue());return t.pageSize=this.get("pager").get("pageSize"),t},e.prototype.uiEvents={"table:command":t,"table:select":n,"quantityReview:click":i},e}),define("channel/AuditListModel",["require","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","./common","./enum","er/datasource"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("./common"),a=require("./enum").Statuses;t.inherits(e,i);var s=require("er/datasource"),l=require("./enum");return e.prototype.defaultStatusValue=0,e.prototype.datasource={crumbPath:s.constant(l.CrumbPath),channelTypes:function(e){var t=r.getInstance().getChannels();return t.channelsList},useTableCommand:s.constant(!0),channelStatus:s.constant([a.fromAlias("ALL"),a.fromAlias("PUBLISHED"),a.fromAlias("DELETED")]),tabsHtml:function(){return o.initTabs("auditList")},tags:function(){return l.tags}},e.prototype.getReviewStatus=function(){var e=this.data();return e.getReviewStatus()},e.prototype.defaultArgs={orderBy:"",order:""},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments),t=this.get("channelType");if("-1"!==t)e.channelType=t;var n=this.get("tag");if("-1"!==n)e.tag=n;return e},e.prototype.saveManyReviewForArticle=function(e){return this.data().saveManyReviewForArticle(e)},e.prototype.search=function(e){return e.isAudited=1,this.data().allList(e)},e.prototype.hasAnyBody=function(e){var t=this.data();return t.hasAnyBody(e)},e}),define("channel/AuditList",["require","er/util","./config","ub-ria/mvc/ListAction","./AuditListModel","./AuditListView"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=e.args,i=this;this.model.saveManyReviewForArticle(t).then(function(e){i.reload()})}function i(e){var t=this,i=e.data;this.model.hasAnyBody({articleId:i}).done(function(){t.redirect("#/channel/view~from=reviewList&articleId="+i)})}function n(e){}var r=require("er/util"),o=require("./config"),a=require("ub-ria/mvc/ListAction");return r.inherits(e,a),e.prototype.group="default",e.prototype.entityDescription=o.description,e.prototype.modelType=require("./AuditListModel"),e.prototype.viewType=require("./AuditListView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("review",i,this),this.view.on("read",n,this),this.view.on("quantityReview",t,this)},e}),define("channel/AlreadyAuditListView",["require","underscore","er/util","ef/UIModel","esui/lib","ub-ria/mvc/ListView","common/layout","tpl!8ab58a8b.tpl.html","./enum","common/GlobalData","esui/Table"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=e.args;switch(e.name){case"review":this.fire("review",t)}}var i=require("underscore"),n=require("er/util"),r=require("ef/UIModel"),o=require("esui/lib"),a=require("ub-ria/mvc/ListView"),s=require("common/layout");require("tpl!8ab58a8b.tpl.html"),n.inherits(e,a),e.prototype.template="alreadyAuditChannelList";var l=(require("./enum"),require("common/GlobalData").getInstance()),u=[{title:"ID",field:"id",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){var t=l.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=location.hash.split("~"),i=t[1]?"&"+t[1]:"",n="#/channel/verify~from=alreadyAuditList"+i+"&articleId="+e.id,r=[{text:e.title,type:"read",url:n}],o=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+o.operations(r)+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return o.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"发布时间",field:"actualTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.actualTime)return"";else return o.date.format(e.actualTime,"YYYY-MM-DD")}},{title:"文章状态",field:"status",sortable:!1,resizable:!1,width:80,stable:!0,content:function(e){var t=l.getReviewStatus().reviewStatusMap||{};return t[e.status]}},{title:"审核结论",field:"auditConclusion",sortable:!1,resizable:!1,width:80,stable:!0,content:function(e){var t=require("./enum").auditConclusion,i=location.hash.split("~"),n=i[1]?"&"+i[1]:"";if(e.auditConclusion){t=t.getTextFromValue(e.auditConclusion);var r="#/channel/verify~from=alreadyAuditList"+n+"&articleId="+e.id,o=[{text:t,type:"read",url:r}],a=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+a.operations(o)+"</div>"}return""}},{title:"标签",field:"tags",sortable:!1,resizable:!1,width:80,stable:!0,content:function(e){return s.getExtractInfo(e.tags.join(","))}},{title:"审核时间",field:"auditTime",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){if(!e.auditTime)return"";else return o.date.format(e.auditTime,"YYYY-MM-DD")}}];return e.prototype.tableFields=u,e.prototype.uiProperties={table:{fields:u}},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var n=this.get("keyword");if(n)t.keyword=i.trim(n.getValue());var o=this.get("calendar").getRawValue();return t.beginTime=r.formatters.date(o.begin),t.endTime=r.formatters.date(o.end),t.pageSize=this.get("pager").get("pageSize"),t},e.prototype.uiEvents={"table:command":t},e}),define("channel/enum",["require","er/Enum","esui/lib","common/GlobalData","common/enum"],function(require){var e=require("er/Enum"),t=require("esui/lib"),i=require("common/GlobalData").getInstance(),exports={};exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports.state={1:"待发布",3:"已删除",2:"已发布"},exports.ReviewStatusMap={0:"全部状态",1:"暂存",2:"已经删除",3:"审批拒绝",4:"待审批",5:"已近发布"},exports.CrumbPath=[{href:"",text:"栏目管理"}],exports.channelStatus=[{name:"全部状态",value:"-1"},{name:"待发布",value:"1"},{name:"已发布",value:"2"},{name:"已删除",value:"3"}],exports.AuditOpinion=new e({alias:"TONGYI",text:"同意",value:1},{alias:"XIACHE",text:"下撤",value:2},{alias:"XIUGAI",text:"修改",value:3},{alias:"OTHER",text:"其他",value:4},{alias:"CAINA",text:"采纳",value:5},{alias:"HULUE",text:"忽略",value:6}),exports.Statuses=new e({alias:"ALL",text:"全部状态",value:-1},{alias:"PUBLISHED",text:"已发布",value:2},{alias:"DELETED",text:"已删除",value:3}),exports.ReleaseSourceList={"国家部委":["国家发展和改革委员会","中国人民银行","中央宣传部","人力资源社会保障部","司法部","民政部","中央政法委","环境保护部","财政部","工商总局","中央编办","住房城乡建设部","质检总局","保监会","中央文明办","交通运输部","安全监管总局","公务员局","高法院","农业部","食品药品监管总局","外汇局","高检院","商务部","知识产权局","教育部","文化部","法制办","工业和信息化部","卫生计生委","互联网信息办","公安部","海关总署","银监会","安全部","税务总局","证监会"]},exports.informationAttributes=[{name:"中央",value:"1"},{name:"地方",value:"2"},{name:"社会热点",value:"15"}],exports.creditHotAttribuites=[{name:"热点事件",value:"3"},{name:"风险提示",value:"4"}],exports.creditResultAttribuites=[{name:"地方成果",value:"5"},{name:"大厅成果",value:"6"}],exports.tags=[{name:"全部标签",value:-1},{name:"头条推荐",value:"头条推荐"},{name:"首页图片",value:"首页图片"},{name:"首页文字",value:"首页文字"},{name:"频道图片",value:"频道图片"},{name:"大家关注",value:"大家关注"}],exports.informationAttributesMap={1:"中央",2:"地方",5:"地方成果",6:"大厅成果",7:"一周信用评价焦点",8:"一周信用动态",9:"一周信用新规",10:"一周失信惩戒",11:"一周风险提示",12:"一周诚信风貌",13:"一周信用评级综述",14:"一周信用综述",15:"社会热点"},exports.organizationMap={1:"国家信息中心"},exports.roleAndNamesMap={0:"编辑员",1:"总编辑",2:"后台监察员"},exports.isReprintedMap={0:"转发",1:"首发"},exports.creditHotAttribuiteMap={3:"热点事件",4:"风险提示"},exports.recommendConfig=[{title:"首页头条推荐",recommendType:1,placeType:2,type:"img",imgInfo:"仅支持jpg，gif，png 三种图像格式，图像需小于 256 K，尺寸为344*210",ckhome:"ckhome"},{title:"首页文字推荐",recommendType:8,placeType:0,type:"text",ckhome:"ckhome"},{title:"频道页图片推荐",recommendType:4,placeType:4,type:"img",imgInfo:"仅支持jpg，gif，png 三种图像格式，图像需小于 256 K，尺寸为310*180",ckhome:""}],exports.homeImgItem={title:"首页图片推荐",recommendType:2,placeType:3,type:"img",imgInfo:"仅支持jpg，gif，png 三种图像格式，图像需小于 256 K，尺寸为132*92",ckhome:"ckhome"},exports.policyText={title:"频道页推荐",recommendType:4,placeType:4,type:"text",ckhome:""},exports.copyRecommendConfig=exports.recommendConfig.concat(exports.homeImgItem),exports.copyPolicyConfig=exports.recommendConfig.slice(0,2).concat(exports.policyText),exports.copyHonestConfig=exports.recommendConfig.slice(2).concat(exports.homeImgItem),exports.copyHotWeekConfig=exports.recommendConfig.slice(2),exports.formConfig={0:{external:["panel-releasesource"],recommend:exports.recommendConfig},1:{external:["panel-information","panel-releasesource"],recommend:exports.copyRecommendConfig},2:{external:["panel-releasesource-required"],recommend:exports.copyPolicyConfig},4:{external:["panel-releasesource"],recommend:exports.copyRecommendConfig},7:{external:["panel-releasesource"],recommend:exports.recommendConfig},8:{external:["panel-releasesource"],recommend:exports.recommendConfig},9:{external:["panel-honestSummer"],recommend:exports.copyHonestConfig},10:{external:["panel-featureArticleAttribute"],recommend:exports.recommendConfig},11:{external:["panel-creditHotAttribuite"],recommend:exports.copyHotWeekConfig},12:{external:["panel-creditResultAttribuite"],recommend:exports.recommendConfig},13:{external:["panel-creditCommentAttribuite","panel-creditCommentStage"],recommend:exports.recommendConfig},14:{external:["panel-releasesource"],recommend:exports.recommendConfig}};var n={0:"编辑暂存",1:"提交审批",2:"删除文章",3:"恢复文章",4:"总编辑审批",5:"审核员审批",6:"编辑提交",7:"批阅"};return exports.AuditLogFields=[{title:"任务提交人",field:"userName",width:150,content:function(e){var t=e.userName;return'<div class="ellipsistext" title="'+t+'">'+t+"</div>"}},{title:"提交人角色",field:"roleName",width:100,content:function(e){var t=e.roleName,i=require("common/enum").Role.valueIndex[t]||{};return i.text||""}},{title:"任务名称",field:"taskName",width:110,content:function(e){return'<div class="ellipsistext" title="'+n[e.taskName]+'">'+n[e.taskName]+"</div>"}},{title:"任务提交时间",field:"commitTime",width:150,content:function(e){if(!e.commitTime)return"";else return t.date.format(e.commitTime,"YYYY-MM-DD HH:mm:ss")}},{title:"文章状态",field:"artStatus",width:100,content:function(e){var t=e.artStatus,n=i.getReviewStatus().reviewStatusMap||{};return'<div class="ellipsistext" title="'+n[t]+'">'+n[t]+"</div>"}},{title:"审批意见",field:"comment",width:240,content:function(e){return'<div class="ellipsistext" title="'+e.comment+'">'+e.comment+"</div>"}}],exports.addLogFields=[{title:"单位名称",field:"organization",width:100,content:function(e){return'<div class="ellipsistext" title="'+e.organization+'">'+e.organization+"</div>"}},{title:"审批结论+意见",field:"comment",width:240,content:function(e){return'<div class="ellipsistext" title="'+e.comment+'">'+e.comment+"</div>"}}],exports.VerifyLogFields=exports.AuditLogFields.slice(0,4).concat(exports.addLogFields),exports.auditConclusion=new e({alias:"ALL",text:"审核结论",value:-1},{alias:"TONGYI",text:"同意",value:1},{alias:"XIACHE",text:"下撤",value:2},{alias:"XIUGAI",text:"修改",value:3},{alias:"OTHER",text:"其他",value:4}),exports}),define("channel/AlreadyAuditListModel",["require","underscore","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","./common","common/permission","ef/UIModel","moment","./enum","er/datasource"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=(require("underscore"),require("er/util")),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("./common"),a=(require("common/permission"),require("ef/UIModel")),s=(require("moment"),require("./enum").auditConclusion);t.inherits(e,i);var l=require("er/datasource"),u=require("./enum");return e.prototype.defaultStatusValue=0,e.prototype.datasource={crumbPath:l.constant(u.CrumbPath),channelTypes:function(e){var t=r.getInstance().getChannels();return t.channelsList},useTableCommand:l.constant(!0),channelStatus:function(e){var t=r.getInstance().getReviewStatus();return t.reviewStatusList},setStatus:function(e){if("undefined"==typeof e.get("status"))e.set("status","-1")},tabsHtml:function(){return o.initTabs("alreadyAuditList")},auditConclusions:l.constant([s.fromAlias("ALL"),s.fromAlias("TONGYI"),s.fromAlias("XIACHE"),s.fromAlias("XIUGAI"),s.fromAlias("OTHER")])},e.prototype.prepare=function(){var e=this.get("beginTime")||"2015-01-01",t=this.get("endTime")||a.formatters.date(new Date);this.set("rangeDate",e+","+t)},e.prototype.getReviewStatus=function(){var e=this.data();return e.getReviewStatus()},e.prototype.defaultArgs={orderBy:"",order:""},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments),t=this.get("channelType");if("-1"!==t)e.channelType=t;var n=this.get("auditConclusion");if("-1"!==n)e.auditConclusion=n;return e},e.prototype.search=function(e){var t=this.data("global").getUserProperty("authorityAlias");if(t.SUPERVISION===!0||t.READONLY===!0)e.isAudited=2;return this.data().allList(e)},e.prototype.hasAnyBody=function(e){var t=this.data();return t.hasAnyBody(e)},e}),define("channel/AlreadyAuditList",["require","er/util","./config","ub-ria/mvc/ListAction","./AlreadyAuditListModel","./AlreadyAuditListView"],function(require){function e(){r.apply(this,arguments)}function t(e){var t=this,i=e.data;this.model.hasAnyBody({articleId:i}).done(function(){t.redirect("#/channel/view~from=reviewList&articleId="+i)})}var i=require("er/util"),n=require("./config"),r=require("ub-ria/mvc/ListAction");return i.inherits(e,r),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./AlreadyAuditListModel"),e.prototype.viewType=require("./AlreadyAuditListView"),e.prototype.initBehavior=function(){r.prototype.initBehavior.apply(this,arguments),this.view.on("review",t,this)},e}),define("common/common",[],function(){function e(){var e=location.hash,t="";if(e.indexOf("targetId")>-1){var i=e.match(/[~&]targetId=([^&]*)/);if(i&&i[1])t=i[1]}return t}return{getTargetId:e}}),define("common/layout",["require","underscore","esui/lib","common/GlobalData","common/permission","common/common"],function(require){function e(e){var t="";return c.each(e,function(e){if(e.name&&!h(e.name))t+="";else{if(t+="<dl",e.active)t+=' class="active"';if(t+=">",e.children&&e.children.length)t+=d.format(g,e),c.each(e.children,function(e){if(e.name&&!h(e.name))t+="";else t+=d.format(y,e)});else t+=d.format(v,e);t+="</dl>"}}),t}function t(e){var t=d.event.getTarget(e);if("dt"===t.nodeName.toLowerCase()||"dt"===t.parentNode.nodeName.toLowerCase()){if("dt"===t.parentNode.nodeName.toLowerCase())t=t.parentNode;t=t.parentNode,d.addClass(t,"active"),c.each(d.getChildren(t.parentNode),function(e){if(e!==t)d.removeClass(e,"active")})}}function i(){var e=d.g("sider");d.on(e,"click",t)}function n(){var t=E;if(p.isAuditor())E[0].href="#/channel/allList";if(p.isReadonly())E[0].href="#/channel/allList";if(p.isSupervision())E[0].href="#/channel/allList";if(p.isUploader())t=E.slice(6);d.g("sider").innerHTML=e(t),i()}function r(){var t=x;d.g("sider").innerHTML=e(t),i()}function o(){var e=m.username?m.username:m.pubUsername;d.g("head-user-name").innerHTML=e}function a(){var e=m.authorityAlias;if(e.DATAUPLOAD===!0)d.g("layOut").href="/publicity/logout",d.g("main-name").innerHTML="双公示数据平台",d.g("logoLink").href="#/pubData/form",d.removeClass(d.g("help-tip"),"hidden");else d.g("layOut").href="/logout",d.g("main-name").innerHTML="后台管理系统"}function s(){o(),n(),a()}function l(){o(),r(),a()}function u(e,t){var i=["ellipsistext"];if(t)i.push("table-ellipsis-wrapper-"+t);return'<div class="'+i.join(" ")+'" title="'+e+'">'+e+"</div>"}var c=require("underscore"),d=require("esui/lib"),f=require("common/GlobalData"),h=require("common/permission").hasModuleAccess,p=require("common/permission"),m=f.getInstance().getUser(),g='<dt class="sider-item sider-${item} sider-item-${name} ">${text}<span class="updown"></span></dt>',v='<dt><a href="${href}" class="sider-item sider-item-${name} sider-${item}">${text}</a></dt>',y='<dd><a href="${href}">${text}</a></dd>',b=require("common/common"),C=b.getTargetId();if(C)C="~targetId="+C;var E=[{text:"文章栏目管理",name:"channel",item:"item1",href:"#/channel/list"+C,children:[],active:!0},{text:"信用记录管理",name:"record",item:"item1",href:"",children:[{text:"信用上传/发布",name:"publish",item:"item1",href:"#/record/list"+C},{text:"信用模板管理",name:"template",item:"item1",href:"#/template/list"+C}]},{text:"用户权限管理",name:"authority",item:"item1",href:"",children:[{text:"组织/用户设置",href:"#/department/form"+C},{text:"用户权限配置",href:"#/role/list"+C}]},{text:"系统日志督查",name:"log",item:"item1",href:"#/log/list"+C,children:[]},{text:"网站留言",name:"siteMessage",item:"item1",href:"#/site/list"+C,children:[]},{text:"账号信息管理",name:"account",item:"item1",href:"#/account/form"+C},{text:"当前状态",name:"pubData",item:"item2",href:"#/pubData/form"},{text:"数据更新记录",name:"pubData",item:"item7",href:"#/pubData/dataHistory"},{text:"数据上传",name:"pubData",item:"item6",href:"#/pubData/upLoad"},{text:"WS数据接口",name:"pubData",item:"item4",href:"#/pubData/wsInterface"},{text:"修改口令",name:"pubData",item:"item5",href:"#/pubData/changePwd"}],x=[{text:"用户列表",name:"account",href:"#/manager/list",children:[],active:!0}];return{init:s,initAdmin:l,getExtractInfo:u}}),define("channel/AllListView",["require","er/util","esui/lib","ub-ria/mvc/ListView","underscore","common/GlobalData","common/layout","ef/UIModel","moment","tpl!8ab58a8b.tpl.html","tpl!8ab58a8b.tpl.html","common/permission","esui/Table","common/util/download","common/util/fixedbugtable"],function(require){function e(){o.apply(this,arguments)}function t(e){var t=this,i=e.args,n=i.split(",");switch(e.name){case"edits":var r=n[2];if(r)return void this.alert("您好，该文章已经推荐，请联系总编辑重新调序替换后进行再次编辑！","提示信息");i={articleId:n[0],channelId:n[1]},t.fire("edits",i);break;case"remove":r=n[1];var o=n[0];if(r)return void this.alert("您好，该文章已经推荐，请联系总编辑重新调序替换后进行再次编辑！","提示信息");var a=this.confirm("你确认要删除么？","提示信息");a.on("ok",function(){t.fire("delete",{args:{ids:[o]}})});break;case"release":t.fire("release",{args:{ids:[i]}});break;case"recovery":t.fire("recovery",{args:{ids:[i]}})}}function i(){var e=require("common/util/download"),t=this.model.get("beginTime"),i=this.model.get("endTime");i=c(i).clone().add("day",1).toDate(),i=c(i).format("YYYY-MM-DD");var n=this.model.get("targetId"),r="";if(n)r="beginTime="+t+"&endTime="+i+"&targetId="+n;else r="beginTime="+t+"&endTime="+i;e.iframePost("/channel/outExcel",r,"","window.downLoad")}var n=require("er/util"),r=require("esui/lib"),o=require("ub-ria/mvc/ListView"),a=require("underscore"),s=require("common/GlobalData").getInstance(),l=require("common/layout"),u=require("ef/UIModel"),c=require("moment");require("tpl!8ab58a8b.tpl.html"),require("tpl!8ab58a8b.tpl.html"),n.inherits(e,o),e.prototype.template="allChannelList";var d=s.getUser().userid,f=require("common/permission");return e.prototype.uiProperties={table:{selectMode:"line"}},e.prototype.getUIProperties=function(){var e=this.uiProperties||{},t=[{title:"文章序号",field:"id",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!0,resizable:!1,width:60,stable:!0,content:function(e){var t=s.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=location.hash.split("~"),i=t[1]?"&"+t[1]:"",n="#/channel/view~from=allList"+i+"&articleId="+e.id,r=[{text:e.title,type:"read",url:n}],o=require("esui/Table");return'<div class="ellipsistext" title="'+e.title+'">'+o.operations(r)+"</div>"}},{title:"文章来源",field:"articleSource",sortable:!0,resizable:!1,width:150,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.articleSource+'">'+e.articleSource+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!0,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return r.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"状态",field:"status",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){var t=s.getReviewStatus().reviewStatusMap||{};return t[e.status]}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){var t=[{command:"edits",type:"edits",args:e.id+","+e.channelId+","+(e.isOrder||""),text:"编辑"},{command:"remove",type:"remove",args:e.id+","+(e.isOrder||""),text:"删除"},{command:"recovery",type:"recovery",args:e.id,text:"恢复"}];switch(e.status){case 1:t=t.slice(0,2);break;case 2:t=t.slice(0,2);break;case 3:t=t.slice(-1);break;case 4:t=t.slice(0,2);break;case 5:case 6:t=[]}if(d!==e.creatorId&&!f.isChiefEditor())t=[];var i=require("esui/Table");return i.operations(t)}},{title:"标签",field:"tags",sortable:!1,resizable:!1,width:70,stable:!0,content:function(e){return l.getExtractInfo(e.tags.join(","))}}],i=s.getUserProperty("authorityAlias");if(i.READONLY===!0||i.SUPERVISION===!0)t.splice(6,1);return e.table.fields=t,e},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=a.trim(i.getValue());if(this.model.get("exportButtonValid")===!0){var n=this.get("calendar").getRawValue();t.beginTime=u.formatters.date(n.begin),t.endTime=u.formatters.date(n.end)}return t.pageSize=this.get("pager").get("pageSize"),t},e.prototype.bindEvents=function(){if(o.prototype.bindEvents.apply(this,arguments),this.model.get("exportButtonValid")===!0)this.get("exportExcel").on("click",i,this);var e=require("common/util/fixedbugtable");e.fixedbugToWidth.call(this)},e.prototype.uiEvents={"table:command":t},e}),define("common/permission",["require","common/GlobalData"],function(require){function e(e){var t=c.getInstance(),i=t.getUserProperty("authorityAlias");if(i.SUPER)return!0;switch(e){case"record":return i.READONLY||i.TPL_MGR||i.UPLOAD||i.AUDIT||i.SUPERVISION;case"publish":return i.READONLY||i.UPLOAD||i.AUDIT||i.SUPERVISION;case"template":return i.TPL_MGR;case"channel":return i.CMS||i.CHIEFEDITOR||i.AUDITOR||i.READONLY||i.SUPERVISION;case"authority":return i.USERS;case"log":return i.READONLY||i.SUPERVISION;case"account":return!0;case"siteMessage":return i.READONLY||i.SUPERVISION;case"pubData":return i.DATAUPLOAD}}function t(){var e=c.getInstance(),t=e.getUserProperty("authorityAlias");if(t.AUDITOR)return"/channel/allList";if(t.SUPER)return"/channel/list";if(t.CMS)return"/channel/list";if(t.READONLY||t.SUPERVISION)return"/channel/allList";if(t.UPLOAD||t.AUDIT)return"/record/list";if(t.TPL_MGR)return"/template/list";if(t.DATAUPLOAD)return"/pubData/form";else return"/account/form"}function i(){return c.getInstance().getUser().authorityAlias.CMS}function n(){return c.getInstance().getUser().authorityAlias.CHIEFEDITOR}function r(){return c.getInstance().getUser().authorityAlias.AUDITOR}function o(){return c.getInstance().getUser().authorityAlias.AUDIT}function a(){return c.getInstance().getUser().authorityAlias.UPLOAD}function s(){return c.getInstance().getUser().authorityAlias.READONLY}function l(){return c.getInstance().getUser().authorityAlias.SUPERVISION}function u(){return c.getInstance().getUser().authorityAlias.DATAUPLOAD}var c=require("common/GlobalData");return{hasModuleAccess:e,getIndex:t,isEditor:i,isChiefEditor:n,isAuditor:r,isReadonly:s,isSupervision:l,isApprove:o,isRecorder:a,isUploader:u}}),define("channel/common",["require","common/permission","underscore","esui/lib"],function(require){function e(){var e=o.slice(0);if(i.isEditor()){var t=e.slice(0,2);return t.concat(e.slice(5,6))}if(i.isChiefEditor()){var n=e.slice(0,3);return n.concat(e.slice(5))}if(i.isAuditor())return e.slice(1,3);if(i.isReadonly()||i.isSupervision()){var r=e.slice(1,2),a=e.slice(3,5);return r.concat(a)}return e}function t(t){var i=e(),o=n.map(i,function(e){
var i=a;if(e.tag===t)i=s;return r.format(i,e)});return o.join("")}var i=require("common/permission"),n=require("underscore"),r=require("esui/lib"),o=[{name:"我上传的文章",href:"#/channel/list",tag:"list"},{name:"所有文章",href:"#/channel/allList",tag:"allList"},{name:"待审批文章",href:"#/channel/reviewList",tag:"reviewList"},{name:"待审核文章",href:"#/channel/auditList",tag:"auditList"},{name:"已审核文章",href:"#/channel/alreadyAuditList",tag:"alreadyAuditList"},{name:"信息中心批复文章",href:"#/channel/center",tag:"centerList"},{name:"顺序调整",href:"#/channel/order",tag:"order"}],a='<li><a href="${href}">${name}</a></li>',s='<li class="active">${name}</li>';return{initTabs:t}}),define("channel/AllListModel",["require","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData","./common","ef/UIModel","./enum","er/datasource"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData"),o=require("./common"),a=require("ef/UIModel");t.inherits(e,i),i.prototype.statusTransitions=[{status:0,deny:[0]},{status:1,deny:[1]}];var s=require("./enum"),l=require("er/datasource");return e.prototype.datasource={crumbPath:l.constant(s.CrumbPath),channelTypes:function(e){var t=r.getInstance().getChannels();return t.channelsList},useTableCommand:l.constant(!0),channelStatus:function(e){var t=r.getInstance().getReviewStatus();return t.reviewStatusList},setStatus:function(e){if("undefined"==typeof e.get("status"))e.set("status","-1")},tabsHtml:function(){return o.initTabs("allList")},tags:function(){return s.tags}},e.prototype.getListChannels=function(){var e=this.data();return e.getListChannels()},e.prototype.defaultArgs={orderBy:"",order:"",status:"-1"},e.prototype.prepare=function(){var e=this.get("beginTime")||a.formatters.date(new Date),t=this.get("endTime")||a.formatters.date(new Date);this.set("rangeDate",e+","+t),this.set("beginTime",e),this.set("endTime",t)},e.prototype.remove=function(e){return this.data().remove(e)},e.prototype.release=function(e){return this.data().release(e)},e.prototype.recovery=function(e){return this.data().recovery(e)},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments),t=this.get("channelType");if("-1"!==t)e.channelType=t;var n=this.get("tag");if("-1"!==n)e.tag=n;var r=this.get("status");if("-1"===r)delete e.status;return e},e.prototype.search=function(e){return e.isAudited=-1,this.data().allList(e)},e.prototype.hasAnyBody=function(e){var t=this.data();return t.hasAnyBody(e)},e}),define("channel/AllList",["require","er/util","./config","ub-ria/mvc/ListAction","./AllListModel","./AllListView"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=e.args,i=this;this.model.remove(t).then(function(){i.reload()})}function i(e){var t=e.args,i=this;this.model.release(t).then(function(){i.reload()})}function n(e){var t=e.args,i=this;this.model.recovery(t).then(function(){i.reload()})}function r(e){var t=this,i=e.articleId,n=location.hash.split("~"),r=n[1]?"&"+n[1]:"";this.model.hasAnyBody({articleId:i}).done(function(){var e="/channel/update~from=allList"+r+"&articleId="+i+"&id="+i;t.redirect(e)})}var o=require("er/util"),a=require("./config"),s=require("ub-ria/mvc/ListAction");return o.inherits(e,s),e.prototype.group="default",e.prototype.entityDescription=a.description,e.prototype.modelType=require("./AllListModel"),e.prototype.viewType=require("./AllListView"),e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on("delete",t,this),this.view.on("release",i,this),this.view.on("recovery",n,this),this.view.on("edits",r,this),this.view.on("reload",function(){this.reload()},this)},e}),define("channel/AddListView",["require","er/util","ub-ria/mvc/ListView","esui/lib","tpl!8ab58a8b.tpl.html","common/GlobalData"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("ub-ria/mvc/ListView"),n=require("esui/lib");require("tpl!8ab58a8b.tpl.html"),t.inherits(e,i),e.prototype.template="addChannelList";var r=require("common/GlobalData").getInstance(),o=[{title:"文章序号",field:"id",sortable:!0,resizable:!1,width:80,stable:!0,content:function(e){return e.id}},{title:"栏目类型",field:"channelId",sortable:!1,resizable:!1,width:80,stable:!0,content:function(e){var t=r.getChannels().valueNameMap;return t[e.channelId]}},{title:"文章标题",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.title+'">'+e.title+"</div>"}},{title:"文章内容",field:"title",sortable:!1,resizable:!1,width:150,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+(e.content||"")+'">'+(e.content||"")+"</div>"}},{title:"文章来源",field:"articleSource",sortable:!0,resizable:!1,width:150,stable:!0,content:function(e){return'<div class="ellipsistext" title="'+e.articleSource+'">'+e.articleSource+"</div>"}},{title:"原文发布时间",field:"releaseTime",sortable:!1,resizable:!1,width:100,stable:!0,content:function(e){if(!e.releaseTime)return"";else return n.date.format(e.releaseTime,"YYYY-MM-DD")}},{title:"点击量",field:"visitsNum",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return e.visitsNum||""}}];return e.prototype.tableFields=o,e.prototype.uiProperties={table:{fields:o,select:"multi"}},e}),define("channel/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(e){n.call(this,e||"channel")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={search:{name:"channel/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/query"}},list:{name:"channel/list",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/queryMy"}},allList:{name:"channel/allList",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/queryAll"}},addList:{name:"addList/search",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/queryAll"}},save:{name:"channel/save",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/savenewsarticle"}},update:{name:"channel/update",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/updatenewsarticle"}},homesave:{name:"channelhome/save",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/uploadheadlines"}},channelInfo:{name:"channel/toupdatenewsarticle",scope:"instance",policy:"auto",options:{method:"get",url:"/channel/toupdatenewsarticle"}},remove:{name:"channel/remove",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/changeStatus"}},release:{name:"channel/release",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/changeStatus"}},recovery:{name:"channel/recovery",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/changeStatus"}},restore:{name:"channel/restore",scope:"instance",policy:"auto"},findById:{name:"channel/findById",scope:"instance",policy:"auto"},getChannels:{name:"channel/getChannels",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/getCurrentUserChannels"}},getListChannels:{name:"channel/getListChannels",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/getCurrentUserChannelsForQuery"}},tree:{name:"channel/tree",scope:"instance",policy:"auto"},orderType:{name:"channel/orderType",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/orderType"}},orderList:{name:"channel/queryOrder",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/queryOrder"}},deleteOrderBack:{name:"channel/deleteOrderBack",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/deleteOrderBack"}},readArchived:{name:"channel/readArchived",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/readArchived"}},saveOrPublish:{name:"channel/saveOrderBack",scope:"instance",policy:"auto",options:{method:"POST",url:"/channel/saveOrderBack"}},getReviewStatus:{name:"auditPending/getReviewStatus",scope:"instance",policy:"auto",options:{method:"GET",url:"/auditPending/getAllStatusByUserId"}},saveReview:{name:"auditPending/save",scope:"instance",policy:"auto",options:{method:"POST",url:"/auditPending/toSubmitAfterOperated"}},hasAnyBody:{name:"channel/hasAnyBody",scope:"instance",policy:"auto",options:{method:"GET",url:"/article/validate/hasAnyBody"}},resetVail:{name:"channel/resetVail",scope:"instance",policy:"auto",options:{method:"GET",url:"/article/validate/resetVailDateTime"}},destoryVail:{name:"channel/destoryVail",scope:"instance",policy:"auto",options:{method:"GET",url:"/article/validate/destoryArticleVailTime"}},getAllRoles:{name:"/getSendAllRoles",scope:"instance",policy:"auto",options:{method:"GET",url:"/getSendAllRoles"}},submitVerify:{name:"submitVerify",scope:"instance",policy:"auto",options:{method:"POST",url:"/saveReviewForArticle"}},getArticleFromReview:{name:"channel/center",scope:"instance",policy:"auto",options:{method:"GET",url:"/getArticleFromReview"}},getSpecialReportList:{name:"channel/getSpecialReportList",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/getSpecialReportList"}},toManyOperated:{name:"/auditPending/toManyOperated",scope:"instance",policy:"auto",options:{method:"POST",url:"/auditPending/toManyOperated"}},saveManyReviewForArticle:{name:"/saveManyReviewForArticle",scope:"instance",policy:"auto",options:{method:"POST",url:"/saveManyReviewForArticle"}},getCreditEvaluationList:{name:"channel/getCreditEvaluationList",scope:"instance",policy:"auto",options:{method:"GET",url:"/channel/getCreditEvaluationList"}}};e.prototype.getAllRoles=function(e){var t=this.request("getSendAllRoles");return t},e.prototype.remove=function(e){return e.status="3",this.request("channel/remove",e)},e.prototype.release=function(e){return e.status="2",this.request("channel/release",e)},e.prototype.recovery=function(e){return e.status="1",this.request("channel/recovery",e)},e.prototype.list=function(e){var t=this.request("channel/list",e);return t},e.prototype.allList=function(e){var t=this.request("channel/allList",e);return t},e.prototype.getArticleFromReview=function(e){var t=this.request("channel/center",e);return t},e.prototype.getSpecialReportList=function(e){var t=this.request("channel/getSpecialReportList",e);return t},e.prototype.getChannelInfo=function(e){var t=this.request("channel/toupdatenewsarticle",e);return t},e.prototype.getChannels=function(){var e=this.request("channel/getChannels");return e},e.prototype.getListChannels=function(){var e=this.request("channel/getListChannels");return e},e.prototype.getOrderType=function(){var e=this.request("channel/orderType");return e},e.prototype.getCreditEvaluationList=function(){var e=this.request("channel/getCreditEvaluationList");return e},e.prototype.getOrderList=function(e){var t=this.request("channel/queryOrder",{articleType:e});return t},e.prototype.toManyOperated=function(e){var t=this.request("/auditPending/toManyOperated",e);return t},e.prototype.saveManyReviewForArticle=function(e){var t=this.request("/saveManyReviewForArticle",e);return t},e.prototype.deleteOrderBack=function(e){var t=this.request("channel/deleteOrderBack",e);return t},e.prototype.readArchived=function(e){var t=this.request("channel/readArchived",{articleType:e});return t},e.prototype.saveOrPublish=function(e){var t=this.request("channel/saveOrderBack",e);return t},e.prototype.getReviewStatus=function(){var e=this.request("auditPending/getReviewStatus");return e},e.prototype.saveReview=function(e){var t=this.request("auditPending/save",e);return t},e.prototype.saveVerify=function(e){var t=this.request("submitVerify",e);return t},e.prototype.hasAnyBody=function(e){var t=this.request("channel/hasAnyBody",e);return t},e.prototype.resetVail=function(e){var t=this.request("channel/resetVail",e);return t},e.prototype.destoryVail=function(e){var t=this.request("channel/destoryVail",e);return t};var o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("channel/AddListModel",["require","er/util","ub-ria/mvc/ListModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n("addList")),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/ListModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.datasource={},e.prototype.defaultArgs={orderBy:"",order:""},e.prototype.prepare=function(){},e.prototype.getQuery=function(){var e=i.prototype.getQuery.apply(this,arguments);return e.channelType=this.get("channelType"),e.status=2,e},e}),define("channel/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/channel/list",type:"channel/List",title:"栏目 - 我上传的文章",auth:["CHANNEL_VIEW"]},{path:"/channel/addList",type:"channel/AddList",title:"栏目 - 选择添加文章列表",auth:["CHANNEL_VIEW"]},{path:"/channel/allList",type:"channel/AllList",title:"栏目 - 所有文章",auth:["CHANNEL_VIEW"]},{path:"/channel/reviewList",type:"channel/ReviewList",title:"栏目 - 待审批列表",auth:["CHANNEL_VIEW"]},{path:"/channel/auditList",type:"channel/AuditList",title:"栏目 - 待审核文章",auth:["CHANNEL_VIEW"]},{path:"/channel/alreadyAuditList",type:"channel/AlreadyAuditList",title:"栏目 - 已审核文章",auth:["CHANNEL_VIEW"]},{path:"/channel/order",type:"channel/OrderForm",title:"栏目 - 顺序调整",auth:["CHANNEL_VIEW"]},{path:"/channel/create",type:"channel/Form",title:"上传文章",args:{formType:"create"},auth:["CHANNEL_MODIFY"]},{path:"/channel/homecreate",type:"channel/HomeForm",title:"上传文章",args:{formType:"create"},auth:["CHANNEL_MODIFY"]},{path:"/channel/update",type:"channel/Form",title:"修改频道",args:{formType:"update"},auth:["CHANNEL_MODIFY"]},{path:"/channel/view",type:"channel/ReadForm",args:{formType:"create"},title:"查看频道信息",auth:["CHANNEL_VIEW"]},{path:"/channel/read",movedTo:"channel/view"},{path:"/channel/preview",type:"channel/PreviewForm",title:"文章预览",auth:["CHANNEL_VIEW"]},{path:"/channel/center",type:"channel/CenterList",title:"信息中心批复文章",auth:["CHANNEL_VIEW"]},{path:"/channel/verify",type:"channel/VerifyForm",title:"查看文章",auth:["CHANNEL_VIEW"]}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"channel",description:"频道"}}),define("channel/AddList",["require","er/util","./config","ub-ria/mvc/ListAction","./AddListModel","./AddListView"],function(require){function e(){n.apply(this,arguments)}var t=require("er/util"),i=require("./config"),n=require("ub-ria/mvc/ListAction");return t.inherits(e,n),e.prototype.group="default",e.prototype.entityDescription=i.description,e.prototype.modelType=require("./AddListModel"),e.prototype.viewType=require("./AddListView"),e}),define("tpl",["require","ub-ria/tpl"],function(require){return require("ub-ria/tpl")}),define("account/FormView",["require","er/util","ub-ria/mvc/FormView","tpl!8ab58a8b.tpl.html"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("ub-ria/mvc/FormView");return require("tpl!8ab58a8b.tpl.html"),t.inherits(e,i),e.prototype.template="accountForm",e.prototype.getEntity=function(){var e=i.prototype.getEntity.apply(this,arguments);return e},e.prototype.uiProperties={},e.prototype.uiEvents={},e}),define("common/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Role=new e({alias:"SUPER",text:"超级管理员",value:"1"},{alias:"CMS",text:"编辑员",value:"2"},{alias:"CHIEFEDITOR",text:"总编辑",value:"64"},{alias:"AUDITOR",text:"审核员",value:"128"},{alias:"TPL_MGR",text:"模板管理员",value:"4"},{alias:"UPLOAD",text:"记录管理员",value:"8"},{alias:"AUDIT",text:"审批员",value:"16"},{alias:"READONLY",text:"后台访问员",value:"32"},{alias:"USERS",text:"用户管理员",value:"256"},{alias:"SUPERVISION",text:"后台监察员",value:"512"},{alias:"DATAUPLOAD",text:"上传数据",value:"1024"}),exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports.TemplateStatus=new e({alias:"INACTIVE",text:"不启用"},{alias:"ACTIVE",text:"启用"},{alias:"DISABLE",text:"禁用"},{alias:"REMOVE",text:"删除"}),exports}),define("common/GlobalData",["require","underscore","er/util","ub-ria/mvc/RequestManager","ub-ria/mvc/RequestStrategy","common/enum","er/Deferred"],function(require){function e(){n.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("ub-ria/mvc/RequestManager"),r=require("ub-ria/mvc/RequestStrategy");i.inherits(e,n);var o={},a={},s={},l={};e.prototype.loadUser=function(){var e=this.request("global/user",null,{method:"GET",url:"/user/getUserInfo"});return e.then(function(e){return t.each(e,function(e,i){var n={},r=require("common/enum").Role.valueIndex;if("authority"===i)t.each(e,function(e,t){n[r[t].alias]=e}),o.authorityAlias=n;else if("pubAuthority"===i)t.each(e,function(e,t){n[r[t].alias]=e}),o.authorityAlias=n;else o[i]=e}),o})},e.prototype.loadPubUser=function(){var e=this.request("global/user",null,{method:"GET",url:"/publicity/getUserInfo"});return e.then(function(e){return t.each(e,function(e,i){var n={},r=require("common/enum").Role.valueIndex;if("authority"===i)t.each(e,function(e,t){n[r[t].alias]=e}),o.authorityAlias=n;else if("pubAuthority"===i)t.each(e,function(e,t){n[r[t].alias]=e}),o.authorityAlias=n;else o[i]=e}),o})},e.prototype.loadSystem=function(){var e=this.request("global/system",null,{method:"GET",url:"/static/asset/config/sysWebInfo.json",cache:!0});return e.then(function(e){return t.extend(a,e),a})},e.prototype.loadChannelsEnum=function(){var e=this.request("channel/getChannelsEnum",null,{method:"GET",url:"/channel/getCurrentUserChannelsForQuery",cache:!0});return e.then(function(e){e.unshift({name:"所有类型",value:"-1"}),s.channelsList=e,s.valueNameMap={},t.each(e,function(e){var t=e.value;s.valueNameMap[t]=e.name})})},e.prototype.loadReviewStatusEnum=function(){var e=this.request("channel/getReviewStatus",null,{method:"GET",url:"/channel/getAllArtStatus",cache:!0});return e.then(function(e){l.reviewStatusList=e,l.reviewStatusMap={},t.each(e,function(e){var t=e.value;l.reviewStatusMap[t]=e.name})})},e.prototype.getReviewStatus=function(){return l},e.prototype.getChannels=function(){return s},e.prototype.getUser=function(){return o},e.prototype.getUserProperty=function(e){return o[e]||o[e.toLowerCase()]},e.prototype.setUserProperty=function(e,t){o[e]=t},e.prototype.getSystem=function(){return a},e.prototype.getSystemProperty=function(e){return a[e]},e.prototype.getPageSize=function(){return this.getSystemProperty("pageSize")},e.prototype.updatePageSize=function(e){return a.pageSize=e,require("er/Deferred").resolved(e)},e.prototype.dispose=function(){};var u={loadUser:{name:"global/user",scope:"global",policy:"abort"},loadSystem:{name:"global/system",scope:"global",policy:"abort"},loadChannelsEnum:{name:"channel/getChannelsEnum",scope:"global",policy:"abort"},loadReviewStatusEnum:{name:"channel/getReviewStatus",scope:"global",policy:"abort"},loadPubUser:{name:"publicity/getUserInfo",scope:"global",policy:"abort"},loadPubChannelEnum:{name:"/publicity/getCurrentUserChannelsForQuery",scope:"global",policy:"abort"},loadPubReviewStatusEnum:{name:"/publicity/getAllArtStatus",scope:"global",policy:"abort"}};t.each(u,function(t){var i=require("ub-ria/mvc/RequestManager");i.register(e,t.name,t)});var c=new e;return c.setRequestStrategy(new r),e.getInstance=function(){return c},e}),define("account/FormModel",["require","er/util","ub-ria/mvc/FormModel","./Data","common/GlobalData"],function(require){function e(){i.apply(this,arguments),this.addData(new n),this.addData("global",r.getInstance())}var t=require("er/util"),i=require("ub-ria/mvc/FormModel"),n=require("./Data"),r=require("common/GlobalData");return t.inherits(e,i),e.prototype.getAccount=function(e){var t=this.data(),i={userId:e};return t.getAccount(i)},e.prototype.datasource={crumbPath:function(e){var t=[{text:e.get("title")}];return t},account:function(e){var t=e.data("global").getUser(),i=t.userid;return e.getAccount(i)}},e}),define("account/Form",["require","ub-ria/mvc/FormAction","er/util","./config","./FormModel","./FormView"],function(require){function e(){t.apply(this,arguments)}var t=require("ub-ria/mvc/FormAction"),i=require("er/util"),n=require("./config");return i.inherits(e,t),e.prototype.group="default",e.prototype.entityDescription=n.description,e.prototype.modelType=require("./FormModel"),e.prototype.viewType=require("./FormView"),e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},e}),define("account/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports}),define("common/util/FrontDB",["require","underscore"],function(require){function e(e,o){var a=o.results;if(!r.isEmpty(e.keyword)&&!r.isEmpty(e.queryBy))a=t(a,e.keyword,e.queryBy);if(!r.isEmpty(e.order)&&!r.isEmpty(e.orderBy))a=i(a,e.order,e.orderBy);return!e.page&&(e.page=1),!e.pageSize&&(e.pageSize=20),o=n(a,e.page,e.pageSize),o.totalCount=a.length,o}function t(e,t,i){i=i.split(","),t=t.toLowerCase();var n=[];return r.each(e,function(e,r){for(var o=0;o<i.length;o++){var a=i[o],s=e[a].toString().toLowerCase();if(-1!==s.indexOf(t)){n.push(e);break}}}),n}function i(e,t,i){var n=r.sortBy(e,i);if("desc"===t){for(var o=[],a=n.length-1;a>-1;a--)o.push(n[a]);return o}else return n}function n(e,t,i){var n={};return n.pageSize=i,n.results=e.slice((t-1)*i,(t-1)*i+i),n}var r=require("underscore");return{process:e}}),define("common/BaseData",["require","underscore","er/util","ub-ria/mvc/RequestManager","ub-ria/mvc/RequestStrategy","common/util/FrontDB"],function(require){function e(e){var t=i.clone(e),n=["page","pageSize","order","orderBy","keyword","queryBy"];i.each(n,function(e){i.has(t,e)&&delete t[e]});var r="";return i.each(t,function(e,i){r+=i+"="+encodeURIComponent(t[i])+"&"}),r}function t(){r.apply(this,arguments),this.setRequestStrategy(new o)}var i=require("underscore"),n=require("er/util"),r=require("ub-ria/mvc/RequestManager"),o=require("ub-ria/mvc/RequestStrategy"),a={};return n.inherits(t,r),t.prototype.setCache=function(t,n){var r=e(t);!i.has(a,r)&&this.clearCache(),a[r]=i.clone(n)},t.prototype.getCache=function(t){var n=e(t);if(!i.has(a,n))return null;else return a[n]},t.prototype.clearCache=function(){for(var e in a)delete a[e]},t.prototype.formatRequestName=function(e){return e.replace(/\$entity/g,this.getEntityName())},t.prototype.formatRequestURL=function(e){return e.replace(/\$entity/g,i.pluralize(this.getBackendEntityName()))},t.prototype.search=function(e){var t=this.entityName,i=this,n=require("common/util/FrontDB");if(null!==i.getCache(e)){var r=i.getCache(e),o=n.process(e,r);return o}else{var a=this.request(t+"/search",e);return a.then(function(e){return function(t){if(t.cache){var n=require("common/util/FrontDB");i.setCache(e,t);var r=n.process(e,t);require("er/util").mix(t,r)}}}(e)),a}},t.prototype.list=function(e){var t=this.entityName;return this.request(t+"/list",e,{method:"GET",url:"/"+t+"/list"})},t.prototype.save=function(e){var t=this.entityName;return this.request(t+"/save",e)},t.prototype.update=function(e){var t=this.entityName;return this.request(t+"/update",e)},t.prototype.updateStatus=function(e,t,i){var n=this.entityName;return this.request(n+"/"+e,{ids:i,status:t},{method:"POST",url:"/"+n+"/status"})},t.prototype.getAdvice=function(e,t,i){var n=this.entityName;return this.request(n+"/"+e+"/advice",{ids:i,status:t},{method:"GET",url:"/"+n+"/status/advice"})},t.prototype.findById=function(e){var t=this.entityName;return this.request(t+"/findById",null,{method:"GET",url:"/"+t+"/"+e})},t}),define("account/Data",["require","underscore","er/util","common/BaseData","ub-ria/mvc/RequestManager"],function(require){function e(){n.call(this,"account")}var t=require("underscore"),i=require("er/util"),n=require("common/BaseData");i.inherits(e,n);var r={search:{name:"account/query",scope:"instance",policy:"auto",options:{method:"GET",url:"/account/query"}},list:{name:"account/list",scope:"instance",policy:"auto"},save:{name:"account/save",scope:"instance",policy:"auto"},update:{name:"account/update",scope:"instance",policy:"auto"},remove:{name:"account/remove",scope:"instance",policy:"auto"},restore:{name:"account/restore",scope:"instance",policy:"auto"},findById:{name:"account/findById",scope:"instance",policy:"auto"},tree:{name:"account/tree",scope:"instance",policy:"auto"}};e.prototype.getAccount=function(e){var t=this.request("account/query",e);return t};var o=require("ub-ria/mvc/RequestManager");return t.each(r,function(t){o.register(e,t.name,t)}),e}),define("account/config",["require","underscore","er/controller"],function(require){var e=require("underscore"),t=[{path:"/account/list",type:"account/List",title:"帐户 - 列表",auth:["ACCOUNT_VIEW"]},{path:"/account/create",type:"account/Form",title:"新建帐户",args:{formType:"create"},auth:["ACCOUNT_MODIFY"]},{path:"/account/form",type:"account/Form",title:"修改帐户",args:{formType:"update"},auth:["ACCOUNT_MODIFY"]},{path:"/account/view",type:"account/Read",title:"查看帐户信息",auth:["ACCOUNT_VIEW"]},{path:"/account/form",type:"account/Form",title:"帐号信息",auth:["ACCOUNT_VIEW"]},{path:"/account/read",movedTo:"account/view"}],i=require("er/controller");return e.each(t,i.registerAction,i),{name:"account",description:"帐户"}}),define("startup/biz",[],{});