/*! CreditChina | 2016 Baidu Inc. All Rights Reserved. */
!function(e,t,i){function n(e){if(!(this instanceof n))return new n(e);if(r(e))e={trigger:e};var i={trigger:null,name:null,action:null,data:null,accept:null,change:null,error:null,multiple:!0,success:null};if(e)t.extend(i,e);var o=t(i.trigger);i.action=i.action||o.data("action")||"/upload",i.name=i.name||o.attr("name")||o.data("name")||"file",i.data=i.data||a(o.data("data")),i.accept=i.accept||o.data("accept"),i.success=i.success||o.data("success"),i.beforeUpload=i.beforeUpload||function(){},this.settings=i,this.setup(),this.bind()}function r(e){return"[object String]"===Object.prototype.toString.call(e)}function o(e){if(!e)return[];var t,i=[];for(var n in e)t=document.createElement("input"),t.type="hidden",t.name=n,t.value=e[n],i.push(t);return i}function a(e){if(!e)return{};for(var t={},i=e.split("&"),n=function(e){return decodeURIComponent(e.replace(/\+/g," "))},r=0;r<i.length;r++){var o=i[r].split("="),a=n(o[0]),s=n(o[1]);t[a]=s}return t}function s(e){for(var t=e.parentsUntil("body"),i=0,n=0;n<t.length;n++){var r=t.eq(n);if("static"!==r.css("position"))i=parseInt(r.css("zIndex"),10)||i}return i}function l(){var e="iframe-uploader-"+c,i=t('<iframe name="'+e+'" />').hide();return c+=1,i}function u(e){if(!(this instanceof u))return new u(e);if(r(e))e={trigger:e};var i=t(e.trigger),o=[];i.each(function(t,i){e.trigger=i,o.push(new n(e))}),this._uploaders=o}var c=0;n.prototype.setup=function(){this.form=t('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />'),this.iframe=l(),this.form.attr("target",this.iframe.attr("name"));var i=this.settings.data;if(this.form.append(o(i)),e.FormData)this.form.append(o({_uploader_:"formdata"}));else this.form.append(o({_uploader_:"iframe"}));var n=document.createElement("input");if(n.type="file",n.name=this.settings.name,this.settings.accept)n.accept=this.settings.accept;if(this.settings.multiple)n.multiple=!0,n.setAttribute("multiple","multiple");this.input=t(n);var r=t(this.settings.trigger);return this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:r.outerHeight(),fontSize:Math.max(64,5*r.outerHeight())}),this.form.append(this.input),this.form.css({position:"absolute",top:this.settings.top||0,left:this.settings.left||24,overflow:"hidden",width:r.outerWidth(),height:r.outerHeight(),zIndex:s(r)+10}).appendTo(r.parent()),this},n.prototype.bind=function(){var e=this,i=t(e.settings.trigger);i.mouseenter(function(){e.form.css({top:i.offset().top,left:i.offset().left,width:i.outerWidth(),height:i.outerHeight()})}),e.bindInput()},n.prototype.bindInput=function(){var e=this;e.input.change(function(t){e.settings.beforeUpload.call(e,e._files),e._files=this.files||[{name:t.target.value}];var i=e.input.val();if(e.settings.change)e.settings.change.call(e,e._files);else if(i)return e.submit()})},n.prototype.submit=function(){var i=this;if(e.FormData&&i._files){var n=new FormData(i.form.get(0));n.append(i.settings.name,i._files);var r;if(i.settings.progress){var o=i._files;r=function(){var e=t.ajaxSettings.xhr();if(e.upload)e.upload.addEventListener("progress",function(e){var t=0,n=e.loaded||e.position,r=e.total;if(e.lengthComputable)t=Math.ceil(n/r*100);i.settings.progress(e,n,r,t,o)},!1);return e}}return t.ajax({url:i.settings.action,type:"post",processData:!1,contentType:!1,data:n,xhr:r,context:this,success:i.settings.success,error:i.settings.error}),this}else i.iframe=l(),i.form.attr("target",i.iframe.attr("name")),t("body").append(i.iframe),i.iframe.one("load",function(){t('<iframe src="javascript:false;"></iframe>').appendTo(i.form).remove();var e;try{e=t(this).contents().find("body").html()}catch(n){e="cross-domain"}if(t(this).remove(),!e){if(i.settings.error)i.settings.error(i.input.val())}else if(i.settings.success)i.settings.success(e)}),i.form.submit();return this},n.prototype.refreshInput=function(){var e=this.input.clone();this.input.before(e),this.input.off("change"),this.input.remove(),this.input=e,this.bindInput()},n.prototype.change=function(e){if(!e)return this;else return this.settings.change=e,this},n.prototype.success=function(e){var t=this;return this.settings.success=function(i){if(t.refreshInput(),e)e(i)},this},n.prototype.error=function(e){var t=this;return this.settings.error=function(i){if(e)t.refreshInput(),e(i)},this},n.prototype.enable=function(){this.input.prop("disabled",!1),this.input.css("cursor","pointer")},n.prototype.disable=function(){this.input.prop("disabled",!0),this.input.css("cursor","not-allowed")},u.prototype.submit=function(){return t.each(this._uploaders,function(e,t){t.submit()}),this},u.prototype.change=function(e){return t.each(this._uploaders,function(t,i){i.change(e)}),this},u.prototype.success=function(e){return t.each(this._uploaders,function(t,i){i.success(e)}),this},u.prototype.error=function(e){return t.each(this._uploaders,function(t,i){i.error(e)}),this},u.prototype.enable=function(){return t.each(this._uploaders,function(e,t){t.enable()}),this},u.prototype.disable=function(){return t.each(this._uploaders,function(e,t){t.disable()}),this},u.Uploader=n,e.Upload=u}(window,jQuery);