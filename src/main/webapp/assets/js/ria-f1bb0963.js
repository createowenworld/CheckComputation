/*! CreditChina | 2016 Baidu Inc. All Rights Reserved. */
define("ub-ria/ui/Warn",["require","esui/lib","esui/controlHelper","esui/Control","esui"],function(require){function e(e){r.apply(this,arguments)}function t(e,t){if(e.fire(t),"ok"===t)e.dispose();else e.hide()}var i=require("esui/lib"),n=require("esui/controlHelper"),r=require("esui/Control");i.inherits(e,r),e.defaultProperties={okLabel:"取消新建",cancelLabel:"继续新建"},e.prototype.type="Warn",e.prototype.initOptions=function(t){var n={};if(i.extend(n,e.defaultProperties,t),null==n.content)n.content=this.main.innerHTML;this.setProperties(n)};var o='<div class="${iconClass}"></div><div class="${contentClass}" id="${contentId}"></div><div class="${operationFieldClass}">    <esui-button class="${okBtnClass}" data-ui="childName:btnOk;">${okLabel}</esui-button>    <esui-button class="${cancelBtnClass}" data-ui="childName:btnCancel;">    ${cancelLabel}</esui-button></div>';return e.prototype.initStructure=function(){this.main.innerHTML=i.format(o,{iconClass:this.helper.getPartClassName("icon"),contentId:this.helper.getId("content"),contentClass:this.helper.getPartClassName("content"),okBtnClass:this.helper.getPartClassName("ok-btn"),cancelBtnClass:this.helper.getPartClassName("cancel-btn"),okLabel:this.okLabel,cancelLabel:this.cancelLabel,operationFieldClass:this.helper.getPartClassName("operation-field")}),this.initChildren(),this.getChild("btnOk").on("click",i.curry(t,this,"ok")),this.getChild("btnCancel").on("click",i.curry(t,this,"cancel"))},e.prototype.repaint=n.createRepaint(r.prototype.repaint,{name:"content",paint:function(e,t){var i=e.helper.getPart("content");i.innerHTML=t}}),e.prototype.hide=function(){this.fire("hide"),this.dispose()},e.prototype.dispose=function(){if(!n.isInStage(this,"DISPOSED"))r.prototype.dispose.apply(this,arguments),i.removeNode(this.main)},e.show=function(t){var i=new e(t);return i.appendTo(t.wrapper||document.body),i},require("esui").register(e),e}),define("ub-ria/ui/Uploader",["require","esui/lib","esui/controlHelper","esui/validator/Validity","esui/validator/ValidityState","esui/InputControl","../util","esui"],function(require){function e(e){s.apply(this,arguments)}function t(e){this.removeState("busy"),this.addState("complete"),this.addState("uploaded");var t=this.helper.getPart("button");t.innerHTML=l.escape(this.overrideText);var i=new o;this.showValidity(i),this.fire("change")}function i(){this.removeState("busy"),this.removeState("complete"),this.removeState("uploaded"),this.helper.getPart("button").innerHTML=l.escape(this.text),this.fileInfo="";var e=document.createElement("input");e.type="file",e.id=this.helper.getId("input"),this.name&&(e.name=this.name);var t=this.helper.getPart("input");this.helper.removeDOMEvent(t,"change"),this.main.firstChild.replaceChild(e,t),this.helper.addDOMEvent(e,"change",n.bind(this.receiveFile,this))}var n=require("esui/lib"),r=require("esui/controlHelper"),o=require("esui/validator/Validity"),a=require("esui/validator/ValidityState"),s=require("esui/InputControl"),l=require("../util");e.prototype.type="Uploader";var u={image:{".jpg":!0,".jpeg":!0,".gif":!0,".bmp":!0,".tif":!0,".tiff":!0,".png":!0},flash:{".flv":!0,".swf":!0}};return e.defaultProperties={width:80,height:25,fileType:"*",method:"POST",text:"点击上传",overrideText:"重新上传",busyText:"正在上传...",completeText:"上传完成",autoUpload:!0,extraArgs:{},action:"",mimeTypes:u},e.prototype.initOptions=function(t){var i={};if(n.extend(i,e.defaultProperties,t),n.isInput(this.main))i.accept=i.accept||n.getAttribute(this.main,"accept"),i.name=i.name||this.main.name;else if("FORM"===this.main.nodeName)if(i.action=i.action||this.main.action,!t.method&&n.hasAttribute(this.main,"method"))i.method=this.main.method;if("string"==typeof i.accept)i.accept=n.splitTokenList(i.accept);if("false"===i.autoUpload)i.autoUpload=!1;if(!i.hasOwnProperty("title")&&this.main.title)i.title=this.main.title;this.setProperties(i)},e.prototype.initStructure=function(){if("FORM"!==this.main.nodeName)this.helper.replaceMain();this.callbackName=n.getGUID("esuiShowUploadResult"),window[this.callbackName]=n.bind(this.showUploadResult,this);var e=this.helper.getPartClassName("indicator"),t=this.helper.getPartClassName("button"),i=this.helper.getId("iframe"),r=['<div id="'+this.helper.getId("input-container")+'">','<span id="'+this.helper.getId("button")+'" ','class="'+t+'">',"</span>",'<input type="hidden" name="callback" ','value="'+this.callbackName+'" ',"/>",'<input type="hidden" name="sessionToken" ','value="'+this.getSessionToken()+'" ',"/>",'<input type="file" ','id="'+this.helper.getId("input")+'" ',this.name?'name="'+this.name+'" ':" ","/>"];l.each(this.extraArgs,function(e,t){r.push('<input type="hidden" name="'+t+'" ','value="'+e+'"/>')}),r.push("</div>",'<div id="'+this.helper.getId("indicator-wrapper")+'"','class="'+e+'">','<span id="'+this.helper.getId("indicator")+'"></span>',"</div>",'<iframe id="'+i+'" name="'+i+'"',' src="about:blank"></iframe>'),this.main.innerHTML=r.join("");var o=this.helper.createPart("form","form");o.setAttribute("enctype","multipart/form-data"),o.target=i,document.body.appendChild(o);var a=this.helper.getPart("input");this.helper.addDOMEvent(a,"change",n.bind(this.receiveFile,this))},e.prototype.repaint=r.createRepaint(s.prototype.repaint,{name:["method","action"],paint:function(e,t,i){var n=e.helper.getPart("form");n.method=t,n.action=i}},{name:["text","overrideText"],paint:function(e,t,i){var n=e.helper.getPart("button"),r=e.hasState("uploaded")?l.escape(i):l.escape(t);n.innerHTML=r}},{name:["busyText","completeText"],paint:function(e,t,i){var n=e.helper.getPart("indicator"),r=e.hasState("busy")?l.escape(t):l.escape(i);n.innerHTML=r}},{name:"accept",paint:function(e,t){var i=e.helper.getPart("input");if(t)n.setAttribute(i,"accept",t.join(","));else n.removeAttribute(i,"accept")}},{name:["disabled","readOnly"],paint:function(e,t,i){var n=e.helper.getPart("input");n.disabled=t,n.readOnly=i}},{name:["width","height"],paint:function(e,t,i){var n=t+"px",r=i+"px";e.main.style.width=n,e.main.style.height=r;var o=e.helper.getPart("button");o.style.lineHeight=r;var a=e.helper.getPart("indicator");a.style.lineHeight=r}},{name:"rawValue",paint:function(e,n){if(n)if(l.isEqual(n,{}))i.call(e);else{if(!n.hasOwnProperty("type"))n.type=e.fileType;e.fileInfo=n,t.call(e,n),e.removeState("complete")}}}),e.prototype.checkFileFormat=function(e){if(this.accept){var t=e.split(".");t="."+t[t.length-1].toLowerCase();for(var i=!1,n=0;n<this.accept.length;n++){var r=this.accept[n].toLowerCase();if(r===t){i=!0;break}if("*"===r.slice(-1)[0]){var o=r.split("/")[0],a=this.mimeTypes[o];if(a&&a.hasOwnProperty(t)){i=!0;break}}}if(!i){var s=this.acceptErrorMessage||"仅接受以下文件格式："+this.accept.join(",");this.notifyFail(s)}return i}return!0},e.prototype.submit=function(){this.showUploading();var e=this.helper.getPart("input-container"),t=this.helper.getPart("form");t.appendChild(e),t.submit(),this.main.insertBefore(e,this.main.firstChild)},e.prototype.receiveFile=function(){var e=this.helper.getPart("input"),t=e.value;if(t&&this.checkFileFormat(t))if(this.fire("receive"),this.autoUpload)this.submit()},e.prototype.showUploading=function(){this.removeState("complete"),this.addState("busy");var e=this.helper.getPart("indicator");e.innerHTML=l.escape(this.busyText)},e.prototype.showUploadResult=function(e){if(e.fields)this.fire("fail",{fields:e.fields}),this.notifyFail(e.fields[0].message);else if(e.info){if(!e.info.hasOwnProperty("type"))e.info.type=this.fileType;this.fileInfo=e.info,this.fire("complete"),this.notifyComplete(e.info)}},e.prototype.notifyFail=function(e){e=e||"上传失败";var t=new o,i=new a(!1,e);t.addState("upload",i),this.showValidity(t),this.removeState("busy")},e.prototype.notifyComplete=function(e){t.call(this,e);var i=this.helper.getPart("indicator");i.innerHTML=l.escape(this.completeText),this.timer=setTimeout(n.bind(this.removeState,this,"complete"),1e3)},e.prototype.getRawValue=function(){return this.fileInfo||null},e.prototype.getRawValueProperty=e.prototype.getRawValue,e.prototype.getFileName=function(){return this.helper.getPart("input").value||""},e.prototype.getSessionToken=function(){return""},e.prototype.dispose=function(){try{delete window[this.callbackName]}catch(e){window[this.callbackName]=void 0}var t=this.helper.getPart("form");n.removeNode(t),s.prototype.dispose.apply(this,arguments)},n.inherits(e,s),require("esui").register(e),e}),define("ub-ria/ui/ToggleButton",["require","esui/lib","esui/InputControl","esui/painters","esui"],function(require){function e(e){n.apply(this,arguments)}function t(e,t){var i=e.helper.getId(t),n=e.helper.getPartClassName("part-"+t),r='<span id="'+i+'" class="'+n+'"></span>';return r}var i=require("esui/lib"),n=require("esui/InputControl");e.prototype.type="ToggleButton",e.prototype.getCategory=function(){return"check"},e.prototype.createMain=function(){return document.createElement("div")},e.prototype.initOptions=function(e){var t={onText:"ON",offText:"OFF",checked:!1};if(i.extend(t,e),!t.title)t.title=this.main.title;if(i.isInput(this.main))this.helper.extractOptionsFromInput(this.main,t);else{var r=i.getChildren(this.main);if(r.length>1){if(!e.onText)t.onText=i.getText(r[0]);if(!e.offText)t.offText=i.getText(r[1])}}n.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){this.main.innerHTML=t(this,"on")+t(this,"off"),this.helper.addDOMEvent(this.main,"click",i.bind(this.toggle,this))};var r=require("esui/painters");return e.prototype.repaint=r.createRepaint(n.prototype.repaint,r.text("onText","on"),r.text("offText","off"),r.attribute("title"),r.style("width"),r.style("height"),r.state("checked")),e.prototype.setProperties=function(){if(this.hasOwnProperty("checked"))this.checked=!!this.checked;var e=n.prototype.setProperties.apply(this,arguments);if(e.hasOwnProperty("checked"))this.fire("change")},e.prototype.isChecked=function(){return this.checked},e.prototype.toggle=function(){this.set("checked",!this.checked)},i.inherits(e,n),require("esui").register(e),e}),define("ub-ria/ui/SelectorTreeStrategy",["require","esui/lib","esui/TreeStrategy"],function(require){function e(e){var i={defaultExpand:!0,orientExpand:!1};t.extend(this,i,e)}var t=require("esui/lib"),i=require("esui/TreeStrategy");return t.inherits(e,i),e.prototype.isLeafNode=function(e){return!e.children},e.prototype.shouldExpand=function(e){if(this.orientExpand)return!e.isSelected;else return this.defaultExpand},e.prototype.enableSelectStrategy=function(e){var t=this;e.on("select",function(e){var i=!0,n=t.isLeafNode(e.node);if("load"!==t.mode){if(t.onlyLeafSelect&&!n)i=!1}else if(!n)i=!1;if(i)this.selectNode(e.node.id)}),e.on("unselect",function(t){if(e.get("allowUnselectNode"))e.unselectNode(t.node.id)})},e}),define("ub-ria/ui/PartialForm",["require","esui/lib","ef/ActionPanel","esui/Form","esui/validator/Validity","esui/validator/ValidityState","esui"],function(require){function e(e){n.apply(this,arguments)}function t(e){var t=require("esui/Form"),n={main:i.g(e.view.container),viewContext:e.view.viewContext};return new t(n)}var i=require("esui/lib"),n=require("ef/ActionPanel");return e.prototype.type="PartialForm",e.prototype.validate=function(){var e=this.get("action");if(!e)return!0;if("function"==typeof e.validate)return e.validate();var i=e.view&&e.view.viewContext;if(!i)return!0;var n=require("esui/validator/Validity"),r=new n,o={validity:r};this.fire("beforevalidate",o);for(var a=t(e),s=a.getInputControls(),l=!0,u=0;u<s.length;u++){var c=s[u];if(!c.isDisabled())l&=c.validate();else;}if(!l)this.fire("invalid",o);return this.fire("aftervalidate",o),l},e.prototype.notifyErrors=function(e){for(var i=require("esui/validator/Validity"),n=require("esui/validator/ValidityState"),r=this.get("action"),o=t(r),a=o.getInputControls(),s=e.fields,l=0;l<a.length&&s.length>0;l++){var u=a[l];if("function"!=typeof u.notifyErrors)for(var c=0;c<s.length;c++){var d=s[c];if(u.name===d.field){var f=new n(!1,d.message),h=new i;if(h.addState("server",f),"function"==typeof u.showValidity)u.showValidity(h)}}else s=u.notifyErrors(e)||s}},e.prototype.getRawValue=function(){var e=this.get("action");if(!e)return null;if("function"==typeof e.getRawValue)return e.getRawValue();if("function"==typeof e.getValue)return e.getValue();else return void 0},e.prototype.getCategory=function(){return"input"},i.inherits(e,n),require("esui").register(e),e}),define("ub-ria/ui/extension/WordCount",["require","esui/lib","esui/validator/Validity","esui/Extension","esui"],function(require){function e(e){r.apply(this,arguments)}function t(){var e=this.getMaxLength(),t=this.target.getValue().length,i={max:e,current:t,available:e-t},r=i.available<0?"error":"hint",o=this.getHintMessage(i),a=new n;a.setCustomValidState(r),a.setCustomMessage(o),this.target.showValidity(a)}var i=require("esui/lib"),n=require("esui/validator/Validity"),r=require("esui/Extension");return e.prototype.type="WordCount",e.prototype.initialTemplate="最多可输入${available}个字符",e.prototype.remainingTemplate="还可输入${available}个字符",e.prototype.exceededTemplate="已超出${available}个字符",e.prototype.getHintMessage=function(e){var t;if(!e.current)t=this.initialTemplate;else if(e.available>=0)t=this.remainingTemplate;else t=this.exceededTemplate,e.available=-e.available;return i.format(t,e)},e.prototype.getMaxLength=function(){if(-1===+this.target.get("maxLength"))return this.target.get("length");else return this.target.get("maxLength")},e.prototype.activate=function(){var e=this.getMaxLength();if(e)this.target.on("input",t,this),this.target.on("afterrender",t,this);r.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){this.target.un("input",t,this),this.target.un("afterrender",t,this),r.prototype.inactivate.apply(this,arguments)},i.inherits(e,r),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/TrimInput",["require","esui/lib","esui/InputControl","esui/Extension","esui/main","eoo"],function(require){function e(){var e=t.trim(this.target.getValue());this.target.setValue(e)}var t=require("esui/lib"),i=require("esui/InputControl"),n=require("esui/Extension"),r=require("esui/main"),exports={};exports.type="TrimInput",exports.activate=function(){var t=this.target;if(t instanceof i)t.on("afterrender",e,this),t.on("change",e,this),this.$super(arguments)},exports.inactivate=function(){var t=this.target;if(t instanceof i)t.un("afterrender",e,this),t.un("change",e,this),this.$super(arguments)};var o=require("eoo").create(n,exports);return r.registerExtension(o),o}),define("ub-ria/ui/extension/TableTip",["require","esui/lib","esui","../../util","esui/Extension","esui/TipLayer"],function(require){function e(){o.apply(this,arguments)}function t(e){return a.exec(e.className)[1]}var i=require("esui/lib"),n=require("esui"),r=require("../../util"),o=require("esui/Extension");require("esui/TipLayer"),e.prototype.type="TableTip";var a=/table-operation-(\w+)/;return e.prototype.createAndAttachTip=function(e,t){var o={id:"table-operation-tip-"+r.escape(t),viewContext:this.target.viewContext,content:i.getText(e[0]),arrow:!0,skin:"table-tip"},a=n.create("TipLayer",o);a.appendTo(document.body),r.each(e,function(e){var t={targetDOM:e,showMode:"over",delayTime:200,positionOpt:{bottom:"bottom",left:"left"}};a.attachTo(t)})},e.prototype.initTips=function(){if(document.querySelectorAll){var e=document.querySelectorAll(".table-operation");r.chain(e).groupBy(t).each(r.bind(this.createAndAttachTip,this))}},e.prototype.activate=function(){o.prototype.activate.apply(this,arguments),this.target.on("afterrender",this.initTips,this)},e.prototype.inactivate=function(){this.target.un("afterrender",this.initTips,this),o.prototype.inactivate.apply(this,arguments)},i.inherits(e,o),n.registerExtension(e),e}),define("ub-ria/ui/extension/ExternSelect",["require","../../util","esui/lib","esui/Extension","esui"],function(require){function e(e){e=e||{},a.apply(this,arguments)}function t(e){this.target.search()}function i(e){this.handleControls(function(t,i){var n=t.getSelectedItem();if(""!==n.value&&t.dataKey)e.filterData.push({keys:[t.dataKey],value:n.value})}),e.preventDefault()}function n(){this.handleControls(function(e){e.un("change",t,this),e.setProperties({selectedIndex:0}),e.on("change",t,this)})}var r=require("../../util"),o=require("esui/lib"),a=require("esui/Extension");return e.prototype.type="ExternSelect",e.prototype.selects=null,e.prototype.resolveControls=function(){var e=[];if(this.selects){var t;if(r.isString(this.selects))t=o.splitTokenList(this.selects);else t=this.selects;if(r.isArray(t))r.each(t,function(t,i){if(t=this.target.viewContext.get(t))e.push(t);else if(this.active)throw new Error('Cannot find related select "#'+t+'" in view context')},this);else throw new Error("selects can only be Array or String")}else throw new Error("selects cannot be null");return e},e.prototype.activate=function(){this.handleControls(function(e,i){e.on("change",t,this)}),this.target.on("clearquery",n,this),this.target.on("search",i,this),a.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){a.prototype.inactivate.apply(this,arguments),this.handleControls(function(e){e.un("change",t,this)},!0),this.target.un("clearquery",n,this),this.target.un("search",i,this)},e.prototype.handleControls=function(e){var t=this.resolveControls();if(t.length)r.each(t,e,this)},o.inherits(e,a),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/ExternSearch",["require","esui/lib","esui/Extension","esui"],function(require){function e(e){e=e||{},o.apply(this,arguments)}function t(e){this.target.search()}function i(e){var t=this.resolveControl(),i={value:t.getValue()};if(t.dataKeys)i.keys=r.splitTokenList(t.dataKeys);e.filterData.push(i),e.preventDefault()}function n(){var e=this.resolveControl();e.set("text","")}var r=require("esui/lib"),o=require("esui/Extension");return e.prototype.type="ExternSearch",e.prototype.searchBox=null,e.prototype.resolveControl=function(){var e;if(!this.searchBox&&this.searchbox)this.searchBox=this.searchbox;if(this.searchBox){if(e=this.target.viewContext.get(this.searchBox),!e&&this.active)throw new Error('Cannot find related searchBox "#'+e+'" in view context')}else throw new Error("searchBox cannot be null");return e},e.prototype.activate=function(){var e=this.resolveControl();e.on("search",t,this),this.target.on("clearquery",n,this),this.target.on("search",i,this),o.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){o.prototype.inactivate.apply(this,arguments);var e=this.resolveControl();if(e)e.un("search",t,this);this.target.un("clearquery",n,this),this.target.un("search",i,this)},r.inherits(e,o),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/AutoSubmit",["require","../../util","esui/lib","esui","esui/Form","esui/Extension"],function(require){function e(e){if(e=e||{},"string"==typeof e.events)e.events=i.map(n.splitTokenList(e.events),n.trim);a.apply(this,arguments)}function t(){var e=this.resolveForm();if(e)e.validateAndSubmit()}var i=require("../../util"),n=require("esui/lib"),r=require("esui"),o=require("esui/Form"),a=require("esui/Extension");return e.prototype.type="AutoSubmit",e.prototype.form=null,e.prototype.events=["click","change","search"],e.prototype.resolveForm=function(){if(this.form)return this.target.viewContext.get(this.form);for(var e=this.target&&this.target.main&&this.target.main.parentNode;e;){var t=r.getControlByDOM(e);if(t&&t instanceof o)return t;e=e.parentNode}return null},e.prototype.activate=function(){i.each(this.events,function(e){this.target.on(e,t,this)},this),a.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){i.each(this.events,function(e){this.target.un(e,t,this)},this),a.prototype.inactivate.apply(this,arguments)},n.inherits(e,a),require("esui").registerExtension(e),e}),define("ub-ria/ui/AbstractBoxGroup",["require","../util","esui/lib","esui/InputControl","esui/painters","esui/main"],function(require){function e(){c.apply(this,arguments)}function t(e){return i(e,"value")}function i(e,t){return e.getAttribute("data-ui-"+t)}function n(e,t,i){e.setAttribute("data-ui-"+t,i)}function r(e){return"checked"===i(e,"checked")}function o(e,n){for(var o=e.children,a=[],s=[],l=n.boxType,u=0,c=o.length;c>u;u++){var d=o[u];if(i(d,"box-type")===l)a.push({value:t(d),text:d.innerHTML||i(d,"text")});if(r(d))s.push(d.value)}if(n.datasource=a,!n.rawValue&&!n.value)n.rawValue=s}function a(e){if(!this.disabled&&!this.readOnly){var i=e.target,n="radio"===this.boxType?[]:l.clone(this.rawValue),r=t(i);if(l.contains(n,r))n=l.without(n,r);else n.push(r);this.set("rawValue",n)}}function s(e,t,i){e.helper.clearDOMEvents();for(var n="",r=e.helper.getPartClasses("wrapper"),o=u.toDictionary(e.rawValue),s=0;s<t.length;s++){var c=t[s],f={wrapperClass:r.concat(e.helper.getPartClasses("wrapper-"+s)).join(" "),id:e.helper.getId("box-"+s),boxType:e.boxType,text:u.trim(c.text),value:c.value,checked:o[c.value]?' data-ui-checked="checked"':"",className:e.helper.getPartClasses(i).join(" ")};n+=u.format(d,f)}e.main.innerHTML=n,l.each(e.getBoxElements(),function(e){this.helper.addDOMEvent(e,"click",a)},e)}var l=require("../util"),u=require("esui/lib"),c=require("esui/InputControl");e.prototype.type="AbstractBoxGroup",e.prototype.initOptions=function(e){var t={datasource:[],orientation:"horizontal",boxType:"radio"};if(l.extend(t,e),!t.datasource.length)o(this.main,t);if(!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)};var d=['<div class="${wrapperClass}">','    <div id="${id}" class="${className}" ${checked}','       data-ui-value="${value}" data-ui-box-type="${boxType}">',"    ${text}</div>","</div>"];return d=d.join(""),e.prototype.setProperties=function(e){if((e.datasource||e.boxType)&&!e.rawValue&&!e.value&&(!this.rawValue||!this.rawValue.length))e.rawValue=[];var t=c.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("esui/painters").createRepaint(c.prototype.repaint,{name:["datasource","boxType"],paint:s},{name:"rawValue",paint:function(e,i){i=i||[],e.rawValue=i;var o={};l.each(i,function(e){o[e]=!0}),l.each(e.getBoxElements(),function(i){n(i,"checked",o[t(i)]?"checked":"");var a=e.helper.getPartClasses("wrapper-checked")[0];if(r(i))u.addClass(i.parentNode,a);else u.removeClass(i.parentNode,a)})}},{name:"orientation",paint:function(e,t){e.removeState("vertical"),e.removeState("horizontal"),e.addState(t)}}),e.prototype.parseValue=function(e){return e.split(",")},e.prototype.getBoxElements=function(){var e=this.boxType;return l.filter(this.main.getElementsByTagName("div"),function(t){return i(t,"box-type")===e})},u.inherits(e,c),require("esui/main").register(e),e}),define("ub-ria/tpl",["require","er/ajax","etpl","./util"],function(require){function e(e){for(var t=[],i={},n=/<\s*esui-([\w-]+)[^>]*>|data-ui-type="(\w+)"/g,r=n.exec(e);r;){var s=r[1]&&o.pascalize(r[1])||r[2];if(!i[s]){i[s]=!0;var l=(a[s]||"ui")+"/";t.push(l+s)}r=n.exec(e)}return t}function t(e){for(var t=[],i={},n=/data-ui-extension-[^-]+-type="(\w+)"/g,r=n.exec(e);r;){var o=r[1];if(!i[o]){i[o]=!0;var a=(s[o]||"ui/extension")+"/";t.push(a+o)}r=n.exec(e)}return t}var i=require("er/ajax"),n=require("etpl"),r=n,o=require("./util");r.addFilter("trim",o.trim),r.addFilter("pascalize",o.pascalize),r.addFilter("camelize",o.camelize),r.addFilter("dasherize",o.dasherize),r.addFilter("constlize",o.constlize),r.addFilter("pluralize",o.pluralize);var a={BoxGroup:"esui",Button:"esui",Calendar:"esui",CheckBox:"esui",CommandMenu:"esui",Crumb:"esui",Dialog:"esui",Form:"esui",Frame:"esui",Label:"esui",Link:"esui",MonthView:"esui",Pager:"esui",Panel:"esui",RangeCalendar:"esui",Region:"esui",RichCalendar:"esui",Schedule:"esui",SearchBox:"esui",Select:"esui",Tab:"esui",Table:"esui",TextBox:"esui",TextLine:"esui",Tip:"esui",TipLayer:"esui",Tree:"esui",Validity:"esui",Wizard:"esui",ActionPanel:"ef",ActionDialog:"ef",ViewPanel:"ef",AbstractBoxGroup:"ub-ria/ui",DrawerActionPanel:"ub-ria/ui",PartialForm:"ub-ria/ui",RichSelector:"ub-ria/ui",SelectorTreeStrategy:"ub-ria/ui",TableRichSelector:"ub-ria/ui",ToggleButton:"ub-ria/ui",TogglePanel:"ub-ria/ui",TreeRichSelector:"ub-ria/ui",Uploader:"ub-ria/ui",Warn:"ub-ria/ui"},s={AutoSort:"esui/extension",Command:"esui/extension",CustomData:"esui/extension",TableEdit:"esui/extension",TableSubrow:"esui/extension",AutoSubmit:"ub-ria/ui/extension",ExternSearch:"ub-ria/ui/extension",ExternSelect:"ub-ria/ui/extension",TableTip:"ub-ria/ui/extension",TrimInput:"ub-ria/ui/extension",WordCount:"ub-ria/ui/extension"},l={setupTemplateEngine:function(e){r=e||n},load:function(n,o,a){function s(i){r.parse(i);var n=e(i),o=t(i),s=n.concat(o);window.require(s,function(){a(i)})}var l={method:"GET",url:o.toUrl(n),cache:!0,dataType:"text"};i.request(l).then(s)},registerControl:function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t),n=e.substring(t+1);a[n]=i},registerExtension:function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t),n=e.substring(t+1);s[n]=i}};return l}),define("ub-ria/mvc/StaticListData",["require","../util","er/Deferred","./RequestManager","eoo"],function(require){function e(e,t,i){var n=1;if("asc"===i)n=-1;if(e===t)return 0;if(null==e&&null==t)return 0;if(null==t)return 1*n;else if(null==e)return-1*n;var r=!isNaN(e),o=!isNaN(t);if(r&&o)return n*(parseFloat(e)-parseFloat(t));if(r||o)return r?1*n:-1*n;else return n*(e+"").localeCompare(t)}var t=require("../util"),exports={};exports.list=function(e){return this.request("$entity/list",e,{method:"GET",url:"/$entity"})},exports.getOtherKeys=function(e){var i=t.keys(e),n=["pageNo","pageSize","orderBy","order"];return t.difference(i,n)},exports.filterData=function(e){var i=t.clone(this.cacheList),n=i.results;if(i.totalCount=n.length,e.orderBy)this.sort(n,e.order,e.orderBy);if(e.pageNo){var r=(e.pageNo-1)*e.pageSize,o=Math.min(r+e.pageSize,n.length);n=n.slice(r,o),i.results=n}return i},exports.search=function(e){var i=this.getOtherKeys(e);if(!this.cacheList||i.length){var n=function(t){return this.cacheList=t,this.filterData(e)};return this.list(e).then(t.bind(n,this))}return require("er/Deferred").resolved(this.filterData(e))},exports.getCacheList=function(){return this.cacheList},exports.sort=function(t,i,n){for(var r=t.length,o=0;r-2>=o;o++)for(var a=r-1;a>=1;a--){e("",0,"desc");var s=e(t[a][n],t[a-1][n],i);if(s>0){var l=t[a];t[a]=t[a-1],t[a-1]=l}}};var i=require("./RequestManager"),n=require("eoo").create(i,exports);return n}),define("ub-ria/mvc/rule",["require"],function(require){return{maxLength:100,mail:{maxLength:64,pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/},description:{maxLength:4e3},phone:{pattern:/^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/},mobile:{pattern:/^(1(3|4|5|8)\d{9})?$/},url:{maxLength:1e3,pattern:/^(?:https?|ftp|wap):\/\/.+$|^(?!(?:https?|ftp|wap):\/\/).+$/},positiveInteger:{pattern:/^\d+$/},money:{pattern:/^\d+(\.\d{1,2})?$/}}}),define("ub-ria/mvc/RequestStrategy",["require"],function(require){function e(){}return e.prototype.formatName=function(e,t){return e},e.prototype.formatURL=function(e,t){return e},e.prototype.formatOptions=function(e){if(!e.dataType)e.dataType="json";return e},e}),define("ub-ria/mvc/RequestManager",["require","../util","er/util","er/ajax"],function(require){function e(e,t){this.entityName=e,this.backendEntityName=t,this.runningRequests={}}function t(e,t){if(!t)return null;var i=r.findWhere(a,{type:e.constructor});return i&&i.config[t]||s[t]||null}function i(e,t,i){var n=e.runningRequests[t.name];if(n){var o=t.policy;if("auto"===o){var a=i.method.toUpperCase();o=r.isEqual(i,n.options)?"reuse":"GET"===a||"PUT"===a?"parallel":"abort"}switch(o){case"reuse":return n.xhr;case"abort":return void n.xhr.abort();default:return}}}function n(e,t,i){if(e.runningRequests&&e.runningRequests[t]&&e.runningRequests[t].xhr===i)e.runningRequests[t]=null;if(l&&l[t]&&l[t].xhr===i)l[t]=null}var r=require("../util"),o=require("er/util"),a=[],s={},l={};e.register=function(e,t,i){var n={name:t,scope:"instance",policy:"auto"};if(i=o.mix(n,i),"instance"===i.scope){var l=r.findWhere(a,{type:e});if(!l)l={type:e,config:{}},a.push(l);var u=l.config;if(u.hasOwnProperty(t))throw new Error('An instance request config "'+t+'" has already been registered');u[t]=i}else{if(s.hasOwnProperty(t))throw new Error('A global request config "'+t+'" has already been registered');s[t]=i}},e.prototype.getEntityName=function(){return this.entityName||""},e.prototype.getBackendEntityName=function(){return this.backendEntityName||this.getEntityName()},e.prototype.setRequestStrategy=function(e){this.requestStrategy=e},e.prototype.getRequestStrategy=function(){return this.requestStrategy},e.prototype.getRequest=function(e,i,n){var r=this.getRequestStrategy();if("string"!=typeof e)n=e,e=null;e=r.formatName(e,n);var a=t(this,e);if(n=o.mix({},a&&a.options,n),"function"==typeof i)i=i(this,n);if("function"==typeof n.data)n.data=n.data(this,n);if(i)n.data=o.mix({},n.data,i);n=r.formatOptions(n);var s={name:e,options:n,config:a};if(s.options.url)s.options.url=r.formatURL(s.options.url,s.options);return s};var u=require("er/ajax");return e.prototype.request=function(e,t,o){var a=this.getRequest(e,t,o);if(!a.config)return u.request(a.options);var s=i(this,a.config,a.options);if(!s)if(s=u.request(a.options),e){var c="instance"===a.config.scope?this.runningRequests:l;c[e]={options:a.options,xhr:s};var d=r.partial(n,this,a.name,s);s.ensure(d)}return s},e.prototype.dispose=function(){r.each(this.runningRequests,function(e){e&&e.xhr.abort()}),this.runningRequests=null},e.prototype.search=function(e){throw new Error("search method is not implemented")},e.prototype.list=function(e){throw new Error("list method is not implemented")},e.prototype.save=function(e){throw new Error("save method is not implemented")},e.prototype.update=function(e){throw new Error("update method is not implemented")},e.prototype.updateStatus=function(e,t){throw new Error("updateStatus method is not implemented")},e.prototype.remove=r.partial(e.prototype.updateStatus,0),e.prototype.restore=r.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(e,t){throw new Error("getAdvice method is not implemented")},e.prototype.getRemoveAdvice=r.partial(e.prototype.getAdvice,0),e.prototype.getRestoreAdvice=r.partial(e.prototype.getAdvice,1),e.prototype.findById=function(e){throw new Error("findById method is not implemented")},e}),define("ub-ria/mvc/ReadView",["require","mini-event","./BaseView","eoo"],function(require){var exports={};exports.bindEvents=function(){this.$super(arguments);var e=this.get("return");if(e){var t=require("mini-event").delegate;t(e,"click",this,"return")}};var e=require("./BaseView"),t=require("eoo").create(e,exports);return t}),define("ub-ria/mvc/ReadModel",["require","./SingleEntityModel","eoo"],function(require){var exports={};exports.defaultDisplayText="--";var e={url:!0,referrer:!0,isChildAction:!0,container:!0,entity:!0};exports.get=function(t){var i=this.$super(arguments);if(e.hasOwnProperty(t))return i;else return this.hasReadableValue(t)?i:this.defaultDisplayText};var t=require("./SingleEntityModel"),i=require("eoo").create(t,exports);return i}),define("ub-ria/mvc/ReadAction",["require","./BaseAction","eoo"],function(require){var exports={};exports.category="read",exports.returnBack=function(){this.fire("back")},exports.initBehavior=function(){this.view.on("return",this.returnBack,this)};var e=require("./BaseAction"),t=require("eoo").create(e,exports);return t}),define("ub-ria/mvc/ListView",["require","../ui/DrawerActionPanel","../util","er/URL","./BaseView","eoo"],function(require){function e(e){var t=e.target.get("pageSize");this.updatePageSize(t)}function t(e){this.updatePageIndex()}function i(e){var t={order:e.order,orderBy:e.field.field};this.sortTable(t)}function n(){var e=this.getSafely("filter");e.isHidden()?r.call(this):a.call(this)}function r(){this.getSafely("filter").show(),this.getSafely("filter-switch").addState("expand")}function o(){this.getSafely("filter").hide(),
this.getSafely("filter-switch").removeState("expand")}function a(){if(this.model.get("filtersInfo").isAllFiltersDefault)o.call(this);else this.submitSearchWithoutKey()}function s(e){var t=this.model.defaultArgs[e]||"";this.get(e).setValue(t)}function l(){this.getGroup("filter-content").toggle()}function u(e,t){var i={modify:"update",read:"view",copy:"copy"},n=i[e]||"",r=this.model.get("url").getPath(),o=r.lastIndexOf("/"),a=require("er/URL").withQuery(r.substring(0,o+1)+n,{id:t});return a}function c(e){var t={status:+e.target.getData("status")};this.fire("batchmodify",t)}function d(e){e.preventDefault(),this.dispose()}function f(e){e.stopPropagation(),e.preventDefault(),this.hide()}function h(e){e.target.hide()}function p(e){this.fire("close")}require("../ui/DrawerActionPanel");var m=require("../util"),exports={};exports.constructor=function(){this.$super(arguments);var r={pager:{pagesizechange:e,pagechange:t},table:{select:"updateBatchButtonStatus",sort:i},"filter:submit":"submitSearch","filter-switch:click":n,"filter-cancel:click":a,"filter-modify:click":l,"table:command":"commandHandler"};this.addUIEvents(r)},exports.updatePageSize=function(e){this.fire("pagesizechange",{pageSize:e})},exports.updatePageIndex=function(){this.fire("pagechange")},exports.updateBatchButtonStatus=function(){var e=this.getSelectedItems();m.each(this.getGroup("batch"),function(t){var i=+t.getData("status"),n=m.isEmpty(e)||!this.model.canUpdateToStatus(e,i);t.set("disabled",n)},this)},exports.getSelectedItems=function(){var e=this.get("table");return e?e.getSelectedItems():[]},exports.sortTable=function(e){this.fire("tablesort",{tableProperties:e})},exports.submitSearch=function(){this.fire("search")},exports.submitSearchWithoutKey=function(e){if(e)s.call(this,e);else{var t=this;this.getGroup("clear-button").each(function(e){var i=e.get("name");s.call(t,i)})}this.fire("search")},exports.commandHandler=function(e){if("click"===e.triggerType){var t=m.findWhere(this.model.getStatusTransitions(),{statusName:e.name});if(t){var i={id:e.args,status:t.status};this.fire("modifystatus",i)}else if("modify"===e.name||"read"===e.name||"copy"===e.name){var n=e.args,r=u.call(this,e.name,n),o={url:r};this.popDrawerAction(o).show()}}},exports.bindEvents=function(){this.getGroup("batch").each(function(e){e.on("click",c,this)},this),this.getGroup("clear-button").each(function(e){var t=e.get("name");e.on("click",function(e){this.submitSearchWithoutKey(t)},this)},this),this.$super(arguments)},exports.tableFields=[],exports.getTableFields=function(){return this.tableFields},exports.getUIProperties=function(){var e=this.$super(arguments)||{};if(!e.table)e.table={};return e.table.fields=this.getTableFields(),e},exports.enterDocument=function(){this.$super(arguments),this.updateBatchButtonStatus(),this.updateSearchBoxStatus()},exports.updateFilterPanelStatus=function(){if(!this.model.get("filtersInfo").isAllFiltersDefault)r.call(this),l.call(this)},exports.updateSearchBoxStatus=function(){if(this.model.get("keyword"))this.getSafely("keyword").addState("clear")},exports.popDrawerAction=function(e){e.id=e.id||"drawer-action";var t=this.get(e.id);if(!t)t=this.create("DrawerActionPanel",e),t.render(),t.on("action@submitcancel",d),t.on("action@back",f),t.on("action@saveandclose",h),t.on("close",p,this);else t.setProperties(e);return t},exports.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=m.trim(i.getValue());return t.pageSize=this.get("pager").get("pageSize"),t},exports.getPageIndex=function(){return this.get("pager").get("page")},exports.adjustLayout=function(){var e=this.get("table");if(e)e.adjustWidth()},exports.updateItems=function(e){var t=this.get("table");m.each(e,function(e){var i=this.model.indexOf(e);if(0>i)throw new Error("No row found");t.updateRowAt(i,e)},this)};var g=require("./BaseView"),v=require("eoo").create(g,exports);return v}),define("ub-ria/mvc/ListModel",["require","../util","er/URL","./BaseModel","eoo"],function(require){function e(){var e=this.get("canBatchModify");this.set("selectMode",e?"multi":"")}function t(e,t){var n=i.findWhere(this.getStatusTransitions(),{status:e});if(n.accept){var r=i.difference(n.accept,n.deny||[]);return i.contains(r,t.status)}else if(n.deny)return!i.contains(n.deny,t.status);return!0}var i=require("../util"),n={list:{retrieve:function(e){var t=e.getQuery();return t=i.purify(t,null,!0),e.search(t)},dump:!0}},r={listWithoutKeywordURL:function(e){var t=e.get("url"),n=t.getPath(),r=t.getQuery();r=i.omit(r,"keyword");var o="#"+require("er/URL").withQuery(n,r);return o}},o={hasResult:function(e){return e.get("results").length||!i.isEmpty(e.get("url").getQuery())}},exports={};exports.setGlobalData=function(e){this.addData("global",e)},exports.defaultStatusValue=1,exports.getDefaultStatusValue=function(){return this.defaultStatusValue||""},exports.defaultArgs={},exports.getDefaultArgs=function(){var e=this.defaultArgs||{},t=this.getDefaultStatusValue();if(!e.hasOwnProperty("status")&&t)e.status=t;return e},exports.constructor=function(){this.$super(arguments),i.each(this.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},this),this.putDatasource(n,0),this.putDatasource(r,0),this.putDatasource(o,1)},exports.statusTransitions=[{status:0,deny:[0],statusName:"remove",command:"删除"},{status:1,deny:[1],statusName:"restore",command:"启用"}],exports.getStatusTransitions=function(){return this.statusTransitions},exports.prepare=function(){this.set("filtersInfo",this.getFiltersInfo()),e.call(this)},exports.getQuery=function(){var e={keyword:this.get("keyword"),status:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),page:this.get("page")||1};if(!e.status)e.status=this.getDefaultStatusValue();else if("all"===e.status)e.status="";return e},exports.canUpdateToStatus=function(e,n){return i.any(e,i.bind(t,this,n))},exports.updatePageSize=function(e){var t=this.data("global");if(!t)throw new Error("No global data object attached to this Model");if("function"!=typeof t.updatePageSize)throw new Error("No updatePageSize method implemented on global data object");return t.updatePageSize(e)},exports.getAllItems=function(){return this.get("results")},exports.getItemById=function(e){var t=this.getAllItems();return t?i.findWhere(t,{id:e}):null},exports.indexOf=function(e){var t=this.getAllItems();if(!t)return-1;if("object"==typeof e)return i.indexOf(t,e);for(var n=0;n<t.length;n++)if(t[n].id===e)return n;return-1},exports.search=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.search)throw new Error("No search method implemented on default data object");return t.search(e||{})},exports.updateStatus=function(e,t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.updateStatus)throw new Error("No updateStatus method implemented on default data object");return i.updateStatus(e,t)},exports.remove=function(e){return this.updateStatus("remove",0,e)},exports.restore=function(e){return this.updateStatus("restore",1,e)},exports.getAdvice=function(e,t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.getAdvice)throw new Error("No getAdvice method implemented on default data object");return i.getAdvice(e,t)},exports.getFilters=function(){return{}},exports.getFiltersInfo=function(){var e=!0,t=this.getDefaultArgs(),n={};return i.each(this.getFilters(),function(r,o){var a={text:"function"==typeof r.text?r.text(r):r.text,defaultValue:t[o],name:o};if(i.defaults(a,r),a.isDefaultValue=a.hasOwnProperty("isDefaultValue")?a.isDefaultValue:a.defaultValue==a.value,!a.isDefaultValue)e=!1;n[o]=a},this),{filters:n,isAllFiltersDefault:e}};var a=require("./BaseModel"),s=require("eoo").create(a,exports);return s}),define("ub-ria/mvc/ListAction",["require","eoo","er/URL","../util","./BaseAction"],function(require){function e(){this.performSearch()}function t(e){i.call(this,e.pageSize)}function i(){var e=this.fire("pagesizechange");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}}function n(){var e=this.fire("pagechange");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();this.reloadWithQueryUpdate(t)}}function r(e){var t=this.view.getSelectedItems();this.modifyStatus(t,e.status)}function o(e,t){var i={title:e.command+this.getEntityDescription(),content:t.message};return this.view.waitConfirm(i)}function a(e){this.model[e.statusName](e.ids).then(h.bind(s,this,e),h.bind(this.notifyModifyFail,this,e))}function s(e){this.notifyModifySuccess(e);var t=this.fire("statusupdate",e);if(e.reload===!1)this.updateItems(e);else if(!t.isDefaultPrevented())this.reload()}function l(e){var t=this.fire("tablesort");if(!t.isDefaultPrevented()){var i=this.getSearchQuery();i.page=1,this.reloadWithQueryUpdate(i)}}function u(e){var t=this.model.getItemById(e.id);this.modifyStatus([t],e.status)}function c(e){var t=this.context.url,i=t.getPath(),n=this.model.getDefaultArgs();return e=h.purify(e,n),f.withQuery(i,e).toString()}var d=require("eoo"),f=require("er/URL"),h=require("../util"),exports={};exports.category="list",exports.initBehavior=function(){this.$super(arguments),this.view.on("search",e,this),this.view.on("pagesizechange",t,this),this.view.on("pagechange",n,this),this.view.on("batchmodify",r,this),this.view.on("tablesort",l,this),this.view.on("modifystatus",u,this)},exports.performSearch=function(){var e=this.fire("search");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}},exports.getSearchQuery=function(){var e=this.view.getSearchArgs();return e.page=this.view.getPageIndex(),e},exports.reloadWithQueryUpdate=function(e){var t=c.call(this,e);this.redirect(t,{force:!0})},exports.modifyStatus=function(e,t){var i=h.pluck(e,"id"),n=h.findWhere(this.model.getStatusTransitions(),{status:t}),r={ids:i,items:e,status:t,statusName:n.statusName,command:n.command,reload:n.reload};if(this.requireAdviceFor(r)){var s=h.pascalize(r.statusName),l="get"+s+"Advice";this.model[l](r.ids,r.items).then(h.bind(o,this,r)).then(h.bind(a,this,r))}else a.call(this,r)},exports.requireAdviceFor=function(e){return"remove"===e.statusName},exports.notifyModifySuccess=function(e){},exports.notifyModifyFail=function(e){var t=this.getEntityDescription();if(e.ids.length>1)this.view.alert("无法"+e.command+"部分或全部"+t,e.command+t);else this.view.alert("无法"+e.command+"该"+t,e.command+t)},exports.updateItems=function(e){var t=e.ids,i=e.status,n=[];h.each(t,function(e){var t=this.model.getItemById(e);if(t)t.status=i,n.push(t)},this),this.view.updateItems(n)},exports.redirectForSearch=function(e){var t=this.model.get("url").getPath(),i=f.withQuery(t,e);this.redirect(i,{force:!0})},exports.getURLForPage=function(e){var t=this.context.url,i=t.getPath(),n=t.getQuery();if(1===e)n=h.omit(n,"page");else n.page=e;return f.withQuery(i,n).toString()},exports.adjustLayout=function(){this.view.adjustLayout()},exports.leave=function(){this.$super(arguments)},exports.getSelectItems=function(){return this.view.getSelectedItems()},d.defineAccessor(exports,"layoutChangeNotifier");var p=require("./BaseAction"),m=d.create(p,exports);return m}),define("ub-ria/mvc/IoCActionFactory",["require","../util","eoo","er/Deferred"],function(require){function e(e){var i=t.compact(e.url.toString().split("/")),n=i[i.length-1];if("create"===n||"update"===n)i[i.length-1]="form";return t.map(i,t.dasherize).join("-")}var t=require("../util"),i=require("eoo"),exports={};exports.constructor=function(e,t){t=t||{},this.actionComponent=e,this.noSchema=t.noSchema||!1},exports.createRuntimeAction=function(e){var i=require("er/Deferred"),n=new i;return this.getIocContainer().getComponent(this.actionComponent,n.resolver.resolve),n.promise.then(t.bind(this.buildAction,this,e))},exports.buildAction=function(t,i){return i.view.name=e(t),i},i.defineAccessor(exports,"iocContainer");var n=i.create(exports);return n}),define("ub-ria/mvc/handler/ToastSubmitHandler",["require","../../util","esui/Toast","./SubmitHandler","eoo"],function(require){var e=require("../../util"),t=require("esui/Toast"),i=require("./SubmitHandler"),exports={};exports.template="",exports.setTemplate=function(e){this.template=e},exports.getTemplate=function(){return this.template},exports.handle=function(e,i){var n=this.getToastMessage(e,i);if(n){var r=t.success(n);r.show()}this.next(e,i)},exports.getToastMessage=function(t,i){var n=this.getTemplate();if(null==n)return"";if(n)return e.template(n,t||{});var r="update"===i.context.formType?"修改":"创建";return"您"+r+"的"+i.getEntityDescription()+"[<strong>"+e.escape(t.name)+"</strong>]已经成功保存"};var n=require("eoo").create(i,exports);return n}),define("ub-ria/mvc/handler/SubmitHandler",["require","eoo"],function(require){var exports={};exports.nextSubmitHandler=null,exports.setNextSubmitHandler=function(e){this.nextSubmitHandler=e},exports.getNextSubmitHandler=function(){return this.nextSubmitHandler},exports.handle=function(e,t){this.next(e,t)},exports.next=function(e,t){var i=this.getNextSubmitHandler();if(i)i.handle(e,t)};var e=require("eoo").create(exports);return e}),define("ub-ria/mvc/handler/RedirectSubmitHandler",["require","../../util","./SubmitHandler","eoo"],function(require){var e=require("../../util"),t=require("./SubmitHandler"),exports={};exports.template="/${entityName}/list",exports.redirectOptions=null,exports.setTemplate=function(e){this.template=e},exports.getTemplate=function(){return this.template},exports.setRedirectOptions=function(e){this.redirectOptions=e},exports.getRedirectOptions=function(){return this.redirectOptions},exports.handle=function(t,i){var n=this.getData(t,i),r=e.template(this.getTemplate(),n);this.redirect(i,r,this.getRedirectOptions()),this.next(t,i)},exports.redirect=function(e,t,i){e.redirect(t,i)},exports.getData=function(e,t){return{entityName:t.getEntityName()}};var i=require("eoo").create(t,exports);return i}),define("ub-ria/ui/DrawerActionPanel",["require","esui/lib","ef/ActionPanel","eoo","esui"],function(require){function e(e){if(this.helper.isPart(e.target,"close-btn"))this.hide(),this.fire("close")}function t(){if(!this.helper.getPart("close-btn")){var e=this.main.appendChild(this.helper.createPart("close-btn"),"span");e.title="关闭"}}function i(e){return e.helper.getPart("mask")||document.body.appendChild(e.helper.createPart("mask"))}var n=require("esui/lib"),exports={};exports.type="DrawerActionPanel",exports.initStructure=function(){this.$super(arguments),t.call(this),document.body.appendChild(this.main),this.addState("hidden")},exports.initEvents=function(){this.$super(arguments),this.helper.addDOMEvent(this.main,"click",e),this.on("actionloaded",t)},exports.enterAction=function(){this.action.context.args.isInDrawerPanel=!0,this.$super(arguments)},exports.show=function(){i(this).style.display="block",document.body.style.overflowY="hidden",this.$super(arguments)},exports.hide=function(){i(this).style.display="none",document.body.style.overflowY="",this.$super(arguments)},exports.dispose=function(){this.hide(),n.removeNode(this.helper.getId("mask")),n.removeNode(this.main.id),this.$super(arguments)};var r=require("ef/ActionPanel"),o=require("eoo").create(r,exports);return require("esui").register(o),o}),define("ub-ria/mvc/FormView",["require","../ui/DrawerActionPanel","../util","esui/validator/Validity","esui/validator/ValidityState","../ui/Warn","er/Deferred","./BaseView","eoo"],function(require){function e(){this.fire("submit")}function t(){this.fire("cancel")}function i(e){e.target.hide(),this.fire("saveandclose")}function n(e,t){e.stopPropagation(),e.preventDefault(),this.handleAfterRelatedEntitySaved(e.entity,t)}function r(e){e.target.hide(),e.target.dispose()}function o(e){e.preventDefault(),this.dispose()}function a(e){e.stopPropagation(),e.preventDefault(),e.target.hide()}require("../ui/DrawerActionPanel");var s=require("../util"),exports={};exports.constructor=function(){this.$super(arguments);var i={"form:submit":e,"cancel:click":t};this.addUIEvents(i)},exports.getUIProperties=function(){var e=this.$super(arguments)||{};return e=s.deepClone(e),e.crumb={linkNodeTemplate:'<a class="${classes}" href="${href}">${text}</a>'},e},exports.getEntity=function(){return this.getFormData()},exports.getFormData=function(){var e=this.get("form");return e?e.getData():{}},exports.notifyErrors=function(e){for(var t=require("esui/validator/Validity"),i=require("esui/validator/ValidityState"),n=this.get("form"),r=0;r<e.fields.length;r++){var o=e.fields[r],a=new i(!1,o.message),s=new t;s.addState("server",a);var l=n.getInputControls(o.field)[0];if(l&&"function"==typeof l.showValidity)l.showValidity(s)}},exports.waitCancelConfirm=function(e){if(!e.viewContext)e.viewContext=this.viewContext;var t="取消"+e.title,i="继续"+e.title,n=this.get("form-cancel-confirm");if(n)n.hide();var r=this.get("submit-section"),o={wrapper:r,id:"form-cancel-confirm",okLabel:t,cancelLabel:i};s.extend(e,o),n=require("../ui/Warn").show(e);var a=this.get("form-page");a.addState("warned");var l=this.get("form-content-main");l.on("command",function(e){if("form-content-click"===e.name)n.hide()});var u=require("er/Deferred"),c=new u;return n.on("ok",c.resolver.resolve),n.on("cancel",c.resolver.reject),n.on("hide",s.bind(a.removeState,a,"warned")),c.promise},exports.disableSubmit=function(){if(this.viewContext)this.getGroup("submit").disable()},exports.enableSubmit=function(){if(this.viewContext)this.getGroup("submit").enable()},exports.popDrawerActionPanel=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.get("href")+"",i=e.target.get("id");if("#"===t.charAt(0))t=t.slice(1);this.popDrawerAction({url:t},i).show()},exports.popDrawerAction=function(e,t){e.id=e.id||"form-drawer-action";var s=this.get(e.id),l=this;if(!s)s=this.create("DrawerActionPanel",e),s.render(),s.on("close",i,this),s.on("action@entitysave",function(e){n.call(l,e,t)},this),s.on("action@handlefinish",r,this),s.on("action@submitcancel",o),s.on("action@back",a,this);else s.setProperties(e);return s},exports.handleAfterRelatedEntitySaved=function(e,t){};var l=require("./BaseView"),u=require("eoo").create(l,exports);return u}),define("ub-ria/mvc/FormModel",["require","er/Deferred","./BaseModel","eoo"],function(require){var e=require("er/Deferred"),exports={};exports.setGlobalData=function(e){this.addData("global",e)},exports.fillEntity=function(e){return e},exports.setValidator=function(e){if(e)e.setRule(this.get("rule"));this.validator=e},exports.getValidator=function(){return this.validator},exports.validateEntity=function(e){var t=this.getValidator();if(!t)throw new Error("No validator object attached to this Model");return t.validate(e)},exports.save=function(t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.save)throw new Error("No save method implemented on default data object");t=this.fillEntity(t);var n=this.validateEntity(t);if(n.length>0)return e.rejected({fields:n});else return i.save(t)},exports.update=function(t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.update)throw new Error("No update method implemented on default data object");t=this.fillEntity(t),t.id=this.get("id");var n=this.validateEntity(t);if(n.length>0)return e.rejected({fields:n});else return i.update(t)};var t=require("./BaseModel"),i=require("eoo").create(t,exports);return i}),define("ub-ria/mvc/FormAction",["require","../util","er/Deferred","er/util","er/events","mini-event","./BaseAction","eoo"],function(require){function e(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function t(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}var i=require("../util"),n=require("er/Deferred"),exports={};exports.category="form",exports.handleSubmitError=function(e){if(409===e.status)e=require("er/util").parseJSON(e.responseText);if(e.fields)return this.view.notifyErrors(e),!0;else return!1},exports.handleSubmitResult=function(e){var t=this.fire("entitysave",{entity:e});if(!t.isDefaultPrevented()){var i=this.getSubmitHandler();if(i)i.handle(e,this)}this.fire("handlefinish")},exports.getSubmitHandler=function(){return this.submitHandler},exports.setSubmitHandler=function(e){this.submitHandler=e},exports.getMethod=function(e){var t={create:"save",update:"update",copy:"save"};return t[e]||null},exports.submitEntity=function(t){var r=this.getMethod(this.context.formType);try{if(r)return this.model[r](t).then(i.bind(this.handleSubmitResult,this),i.bind(e,this));throw new Error("Cannot find formType in methodMap")}catch(o){return n.rejected(o)}},exports.cancelConfirmTitle="确认取消编辑",exports.getCancelConfirmTitle=function(){var e=this.model.get("formType");if("create"===e)return"新建";else return"编辑"},exports.cancelConfirmMessage="取消编辑将不保留已经填写的数据，确定继续吗？",exports.getCancelConfirmMessage=function(){return this.cancelConfirmMessage},exports.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var n={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage()};this.view.waitCancelConfirm(n).then(i.bind(t,this))}else t.call(this)},exports.redirectAfterCancel=function(){this.back("/"+this.getEntityName()+"/list")},exports.isFormDataChanged=function(e){return!0},exports.submit=function(){var e=this.view.getEntity();this.view.disableSubmit(),n.when(this.submitEntity(e)).ensure(i.bind(this.view.enableSubmit,this.view))},exports.initBehavior=function(){this.$super(arguments);var e=this.view.getFormData();this.model.set("initialFormData",e,{silent:!0}),this.view.on("submit",this.submit,this),this.view.on("cancel",this.cancelEdit,this),require("mini-event").delegate(this.view,this,"saveandclose")},exports.isChildForm=function(){return!!this.model.get("returnUrl")};var r=require("./BaseAction"),o=require("eoo").create(r,exports);return o}),define("ub-ria/mvc/filterHelper",["require","../util"],function(require){var e=require("../util"),t={},i=t.select={};return i.getText=function(t){var i=e.find(t.datasource,function(e){return e.value==t.value});return i&&i.text||""},t}),define("ub-ria/mvc/EntityValidator",["require","../util","./checker/requiredChecker","./checker/typeChecker","./checker/rangeLengthChecker","./checker/maxLengthChecker","./checker/minLengthChecker","./checker/rangeChecker","./checker/maxChecker","./checker/minChecker","./checker/enumChecker","./checker/patternChecker"],function(require){function e(){this.initCheckers()}function t(e,i,n,r){for(var o in e)if("id"!==o){var a=i[o],l=e[o],u=this.getFieldCheckers(l),c=r.length>0?r.join(".")+"."+o:o,d={value:a,fieldPath:c,fieldSchema:l},f=this.excuteCheckers(u,d);if(!f)if(!s.isEmpty(a)){if("object"===l[0])r.push(o),t.call(this,l[2].content,i[o],n,r),r.pop();else if("array"===l[0]){r.push(o);for(var h=0;h<a.length;h++){var p={};p[h]=l[2].item,t.call(this,p,a,n,r)}r.pop()}}else;else n.push(f)}else;}function i(e,t){for(var i={},n=/\$\{(.+?)\}/g,r=n.exec(e),o=t[2]||{};r;){var a=r[1];if(i[a]=o[a],!i[a])i[a]=t[1];r=n.exec(e)}return s.template(e,i,{interpolate:n})}function n(e){var t=e[2];if(!t)return e;for(var i=["maxLength","minLength","min","max","pattern"],n=s.keys(t),o=s.intersection(i,n),a=0;a<o.length;a++){var l=o[a],u=t[l];if(s.isString(u)){var c=u.split(".");c=c.slice(1);var d=this.rule[c[0]];d=c.length>1?r(d,c.slice(1)):d,t[l]=d}else;}return e}function r(e,t){for(var i=e,n=0;n<t.length;n++)i=i[t[n]];return i}function o(e){var t=["content","item","datasource"],i=[],n=e[0],r=e[2]||{};if(r=s.omit(r,t),r.required===!1)delete r.required;if([].push.apply(i,s.keys(r)),"reference"!==n&&"reference-set"!==n)i.push("type");return i=a(i,"rangeLength","minLength","maxLength"),i=a(i,"range","min","max")}function a(e,t,i,n){if(s.indexOf(e,i)>=0&&s.indexOf(e,n)>=0)e=s.without(e,i,n),e.push(t);return e}var s=require("../util"),l={required:require("./checker/requiredChecker"),type:require("./checker/typeChecker"),rangeLength:require("./checker/rangeLengthChecker"),maxLength:require("./checker/maxLengthChecker"),minLength:require("./checker/minLengthChecker"),range:require("./checker/rangeChecker"),max:require("./checker/maxChecker"),min:require("./checker/minChecker"),"enum":require("./checker/enumChecker"),pattern:require("./checker/patternChecker")};return e.prototype.initCheckers=function(){this.checkers=s.deepClone(l)},e.prototype.setErrorMessages=function(e){if(e){var t=this.getCheckers();s.each(e,function(e,i){var n=t[i];if(n)n.errorMessage=e})}},e.prototype.addChecker=function(e){if(e&&e.name&&e.errorMessage&&e.check&&e.priority){var t=this.getCheckers();return t[e.name]=e,this.checkers[e.name]}return null},e.prototype.removeChecker=function(e){var t=this.getCheckers();return delete t[e]},e.prototype.getCheckers=function(){return this.checkers||{}},e.prototype.setSchema=function(e){this.schema=e},e.prototype.getSchema=function(){return this.schema},e.prototype.setRule=function(e){this.rule=e},e.prototype.getRule=function(){return this.rule},e.prototype.validate=function(e){var i=this.getSchema(),n=[],r=[];return t.call(this,i,e,n,r),n},e.prototype.excuteCheckers=function(e,t){var r=t.value,o=t.fieldPath,a=s.deepClone(t.fieldSchema);a=n.call(this,a);for(var l=0;l<e.length;l++){var u=e[l],c=u.check(r,a);if(!c){var d=u.errorMessage;if("object"==typeof d)d=d[a[0]];if(!s.isString(d))throw new Error("未找到对应错误信息模板");var f=i(d,a),h={field:o,message:f};return h}}return null},e.prototype.getFieldCheckers=function(e){for(var t=o(e),i=this.getCheckers(),n=[],r=0;r<t.length;r++)if(i[t[r]])n.push(i[t[r]]);return n.sort(function(e,t){return e.priority-t.priority}),n},e}),define("ub-ria/mvc/DetailView",["require","mini-event","./BaseView","eoo"],function(require){function e(e){e.preventDefault();var t=e.target.get("href")+"";if("#"===t.charAt(0))t=t.slice(1);this.popDrawerAction({url:t}).show()}function t(e){e.preventDefault(),this.dispose()}function i(e){e.stopPropagation(),e.preventDefault(),this.hide()}function n(e){e.target.hide()}var exports={};exports.constructor=function(){this.$super(arguments);var t={"create:click":e,"modify:click":e};this.addUIEvents(t)},exports.popDrawerAction=function(e){e.id=e.id||"drawer-action";var r=this.get(e.id);if(!r)r=this.create("DrawerActionPanel",e),r.render(),r.on("action@submitcancel",t),r.on("action@back",i),r.on("action@saveandclose",n);else r.setProperties(e);return r},exports.bindEvents=function(){var e=require("mini-event").delegate,t=this.getSafely("detail-list");e(t,"action@search",this,"listrefresh",{preserveData:!0,syncState:!0}),e(t,"action@pagechange",this,"pagechange",{preserveData:!0,syncState:!0}),e(t,"action@statusupdate",this,"listrefresh",{preserveData:!0,syncState:!0}),e(t,"action@pagesizechange",this,"listrefresh",{preserveData:!0,syncState:!0}),e(t,"action@tablesort",this,"listrefresh",{preserveData:!0,syncState:!0}),this.$super(arguments)},exports.getListQuery=function(){var e=this.getSafely("detail-list").get("action");if(e)return e.getSearchQuery();else return{}};var r=require("./BaseView"),o=require("eoo").create(r,exports);return o}),define("ub-ria/mvc/SingleEntityModel",["require","../util","er/util","./BaseModel"],function(require){function e(e){return this.fill(e),e}function t(){r.apply(this,arguments),this.putDatasource(o)}var i=require("../util"),n=require("er/util"),r=require("./BaseModel"),o={entity:function(t){var n=t.get("id");if(n){var r=t.get("entity");if(r)return e.call(t,r);else return t.findById(n).then(i.bind(e,t))}return{}}};return n.inherits(t,r),t.prototype.findById=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.findById)throw new Error("No findById method implemented on default data object");return t.findById(e)},t}),define("ub-ria/mvc/DetailModel",["require","../util","er/URL","./SingleEntityModel","eoo"],function(require){function e(){var e=this.getListActionURL();this.set("listActionURL",e)}var t=require("../util"),exports={};exports.setGlobalData=function(e){this.addData("global",e)},exports.getListActionURL=function(){var e=this.get("url").getQuery(),i={};if(t.each(e,function(e,t){if(0===t.indexOf("list."))i[t.substring(5)]=e}),e.id)i[this.entityName+"Id"]=e.id;var n=require("er/URL"),r=n.withQuery("/"+this.getListActionName()+"/list",i);return r+""},exports.getListActionName=function(){return this.entityName},exports.getTreeNodeEntityName=function(){return this.entityName},exports.load=function(){var i=this.$super(arguments);return i.then(t.bind(e,this))};var i=require("./SingleEntityModel"),n=require("eoo").create(i,exports);return n}),define("ub-ria/mvc/DetailAction",["require","../util","er/URL","./BaseAction","eoo"],function(require){function e(e){var t=this.context.url,i=t.getPath();return e=n.purify(e),require("er/URL").withQuery(i,e).toString()}function t(e,t){e.preventDefault();var i={id:this.model.get("id")},r=this.view.getListQuery();if(!t)r.page=1;n.each(r,function(e,t){i["list."+t]=e}),this.reloadWithQueryUpdate(i)}function i(e){t.call(this,e,!0)}var n=require("../util"),exports={};exports.category="detail",exports.reloadWithQueryUpdate=function(t){var i=e.call(this,t);this.redirect(i,{force:!0})},exports.initBehavior=function(){this.$super(arguments),this.view.on("listrefresh",t,this),this.view.on("pagechange",i,this)};var r=require("./BaseAction"),o=require("eoo").create(r,exports);return o}),define("ub-ria/mvc/checker/typeChecker",["require","../../util"],function(require){function e(e,i){var n=i[0],r={Undefined:!0,Null:!0,Array:["array"],String:["string"],Number:["number","enum"],Boolean:["bool"],Object:["object"]},o="";if(null===e)o="Null";else if(void 0===e)o="Undefined";else o=Object.prototype.toString.call(e),o=o.substring(8,o.length-1);return r[o]===!0||t.indexOf(r[o],n)>=0}var t=require("../../util"),i={name:"type",errorMessage:"${title}的类型不符合要求",priority:10,check:e};return i}),define("ub-ria/mvc/checker/requiredChecker",["require","../../util"],function(require){function e(e,i){return!t.isEmpty(e)||t.isNumber(e)||t.isBoolean(e)}var t=require("../../util"),i={name:"required",errorMessage:"${title}不能为空",priority:1,check:e};return i}),define("ub-ria/mvc/checker/rangeLengthChecker",["require"],function(require){function e(e,t){var i=t[2].minLength,n=t[2].maxLength;if(i>n){var r=n;n=i,i=r}return!e||0===e.length||e.length>=i&&e.length<=n}var t={name:"rangeLength",errorMessage:{array:"${title}不能小于${minLength}个，且不能超过${maxLength}个",string:"${title}不能小于${minLength}个字符，且不能超过${maxLength}个字符"},priority:20,check:e};return t}),define("ub-ria/mvc/checker/rangeChecker",["require"],function(require){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].min,n=t[2].max;if(i>n){var r=n;n=i,i=r}return e>=i&&n>=e}var t={name:"range",errorMessage:"${title}必须是≥${min}且≤${max}的数字",priority:20,check:e};return t}),define("ub-ria/mvc/checker/patternChecker",["require"],function(require){function e(e,t){if(!e&&0!==e)return!0;var i=new RegExp(t[2].pattern);return i.test(e)}var t={name:"pattern",errorMessage:"${title}格式不符合要求",priority:30,check:e};return t}),define("ub-ria/mvc/checker/minLengthChecker",["require"],function(require){function e(e,t){var i=t[2].minLength;return!(e&&0!==e.length&&e.length<i)}var t={name:"minLength",errorMessage:{array:"${title}不能小于${minLength}个",string:"${title}不能小于${minLength}个字符"},priority:20,check:e};return t}),define("ub-ria/mvc/checker/minChecker",["require"],function(require){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].min;return e>=i}var t={name:"min",errorMessage:"${title}不能小于${min}",priority:20,check:e};return t}),define("ub-ria/mvc/checker/maxLengthChecker",["require"],function(require){function e(e,t){var i=t[2].maxLength;
return!(e&&0!==e.length&&e.length>i)}var t={name:"maxLength",errorMessage:{array:"${title}不能超过${maxLength}个",string:"${title}不能超过${maxLength}个字符"},priority:20,check:e};return t}),define("ub-ria/mvc/checker/maxChecker",["require"],function(require){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].max;return i>=e}var t={name:"max",errorMessage:"${title}不能大于${max}",priority:20,check:e};return t}),define("ub-ria/mvc/checker/enumChecker",["require"],function(require){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].datasource,n=i.fromValue(e);return!!n}var t={name:"enum",errorMessage:"${title}的值不合法",priority:20,check:e};return t}),define("ub-ria/mvc/BaseView",["require","../util","er/Deferred","ef/UIView","eoo"],function(require){var e=require("../util"),exports={};exports.addUIEvents=function(t){var i=[t];e.each(t,function(n,r){if(e.isArray(n)){for(;n.length>1;){var o={};o[r]=n.splice(-1)[0],i.push(o)}if(n.length)t[r]=n.splice(-1)[0]}});var n=this.uiEvents;this.uiEvents=n&&[].concat(n)||[],this.uiEvents=this.uiEvents.concat(i)},exports.getUIEventsCollection=function(){var e=this.uiEvents;return e&&[].concat(e)||[]},exports.bindEvents=function(){e.each(this.getUIEventsCollection(),function(t){e.each(t,function(e,t){this.bindUIEvent(t,e)},this)},this)},exports.addUIProperties=function(t){this.uiProperties=this.uiProperties||{};var i=this.uiProperties;e.each(t,function(t,n){if(i.hasOwnProperty(n))e.extend(i[n],t);else i[n]=t})},exports.getUIProperties=function(){return this.uiProperties||{}},exports.getTemplateName=function(){var e=this.$super(arguments);if(this.model&&this.model.get("isChildAction")&&!this.model.get("isInDrawerPanel"))e+="Main";return e},exports.waitConfirm=function(){var e=this.confirm.apply(this,arguments),t=require("er/Deferred"),i=new t;return e.on("ok",i.resolver.resolve),e.on("cancel",i.resolver.reject),i.promise},exports.waitActionDialog=function(){var e=this.popActionDialog.apply(this,arguments),t=require("er/Deferred"),i=new t;return e.on("actionloaded",i.resolver.resolve),e.on("actionloadfail",i.resolver.reject),e.on("actionloadabort",i.resolver.reject),i.promise},exports.getTemplateData=function(){var e=this.$super(arguments),t=e.get,i=this.model;return e.get=function(e){if("?"===e.charAt(e.length-1)){var n=e.slice(0,-1);return i.checkPermission(n)}return t(e)},e};var t=require("ef/UIView"),i=require("eoo").create(t,exports);return i}),define("ub-ria/mvc/BaseChildView",["require","../util","esui/validator/Validity","esui/validator/ValidityState","ef/UIView","eoo"],function(require){function e(e){var t=e.getCategory();return"input"===t||"check"===t}var t=require("../util"),exports={};exports.getViewData=function(){for(var e={},t=this.getAllInputControls(),i=0,n=t.length;n>i;i++){var r=t[i];if("check"!==r.getCategory()||r.isChecked())if(!r.isDisabled()){var o=r.get("name"),a=r.getRawValue();if(e.hasOwnProperty(o))e[o]=[].concat(e[o],a);else e[o]=a}else;else;}return e},exports.setViewData=function(e){t.each(e,function(e,i){i=t.dasherize(i),this.get(i).set("rawValue",e)},this)},exports.disableInputControls=function(){var e=this.getAllInputControls();t.each(e,function(e){if(t.isFunction(e.disable))e.disable()})},exports.enableInputControls=function(){var e=this.getAllInputControls();t.each(e,function(e){if(t.isFunction(e.enable))e.enable()})},exports.setReadOnly=function(e){var i=this.getAllInputControls();t.each(i,function(i){if(t.isFunction(i.setReadOnly))i.setReadOnly(e)})},exports.notifyErrors=function(e){for(var i=require("esui/validator/Validity"),n=require("esui/validator/ValidityState"),r=0;r<e.length;r++){var o=e[r],a=new n(!1,o.message),s=new i;s.addState("server",a);var l=t.dasherize(o.field),u=this.get(l);if(u)u.showValidity(s)}},exports.validate=function(){for(var e=this.getAllInputControls(),t=!0,i=0;i<e.length;i++){var n=e[i];if(!n.isDisabled())t&=n.validate();else;}return!!t},exports.getAllInputControls=function(){var i=this.viewContext.getControls(),n=[];return t.each(i,function(t){if(e(t))n.push(t)}),n};var i=require("ef/UIView"),n=require("eoo").create(i,exports);return n}),define("ub-ria/mvc/BaseModel",["require","../util","eoo","ef/UIModel"],function(require){var e=require("../util"),t=require("eoo"),exports={};exports.addData=function(e,t){if(!this.dataPool)this.dataPool={};if(arguments.length<2)t=e,e="default";if(!e)e="default";if(!this.dataPool[e])this.dataPool[e]=t},exports.setData=function(e){this.addData(e)},exports.data=function(e){if(!e)e="default";return this.dataPool[e]||null},exports.putDatasource=function(t,i){if(t=e.clone(t),!this.datasource)this.datasource=[];else if(!e.isArray(this.datasource))this.datasource=[this.datasource];if(void 0===i)this.datasource.push(t);else{var n=this.datasource[i]||{};if(e.isArray(n))n.push(t);else e.extend(n,t);this.datasource[i]=n}},exports.checkPermission=function(e){var t=this.getPermission();if(!t)throw new Error("No attached permission object");var i=t[e];if(!i)throw new Error('No "'+i+'" method on permission object');return i.call(t)},exports.dispose=function(){this.$super(arguments),e.each(this.dataPool,function(e){e.dispose()}),this.dataPool=null},t.defineAccessor(exports,"permission");var i=require("ef/UIModel"),n=t.create(i,exports);return n}),define("ub-ria/mvc/BaseAction",["require","er/util","../util","er/Action","er/Model","./BaseModel"],function(require){function e(e){n.apply(this,arguments),this.entityName=e}var t=require("er/util"),i=require("../util"),n=require("er/Action");return t.inherits(e,n),e.prototype.getEntityName=function(){if(!this.entityName){var e=this.context.url.getPath();this.entityName=e.split("/")[1]}return this.entityName},e.prototype.entityDescription="",e.prototype.getEntityDescription=function(){return this.entityDescription||""},e.prototype.group="",e.prototype.getGroup=function(){return this.group},e.prototype.category="",e.prototype.getCategory=function(){return this.category||""},e.prototype.getPageCategories=function(){var e=[],t=i.dasherize(this.getCategory()),n=i.dasherize(this.getEntityName());if(t)e.push(t+"-page");if(n)e.push(n+"-page");if(t&&n)e.push(n+"-"+this.category+"-page");return e},e.prototype.createModel=function(e){e.entityDescription=this.getEntityDescription();var t=n.prototype.createModel.apply(this,arguments),r=require("er/Model");if(!(t instanceof r)&&i.isEmpty(t)){var o=require("./BaseModel"),a=this.getEntityName();t=new o(a,e)}return t},e.prototype.setModel=function(e){e.set("entityDescription",this.getEntityDescription()),this.model=e},e}),define("ub-ria/main",["require","./extension/underscore","./extension/mvc","./extension/ajax","./extension/ui","er"],function(require){var e={version:"2.0.0-beta.4",enableExtensions:function(){require("./extension/underscore").enable(),require("./extension/mvc").enable(),require("./extension/ajax").enable(),require("./extension/ui").enable()},start:function(){e.enableExtensions(),require("er").start()}};return e}),define("ub-ria",["ub-ria/main"],function(e){return e}),define("ub-ria/filterTree",["require","./util"],function(require){function e(i,n){if(n.children)n.children=t.filter(n.children,t.partial(e,i));if(n.children&&n.children.length||i(n))return n;else return null}var t=require("./util"),exports={};return exports.byFunction=function(i,n){var r=e(n,i);if(!r)r=t.omit(i,"children"),r.children=[];return r},exports.byKeyword=function(e,t){var i=function(e){return e.text.indexOf(t)>=0};return exports.byFunction(e,i)},exports}),define("ub-ria/extension/underscore",["require","underscore"],function(require){function e(){t.templateSettings={interpolate:/\$\{(.+?)\}/g,escape:/\$\{\:(.+?)\}/g}}var t=require("underscore");return{enable:t.once(e)}}),define("ub-ria/extension/ui",["require","../util","esui/lib","esui/validator/MaxLengthRule","esui/validator/MinLengthRule","esui/validator/MaxByteLengthRule","esui/validator/MinByteLengthRule","esui/validator/RequiredRule","esui/validator/PatternRule","esui/validator/MaxRule","esui/validator/MinRule","esui/validator/Rule","esui/Table","esui/CommandMenu","esui/Tab"],function(require){function e(){function e(e){var t=e.get("min"),i=e.get("max"),n=e.get("pattern")+"";if(null!=t&&null!=i&&l.hasOwnProperty(n)){var o=/\B(?=(\d{3})+(?!\d))/g,s=(t+"").replace(o,","),u=(i+"").replace(o,",");if(a.hasOwnProperty(n))return r.escape(e.get("title"))+"请填写≥"+s+"且≤"+u+"的整数";else return r.escape(e.get("title"))+"请填写≥"+s+"且≤"+u+"的数字，最多可保存至小数点后两位"}return null}require("esui/validator/MaxLengthRule"),require("esui/validator/MinLengthRule"),require("esui/validator/MaxByteLengthRule"),require("esui/validator/MinByteLengthRule");var t=require("esui/validator/RequiredRule"),i=require("esui/validator/PatternRule"),n=require("esui/validator/MaxRule"),o=require("esui/validator/MinRule");t.prototype.errorMessage="请填写${title}";var a={"^\\d+$":!0,"/^\\d+$/":!0},s={"^\\d+(\\.\\d{1,2})?$":!0,"/^\\d+(\\.\\d{1,2})?$/":!0},l=r.extend({},a,s),u=require("esui/validator/Rule");n.prototype.getErrorMessage=function(t){if(t.get("maxErrorMessage")){var i=u.prototype.getErrorMessage;return i.apply(this,arguments)}var n=e(t);if(n)return n;else return u.prototype.getErrorMessage.apply(this,arguments)},o.prototype.getErrorMessage=function(t){if(t.get("minErrorMessage")){var i=u.prototype.getErrorMessage;return i.apply(this,arguments)}var n=e(t);if(n)return n;else return u.prototype.getErrorMessage.apply(this,arguments)},i.prototype.getErrorMessage=function(t){var i=t.get("pattern")+"";if(t.get("patternErrorMessage")||!l.hasOwnProperty(i)){var n=u.prototype.getErrorMessage;return n.apply(this,arguments)}var r=e(t);if(r)return r;else return u.prototype.getErrorMessage.apply(this,arguments)}}function t(){var e=require("esui/Table");e.command=function(e){var t={tagName:"span",text:""};r.extend(t,e);var i=r.escape(t.tagName),n="<"+i;if(t.className)n+=' class="'+r.escape(t.className)+'"';if(n+=' data-command="'+r.escape(t.command)+'"',t.args)n+=' data-command-args="'+r.escape(t.args)+'"';return n+=">"+r.escape(t.text)+"</"+i+">"},e.operations=function(t){var i="",n=r.map(t,function(t){if(r.isString(t))return i='<span class="table-operation-separator">'+r.escape(t)+"</span>";if(t.auth===!1)return"";if(t.url){var n=[];if(n.push('<a href="'+r.escape(t.url)+'"'),n.push(' class="table-operation table-operation-'),n.push(r.escape(t.type)+'"'),"_blank"===t.target)n.push(' target="_blank"');if(!t.redirectOptions)n.push(' data-redirect="global">');else if(0===t.redirectOptions.length)n.push(">");else if(r.isArray(t.redirectOptions))n.push(' data-redirect="'+t.redirectOptions.join(" ")+'">');return n.push(r.escape(t.text)),n.push("</a>"),n.join("")}var o="table-operation table-operation-"+r.escape(t.type),a={className:o,text:t.text,command:t.command,args:t.args};if(t.tagName)a.tagName=t.tagName;return e.command(a)});n=r.without(n,"");for(var o=0;o<n.length-1;)if(n[o]===i&&n[o+1]===i)n.splice(o,1);else o++;if(n[0]===i)n.shift();if(n[n.length-1]===i)n.pop();return n.join("")},e.slideOperations=function(t){var i=e.operations(t),n='<span class="table-operation-trigger">操作</span><div class="table-operation-layer-wrapper">    <div class="table-operation-layer">'+i+"    </div></div>";return n},e.status=function(e){return'<span class="table-status-'+r.escape(e.type)+'">'+e.text+"</span>"}}function i(){var e=require("esui/CommandMenu");e.prototype.linkTemplate='<a target="${target}" href="${href}">${text}</a>',e.prototype.getItemHTML=function(e){var t={text:o.encodeHTML(e.text),href:e.href&&o.encodeHTML(e.href),target:e.target||"_self"},i=e.href?this.linkTemplate:this.itemTemplate;return o.format(i,t)};var t=require("esui/Tab");t.prototype.linkTemplate='<a href="${href}">${title}</a>',t.prototype.getContentHTML=function(e){var t={title:o.encodeHTML(e.title),href:e.href&&o.encodeHTML(e.href)},i=e.href?this.linkTemplate:this.contentTemplate;return o.format(i,t)}}function n(){e(),t(),i()}var r=require("../util"),o=require("esui/lib");return{enable:r.once(n)}}),define("ub-ria/extension/mvc",["require","../util","er/util","er/events"],function(require){function e(){r.on("enteractioncomplete",function(e){if(e.action&&e.action.getPageCategories){var t=n.getElement(e.container);if(t){var r=e.action.getPageCategories();if(t.classList)i.each(r,function(e){t.classList.add(e)});else{var o=t.className?t.className.split(/\s+/):[];o=i.union(o,r),t.className=o.join(" ")}}}}),r.on("leaveaction",function(e){if(e.action&&e.action.getPageCategories){var t=n.getElement(e.action.context.container);if(t){var r=e.action.getPageCategories();if(t.classList)i.each(r,function(e){t.classList.remove(e)});else{var o=t.className?t.className.split(/\s+/):[],a=i.difference(o,r);if(a.length!==o.length)t.className=a.join(" ")}}}})}function t(){e()}var i=require("../util"),n=require("er/util"),r=require("er/events");return{enable:i.once(t)}}),define("ub-ria/util",["require","eoo","underscore"],function(require){var e={},t=require("eoo")["static"](require("underscore"));return t.purify=function i(n,r,o){r=r||e;var a={};return t.each(n,function(e,t){var n=null==e||""===e,s=r.hasOwnProperty(t)&&r[t]===e;if(!n&&!s)if(o&&"object"==typeof e)a[t]=i(e,r[t],o);else a[t]=e}),a},t.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},t.pascalize=function(e){if(e+="",/^[A-Z\s-\/_]+$/.test(e))e=e.toLowerCase();return e=e.replace(/[\s-\/_]+(.)/g,function(e,t){return t.toUpperCase()}),e=e.charAt(0).toUpperCase()+e.slice(1)},t.pascalize=t.memoize(t.pascalize),t.camelize=function(e){return e=t.pascalize(e),e.charAt(0).toLowerCase()+e.slice(1)},t.camelize=t.memoize(t.camelize),t.dasherize=function(e){if(e=t.pascalize(e),e=e.replace(/[A-Z]{2,}$/g,function(e){return e.charAt(0)+e.slice(1).toLowerCase()}),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},t.dasherize=t.memoize(t.dasherize),t.constlize=function(e){return e=t.pascalize(e),e.toUpperCase()},t.constlize=t.memoize(t.constlize),t.pluralize=function(e){return e.replace(/y$/,"ie")+"s"},t.pluralize=t.memoize(t.pluralize),t.formatNumber=function(e,t,i,n){if("number"!=typeof arguments[1])n=arguments[2],i=arguments[1],t=0;if(n=n||"",i=i||"",null==e||isNaN(e))return n+i;e=parseFloat(e).toFixed(t);var r=e.split("."),o=r[0],a=r[1];o=o.replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");var s=n+o;if(a)s+="."+a;return s},t.pad=function(e,t,i){e+="";var n=i-e.length;if(n>0){var r=new Array(n+1).join(t);return r+e}return e},t.padRight=function(e,t,i){e+="";var n=i-e.length;if(n>0){var r=new Array(n+1).join(t);return e+r}return e},t.deepClone=function(e){if(!t.isObject(e)||t.isFunction(e)||t.isRegExp(e))return e;if(t.isArray(e))return t.map(e,t.deepClone);var i={};return t.each(e,function(e,n){i[n]=t.deepClone(e)}),i},t}),define("ub-ria/extension/ajax",["require","er/ajax","../util"],function(require){function e(){var e=require("er/ajax"),t=e.hooks.serializeData;e.hooks.serializeData=function(i,n,r){if(!i&&"application/json"===r)return JSON.stringify(n);else return t.apply(e.hooks,arguments)},e.hooks.serializeData.getKey=t.getKey}return{enable:require("../util").once(e)}}),define("saber-cookie/cookie",["require"],function(require){function e(e){return"string"==typeof e&&""!==e}function t(t){return e(t)}function i(t,i){if(e(t)){var n=String(document.cookie).match(new RegExp("(?:^|)"+t+"(?:(?:=([^;]*))|;|$)"));if(n)if(n=n[1])return i?decodeURIComponent(n):n;else return""}return null}var exports={};return exports.set=function(e,i,n){if(t(e)){n=n||{};var r=n.expires;if("number"==typeof r)r=new Date,r.setTime(r.getTime()+n.expires);document.cookie=e+"="+(n.raw?i:encodeURIComponent(i))+(r instanceof Date?"; expires="+r.toUTCString():"")+(n.domain?"; domain="+n.domain:"")+(n.path?"; path="+n.path:"")+(n.secure?"; secure":"")}},exports.get=function(e,n){return n=n||{},i(t(e)?e:"",!n.raw)},exports.remove=function(e,t){t=t||{},t.raw=!0,t.expires=new Date(0),this.set(e,"",t)},exports}),define("saber-cookie",["saber-cookie/cookie"],function(e){return e}),define("er-track/trackers/console",["require"],function(require){function e(e){if(window.console)if("function"==typeof console.log)console.log.apply(console,e);else console.log(e.join(" "))}function t(t){if(window.console)if(console.groupCollapsed){console.groupCollapsed(t);for(var i=1;i<arguments.length;i++)e(arguments[i]);console.groupEnd(t)}else{console.log("➤"+t);for(var n="├───",i=1;i<arguments.length;i++){if(i===arguments.length-1)n="└───";var r=arguments[i];if("string"==typeof r)r=n+r;else r[0]=n+r[0];e(r)}}}var exports={name:"console"};return exports.create=function(e){return{name:"console",trackException:function(e){var i=["我靠，有个Promise出异常了",["出事的Deferred对象: ",e.deferred],["出事时给的参数: ",e.args],["出事的原因大概是: "+e.reason]];if(e.reason instanceof Error)i.push("好像是一个异常对象，所以把调用堆栈给你看看好了：\n"+e.reason.stack);t.apply(null,i)},trackEnterAction:function(e){t('亲你正在进入"'+e.url+'"',["Action：",e.action],["Model：",e.action.model],["Model里的数据：",e.action.model.dump()],["View：",e.action.view],["DOM容器：",e.action.view.getContainerElement()])},trackLeaveAction:function(e){t('亲你已经离开"'+e.action.context.url+'"',["当前的Action：",e.action],["前往的URL："+e.to.url])},load:function(e){e()}}},exports}),define("er-track/trackers/baidu",["require","../loadScript"],function(require){if(!window._hmt)window._hmt=[];var exports={name:"baidu"};return exports.create=function(e){return{name:"baidu",trackPageView:function(e){var t=e.referrer||document.referrer;return window._hmt.push(["_setReferrerOverride",t]),window._hmt.push(["_trackPageview",e.url]),this},load:function(t){if(!e.account)return t();var i=e.scriptURL||"//hm.baidu.com/hm.js";i+="?"+e.account;var n=require("../loadScript");n(i,t)}}},exports}),define("er-track/main",["require","./events"],function(require){var exports={},e={packageName:"er-track"};return exports.config=function(t,i){return e[t]=i,this},exports.create=function(){function t(t){return o[t]||e[t]||null}function i(e,t){for(var i in a)if(a.hasOwnProperty(i)){var n=a[i];n[e]&&n[e].apply(n,t)}}function n(){for(var e=0;e<l.length;e++){var t=l[e][0],n=l[e][1];i(t,n)}}function r(){l.push.apply(l,arguments)}var o={},a={},s={};s.config=function(e,t){return o[e]=t,this},s.use=function(e){if(a[e])return a[e];var t={name:e,configuration:{},config:function(e,t){return this.configuration[e]=t,this},setAccount:function(e){return this.config("account",e)}};return a[e]=t,t};var l=[];s.start=function(){var e=[];for(var r in a)if(a.hasOwnProperty(r)){var o=t("packageName")+"/trackers/"+r;e.push(o)}window.require(e,function(){function e(){if(t--,0===t)n(),l={push:function(e){i(e[0],e[1])}}}for(var t=arguments.length,r=0;r<arguments.length;r++){var o=arguments[r],s=a[o.name].configuration,u=o.create(s);a[o.name]=u,u.load(e)}})};var u=require("./events");return s.include=function(e){if(u.hasOwnProperty(e))u[e](r);return this},s.includeAll=function(){for(var e in u)s.include(e);return this},s},exports}),define("er-track",["er-track/main"],function(e){return e}),define("er-track/loadScript",["require"],function(require){return function(e,t){var i=document.createElement("script");if(i.charset="utf-8",i.async=!0,i.src=e,t){var n=!1;i.onload=i.onreadystatechange=function(){if(!(n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))n=!0,t()}}var r=document.getElementsByTagName("script")[0];if(r&&r.parentNode)r.parentNode.insertBefore(i,r);else{var o=document.getElementsByTagName("head")[0]||document.body;o.insertBefore(i,o.firstChild)}}}),define("er-track/events",["require","er/events","er/Deferred","er/ajax"],function(require){return{pageView:function(e){require("er/events").on("redirect",function(t){e(["trackPageView",[t]])})},exception:function(e){require("er/Deferred").on("exception",function(t){e(["trackException",[t]])})},requestTimeout:function(e){require("er/ajax").on("timeout",function(t){var i=[t.options.url,t.options];e(["trackRequestTimeout",i])})},enterAction:function(e){require("er/events").on("enteractioncomplete",function(t){e(["trackEnterAction",[t]])})},leaveAction:function(e){require("er/events").on("leaveaction",function(t){e(["trackLeaveAction",[t]])})}}}),define("etpl/tpl",["require","exports","module","."],function(require,exports,module){var e=require(".");return{load:function(t,i,n){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open("GET",i.toUrl(t),!0),r.onreadystatechange=function(){if(4===r.readyState){if(r.status>=200&&r.status<300){var t=r.responseText,i=module.config();if(i.autoCompile||null==i.autoCompile)e.compile(t);n(t)}r.onreadystatechange=new Function,r=null}},r.send(null)}}}),define("er/tpl",["require","etpl/tpl"],function(require){return require("etpl/tpl")}),define("er/template",["require","etpl/main"],function(require){var e=require("etpl/main");return e.merge=function(t,i,n){var r="";try{var r=e.render(i,n)}catch(o){}if(t)t.innerHTML=r;return r},e}),define("er/Observable",["require","mini-event/EventTarget"],function(require){return require("mini-event/EventTarget")}),define("er/router",["require","./URL","eoo","mini-event/EventTarget","./locator","./events"],function(require){function e(e){for(var t=require("./URL").parse(e.url),i=t.getPath(),n=0;n<this.routes.length;n++){var r=this.routes[n];if(r.rule instanceof RegExp&&r.rule.test(i)||r.rule===i)return void r.handler.call(this,t)}if(this.backup)this.backup(t);this.getEventBus().fire("route",{url:t,router:this})}var exports={};exports.constructor=function(){this.routes=[],this.backup=null},exports.add=function(e,t){this.routes.push({rule:e,handler:t})},exports.setBackup=function(e){this.backup=e},exports.getLocator=function(){return this.locator},exports.setLocator=function(e){this.locator=e},exports.getEventBus=function(){return this.eventBus},exports.setEventBus=function(e){this.eventBus=e},exports.start=function(){this.getLocator().on("redirect",e,this)};var t=require("eoo").create(require("mini-event/EventTarget"),exports),i=new t;return i.setLocator(require("./locator")),i.setEventBus(require("./events")),i.Router=t,i}),define("er/main",["require","./controller","./router","./locator"],function(require){var e={version:"3.1.0-beta.5",start:function(){require("./controller").start(),require("./router").start(),require("./locator").start()}};return e}),define("er",["er/main"],function(e){return e}),define("er/Enum",["require","eoo"],function(require){var exports={};exports.constructor=function(){this.valueIndex=[],this.aliasIndex={},this.textIndex={};for(var e=0;e<arguments.length;e++){var t=arguments[e];if(null==t.value)t.value=e;this.addElement(t)}},exports.addElement=function(e){if(this.hasOwnProperty(e.value))throw new Error("Already defined an element with value"+e.value+" in this enum type");if(this.hasOwnProperty(e.alias))throw new Error('Already defined an element with alias "'+e.alias+'" in this enum type');this[e.value]=e.alias,this[e.alias]=e.value,this.valueIndex[e.value]=e,this.aliasIndex[e.alias]=e,this.textIndex[e.text]=e},exports.fromValue=function(e){return this.valueIndex[e]},exports.fromAlias=function(e){return this.aliasIndex[e]},exports.fromText=function(e){return this.textIndex[e]},exports.getTextFromValue=function(e){return this.fromValue(e).text},exports.getTextFromAlias=function(e){return this.fromAlias(e).text},exports.getValueFromAlias=function(e){return this.fromAlias(e).value},exports.getValueFromText=function(e){return this.fromText(e).value},exports.getAliasFromValue=function(e){return this.fromValue(e).alias},exports.getAliasFromText=function(e){return this.fromText(e).alias},exports.toArray=function(){var e=[];if(arguments.length>0)for(var t=0;t<arguments.length;t++){var i=arguments[t];if("string"==typeof i)e.push(this.fromAlias(i));else e.push(i)}else for(var t=0;t<this.valueIndex.length;t++)if(this.valueIndex[t])e.push(this.valueIndex[t]);return e};var e=require("eoo").create(exports);return e}),define("er/permission",[],function(){var e={},t={add:function(t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if("object"==typeof n)this.add(n);else e[i]=n}},isAllow:function(t){return!!e[t]}};return t}),define("er/datasource",["require","./util","./ajax","./permission"],function(require){var e={};return e.constant=function(e){return function(){return e}},e.remote=function(e,t){return function(i){if(t=require("./util").mix({url:e,dataType:"json"},t),"function"==typeof t.data)t.data=t.data(i);var n=require("./ajax");return n.request(t)}},e.permission=function(e){return function(){var t=require("./permission");return t.isAllow(e)}},e.defaultValue=function(e,t){return function(i,n){if(!n.name&&!t)throw new Error("No property name specified to determine whether value exists in this model");var r=t||n.name;return i.hasValue(r)?i.get(r):e}},e.convertTo=function(e,t){return function(i,n){if(!n.name&&!t)throw new Error("No property name specified to convert");var r=t||n.name,o=i.get(r);switch(e){case"number":return parseInt(o,10);case"string":return o+"";case"boolean":return!!o;default:return o}}},e}),define("er/URL",["require","./util","eoo"],function(require){var e=require("./util"),exports={};exports.constructor=function(i,n,r){i=i||"/",n=n||"",r=r||"~",this.toString=function(){return n?i+r+n:i},this.getPath=function(){return i},this.getSearch=function(){return n};var o=null;this.getQuery=function(i){if(!o)o=t.parseQuery(n);return i?o[i]:e.mix({},o)}},exports.compare=function(e){if("string"==typeof e)e=t.parse(e);var i={},n=this.getPath(),r=e.getPath();if(n===r)i.path=!1;else i.path={key:"path",self:n,other:r};var o=this.getQuery(),a=e.getQuery(),s={},l=[],u=!1;for(var c in o)if(o.hasOwnProperty(c)){var d=o[c],f=a[c];if(d!==f){u=!0;var h={key:c,self:d,other:f};l.push(h),s[c]=h}}for(var c in a)if(a.hasOwnProperty(c)&&!o.hasOwnProperty(c)){u=!0;var h={key:c,self:void 0,other:a[c]};l.push(h),s[c]=h}return i.queryDifference=l,i.query=u?s:!1,i};var t=require("eoo").create(exports);return t.parse=function(i,n){var r={querySeparator:"~"};n=e.mix(r,n);var o=i.indexOf(n.querySeparator);if(o>=0)return new t(i.slice(0,o),i.slice(o+1),n.querySeparator);else return new t(i,"",n.querySeparator)},t.withQuery=function(i,n,r){i+="";var o={querySeparator:"~"};r=e.mix(o,r);var a=i.indexOf(r.querySeparator)<0?r.querySeparator:"&",s=t.serialize(n),l=i+a+s;return t.parse(l,r)},t.parseQuery=function(e){for(var t=e.split("&"),i={},n=0;n<t.length;n++){var r=t[n];if(r){var o=r.indexOf("="),a=0>o?decodeURIComponent(r):decodeURIComponent(r.slice(0,o)),s=0>o?!0:decodeURIComponent(r.slice(o+1));if(i.hasOwnProperty(a)){if(s!==!0)i[a]=[].concat(i[a],s)}else i[a]=s}else;}return i},t.serialize=function(e){if(!e)return"";var t="";for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n)}return t.slice(1)},t.empty=new t,t}),define("er/controller",["require","./Deferred","./URL","./config","./util","./assert","mini-event/EventTarget","eoo","./locator","./router","./events","./permission"],function(require){function e(e,t,i){var n=e.childActionMapping[t.id];if(n){if(e.childActionMapping[t.id]=void 0,n.hijack)if(t.removeEventListener)t.removeEventListener("click",n.hijack,!1);else t.detachEvent("onclick",n.hijack);if(n.action){if(!i)i={url:null,referrer:n.url,container:t.id,isChildAction:!0};if(e.getEventBus().fire("leaveaction",{controller:e,action:n.action,to:i}),"function"==typeof n.action.leave)n.action.leave()}}}function t(t,i,n,r,o){if(e(t,i,o),i.addEventListener)i.addEventListener("click",r,!1);else i.attachEvent("onclick",r);var a={url:o.url,container:i.id,action:n,hijack:r};t.childActionMapping[i.id]=a;var s=require("mini-event/EventTarget");if(n instanceof s)n.on("leave",function(){e(t,i)})}var i=require("./Deferred"),n=require("./URL"),r=require("./config"),o=require("./util"),a=require("./assert"),exports={};exports.constructor=function(){this.actionPathMapping={},this.childActionMapping={},this.currentURL=null,this.currentAction=null,this.globalActionLoader=null,this.childActionLoaders={}},exports.registerAction=function(e){if(!e.hasOwnProperty("length"))e=[e];for(var t=0;t<e.length;t++){var i=e[t];a.hasProperty(i,"path",'action config should contains a "path" property'),this.actionPathMapping[i.path]=i}},exports.getDefaultTitle=function(){return this.defaultTitle},exports.setDefaultTitle=function(e){this.defaultTitle=e},exports.getRouter=function(){return this.router},exports.setRouter=function(e){this.router=e},exports.getLocator=function(){return this.locator},exports.setLocator=function(e){this.locator=e},exports.getEventBus=function(){return this.eventBus},exports.setEventBus=function(e){this.eventBus=e},exports.getPermissionProvider=function(){return this.permissionProvider},exports.setPermissionProvider=function(e){this.permissionProvider=e},exports.getMainContainer=function(){return this.mainContainer||r.mainElement},exports.setMainContainer=function(e){this.mainContainer=e},exports.getNoAuthorityLocation=function(){return this.noAuthorityLocation||r.noAuthorityLocation},exports.setNoAuthorityLocation=function(e){this.noAuthorityLocation=e},exports.getNotFoundLocation=function(){return this.notFoundLocation||r.notFoundLocation},exports.setNotFoundLocation=function(e){this.notFoundLocation=e},exports.start=function(){if(!this.getDefaultTitle())this.setDefaultTitle(r.systemName||document.title);this.getRouter().setBackup(o.bind(this.renderAction,this))},exports.findActionConfig=function(e){var t=e.url.getPath(),i=this.actionPathMapping[t];return i},exports.resolveActionConfig=function(e,t){return e},exports.checkAuthority=function(e,t){var i=e.authority;if(!i)return!0;var n=this.getPermissionProvider();if("function"==typeof i)return i(t,e,n);if("string"==typeof i)i=i.split("|");for(var r=0;r<i.length;r++)if(n.isAllow(o.trim(i[r])))return!0;return!1},exports.findEligibleActionConfig=function(e){var t=this.findActionConfig(e);if(t&&t.movedTo)return this.getEventBus().fire("actionmoved",{controller:this,url:e.url,config:t,movedTo:t.movedTo}),e.originalURL=e.url,e.url=n.parse(t.movedTo),this.findEligibleActionConfig(e);if(t&&t.childActionOnly&&!e.isChildAction)t=null;if(!t)if(this.getEventBus().fire("actionnotfound",o.mix({controller:this,failType:"NotFound",reason:"Not found"},e)),e.originalURL=e.url,e.url=n.parse(this.getNotFoundLocation()),!this.actionPathMapping[e.url.getPath()])return null;else return this.findEligibleActionConfig(e);var i=this.checkAuthority(t,e);if(!i){this.getEventBus().fire("permissiondenied",o.mix({controller:this,failType:"PermissionDenied",reason:"Permission denied",config:t},e));var r=t.noAuthorityLocation||this.getNoAuthorityLocation();return e.originalURL=e.url,e.url=n.parse(r),this.findEligibleActionConfig(e)}return t},exports.loadAction=function(e){var t=this.findEligibleActionConfig(e);if(t=this.resolveActionConfig(t,e),!t){var n=new i;return n.syncModeEnabled=!1,n.reject("no action configured for url "+e.url.getPath()),n.promise}if(t.title)e.title=t.title,e.args.title=t.title;if(t.documentTitle)e.documentTitle=t.documentTitle,e.args.documentTitle=t.documentTitle;if(t.args)for(var r in t.args)if(t.args.hasOwnProperty(r)){if(!e.args.hasOwnProperty(r))e.args[r]=t.args[r];if(!e.hasOwnProperty(r))e[r]=t.args[r]}var a=new i;a.syncModeEnabled=!1;var s=a.promise,l=!1,u=function(){if(!l)l=!0,this.getEventBus().fire("actionabort",o.mix({controller:this},e))};if(s.abort=o.bind(u,this),!e.isChildAction)this.currentURL=e.url;var c=function(n){if(!l){if(!n){var r="No action implement for "+t.type,s=o.mix({controller:this,failType:"NoModule",config:t,reason:r},e);return this.getEventBus().fire("actionfail",s),this.getEventBus().notifyError(s),void a.reject(r)}if(this.getEventBus().fire("actionloaded",{controller:this,url:e.url,config:t,action:n}),"function"==typeof n)a.resolve(new n,e);else if("function"==typeof n.createRuntimeAction){var u=function(i){if(!i){var n="Action factory returns non-action",r=o.mix({controller:this,failType:"InvalidFactory",
config:t,reason:n,action:i},e);this.getEventBus().fire("actionfail",r),this.getEventBus().notifyError(r),a.reject(n)}else a.resolve(i,e)};u=o.bind(u,this);var c=n.createRuntimeAction(e);i.when(c).then(u)}else a.resolve(n,e)}};if(c=o.bind(c,this),"string"==typeof t.type)window.require([t.type],c);else c(t.type);return s},exports.enterAction=function(e,t){if(!t.isChildAction){if(t.url!==this.currentURL)return;if(this.currentAction)if(this.getEventBus().fire("leaveaction",{controller:this,action:this.currentAction,to:o.mix({},t)}),"function"==typeof this.currentAction.leave)this.currentAction.leave();this.currentAction=e,document.title=t.title||t.documentTitle||this.getDefaultTitle()}this.getEventBus().fire("enteraction",o.mix({controller:this,action:e},t));var i=function(){this.getEventBus().fire("enteractioncomplete",o.mix({controller:this,action:e},t))};i=o.bind(i,this);var n=function(e){var i="";if(!e)i="Invoke action.enter() causes error";else if(e.message){if(i=e.message,e.stack)i+="\n"+e.stack}else if(window.JSON&&"function"==typeof JSON.stringify)try{i=JSON.stringify(e)}catch(n){i=e}else i=e;var r=o.mix({failType:"EnterFail",reason:i},t);this.getEventBus().fire("enteractionfail",r),this.getEventBus().notifyError(r)};n=o.bind(n,this);var r=e.enter(t);return r.then(i,n),r},exports.forward=function(e,t,i,n){var r={url:e,container:t,isChildAction:!!n};if(n){var s=this.childActionMapping[t];r.referrer=s?s.url:null}else r.referrer=this.currentURL;o.mix(r,i),r.args=o.mix({},r),o.mix(r.args,e.getQuery()),this.getEventBus().fire("forwardaction",o.mix({controller:this},r));var l=this.loadAction(r);return a.has(l,"loadAction should always return a Promise"),l},exports.renderAction=function(e){if("string"==typeof e)e=n.parse(e);if(this.globalActionLoader&&"function"==typeof this.globalActionLoader.abort)this.globalActionLoader.abort();if(this.currentAction&&"function"==typeof this.currentAction.filterRedirect&&this.currentAction.filterRedirect(e)===!1)return i.rejected("Redirect aborted by previous action");this.globalActionLoader=this.forward(e,this.getMainContainer(),null,!1);var t=this.getEventBus();return this.globalActionLoader.then(o.bind(this.enterAction,this)).fail(o.bind(t.notifyError,t))},exports.enterChildAction=function(i,n){function r(t,i,r){i=i||{};var t=u.resolveURL(t,i);if(i.global){var o=document.getElementById(n.container),a=u.redirect(t,i);if(a&&o)e(c,o);return a}var s=c.childActionMapping[n.container],l=t.toString()!==s.url.toString(),d=l||i.force;if(d)if(i.silent)s.url=t;else c.renderChildAction(t,s.container,r);return d}function a(e){if(e.isChildActionRedirected)return!0;for(var t=e.target||e.srcElement;t&&(!t.id||!c.childActionMapping[t.id]);)t=t.parentNode;if(t.id!==n.container)return e.isChildActionRedirected=!0,!0;else return!1}function s(e){e=e||window.event;var t=e.target||e.srcElement;if("a"===t.nodeName.toLowerCase()){var i=t.getAttribute("href",2)||"";if("#"===i.charAt(0))if(!a(e)){if(e.preventDefault)e.preventDefault();else e.returnValue=!1;for(var n=i.substring(1),s=(t.getAttribute("data-redirect")||"").split(/[,\s]/),l={},u=0;u<s.length;u++){var c=o.trim(s[u]);l[c]=!0}r(n,l)}}}this.childActionLoaders[n.container]=null;var l=document.getElementById(n.container);if(l){var u=this.getLocator(),c=this;return i.redirect=r,i.reload=function(e){this.redirect(n.url,{force:!0},e)},i.back=function(e,t){var i=this.context&&this.context.referrer,n=i||e;this.redirect(n,null,t)},t(this,l,i,s,n),this.enterAction(i,n)}},exports.renderChildAction=function(e,t,r){if(a.has(t),"string"==typeof e)e=n.parse(e);var s=this.childActionLoaders[t];if(s&&"function"==typeof s.abort)s.abort();var l=this.childActionMapping[t],u=l&&l.action;if(u&&"function"==typeof u.filterRedirect&&u.filterRedirect(e)===!1)return i.rejected("Redirect aborted by previous action");var c=this.forward(e,t,r,!0),d=this.getEventBus(),f=c.then(o.bind(this.enterChildAction,this)).fail(o.bind(d.notifyError,d));return f.abort=c.abort,this.childActionLoaders[t]=f,f};var s=require("eoo").create(require("mini-event/EventTarget"),exports),l=new s;return l.setLocator(require("./locator")),l.setRouter(require("./router")),l.setEventBus(require("./events")),l.setPermissionProvider(require("./permission")),l.Controller=s,l}),define("er/config",[],{mainElement:"main",indexURL:"/",systemName:"",noAuthorityLocation:"/401",notFoundLocation:"/404"}),define("er/locator",["require","./config","./events","mini-event/EventTarget"],function(require){function e(){var e=location.href.indexOf("#"),t=-1===e?"":location.href.slice(e);return t}function t(){var t=e();o.redirect(t)}function i(e){if(window.addEventListener)window.addEventListener("hashchange",t,!1);else if("onhashchange"in window&&document.documentMode>7)window.attachEvent("onhashchange",t);else s=setInterval(t,100);if(e)l=setTimeout(t,0)}function n(){if(s)clearInterval(s),s=null;if(l)clearTimeout(l),l=null;if(window.removeEventListener)window.removeEventListener("hashchange",t,!1);else if("onhashchange"in window&&document.documentMode>7)window.detachEvent("onhashchange",t)}function r(t,r){var o=a!==t;if(o&&e()!==t)if(r.silent)n(),location.hash=t,i(!1);else location.hash=t;return a=t,o}var o={},a="",s=0,l=1;return o.start=function(){i(!0)},o.stop=n,o.resolveURL=function(e){if(e+="",0===e.indexOf("#"))e=e.slice(1);if(!e||"/"===e)e=require("./config").indexURL;return e},o.redirect=function(e,t){t=t||{},e=o.resolveURL(e);var i,n=a;if(n.indexOf("targetId")>-1){var s=n.match(/[~&]targetId=([^&]*)/);if(s&&s[1])i=s[1]}if(i)if(-1===e.indexOf("targetId"))if(e.indexOf("~")>-1)e+="&targetId="+i;else e+="~targetId="+i;var l=r(e,t),u=l||t.force;if(u){if(!t.silent)o.fire("redirect",{url:e,referrer:n});require("./events").fire("redirect",{url:e,referrer:n})}return u},o.reload=function(){if(a)o.redirect(a,{force:!0})},require("mini-event/EventTarget").enable(o),o}),define("er/Action",["require","./util","./Deferred","./events","./locator","eoo","mini-event/EventTarget"],function(require){function e(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(!i.success)e.push(i)}return this.handleError(e)}var t=require("./util"),exports={};exports.constructor=function(){this.disposed=!1,this.initialize()},exports.initialize=t.noop,exports.context=null,exports.modelType=null,exports.viewType=null,exports.enter=function(i){this.context=i||{},this.fire("enter");var n=t.mix({},i&&i.args);if(this.model)this.model.fill(n);else this.model=this.createModel(n);if(this.fire("beforemodelload"),this.model&&"function"==typeof this.model.load){var r=this.model.load();return r.then(t.bind(this.forwardToView,this),t.bind(e,this))}else return this.forwardToView(),require("./Deferred").resolved(this)},exports.handleError=function(e){throw e},exports.createModel=function(e){if(this.modelType){var t=new this.modelType(e);return t}else return{}},exports.forwardToView=function(){if(this.disposed)return this;if(this.fire("modelloaded"),!this.view)this.view=this.createView();if(this.view){if(this.view.model=this.model,!this.view.container)this.view.container=this.context.container;this.fire("beforerender"),this.view.render(),this.fire("rendered"),this.initBehavior(),this.fire("entercomplete")}else{var e=require("./events");e.notifyError("No view attached to this action")}return this},exports.createView=function(){return this.viewType?new this.viewType:null},exports.initBehavior=t.noop,exports.filterRedirect=t.noop,exports.leave=function(){if(this.disposed)return this;if(this.disposed=!0,this.fire("beforeleave"),this.model){if("function"==typeof this.model.dispose)this.model.dispose();this.model=null}if(this.view){if("function"==typeof this.view.dispose)this.view.dispose();this.view=null}this.fire("leave"),this.destroyEvents()},exports.redirect=function(e,t){var i=require("./locator");i.redirect(e,t)},exports.reload=function(){var e=require("./locator");e.reload()},exports.back=function(e){var t=this.context&&this.context.referrer,i=t||e;if(i)this.redirect(i)};var i=require("eoo").create(require("mini-event/EventTarget"),exports);return i}),define("er/Deferred",["require","./util","./assert","eoo","mini-event/EventTarget"],function(require){function e(e){function t(){for(var t=0;t<i.length;t++){var n=i[t];try{n.apply(e.promise,e._args)}catch(r){}}}if("pending"!==e.state){var i="resolved"===e.state?e._doneCallbacks.slice():e._failCallbacks.slice();if(e.syncModeEnabled)t();else r(t);e._doneCallbacks=[],e._failCallbacks=[]}}function t(e,t,i,n){return function(){if("function"==typeof i){var r=t.resolver;try{var a=i.apply(e.promise,arguments);if(o.isPromise(a))a.then(r.resolve,r.reject);else r.resolve(a)}catch(s){o.fire("exception",{deferred:e,args:[s],reason:s}),r.reject(s)}}else t[n].apply(t,e._args)}}var i=require("./util"),n=require("./assert"),r="function"==typeof window.setImmediate?function(e){window.setImmediate(e)}:function(e){window.setTimeout(e,0)},exports={};exports.constructor=function(){this.state="pending",this._args=null,this._doneCallbacks=[],this._failCallbacks=[],this.promise={done:i.bind(this.done,this),fail:i.bind(this.fail,this),ensure:i.bind(this.ensure,this),then:i.bind(this.then,this)},this.promise.promise=this.promise,this.resolver={resolve:i.bind(this.resolve,this),reject:i.bind(this.reject,this)}},exports.syncModeEnabled=!1,exports.resolve=function(){if("pending"===this.state)this.state="resolved",this._args=[].slice.call(arguments),o.fire("resolve",{deferred:this,args:this._args,reason:this._args[0]}),e(this)},exports.reject=function(){if("pending"===this.state)this.state="rejected",this._args=[].slice.call(arguments),o.fire("reject",{deferred:this,args:this._args,reason:this._args[0]}),e(this)},exports.done=function(e){return this.then(e)},exports.fail=function(e){return this.then(null,e)},exports.ensure=function(e){return this.then(e,e)},exports.then=function(i,n){var r=new o;return r.syncModeEnabled=this.syncModeEnabled,this._doneCallbacks.push(t(this,r,i,"resolve")),this._failCallbacks.push(t(this,r,n,"reject")),e(this),r.promise};var o=require("eoo").create(exports);return require("mini-event/EventTarget").enable(o),o.isPromise=function(e){return e&&"function"==typeof e.then},o.all=function(){function e(e){a--,n.greaterThanOrEquals(a,0,"workingCount should be positive");var t=[].slice.call(arguments,1);if(t.length<=1)t=t[0];if(l[e]=t,0===a)u[s].apply(u,l)}function t(){s="reject",e.apply(this,arguments)}var r=[].concat.apply([],arguments),a=r.length;if(!a)return o.resolved();for(var s="resolve",l=[],u=new o,c=0;c<r.length;c++){var d=r[c];d.then(i.bind(e,d,c),i.bind(t,d,c))}return u.promise},o.resolved=function(){var e=new o;return e.resolve.apply(e,arguments),e.promise},o.rejected=function(){var e=new o;return e.reject.apply(e,arguments),e.promise},o.when=function(e){if(o.isPromise(e))return e;var t=new o;return t.syncModeEnabled=!0,t.resolve(e),t.promise},o.require=function(e){var t=new o;return window.require(e,t.resolver.resolve),t.promise.abort=t.resolver.reject,t.promise},o}),define("ef/ViewPanel",["require","underscore","esui/Control","esui/painters","er/Deferred","mini-event","eoo","esui"],function(require){function e(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});t.type="view@"+e.type,this.fire(t)}function t(){return this.viewContext.id+"-"+this.id}var i=require("underscore"),n=require("esui/Control"),exports={};exports.type="ViewPanel",exports.repaint=require("esui/painters").createRepaint(n.prototype.repaint,{name:"viewType",paint:function(e,t){e.disposeView();var n=require("er/Deferred"),r=n.require([t]);r.then(i.bind(e.fire,e,"viewloaded")),e.view=r.then(i.bind(e.renderView,e))}}),exports.disposeView=function(){var e=this.get("view");if(e&&"function"==typeof e.dispose)e.dispose();this.view=null},exports.renderView=function(i){if(this.helper.isInStage("RENDERED")){this.loadedViewModule=i;var n=this.view="function"==typeof i?new i:i;n.name=t.call(this),n.model=this.get("model"),n.container=this.main.id,n.render(),this.fire("viewrendered"),n.on("*",e,this)}return this.view},exports.refresh=function(){var e=this.get("loadedViewModule");if(!e)throw new Error("No view module loaded yet");this.disposeView(),this.renderView(e)};var r=require("eoo").create(n,exports);return require("esui").register(r),r}),function(e){function t(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}function i(){this.raw=[],this.length=0}function n(){return"___"+S++}function r(e,t){var i=new Function;i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function o(e){return k[e]}function a(e){return'"'+e.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function s(e){return e.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(e){return"\\"+e})}function l(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,i){return t[i-0+1]})}function u(e){return e=e.replace(/^\s*\*/,""),l('gv({0},["{1}"])',a(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return"."+t}).split(".").join('","'))}function c(e,t,i,n,r,o){for(var a=i.length,s=e.split(t),l=0,u=[],c=0,d=s.length;d>c;c++){var f=s[c];if(c){var h=1;for(l++;;){var p=f.indexOf(i);if(0>p){u.push(l>1&&h?t:"",f);break}if(l=n?l-1:0,u.push(l>0&&h?t:"",f.slice(0,p),l>0?i:""),f=f.slice(p+a),h=0,0===l)break}if(0===l)r(u.join("")),o(f),u=[]}else f&&o(f)}if(l>0&&u.length>0)o(t),o(u.join(""))}function d(e,t,i){var n,r=[],o=t.options,s="",l="",f="",h="";if(i)s="ts(",l=")",f=L,h=I,n=o.defaultFilter;return c(e,o.variableOpen,o.variableClose,1,function(e){if(i&&e.indexOf("|")<0&&n)e+="|"+n;var o=e.indexOf("|"),a=(o>0?e.slice(0,o):e).replace(/^\s+/,"").replace(/\s+$/,""),c=o>0?e.slice(o+1):"",p=0===a.indexOf("*"),m=[p?"":s,u(a),p?"":l];if(c){c=d(c,t);for(var g=c.split("|"),v=0,y=g.length;y>v;v++){var b=g[v];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(b)){if(m.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)m.push(",",RegExp.$3);m.push(")")}}}r.push(f,m.join(""),h)},function(e){r.push(f,i?a(e):e,h)}),r.join("")}function f(e,t){this.value=e,this.engine=t}function h(e,t){this.value=e,this.engine=t,this.children=[],this.cloneProps=[]}function p(e,t){var i=e.stack,n=t?i.find(function(e){return e instanceof t}):i.bottom();if(n){for(var r;(r=i.top())!==n;){if(!r.autoClose)throw new Error(r.type+" must be closed manually: "+r.value);r.autoClose(e)}n.close(e)}return n}function m(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,h.call(this,e,t),this.blocks={}}function g(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,h.call(this,e,t),this.cloneProps=["name"]}function v(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,h.call(this,e,t),this.cloneProps=["name","state","blocks"],this.blocks={}}function y(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.expr=RegExp.$2,h.call(this,e,t),this.cloneProps=["name","expr"]}function b(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,h.call(this,e,t),this.cloneProps=["name","args"]}function C(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,h.call(this,e,t),this.cloneProps=["name","args"]}function E(e,t){var i=new RegExp(l("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",s(t.options.variableOpen),s(t.options.variableClose)),"i");if(!i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,h.call(this,e,t),this.cloneProps=["list","item","index"]}function x(e,t){h.call(this,e,t)}function w(e,t){x.call(this,e,t)}function D(e,t){h.call(this,e,t)}function B(e,t){t.target=e;var i=t.engine,n=e.name;if(i.targets[n])switch(i.options.namingConflict){case"override":i.targets[n]=e,t.targets.push(n);case"ignore":break;default:throw new Error("Target exists: "+n)}else i.targets[n]=e,t.targets.push(n)}function A(e,t){O[e]=t,t.prototype.type=e}function T(e){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(e),this.targets={},this.filters=t({},N)}function F(e,t){function n(){var e;if(d.length>0&&(e=d.join(""))){var i=new f(e,t);if(i.beforeAdd(u),l.top().addChild(i),d=[],t.options.strip&&u.current instanceof h)i.value=e.replace(/^[\x20\t\r]*\n/,"");u.current=i}}var r,o=t.options.commandOpen,a=t.options.commandClose,s=t.options.commandSyntax,l=new i,u={engine:t,targets:[],stack:l,target:null},d=[];return c(e,o,a,0,function(e){var i=s.exec(e);if(i&&(r=O[i[2].toLowerCase()])&&"function"==typeof r){n();var l=u.current;if(t.options.strip&&l instanceof f)l.value=l.value.replace(/\r?\n[\x20\t]*$/,"\n");if(i[1])l=p(u,r);else{if(l=new r(i[3],t),"function"==typeof l.beforeOpen)l.beforeOpen(u);l.open(u)}u.current=l}else if(!/^\s*\/\//.test(e))d.push(o,e,a);r=null},function(e){d.push(e)}),n(),p(u),u.targets}i.prototype={push:function(e){this.raw[this.length++]=e},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(e){for(var t=this.length;t--;){var i=this.raw[t];if(e(i))return i}}};var S=178245,k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},N={html:function(e){return e.replace(/[&<>"']/g,o)},url:encodeURIComponent,raw:function(e){return e}},_='var r="";',L="r+=",I=";",R="return r;";if("undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)_="var r=[],ri=0;",L="r[ri++]=",R='return r.join("");';f.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return"";else return d(e,this.engine,1)},clone:function(){return this}},h.prototype={addChild:function(e){this.children.push(e)},open:function(e){var t=e.stack.top();t&&t.addChild(this),e.stack.push(this)},close:function(e){if(e.stack.top()===this)e.stack.pop()},getRendererBody:function(){for(var e=[],t=this.children,i=0;i<t.length;i++)e.push(t[i].getRendererBody());return e.join("")},clone:function(){for(var e=new this.constructor(this.value,this.engine),t=0,i=this.children.length;i>t;t++)e.addChild(this.children[t].clone());for(var t=0,i=this.cloneProps.length;i>t;t++){var n=this.cloneProps[t];e[n]=this[n]}return e}};var P='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';r(m,h),r(g,h),r(v,h),r(y,h),r(b,h),r(C,h),r(E,h),r(x,h),r(w,x),r(D,x);var M={READING:1,READED:2,APPLIED:3,READY:4};v.prototype.applyMaster=m.prototype.applyMaster=function(e){function t(e){var n=e.children;if(n instanceof Array)for(var r=0,o=n.length;o>r;r++){var a=n[r];if(a instanceof g&&i[a.name])a=n[r]=i[a.name];t(a)}}if(this.state>=M.APPLIED)return 1;var i=this.blocks,n=this.engine.targets[e];if(n&&n.applyMaster(n.master))return this.children=n.clone().children,t(this),this.state=M.APPLIED,1;else return void 0},m.prototype.isReady=function(){function e(n){for(var r=0,o=n.children.length;o>r;r++){var a=n.children[r];if(a instanceof v){var s=t.targets[a.name];i=i&&s&&s.isReady(t)}else if(a instanceof h)e(a)}}if(this.state>=M.READY)return 1;var t=this.engine,i=1;if(this.applyMaster(this.master))return e(this),i&&(this.state=M.READY),i;else return void 0},m.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[P,_,this.getRendererBody(),R].join("\n")),t=this.engine;return this.renderer=function(i){return e(i,t)},this.renderer}return null},m.prototype.open=function(e){p(e),h.prototype.open.call(this,e),this.state=M.READING,B(this,e)},y.prototype.open=C.prototype.open=function(e){e.stack.top().addChild(this)},g.prototype.open=function(e){h.prototype.open.call(this,e),(e.imp||e.target).blocks[this.name]=this},w.prototype.open=function(e){var t=new D;t.open(e);var i=p(e,x);i.addChild(this),e.stack.push(this)},D.prototype.open=function(e){var t=p(e,x);t.addChild(this),e.stack.push(this)},v.prototype.open=function(e){this.parent=e.stack.top(),this.target=e.target,h.prototype.open.call(this,e),this.state=M.READING,e.imp=this},C.prototype.close=y.prototype.close=function(){},v.prototype.close=function(e){h.prototype.close.call(this,e),this.state=M.READED,e.imp=null},m.prototype.close=function(e){h.prototype.close.call(this,e),this.state=this.master?M.READED:M.APPLIED,e.target=null},v.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0;for(var i in this.blocks)this.target.blocks[i]=this.blocks[i];this.blocks={},this.close(e)},C.prototype.beforeOpen=v.prototype.beforeOpen=y.prototype.beforeOpen=E.prototype.beforeOpen=b.prototype.beforeOpen=g.prototype.beforeOpen=x.prototype.beforeOpen=f.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new m(n(),e.engine);t.open(e)}},v.prototype.getRendererBody=function(){return this.applyMaster(this.name),h.prototype.getRendererBody.call(this)},C.prototype.getRendererBody=function(){return l("{0}engine.render({2},{{3}}){1}",L,I,a(this.name),d(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,i){return(t||"")+a(i)+":"}))},y.prototype.getRendererBody=function(){if(this.expr)return l("v[{0}]={1};",a(this.name),d(this.expr,this.engine));else return""},x.prototype.getRendererBody=function(){return l("if({0}){{1}}",d(this.value,this.engine),h.prototype.getRendererBody.call(this))},D.prototype.getRendererBody=function(){return l("}else{{0}",h.prototype.getRendererBody.call(this))},E.prototype.getRendererBody=function(){return l('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',n(),d(this.list,this.engine),a(this.index||n()),a(this.item),n(),n(),h.prototype.getRendererBody.call(this))},b.prototype.getRendererBody=function(){var e=this.args;return l("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",_,R,L,I,h.prototype.getRendererBody.call(this),a(this.name),e?","+d(e,this.engine):"")};var O={};A("target",m),A("block",g),A("import",v),A("use",C),A("var",y),A("for",E),A("if",x),A("elif",w),A("else",D),A("filter",b),T.prototype.config=function(e){t(this.options,e)},T.prototype.compile=T.prototype.parse=function(e){if(e){var t=F(e,this);if(t.length)return this.targets[t[0]].getRenderer()}return new Function('return ""')},T.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0},T.prototype.render=function(e,t){var i=this.getRenderer(e);if(i)return i(t);else return""},T.prototype.addFilter=function(e,t){if("function"==typeof t)this.filters[e]=t};var U=new T;if(U.Engine=T,"object"==typeof exports&&"object"==typeof module)exports=module.exports=U;else if("function"==typeof define&&define.amd)define("etpl/main",[],U);else e.etpl=U}(this),define("etpl",["etpl/main"],function(e){return e}),define("er/View",["require","./util","./Model","etpl","eoo","mini-event/EventTarget"],function(require){var e=require("./util"),exports={};exports.constructor=function(){this.initialize()},exports.initialize=e.noop,exports.template="",exports.getTemplateName=function(){return this.template||""},exports.model=null,exports.container="",exports.getContainerElement=function(){return e.getElement(this.container)||null},exports.getTemplateData=function(){var e=this.model;if(e&&"function"!=typeof e.get){var t=require("./Model");e=new t(e)}var i=function(t){for(var i=t.replace(/\[(\d+)\]/g,".$1").split("."),n=i.shift(),r=e.get(n);r&&(n=i.shift());)r=r[n];return r};return{get:i,relatedModel:e}},exports.render=function(){var e=this.getContainerElement();if(!e){var t=this.model&&"function"==typeof this.model.get&&this.model.get("url");throw new Error("Container not found when rendering "+(t?'"'+t+'"':"view"))}var i=require("etpl"),n=i.render(this.getTemplateName(),this.getTemplateData());e.innerHTML=n,this.enterDocument()},exports.enterDocument=require("./util").noop,exports.dispose=function(){var e=this.getContainerElement();e&&(e.innerHTML="")};var t=require("eoo").create(require("mini-event/EventTarget"),exports);return t}),define("ef/UIView",["require","underscore","er/View","ef/ActionDialog","esui","esui/Dialog","esui/main","esui/ViewContext","eoo"],function(require){function e(e,t){for(var i=e,n=0;n<t.length;n++)i=i[t[n]];return i}function t(e,t,i,n){if("string"==typeof n)n=e[n];if("function"!=typeof n)return n;var r=e.get(t);if(r)r.on(i,n,e);return n}function i(){return"ef-"+o++}var n=require("underscore"),r=require("er/View");require("ef/ActionDialog");var exports={};exports.replaceValue=function(t){if("string"!=typeof t)return t;if("@@"===t||"**"===t)return this.model;var i=t.charAt(0),n=t.substring(1);if("@"===i||"*"===i){var r=n.split("."),o=this.model.get(r[0]);return r.length>1?e(o,r.slice(1)):o}return t},exports.get=function(e){try{return this.viewContext.get(e)}catch(t){}},exports.getSafely=function(e){return this.viewContext.getSafely(e)},exports.getGroup=function(e){return this.viewContext.getGroup(e)},exports.create=function(e,t){if(t=t||{},!t.viewContext)t.viewContext=this.viewContext;return require("esui").create(e,t)},exports.alert=function(e,t){var i="string"==typeof e?{title:t||document.title,content:e}:n.clone(e);if(!i.viewContext)i.viewContext=this.viewContext;var r=require("esui/Dialog");return r.alert(i)},exports.confirm=function(e,t){var i="string"==typeof e?{title:t||document.title,content:e}:n.clone(e);if(!i.viewContext)i.viewContext=this.viewContext;var r=require("esui/Dialog");return r.confirm(i)},exports.popActionDialog=function(e){var t=document.createElement("div");document.body.appendChild(t);var i={width:600,needFoot:!1,draggable:!0,closeOnHide:!0,autoClose:!0,main:t,viewContext:this.viewContext};e=n.defaults({},e,i);var r=require("esui/main"),o=r.create("ActionDialog",e);return o.render(),o.show(),o},exports.uiEvents=null,exports.getUIEvents=function(){return this.uiEvents||{}},exports.uiProperties=null,exports.getUIProperties=function(){return this.uiProperties},exports.bindEvents=function(){var e=this.getUIEvents();if(e)n.each(e,function(e,t){this.bindUIEvent(t,e)},this)},exports.bindUIEvent=function(e,i){var r=e.split(":");if(r.length>1){var o=r[0],a=r[1];t(this,o,a,i)}else{var s=i;if("object"!=typeof s)return;n.each(s,function(i,n){t(this,e,n,i)},this)}};var o=8785925;exports.getViewName=function(){if(this.name)return this.name;var e=this.constructor&&this.constructor.name;if(!e&&this.constructor){var t=this.constructor.toString(),n=/function\s+([^\(]*)/.exec(t);e=n&&n[1].replace(/\s+$/g,"")}if(!e)e=i();if(e=e.replace(/View$/,""),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},exports.createViewContext=function(){var e=require("esui/ViewContext"),t=this.getViewName();return new e(t||null)},exports.enterDocument=function(){this.viewContext=this.createViewContext();var e=this.getContainerElement(),t={viewContext:this.viewContext,properties:this.getUIProperties(),valueReplacer:n.bind(this.replaceValue,this)};try{require("esui").init(e,t)}catch(i){var r=new Error("ESUI initialization error on view because: "+i.message);throw r.actualError=i,r}this.bindEvents()},exports.dispose=function(){if(this.viewContext)this.viewContext.dispose(),this.viewContext=null;this.$super(arguments)};var a=require("eoo").create(r,exports);return a}),define("er/util",[],function(){var e=+new Date,t={};t.guid=function(){return"er"+e++},t.mix=function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i){for(var n in i)if(i.hasOwnProperty(n))e[n]=i[n]}else;}return e};var i=Function.prototype.bind;t.bind=i?function(e){return i.apply(e,[].slice.call(arguments,1))}:function(e,t){var i=[].slice.call(arguments,2);return function(){var n=i.concat([].slice.call(arguments));return e.apply(t,n)}},t.noop=function(){};var n=!{toString:1}.propertyIsEnumerable("toString");t.inherits=function(e,t){var i=function(){};i.prototype=t.prototype;var r=new i,o=e.prototype;e.prototype=r;for(var a in o)r[a]=o[a];if(n){if(o.hasOwnProperty("toString"))r.toString=o.toString;if(o.hasOwnProperty("valueOf"))r.valueOf=o.valueOf}return e.prototype.constructor=e,e},t.parseJSON=function(e){if(!e)return void 0;if(window.JSON&&"function"==typeof JSON.parse)return JSON.parse(e);else return new Function("return ("+e+");")()};var r=/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g;return t.trim=function(e){return e.replace(r,"")},t.encodeHTML=function(e){return e+="",e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},t.getElement=function(e){if("string"==typeof e)e=document.getElementById(e);return e},t}),define("er/Model",["require","./util","./Deferred","eoo","mini-event/EventTarget"],function(require){function e(e,t){function i(i){if(t.dump)e.fill(i,u);else e.set(t.name,i,u);return{success:!0,name:t.name,options:t,value:i}}function n(e){return{success:!1,name:t.name,options:t,error:e}}try{var r=t.retrieve(e,t);if(l.isPromise(r)){if("function"==typeof r.abort)e.addPendingWorker(r);return r.then(i,function(t){t=n(t);try{var r=e.handleError(t);return i(r)}catch(o){if(o.success===!1)throw o;else throw n(o)}})}else{var o=i(r);return l.resolved(o)}}catch(a){var s=n(a);return l.rejected(s)}}function t(e,t){for(var i=l.resolved(),r=0;r<t.length;r++){var o=t[r],a=s.bind(n,null,e,o);i=i.then(a)}return i}function i(e,t){var i=[];for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];if("function"==typeof o)o={retrieve:o,name:r};else if("function"==typeof o.retrieve)o=s.mix({name:r},o);i.push(n(e,o))}return l.all(i)}function n(n,r){if(!r)return l.resolved();if("function"==typeof r){var o={retrieve:r,dump:!0};return e(n,o)}if(r instanceof Array)return t(n,r);if("function"==typeof r.retrieve)return e(n,r);else return i(n,r)}function r(e,t){for(var i=0;i<e.pendingWorkers.length;i++)if(e.pendingWorkers[i]===t)return void e.pendingWorkers.splice(i,1)}function o(){function e(e){var t={success:!1,name:"$prepare",options:{},error:e};throw t}try{var t=this.prepare();if(l.isPromise(t))return t.fail(e);else return t}catch(i){e(i)}}function a(e,t,i){var n=e.store.hasOwnProperty(t)?"change":"add",r=e.store[t];if(e.store[t]=i,r!==i)return{type:n,name:t,oldValue:r,newValue:i};else return null}var s=require("./util"),l=require("./Deferred"),u={silent:!0},exports={};exports.constructor=function(e){if(this.store={},this.pendingWorkers=[],e)this.fill(e,u);this.initialize()},exports.initialize=s.noop,exports.addPendingWorker=function(e){this.pendingWorkers.push(e),e.ensure(s.bind(r,null,this,e))},exports.datasource=null,exports.getDatasource=function(){return this.datasource},exports.load=function(){try{var e=this.getDatasource(),t=n(this,e);return t.then(s.bind(o,this))}catch(i){return l.rejected(i)}},exports.prepare=s.noop,exports.get=function(e){return this.store[e]},exports.set=function(e,t,i){i=i||{};var n=a(this,e,t);if(n&&!i.silent){var r={changes:[n]};this.fire("change",r)}return t},exports.fill=function(e,t){t=t||{};var i=[];for(var n in e)if(e.hasOwnProperty(n)){var r=a(this,n,e[n]);if(r)i.push(r)}if(i.length&&!t.silent){var o={changes:i};this.fire("change",o);
}return e},exports.remove=function(e,t){if(this.store.hasOwnProperty(e)){t=t||{};var i=this.store[e];if(delete this.store[e],!t.silent){var n={changes:[{type:"remove",name:e,oldValue:i,newValue:void 0}]};this.fire("change",n)}return i}},exports.getAsModel=function(e){var t=this.get(e);if(!t||"[object Object]"!=={}.toString.call(t))return new c;else return new c(t)},exports.dump=function(){return s.mix({},this.store)},exports.has=function(e){return this.store.hasOwnProperty(e)},exports.hasValue=function(e){return this.has(e)&&null!=this.store[e]},exports.hasReadableValue=function(e){return this.hasValue(e)&&""!==this.store[e]},exports.valueOf=function(){return this.dump()},exports.clone=function(){return new c(this.store)},exports.handleError=function(e){throw e},exports.dispose=function(){if(this.pendingWorkers){for(var e=0;e<this.pendingWorkers.length;e++){var t=this.pendingWorkers[e];if("function"==typeof t.abort)try{t.abort()}catch(i){}}this.pendingWorkers=null}};var c=require("eoo").create(require("mini-event/EventTarget"),exports);return c}),define("ef/UIModel",["require","er/Model","eoo"],function(require){function e(e){return e+="",1===e.length?"0"+e:e}var t=require("er/Model"),exports={},i={date:function(t){return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())},dateRange:function(e){return i.date(e.begin)+","+i.date(e.end)},time:function(t){return i.date(t)+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},timeRange:function(e){return i.time(e.begin)+","+i.time(e.end)}};exports.formatters={},exports.set=function(e,t,i){if(this.formatters.hasOwnProperty(e))t=this.formatters[e](t);this.$super([e,t,i])},exports.fill=function(e,t){for(var i in e)if(e.hasOwnProperty(i)&&this.formatters.hasOwnProperty(i)){var n=this.formatters[i],r=e[i];e[i]=n(r)}this.$super(arguments)},exports.getPart=function(e){if("[object Array]"!==Object.prototype.toString.call(e))e=[].slice.call(arguments);for(var t={},i=0;i<e.length;i++){var n=e[i];t[n]=this.get(n)}return t};var n=require("eoo").create(t,exports);return n.formatters=i,n}),define("er/assert",[],function(){if(window.DEBUG){var e=function(e,t){if(!e)throw new Error(t)};return e.has=function(t,i){e(null!=t,i)},e.equals=function(t,i,n){e(t===i,n)},e.hasProperty=function(t,i,n){e(null!=t[i],n)},e.lessThan=function(t,i,n){e(i>t,n)},e.greaterThan=function(t,i,n){e(t>i,n)},e.lessThanOrEquals=function(t,i,n){e(i>=t,n)},e.greaterThanOrEquals=function(t,i,n){e(t>=i,n)},e}else{var e=function(){};return e.has=e,e.equals=e,e.hasProperty=e,e.lessThan=e,e.greaterThan=e,e.lessThanOrEquals=e,e.greaterThanOrEquals=e,e}}),define("er/ajax",["require","./assert","./util","./Deferred","eoo","mini-event/EventTarget"],function(require){function e(e,t){for(var i=e?encodeURIComponent(e):"",n=[],r=0;r<t.length;r++){var o=t[r];n[r]=this.serializeData("",o)}return i?i+"="+n.join(","):n.join(",")}function t(e,t){if(1===arguments.length)t=e,e="";if(null==t)t="";var i=this.serializeData.getKey,n=e?encodeURIComponent(e):"",r=Object.prototype.toString.call(t);switch(r){case"[object Array]":return this.serializeArray(e,t);case"[object Object]":var o=[];for(var a in t){var s=i(a,e),l=this.serializeData(s,t[a]);o.push(l)}return o.join("&");default:return n?n+"="+encodeURIComponent(t):encodeURIComponent(t)}}var i="_";t.getKey=function(e,t){return t?t+"."+e:e};var exports={};exports.constructor=function(){this.hooks={serializeData:t,serializeArray:e},this.config={cache:!1,timeout:0,charset:""}},exports.request=function(e){if("function"==typeof this.hooks.beforeExecute)this.hooks.beforeExecute(e);var t=require("./assert");t.hasProperty(e,"url","url property is required");var n={method:"POST",data:{},cache:this.config.cache,timeout:this.config.timeout,charset:this.config.charset},r=require("./util");e=r.mix(n,e);var o=require("./Deferred"),a=new o;if("function"==typeof this.hooks.beforeCreate){var s=this.hooks.beforeCreate(e,a);if(s===!0){var l=a.promise;return l.abort=function(){},l.setRequestHeader=function(){},l}}var u=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");r.mix(u,e.xhrFields);var l=a.promise,c={abort:function(){u.onreadystatechange=null;try{u.abort()}catch(e){}if(!l.status)l.status=0;l.readyState=u.readyState,l.responseText="",l.responseXML="",a.reject(l)},setRequestHeader:function(e,t){u.setRequestHeader(e,t)},getAllResponseHeaders:function(){return u.getAllResponseHeaders()},getResponseHeader:function(e){return u.getResponseHeader(e)},getRequestOption:function(t){return e[t]}};r.mix(l,c);var d={xhr:l,options:e};l.then(r.bind(this.fire,this,"done",d),r.bind(this.fire,this,"fail",d));var f=function(){if(4===u.readyState){var t=l.status||u.status;if(1223===t)t=204;if(l.status=l.status||t,l.readyState=u.readyState,l.responseText=u.responseText,l.responseXML=u.responseXML,"function"==typeof this.hooks.afterReceive)this.hooks.afterReceive(l,e);if(200>t||t>=300&&304!==t)return void a.reject(l);var i=u.responseText;if("json"===e.dataType)try{i=r.parseJSON(i)}catch(n){return l.error=n,void a.reject(l)}if("function"==typeof this.hooks.afterParse)try{i=this.hooks.afterParse(i,l,e)}catch(n){return l.error=n,void a.reject(l)}a.resolve(i)}};u.onreadystatechange=r.bind(f,this);var h=e.method.toUpperCase(),p={};if("GET"===h)r.mix(p,e.data);if(e.cache===!1)p[i]=+new Date;var m=this.hooks.serializeData("",p,"application/x-www-form-urlencoded"),g=e.url;if(m){var v=g.indexOf("?")>=0?"&":"?";g+=v+m}if(u.open(h,g,!0),"function"==typeof this.hooks.beforeSend)this.hooks.beforeSend(l,e);if("GET"===h)u.send();else{var y=e.contentType||"application/x-www-form-urlencoded",m=this.hooks.serializeData("",e.data,y,l);if(e.charset)y+=";charset="+e.charset;u.setRequestHeader("Content-Type",y),u.send(m)}if(e.timeout>0){var b=function(){this.fire("timeout",{xhr:l,options:e}),l.status=408,l.abort()},C=setTimeout(r.bind(b,this),e.timeout);l.ensure(function(){clearTimeout(C)})}return l},exports.get=function(e,t,i){var n={method:"GET",url:e,data:t,cache:i||this.config.cache};return this.request(n)},exports.getJSON=function(e,t,i){var n={method:"GET",url:e,data:t,dataType:"json",cache:i||this.config.cache};return this.request(n)},exports.post=function(e,t,i){var n={method:"POST",url:e,data:t,dataType:i||"json"};return this.request(n)},exports.log=function(e,t){var i=new Image,n=window.ER_LOG_POOL||(window.ER_LOG_POOL={}),r=+new Date;n[r]=i,i.onload=i.onerror=i.onabort=function(){i.onload=i.onerror=i.onabort=null,n[r]=null,i=null};var o=this.hooks.serializeData("",t,"application/x-www-form-urlencoded");if(o){var a=e.indexOf("?")>=0?":":"?";e+=a+o}i.src=e};var n=require("eoo").create(require("mini-event/EventTarget"),exports),r=new n;return r.Ajax=n,r}),define("ef/RemoteTreeStrategy",["require","esui/TreeStrategy","er/ajax","eoo"],function(require){function e(e,t,i){var n=i.node;if(n.children)return void e.expandNode(n.id);var r=e.workingRequests[n.id];if(r)r.abort();r=this.requestNodeData(n),e.workingRequests[n.id]=r,r.done(lib.bind(e.expandNode,e,n.id))}var t=require("esui/TreeStrategy"),exports={};exports.constructor=function(e){if(e.requestMethod)e.requestMethod=e.requestMethod.toLowerCase();t.apply(this,arguments),this.workingRequests={}},exports.urlTemplate="",exports.requestMethod="get",exports.getRequestURL=function(e){return lib.format(this.urlTemplate,e)},exports.getRequestData=function(e){return null},exports.requestNodeData=function(e){var t=this.getRequestURL(e),i=this.getRequestData(e),n=require("er/ajax");return"get"===this.requestMethod?n.getJSON(t,i,this.useCache||!1):n.post(t,i,"json")},exports.enableToggleStrategy=function(t){t.on("expand",lib.curry(e,t,this)),t.on("collapse",function(e){this.collapseNode(e.node.id,!1)})};var i=require("eoo").create(t,exports);return i}),void function(e){e("eoo/oo",[],function(){function e(){return e.create.apply(e,arguments)}function t(t){var i=function(){return i.prototype.constructor.apply(this,arguments)};o.prototype=t.prototype;var n=i.prototype=new o;if(n.$self=i,!("$super"in n))n.$super=e.prototype.$super;return i.$superClass=t,i}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e,t){for(var n in e)i(e,n)&&t(e[n],n,e);if(l)for(var r=u.length-1;r>-1;--r){var o=u[r];i(e,o)&&t(e[o],o,e)}}function r(){return this.prototype.constructor.toString()}var o=function(){},a="__eooName__",s="__eooOwner__";e.create=function(i,o){if(o=o||{},i=i||e,"object"==typeof i)o=i,i=e;var l=t(i),u=l.prototype;return n(o,function(e,t){if("function"==typeof e)e[a]=t,e[s]=l;u[t]=e}),l.toString=r,l},e["static"]="function"==typeof Object.create?Object.create:function(e){if(arguments.length>1)throw new Error("Second argument not supported");return o.prototype=e,new o},e.toString=function(){return"function Class() { [native code] }"},e.prototype={constructor:function(){},$self:e,$superClass:Object,$super:function(e){var t=this.$super.caller,i=t[a],n=t[s].$superClass,r=n.prototype[i];if("function"!=typeof r)throw new TypeError("Call the super class's "+i+", but it is not a function!");return r.apply(this,e)}};var l=!{toString:1}.propertyIsEnumerable("toString"),u=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"];return e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),void function(e,t){e("eoo/defineAccessor",["require"],function(require){function e(e){var t="return typeof this."+i+" === 'object' ? this."+i+"['"+e+"'] : undefined;";return new Function(t)}function t(e){var t="this."+i+" = this."+i+" || {};\nthis."+i+"['"+e+"'] = value;";return new Function("value",t)}var i="__eooPrivateMembers__";return function(i,n,r){var o=n.charAt(0).toUpperCase()+n.slice(1),a="get"+o,s="set"+o;if(!r)i[a]=!r||"function"!=typeof r.get?e(n):r.get,i[s]=!r||"function"!=typeof r.set?t(n):r.set;else"function"==typeof r.get&&(i[a]=r.get),"function"==typeof r.set&&(i[s]=r.set)}})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),void function(e){e("eoo/main",["require","./oo","./defineAccessor"],function(require){var e=require("./oo");return e.defineAccessor=require("./defineAccessor"),e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),define("eoo",["eoo/main"],function(e){return e}),define("er/events",["require","eoo","mini-event/EventTarget"],function(require){var exports={};exports.notifyError=function(e){if("string"==typeof e)e=new Error(e);return this.fire("error",{error:e}),e};var e=require("eoo").create(require("mini-event/EventTarget"),exports),t=new e;return t.EventBus=e,t}),define("ef/ActionPanel",["require","er/events","esui/Panel","mini-event","er/Deferred","esui/painters","er/controller","eoo","esui"],function(require){function e(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});t.type="action@"+e.type,this.fire(t)}function t(t){if(t.isChildAction&&t.container===this.main.id){if(this.action=t.action,this.action.on("enter",this.enterAction,this),"function"==typeof this.action.on)this.action.on("*",e,this);this.fire("actionattach")}}function i(e){if(e.isChildAction&&e.container===this.main.id)this.fire("actionloaded")}function n(e){if(e.isChildAction&&e.container===this.main.id)this.action=null,this.fire("actionloadfail",{failType:e.failType,reason:e.reason})}function r(e){if(e.isChildAction&&e.container===this.main.id)this.fire("actionloadabort")}var o=require("er/events"),a=require("esui/Panel"),exports={};exports.type="ActionPanel",exports.setContent=function(){},exports.actionType=null,exports.action=null,exports.initStructure=function(){o.on("enteraction",t,this),o.on("enteractioncomplete",i,this),o.on("actionnotfound",n,this),o.on("permissiondenied",n,this),o.on("actionfail",n,this),o.on("enteractionfail",n,this),o.on("actionabort",r,this)},exports.enterAction=function(){this.url=this.action.context.url.toString()},exports.disposeAction=function(){var t=require("er/Deferred"),i=this.action;if(i){if(t.isPromise(i)&&"function"==typeof i.abort)i.abort();else{if("function"==typeof i.un)i.un("*",e,this);if("function"==typeof i.leave)i.leave()}this.action=null}},exports.repaint=require("esui/painters").createRepaint(a.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,i){if(e.disposeAction(),t)if(!e.lazy||!e.helper.isInStage("INITED")){var n=require("er/controller");if(e.action=n.renderChildAction(t,e.main.id,i),"function"!=typeof e.action.abort)e.action=null}}}),exports.dispose=function(){this.disposeAction(),o.un("enteraction",t,this),o.un("enteractioncomplete",i,this),o.un("actionnotfound",n,this),o.un("permissiondenied",n,this),o.un("actionfail",n,this),o.un("enteractionfail",n,this),o.un("actionabort",r,this),this.$super(arguments)},exports.reload=function(e){var t=this.url;this.url=null,this.setProperties({url:t,actionOptions:e})};var s=require("eoo").create(a,exports);return require("esui").register(s),s}),define("ef/ActionDialog",["require","esui/main","esui/Dialog","./ActionPanel","mini-event","esui/painters","eoo","esui"],function(require){var e=require("esui/main"),t=require("esui/Dialog");require("./ActionPanel");var exports={};exports.type="ActionDialog",exports.styleType="Dialog",exports.setContent=function(){},exports.createBF=function(t,i){if(i)this.content=i.innerHTML;else i=document.createElement("div"),this.main.appendChild(i);this.helper.addPartClasses(t+"-panel",i);var n={main:i},r="Panel";if("body"===t)n.url=this.url,n.actionOptions=this.actionOptions,r="ActionPanel";var o=e.create(r,n);if("body"===t){o.on("actionattach",function(){if(this.autoClose){var e=this.get("action");if("function"==typeof e.on)e.on("handlefinish",!1),e.on("handlefinish",this.dispose,this)}this.fire("actionattach")},this),o.on("actionloaded",function(){this.resize()},this),o.on("*",function(e){if(0===e.type.indexOf("action@"))this.fire(e)},this);var a=require("mini-event");a.delegate(o,this,"actionloaded"),a.delegate(o,this,"actionloadfail"),a.delegate(o,this,"actionloadabort")}return o.render(),this.addChild(o,t),o},exports.repaint=require("esui/painters").createRepaint(t.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,i){var n=e.getBody(),r={url:t,actionOptions:i};n.setProperties(r)}}),exports.getAction=function(){var e=this.getBody();if(e)return e.get("action");else return null},exports.reload=function(){var e=this.getBody();if(e)e.reload()};var i=require("eoo").create(t,exports);return require("esui").register(i),i}),define("startup/ria",[],{});